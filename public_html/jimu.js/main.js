// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/LoadingIndicator esri/config esri/tasks/GeometryService".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e){function t(c,e){var b=f.clone(c),g=a.widgetProperties;"undefined"===typeof e&&(e=!1);delete b.mode;a.visitElement(b,function(c,v){c.widgets?(delete c.isOnScreen,
delete c.gid,"jimu.js/images/group_icon.png"===c.icon&&delete c.icon,delete c.openType,v.isOnScreen&&c.panel&&a.isEqual(c.panel,b.widgetOnScreen.panel)&&delete c.panel):(c.icon&&c.icon===c.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete c.icon,delete c.panel,delete c.folderUrl,delete c.amdFolder,delete c.thumbnail,delete c.configFile,delete c.gid,delete c.isOnScreen,delete c.isRemote,g.forEach(function(a){delete c[a]}),e?"undefined"===typeof c.openAtStart&&(c.openAtStart=!1):(c.visible&&
delete c.visible,c.manifest&&c.label===c.manifest.label&&delete c.label,c.isDefaultConfig&&(delete c.config,delete c.isDefaultConfig)),delete c.manifest)});delete b.rawAppConfig;delete b._ssl;delete b.getConfigElementById;delete b.getConfigElementsByName;delete b.processNoUriWidgets;delete b.addElementId;delete b.getCleanConfig;delete b.visitElement;delete b.agolConfig;delete b._itemData;delete b.oldWabVersion;return b}var c=null,u;u=p(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,
portalSelf:null,constructor:function(c){this.urlParams=c||{};this.listenBuilderEvents();this.versionManager=new l;this.widgetManager=n.getInstance();this.configLoader=s.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&(window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(b);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic))&&
window.parent.setPreviewViewerTopic(b);a.isMobileUa()||q(window,"resize",f.hitch(this,this._onWindowResize));q(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){b.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));b.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));b.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));b.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));
b.subscribe("builder/mapChanged",f.hitch(this,this._onMapChanged));b.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));b.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));b.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));b.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));b.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));b.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));
b.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));b.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));b.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));b.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));b.subscribe("builder/appProxyForUrlChanged",f.hitch(this,this._onAppProxyForUrlChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode)){var c=
new h;c.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(e){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(e);window.appInfo.isRunInMobile=a.inMobileSize();console.timeEnd("Load Config");e=this.getAppConfig();c.destroy();b.publish("appConfigLoaded",e);return e}),f.hitch(this,function(a){c.destroy();console.error(a);a&&(a.message&&"string"===typeof a.message)&&this._showErrorMessage(a.message)}))}},_showErrorMessage:function(c){d.create("div",
{"class":"app-error",innerHTML:c},document.body)},getAppConfig:function(){var c;window.appInfo.isRunInMobile?(c=f.clone(this._getMobileConfig(this.appConfig)),c._originConfig=f.clone(this.appConfig)):c=f.clone(this.appConfig);c.getConfigElementById=function(c){return a.getConfigElementById(this,c)};c.getConfigElementsByName=function(c){return a.getConfigElementsByName(this,c)};c.getCleanConfig=function(c){return this._originConfig?t(this._originConfig,c):t(this,c)};c.visitElement=function(c){a.visitElement(this,
c)};return c},_onOrientationChange:function(){this.appConfig&&b.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var c=a.inMobileSize();window.appInfo.isRunInMobile!==c&&(window.appInfo.isRunInMobile=c,this.appConfig&&b.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(c){return a.mixinAppConfigPosition(c,c.mobileLayout)},_onWidgetChanged:function(c){var e=a.reCreateObject(c);c=a.getConfigElementById(this.appConfig,
c.id);!1===e.inPanel&&!c.uri&&(e.closeable=!0);for(var g in e)c[g]=e[g];delete c.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"widgetChange",e)},_onGroupChanged:function(c){var e=a.reCreateObject(c);c=a.getConfigElementById(this.appConfig,c.id);for(var g in e)c[g]=e[g];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),
"groupChange",e)},_onWidgetPoolChanged:function(c){var e=a.reCreateObject(c);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=e.widgets,this.appConfig.widgetPool.groups=e.groups):(c=a.getConfigElementById(this.appConfig,e.controllerId),k.forEach(c.controlledWidgets,function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this),k.forEach(c.controlledGroups,function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this),this.appConfig.widgetPool.widgets=
"undefined"===typeof this.appConfig.widgetPool.widgets?e.widgets:this.appConfig.widgetPool.widgets.concat(e.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?e.groups:this.appConfig.widgetPool.groups.concat(e.groups),this.configLoader.addNeedValues(this.appConfig),c.controlledWidgets=k.map(e.widgets,function(c){return c.id}),c.controlledGroups=k.map(e.groups,function(c){return c.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,
function(c){this.appConfig=c;this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",e)}))},_removeWidgetOrGroupFromPoolById:function(c,a){k.some(c.widgetPool.widgets,function(e,b){if(e.id===a)return c.widgetPool.widgets.splice(b,1),!0});k.some(c.widgetPool.groups,function(e,b){if(e.id===a)return c.widgetPool.groups.splice(b,1),!0})},_onOpenAtStartChanged:function(c){var e=a.reCreateObject(c),g=this.appConfig;c.isOnScreen?(g=g.widgetOnScreen&&g.widgetOnScreen.widgets)&&
0<g.length&&k.forEach(g,f.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((g=g.widgetPool)&&(g.groups&&0<g.groups.length)&&k.forEach(g.groups,f.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),g&&(g.widgets&&0<g.widgets.length)&&k.forEach(g.widgets,f.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));b.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",e)},_onAppAttributeChanged:function(c){c=
a.reCreateObject(c);f.mixin(this.appConfig,c);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"attributeChange",c)},_onLoadingPageChanged:function(c){c=a.reCreateObject(c);var e;"backgroundColor"in c?this.appConfig.loadingPage.backgroundColor=c.backgroundColor:"backgroundImage"in c?(e=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=
f.mixin(e,c.backgroundImage)):"loadingGif"in c&&(e=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=f.mixin(e,c.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",c)},_onAppProxyForMapChanged:function(c){c=a.reCreateObject(c);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==c.mapItemId?this.appConfig.map.appProxy=c:k.forEach(c.proxyItems,
f.hitch(this,function(c){k.some(this.appConfig.map.appProxy.proxyItems,function(a){if(a.sourceUrl===c.sourceUrl)return a.useProxy=c.useProxy,a.proxyUrl=c.proxyUrl||"",a.proxyId=c.proxyId||"",!0})})):this.appConfig.map.appProxy=c;b.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",c)},_onAppProxyForUrlChanged:function(c){c=a.reCreateObject(c);this.appConfig.appProxies=c;b.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",c)},_onTemplateConfigChanged:function(c){c=a.reCreateObject(c);
this.appConfig.templateConfig=c;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",c)},_onMapChanged:function(c){var e=a.reCreateObject(c);this.appConfig.map.mapOptions&&a.deleteMapOptions(this.appConfig.map.mapOptions);f.mixin(this.appConfig.map,e);this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(c){this.appConfig=
c;this._addDefaultValues(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"mapChange",e)}))},_onMapOptionsChanged:function(c){c=a.reCreateObject(c);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,c);b.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",c)},_onThemeChanged:function(c){this._getAppConfigFromTheme(c).then(f.hitch(this,function(a){this.appConfig=a;b.publish("appConfigChanged",this.getAppConfig(),"themeChange",
c.getName())}))},_onLayoutChanged:function(c){this.appConfig=a.mixinAppConfigPosition(this.appConfig,c.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);b.publish("appConfigChanged",this.getAppConfig(),"layoutChange",c.name)},_onStyleChanged:function(c){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,c.name);c.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:c.styleColor}:delete this.appConfig.theme.customStyles;b.publish("appConfigChanged",this.getAppConfig(),
"styleChange",c.name)},_onSyncExtent:function(c){b.publish("syncExtent",c)},_genStyles:function(c,a){var e=[];e.push(a);k.forEach(c,function(c){0>e.indexOf(c)&&e.push(c)});return e},_getAppConfigFromTheme:function(c){var a=new m,e,b=[],b=this.getAppConfig().getCleanConfig();b.mode=this.urlParams.mode;k.forEach(b.widgetPool.groups,function(c){delete c.panel},this);if(c.appConfig)e=f.clone(c.appConfig),e.map=b.map,e.map.position=c.appConfig.map.position,this._copyPoolToThemePool(b,e),e.links=b.links,
e.title=b.title,e.subtitle=b.subtitle,e.logo=b.logo;else{var g=c.getCurrentLayout(),h=c.getCurrentStyle();e=f.clone(b);g=f.clone(g.layoutConfig);e.widgetOnScreen=g.widgetOnScreen;g.widgetPool&&(k.forEach(g.widgetPool.widgets,function(c){c.isPreconfiguredInTheme=!0}),k.forEach(g.widgetPool.groups,function(c){c.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(b,g);e.widgetPool=g.widgetPool;g.map&&g.map.position&&(e.map.position=g.map.position);e.mobileLayout=g.mobileLayout;b=this._genStyles(k.map(c.getStyles(),
function(c){return c.name}),h.name);e.theme={name:c.getName(),styles:b,version:c.getVersion()}}this.configLoader.addNeedValues(e);this.configLoader.loadWidgetsManifest(e).then(f.hitch(this,function(c){return this.configLoader.loadAndUpgradeAllWidgetsConfig(c)})).then(f.hitch(this,function(){this._addDefaultValues(e);a.resolve(e)}));return a},_copyPoolToThemePool:function(c,a){var e=c.widgetPool;a.widgetPool||(a.widgetPool={});var b=a.widgetPool,g=k.filter(b.widgets,function(c){if(c.isPreconfiguredInTheme||
!k.some(e.widgets,function(a){return a.name===c.name}))return!0}),h=k.filter(b.groups,function(c){return c.isPreconfiguredInTheme}),r=k.filter(e.widgets,function(c){return!c.isPreconfiguredInTheme}),l=k.filter(e.groups,function(c){return!c.isPreconfiguredInTheme}),r=this._getPoolWidgetsWithoutDuplicated(r,a.widgetOnScreen.widgets||[]);b.widgets=r.concat(g);b.groups=l.concat(h)},_getPoolWidgetsWithoutDuplicated:function(c,e){for(var b=f.clone(c),g=this.getAppConfig(),h=c.length-1;0<=h;h--)for(var r=
e.length-1;0<=r;r--)if(e[r].uri){var l=e[r].name;l||(l=a.getWidgetNameFromUri(e[r].uri));var t=g.getConfigElementById(c[h].id);c[h]&&(c[h].name===l&&!1===t.supportMultiInstance)&&(console.log("Widget",c[h].name,"is not copied to new theme because this widget exists in new theme."),b.splice(h,1))}return b},_onAppConfigSet:function(c){c=a.reCreateObject(c);window.appInfo.isRunInMobile=a.inMobileSize();this.configLoader.processProxy(c);this.configLoader.addNeedValues(c);this.configLoader.loadAndUpgradeAllWidgetsConfig(c).then(f.hitch(this,
function(c){this._addDefaultValues(c);g.setPortalUrl(c.portalUrl);window.portalUrl=c.portalUrl;this.appConfig?(a.deleteMapOptions(c.map.mapOptions),this.appConfig=c,b.publish("appConfigChanged",this.getAppConfig(),"resetConfig",c)):(this.appConfig=c,b.publish("appConfigLoaded",this.getAppConfig()))}))},_addDefaultValues:function(c){this._addDefaultPortalUrl(c);this._addDefaultGeometryService(c);this._addDefaultStyle(c);this._addDefaultMap(c);this._addDefaultVisible(c);"undefined"===typeof c.widgetOnScreen&&
(c.widgetOnScreen={});"undefined"===typeof c.widgetPool&&(c.widgetPool={});this._addDefaultPanelAndPosition(c);this._addDefaultOfWidgetGroup(c);(c.widgetPool.widgets&&0<c.widgetPool.widgets.length&&void 0===c.widgetPool.widgets[0].index||c.widgetPool.groups&&0<c.widgetPool.groups.length&&void 0===c.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(c);return c},_addDefaultPortalUrl:function(c){"undefined"===typeof c.portalUrl&&(c.portalUrl="http://www.arcgis.com/");c.portalUrl&&"/"!==c.portalUrl.substr(c.portalUrl.length-
1)&&(c.portalUrl+="/")},_addDefaultGeometryService:function(c){var a=c&&c.geometryService,a=a&&"string"===typeof a&&f.trim(a)?f.trim(a):this.portalSelf.helperServices.geometry.url;c.geometryService=a;r.defaults.geometryService=new e(c.geometryService)},_addDefaultStyle:function(c){if(c.theme&&(!c.theme.styles||0===c.theme.styles.length))c.theme.styles=["default"]},_addDefaultMap:function(c){c.map.id="map";"undefined"===typeof c.map["3D"]&&"undefined"===typeof c.map["2D"]&&(c.map["2D"]=!0);"undefined"===
typeof c.map.position&&(c.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof c.map.portalUrl&&(c.map.portalUrl=c.portalUrl)},_addDefaultVisible:function(c){a.visitElement(c,function(c){void 0===c.visible&&(c.visible=!0)})},_addDefaultPanelAndPosition:function(c){this._addOnScreenDefaultPanelAndPosition(c);this._addPoolDefaultPanelAndPosition(c)},_addOnScreenDefaultPanelAndPosition:function(c){var a,e;if(c=c.widgetOnScreen){a=c.panel&&c.panel.positionRelativeTo?c.panel.positionRelativeTo:
"map";"undefined"===typeof c.panel||"undefined"===typeof c.panel.uri?c.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof c.panel.position?c.panel.position={relativeTo:a}:"undefined"===typeof c.panel.position.relativeTo&&(c.panel.position.relativeTo=a);if(c.widgets)for(a=0;a<c.widgets.length;a++)c.widgets[a].position||(c.widgets[a].position={}),c.widgets[a].position.relativeTo||(c.widgets[a].position.relativeTo=c.widgets[a]&&c.widgets[a].positionRelativeTo?c.widgets[a].positionRelativeTo:
"map"),!0===c.widgets[a].inPanel&&!c.widgets[a].panel&&(c.widgets[a].panel=f.clone(c.panel),c.widgets[a].panel.position=c.widgets[a].position,c.widgets[a].panel.position.relativeTo=c.widgets[a].position.relativeTo);if(c.groups)for(a=0;a<c.groups.length;a++){c.groups[a].panel||(c.groups[a].panel=c.panel);c.groups[a].panel&&!c.groups[a].panel.position&&(c.groups[a].panel.position={});c.groups[a].panel.position.relativeTo||(c.groups[a].panel.position.relativeTo=c.groups[a].panel.positionRelativeTo?c.groups[a].panel.positionRelativeTo:
"map");c.groups[a].widgets||(c.groups[a].widgets=[]);for(e=0;e<c.groups[a].widgets.length;e++)c.groups[a].widgets[e].panel=c.groups[a].panel}}},_addPoolDefaultPanelAndPosition:function(c){var a,e,b=c.widgetPool;if(b){a=b.panel&&b.panel.positionRelativeTo?b.panel.positionRelativeTo:"map";"undefined"===typeof b.panel||"undefined"===typeof b.panel.uri?b.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof b.panel.position?b.panel.position={relativeTo:a}:"undefined"===typeof b.panel.position.relativeTo&&
(b.panel.position.relativeTo=a);if(b.groups)for(a=0;a<b.groups.length;a++){b.groups[a].panel?b.groups[a].panel.position.relativeTo||(b.groups[a].panel.position.relativeTo=b.groups[a].panel.positionRelativeTo?b.groups[a].panel.positionRelativeTo:"map"):b.groups[a].panel=b.panel;b.groups[a].widgets||(b.groups[a].widgets=[]);for(e=0;e<b.groups[a].widgets.length;e++)b.groups[a].widgets[e].panel=b.groups[a].panel}if(b.widgets)for(a=0;a<b.widgets.length;a++)!1===b.widgets[a].inPanel?(e=b.widgets[a].positionRelativeTo?
b.widgets[a].positionRelativeTo:"map",b.widgets[a].position?b.widgets[a].position.relativeTo||(b.widgets[a].position.relativeTo=e):b.widgets[a].position={relativeTo:e}):b.widgets[a].panel||(b.widgets[a].panel=c.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(c){a.visitElement(c,f.hitch(this,function(c,a){c.isOnScreen=a.isOnScreen;c.widgets?(c.gid=c.id,1===c.widgets.length?(c.label||(c.label=c.widgets[0].label?c.widgets[0].label:"Group"),c.icon||(c.icon=c.widgets[0].uri?this._getDefaultIconFromUri(c.widgets[0].uri):
"jimu.js/images/group_icon.png")):(c.icon=c.icon?c.icon:"jimu.js/images/group_icon.png",c.label=c.label?c.label:"Group_"+a.index)):c.gid=a.groupId}))},_getDefaultIconFromUri:function(c){c=c.split("/");c.pop();return c.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(c){var a=0,e,b;if(c.widgetPool.widgets)for(e=0;e<c.widgetPool.widgets.length;e++)c.widgetPool.widgets[e].index=a,a++;if(c.widgetPool.groups)for(e=0;e<c.widgetPool.groups.length;e++){c.widgetPool.groups[e].index=
a;a++;for(b=0;b<c.widgetPool.groups[e].widgets.length;b++)c.widgetPool.groups[e].widgets[b].index=b}}});u.getInstance=function(a){null===c?c=new u(a):a&&(c.urlParams=a,c.configLoader&&(c.configLoader.urlParams=a));window.getAppConfig=f.hitch(c,c.getAppConfig);return c};return u})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C,E,F,G,I,R,O,P,K,J,L){function Q(c,a){c=c||"";for(var e=0,b=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!z.file.isEnabledFlash(),failure:[c+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){e++;e===b.length&&a()}}],g=0;g<b.length;g++)testLoad(b[g])}function M(c,a){var e=c.match(/url\([^)]+\)/gi),b,g;if(null===e||""===a)return c;for(b=0;b<e.length;b++)if(g=e[b].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=g.length){var h=
g[2];a.endWith("/")||(a+="/");c=c.replace(g[1]+h+g[3],g[1]+a+h+g[3])}return c}function H(c,a){var e=Array.isArray(a),b=e&&[]||{};e?(c=c||[],b=b.concat(c),a.forEach(function(a,e){"undefined"===typeof c[e]?b[e]=a:"object"===typeof a?b[e]=H(c[e],a):-1===c.indexOf(a)&&b.push(a)})):(c&&"object"===typeof c&&Object.keys(c).forEach(function(a){b[a]=c[a]}),Object.keys(a).forEach(function(e){b[e]="object"!==typeof a[e]||!a[e]?a[e]:c[e]?H(c[e],a[e]):a[e]}));return b}function N(c,a,e){a=function(c){var a=[];
c.split("_").forEach(function(c){var e=!1,b;"--"===c.slice(c.length-2)&&(e=!0,c=c.slice(0,c.length-2));b=c.search(/\[[0-9]+\]/);-1===b&&(b=c.length);a.push({key:c.slice(0,b),index:Number(c.slice(b+1,-1)),deleteFlag:e})});return a}(a);for(var b=1;b<a.length-1;b++)if(c=p.isArray(c[a[b].key])?c[a[b].key][a[b].index]:c[a[b].key],!c)return;if(a[a.length-1].deleteFlag)!0===e&&(p.isArray(c[a[a.length-1].key])?delete c[a[a.length-1].key][a[a.length-1].index]:delete c[a[a.length-1].key]);else if(p.isArray(c[a[a.length-
1].key])){if(void 0===e)return c[a[a.length-1].key][a[a.length-1].index];c[a[a.length-1].key][a[a.length-1].index]=e}else{if(void 0===e)return c[a[a.length-1].key];c[a[a.length-1].key]=e}}function U(c,a,e){function b(e){e=z.template.getSearchRange(a,e,"]");var g=a.slice(e.firstPos,e.lastPos);return-1!==e.firstPos?(g=a.slice(e.firstPos+g.indexOf("[")+1,e.lastPos-1),e=a.slice(e.lastPos+1),(g=z.getConfigElementById(c,g))?{object:g,key:"section_"+e,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}
var g=c,h=a=a.replace(/\//g,"_"),r=b("groups\\[.+\\]");if("deleted"!==r.state&&("isSection"===r.state&&(g=r.object,h=r.key),r=b("widgets\\[.+\\]"),"delete"!==r.state))return"isSection"===r.state&&(g=r.object,h=r.key),N(g,h,e)}var z={},aa={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};p.mixin(z,L);window.atob||(window.atob=function(c){c=t.decode(c);for(var a="",e=0,b=c.length;e<b;e++)a+=String.fromCharCode(c[e]);return a});window.btob||(window.btob=
function(c){for(var a=[],e=0,b=c.length;e<b;e++)a.push(String.charCodeAt(c[e]));return t.encode(a)});var W="unload",Y=[];require.on("error",function(c){f.forEach(Y,function(a){c.info[0]&&-1<c.info[0].indexOf(a.resKey)&&a.def.reject(c);for(var e in c.info)-1<e.indexOf(a.resKey)&&a.def.reject(c)})});z.checkError=function(c,a){Y.push({resKey:c,def:a})};z.replacePlaceHolder=function(c,a){var e=s.stringify(c),b=e.match(/\$\{(\w)+\}/g),g;if(null===b)return c;for(g=0;g<b.length;g++){var h=b[g].match(/(\w)+/g)[0];
a[h]&&(e=e.replace(b[g],a[h]))}return s.parse(e)};z.changeUnit=function(c){var a=Math.abs(c),e;c=Math.floor(a);e=Math.floor(60*(a-c));a=(60*(60*(a-c)-e)).toFixed(2);return c+"\u00b0"+(10>e?"0"+e:e)+"'"+(10>a?"0"+a:a)+'"'};z.formatTime=function(c){var a=c/1E3;c=Math.floor(a/60);a=Number(a-60*c).toFixed(1);return(10>c?"0"+c:c)+":"+(10>a?"0"+a:a)};z.parseTime=function(c){var a=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!a.test(c))return console.log("wrong time format."),-1;c=c.match(a);return 1E3*(60*parseInt(c[1],
10)+parseInt(c[2],10)+parseInt(c[3],10)/10)};z.preloadImg=function(c,a){var e=[],e="string"===typeof c?[c]:c;f.forEach(e,function(c){(new Image).src=a?a+c:c})};var T=null;z.getImagesSize=function(c){var a=new n;if(!c||0!==c.indexOf("http"))return a.reject(),a;null===T&&(T=k.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var e=l(T,"load",function(){clearTimeout(b);b=null;e.remove();var c=k.getContentBox(T);1===c.w&&1===c.h||0===c.w||0===
c.h?a.reject():a.resolve([c.w,c.h])},{}),b=setTimeout(function(){clearTimeout(b);b=null;a.reject()},5E3);k.setAttr(T,"src",c);return a};z.getPositionStyle=function(c){var a={};if(!c)return a;c=p.clone(c);if(window.isRTL){var e;"undefined"!==typeof c.left&&"undefined"!==typeof c.right?(e=c.left,c.left=c.right,c.right=e):"undefined"!==typeof c.left?(c.right=c.left,delete c.left):"undefined"!==typeof c.right&&(c.left=c.right,delete c.right);"undefined"!==typeof c.paddingLeft&&"undefined"!==typeof c.paddingRight?
(e=c.paddingLeft,c.paddingLeft=c.paddingRight,c.paddingRight=e):"undefined"!==typeof c.paddingLeft?(c.paddingRight=c.paddingLeft,delete c.paddingLeft):"undefined"!==typeof c.paddingRight&&(c.paddingLeft=c.paddingRight,delete c.paddingRight)}e="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var b=0;b<e.length;b++){var g=e[b];"number"===typeof c[g]?a[g]=c[g]+"px":"undefined"!==typeof c[g]?a[g]=c[g]:"padding"===g.substr(0,7)?a[g]=0:a[g]="auto"}a.zIndex=
"undefined"===typeof c.zIndex?"auto":c.zIndex;return a};z.isEqual=function(c,a){function e(c,a){var h;if(null===c&&null===a||"undefined"===typeof c&&"undefined"===typeof a)return!0;if(null===c&&null!==a||null===a&&null!==c||"undefined"===typeof c&&"undefined"!==typeof a||"undefined"===typeof a&&"undefined"!==typeof c)return!1;if(isNaN(c)&&isNaN(a)&&"number"===typeof c&&"number"===typeof a||c===a)return!0;if("function"===typeof c&&"function"===typeof a||c instanceof Date&&a instanceof Date||c instanceof
RegExp&&a instanceof RegExp||c instanceof String&&a instanceof String||c instanceof Number&&a instanceof Number)return c.toString()===a.toString();if(-1<b.indexOf(c)||-1<g.indexOf(a))return!1;if(null!==a){for(h in a)if(a.hasOwnProperty(h)!==c.hasOwnProperty(h)||typeof a[h]!==typeof c[h])return!1;for(h in c){if(a.hasOwnProperty(h)!==c.hasOwnProperty(h)||typeof a[h]!==typeof c[h])return!1;switch(typeof c[h]){case "object":case "function":b.push(c);g.push(a);if(!e(c[h],a[h]))return!1;b.pop();g.pop();
break;default:if(isNaN(c[h])&&isNaN(a[h])&&"number"===typeof c[h]&&"number"===typeof a[h])return!0;if(c[h]!==a[h])return!1}}}return!0}var b,g;b=[];g=[];return!e(c,a)?!1:!0};z.file={loadFileAPI:function(){var c=new n;if("unload"===W){var a=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:a+"libs/polyfills/fileAPI/",flashUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};Q(a,p.hitch(this,function(){W="loaded";
c.resolve()}));W="loading"}else"loaded"===W&&c.resolve();return c},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return d("safari")&&6>d("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var c=null;if(document.all)try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){c=null}else navigator.plugins&&0<navigator.plugins.length&&(c=navigator.plugins["Shockwave Flash"]);return!!c},
containSeparator:function(c){return 0<=c.indexOf("/")?!0:0<=c.indexOf("\\")?!0:!1},getNameFromPath:function(c){var a="",a=0<=c.indexOf("/")?"/":"\\";c=c.split(a);return 0<c.length?c[c.length-1]:null},getFolderFromPath:function(c){return c.substr(0,c.length-z.file.getNameFromPath(c).length)},readFile:function(c,a,e,b){if(this.supportHTML5()){var g=c.target.files[0];g&&(g.type.match(a)?g.size>=e?b({errCode:"exceed"}):(c=new FileReader,c.onload=function(c){b(null,g.name,c.target.result)},c.readAsDataURL(g)):
b({errCode:"invalidType"}))}else if(this.supportFileAPI()){var h=window.FileAPI.getFiles(c);h[0].type.match(a)?h[0].size>=e?b({errCode:"exceed"}):window.FileAPI.readAsDataURL(h[0],function(c){c&&c.result?b(null,h[0].name,c.result):b({errCode:"readError"})}):b({errCode:"invalidType"})}}};z.getUriInfo=function(c){var a,e={};a=c.indexOf("/");c.substring(0,a);a=c.substring(0,c.lastIndexOf("/")+1);e.folderUrl=require(z.getRequireConfig()).toUrl(a);e.amdFolder=a;e.url=e.folderUrl;if(/^http(s)?:\/\//.test(c)||
/^\/\//.test(c))e.isRemote=!0;return e};z.widgetJson=function(){return{addManifest2WidgetJson:function(c,a){p.mixin(c,a.properties);c.name=a.name;c.label||(c.label=a.label);c.manifest=a;c.isRemote=a.isRemote;c.isRemote&&(c.itemId=a.itemId);a.featureActions&&(c.featureActions=a.featureActions);c.icon||(c.icon=a.icon);c.thumbnail||(c.thumbnail=a.thumbnail);c.folderUrl=a.folderUrl;c.amdFolder=a.amdFolder},removeManifestFromWidgetJson:function(c){if(c.manifest){for(var a in c.manifest.properties)c[a]=
void 0;c.name=void 0;c.label=void 0;c.featureActions=void 0;c.manifest=void 0}}}}();z.getRequireConfig=function(){if(jimuConfig){var c=[];jimuConfig.widgetsPackage&&(c=c.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(c=c.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(c=c.concat(jimuConfig.configsPackage));return{packages:c}}return{}};z.getTypeByGeometryType=function(c){var a="",e="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
b=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(c)?a="point":0<=e.indexOf(c)?a="polyline":0<=b.indexOf(c)&&(a="polygon");return a};z.getSymbolTypeByGeometryType=function(c){var a=null;c=z.getTypeByGeometryType(c);"point"===c?a="marker":"polyline"===c?a="line":"polygon"===c&&(a="fill");return a};z.getServices=function(){return aa};z.getArcGISDefaultGeometryService=function(){return new C(aa.geometryService)};z.restoreToDefaultWebMapExtent=
function(c,a,e){var b=new n;if(!(c&&"esri.Map"===c.declaredClass))return setTimeout(function(){b.reject("Invalid map.")},0),b;a=a&&a.itemInfo;if(!a)return setTimeout(function(){b.reject("Invalid itemInfo")},0),b;a=a.item&&a.item.extent;if(!a)return setTimeout(function(){b.reject("Invalid itemInfo.item.extent")}),b;var g=new y({wkid:4326}),g=new x(a[0][0],a[0][1],a[1][0],a[1][1],g);if(4326===parseInt(c.spatialReference.wkid,10))return c.setExtent(g);if(c.spatialReference.isWebMercator())return g=D.geographicToWebMercator(g),
c.setExtent(g);a=new E;a.geometries=[g];a.outSR=c.spatialReference;g=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;g&&"esri.tasks.GeometryService"===g.declaredClass||(e&&"string"===typeof e&&p.trim(e)?(e=p.trim(e),g=new C(e)):g=z.getArcGISDefaultGeometryService());g.project(a).then(function(a){if(a=a&&a[0])return c.setExtent(a);b.reject("Invalid projected geometry.");return b},function(c){console.error(c);b.reject(c);return b});return b};z.getAncestorWindow=function(){for(var c=
window;c&&c.parent&&c!==c.parent;)c=c.parent;return c};z.getAncestorDom=function(c,a,e){if(c&&1===c.nodeType&&a&&"function"===typeof a){var b=100,g=document.body;e&&("number"===typeof e?(e=parseInt(e,10),0<e&&(b=e)):1===e.nodeType&&(g=e));for(e=0;c.parentNode&&e<b&&k.isDescendant(c.parentNode,g);){if(a(c.parentNode))return c.parentNode;c=c.parentNode;e++}}return null};z.bindClickAndDblclickEvents=function(c,a,e,b){var g=null;if(c&&1===c.nodeType&&a&&"function"===typeof a&&e&&"function"===typeof e){var h=
200;b&&"number"===typeof b&&(b=parseInt(b,10),0<b&&(h=b));var r=0,g=l(c,"click",function(c){r++;1===r?setTimeout(function(){1===r&&(r=0,a(c))},h):2===r&&(r=0,e(c))})}return g};z.isScrollToBottom=function(c){var a=k.getContentBox(c);return 1>c.scrollHeight-(c.scrollTop+a.h)};z.getAllItemTypes=function(){var c=[],c=c.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return c=c.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};z.getItemQueryStringByTypes=function(c){var a="",e=z.getAllItemTypes();if(c&&0<c.length&&0<c.length){var b="";f.forEach(c,function(a,e){b+=' type:"'+a+'" ';e!==c.length-1&&(b+=" OR ")});a=" ( "+b+" ) ";e=c.concat(e);e=f.filter(e,function(a){return f.every(c,
function(c){return 0>c.toLowerCase().indexOf(a.toLowerCase())})});f.forEach(e,function(c){a+=' -type:"'+c+'" '})}return a};z.getItemQueryStringByTypeKeywords=function(c){var a="";c&&0<c.length&&(a=' typekeywords:"'+c.join(",")+'" ');return a};z.isNotEmptyString=function(c,a){var e=c&&"string"===typeof c;return e?a?e&&p.trim(c):!0:!1};z.isValidNumber=function(c){return"number"===typeof c&&!isNaN(c)};z.isObject=function(c){return c&&"object"===typeof c};z.createWebMap=function(c,a,e,b){c=J.getStandardPortalUrl(c);
c=J.getBaseItemUrl(c);u.arcgisUrl=c;return u.createMap(a,e,b)};z.getRandomString=function(){var c=Math.random().toString();return c=c.slice(2,c.length)};z._getDomainsByServerName=function(c){var a=c.split("."),e=a.length;return f.map(a,p.hitch(this,function(c,b){var g=a.slice(b,e),h="",r=g.length-1;f.forEach(g,p.hitch(this,function(c,a){h+=c;a!==r&&(h+=".")}));return h}))};z.removeCookie=function(c,a){var e=this._getDomainsByServerName(window.location.hostname);f.forEach(e,p.hitch(this,function(e){g(c,
null,{expires:-1,path:a});g(c,null,{expires:-1,path:a,domain:e});g(c,null,{expires:-1,path:a,domain:"."+e})}))};z.isLocaleChanged=function(c,a){return!c.startWith(a)};z.hashToObject=function(c){c=c.replace("#","");c=m.queryToObject(c);for(var a in c)if(c.hasOwnProperty(a))try{c[a]=s.parse(c[a])}catch(e){}return c};z.reCreateObject=function(c){function a(c){var b=[];c.forEach(function(c){Array.isArray(c)?b.push(a(c)):"object"===typeof c?b.push(e(c)):b.push(c)});return b}function e(c){var b={},g;for(g in c)c.hasOwnProperty(g)&&
(null===c[g]?b[g]=null:Array.isArray(c[g])?b[g]=a(c[g]):b[g]="object"===typeof c[g]?e(c[g]):c[g]);return b}return Array.isArray(c)?a(c):e(c)};z.setVerticalCenter=function(c){setTimeout(function(){var a=q(".jimu-vcenter-text",c),e,b;f.forEach(a,function(c){e=k.getContentBox(c).h;k.setStyle(c,{lineHeight:e+"px"})},this);a=q(".jimu-vcenter",c);f.forEach(a,function(c){e=k.getContentBox(c).h;b=k.getContentBox(q(c).parent()[0]).h;k.setStyle(c,{marginTop:(b-e)/2+"px"})},this)},10)};z.merge=H;z.loadStyleLink=
function(c,a,e){var b=new n,g,h=require(z.getRequireConfig()).toUrl(a);if(require.cache["url:"+h]){g=require.cache["url:"+h];var r=h.split("/").pop(),h=h.substr(0,h.length-r.length);g=M(g,h);c=e?k.create("style",{id:c,type:"text/css"},k.byId(e),"before"):k.create("style",{id:c,type:"text/css"},document.getElementsByTagName("head")[0]);c.styleSheet&&!c.sheet?c.styleSheet.cssText=g:c.appendChild(k.toDom(g));b.resolve("load");return b}g=e?k.create("link",{id:c,rel:"stylesheet",type:"text/css",href:h+
"?wab_dv\x3d"+window.deployVersion},k.byId(e),"before"):k.create("link",{id:c,rel:"stylesheet",type:"text/css",href:h+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);l(g,"load",function(){b.resolve("load")});var t=setInterval(function(){var c;if(f.some(document.styleSheets,function(e){if(e.href&&e.href.substr(e.href.indexOf(a),e.href.length)===a)return c=e,!0}))try{!b.isFulfilled()&&(c.cssRules&&c.cssRules.length||c.rules&&c.rules.length)&&b.resolve("load"),clearInterval(t)}catch(e){}},
50);return b};z.changeLocation=function(c){window.history.pushState&&window.history.pushState({path:c},"",c)};z.urlToObject=function(c){var a=null;-1===c.indexOf("#")?(a=I.urlToObject(c),a.hash=null):(c=c.split("#"),a=I.urlToObject(c[0]),a.hash=c[1]?-1<c[1].indexOf("\x3d")?m.queryToObject(c[1]):c[1]:null);return a};z.manifest=function(){function c(a){a.panels.forEach(function(c){c.uri="panels/"+c.name+"/Panel.js"});a.styles.forEach(function(c){c.uri="styles/"+c.name+"/style.css"});a.layouts.forEach(function(c){c.uri=
"layouts/"+c.name+"/config.json";c.icon="layouts/"+c.name+"/icon.png";c.RTLIcon="layouts/"+c.name+"/icon_rtl.png"})}return{addManifestProperies:function(a){a.icon||(a.icon=a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);a.thumbnail||(a.thumbnail=a.folderUrl+"images/thumbnail.png");"theme"===a.category?c(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=
!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),L.processWidgetProperties(a))},processManifestLabel:function(c,a){var e=a.split("-")[0];c.label=c.i18nLabels&&(c.i18nLabels[a]||c.i18nLabels[e]||c.i18nLabels.defaultLabel)||c.label||c.name;c.layouts&&f.forEach(c.layouts,function(e){var b="i18nLabels_layout_"+e.name;e.label=c[b]&&(c[b][a]||c[b].defaultLabel)||e.label||e.name});c.styles&&f.forEach(c.styles,function(e){var b="i18nLabels_style_"+e.name;e.label=c[b]&&
(c[b][a]||c[b].defaultLabel)||e.label||e.name})},addI18NLabel:function(c){var a=new n;if(c.i18nLabels)return a.resolve(c),a;c.i18nLabels={};if(c.properties&&!1===c.properties.hasLocale)return a.resolve(c),a;var e;e=c.isRemote?c.amdFolder+"nls/strings.js":c.amdFolder+"nls/strings";require(z.getRequireConfig(),["dojo/i18n!"+e],function(e){var b={};b[dojoConfig.locale]=e;L.addI18NLabelToManifest(c,null,b);a.resolve(c)});return a}}}();z.getUniqueValues=function(c,a,e,b){return function(){var a=new n;
b?a.resolve(b):a=R({url:c,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});return a}().then(function(b){return z._getUniqueValues(c,a,e,b).then(function(c){var e=[],e=z.getFieldInfoByFieldName(b.fields,a),g=null,h=0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type);e&&(h&&(c=f.map(c,function(c){c=parseFloat(c);isNaN(c)&&(c=null);return c})),e.domain&&e.domain.codedValues&&0<e.domain.codedValues.length?
(g={},f.forEach(e.domain.codedValues,function(c){g[c.code]=c.name})):b.typeIdField===a&&(g={},f.forEach(b.types,function(c){g[c.id]=c.name})));return e=f.map(c,function(c){var a=null,a=null===c||void 0===c?"\x3cNull\x3e":g&&g.hasOwnProperty(c)?g[c]:h?z.localizeNumber(c):c;return{value:c,label:a}})})})};z._getUniqueValues=function(c,a,e,b){var g=new n;c=c.replace(/\/*$/g,"");e||(e="1\x3d1");/\/ImageServer$/gi.test(c)?g=z._getUniqueValuesByQueryTask(c,a,e):(g=z.getFieldInfoByFieldName(b.fields,a),g=
0<z._getCodedValuesOrTypesCount(g,b)?z._getUniqueValuesByQueryTask(c,a,e):z._getUniqueValuesByGenerateRenderer(c,a,e));return g};z._getCodedValuesOrTypesCount=function(c,a){if(c){if(c.domain&&"codedValue"===c.domain.type&&c.domain.codedValues)return c.domain.codedValues.length;if(a.typeIdField===c.name&&a.types)return a.types.length}return 0};z._getUniqueValuesByQueryTask=function(c,a,e){var b=new O;b.where=e;b.returnDistinctValues=!0;b.returnGeometry=!1;b.outFields=[a];return(new P(c)).execute(b).then(function(c){var e=
[];c.features&&0<c.features.length&&f.forEach(c.features,function(c){c&&c.attributes&&e.push(c.attributes[a])});return e})};z._getUniqueValuesByGenerateRenderer=function(c,a,e){var b=new n;c=c.replace(/\/*$/g,"")+"/generateRenderer";a=s.stringify({type:"uniqueValueDef",uniqueValueFields:[a]});R({url:c,content:{classificationDef:a,f:"json",where:e},handleAs:"json",callbackParamName:"callback"}).then(p.hitch(this,function(c){var a=[];(c=c&&c.uniqueValueInfos)&&0<c.length&&(a=f.map(c,p.hitch(this,function(c){return c.value})));
b.resolve(a)}),p.hitch(this,function(c){b.reject(c)}));return b};z.isCodedValuesSupportFilter=function(c,a){var e=parseFloat(c.currentVersion);return a<=parseFloat(c.maxRecordCount)&&10.1<e};z.combineRadioCheckBoxWithLabel=function(c,a){var e=!1;if(c&&1===c.nodeType&&"input"===c.tagName.toLowerCase()){var b=c.getAttribute("type")||"",b=b.toLowerCase();if("radio"===b||"checkbox"===b)e=!0}b=!1;a&&(1===a.nodeType&&"label"===a.tagName.toLowerCase())&&(b=!0);e&&b&&(e=c.getAttribute("id"),e||(e="input_"+
z.getRandomString(),c.setAttribute("id",e)),a.setAttribute("for",e),k.setStyle(a,"cursor","pointer"))};z.groupRadios=function(c,a){var e=[],b="radiogroup_"+z.getRandomString();f.forEach(c,function(c){c.name=b;a&&(c=l(c,"change",a),e.push(c))});return e};z.convertExtentToPolygon=function(c){var a=c.xmin,e=c.xmax,b=c.ymin,g=c.ymax;return new A({rings:[[[a,g],[e,g],[e,b],[a,b],[a,g]]],spatialReference:c.toJson()})};z.combineGeometries=function(c){function a(c){var e={points:[],spatialReference:c[0].spatialReference.toJson()};
f.forEach(c,function(c){"point"===c.type?e.points=e.points.concat([[c.x,c.y]]):"multipoint"===c.type&&(e.points=e.points.concat(c.points))});return new w(e)}function e(c){var a={paths:[],spatialReference:c[0].spatialReference.toJson()};f.forEach(c,function(c){a.paths=a.paths.concat(c.paths)});return new B(a)}function b(c){var a={rings:[],spatialReference:c[0].spatialReference.toJson()};f.forEach(c,function(c){"polygon"===c.type?a.rings=a.rings.concat(c.rings):"extent"===c.type&&(c=z.convertExtentToPolygon(c),
a.rings=a.rings.concat(c.rings))});return new A(a)}var g=null;if(c&&0<c.length)if(1===c.length)g=c[0];else{for(var h=null,r=null,l=null,t=null,n=0;n<c.length;n++){h=c[n];switch(h.type){case "point":case "multipoint":t="point";break;case "polyline":t="polyline";break;case "polygon":case "extent":t="polygon";break;default:return null}if(0===n)l=t;else if(l!==t)return null;if(n!==c.length-1&&(r=c[n+1],!h.spatialReference.equals(r.spatialReference)))return null}"point"===t?g=a(c):"polyline"===t?g=e(c):
"polygon"===t&&(g=b(c))}return g};z.combineGeometriesByGraphics=function(c){var a=null;c&&0<c.length&&(c=f.map(c,function(c){return c.geometry}),a=z.combineGeometries(c));return a};z.isFeaturelayerUrlSupportQuery=function(c,a){var e=!1,b=/\/featureserver\//gi.test(c),g=/\/mapserver\//gi.test(c);a=(a||"").toLowerCase();b?e=0<=a.indexOf("query"):g&&(e=0<=a.indexOf("data"));return e};z.isImageServiceSupportQuery=function(c){return 0<=(c||"").toLowerCase().indexOf("catalog")};z.isStringEndWith=function(c,
a){return c.lastIndexOf(a)+a.length===c.length};z.localizeNumber=function(c,a){var e=(c.toString().split(".")[1]||"").length,g="",g=a&&isFinite(a.places)&&a.places,g=0<g||0<e?"#,###,###,##0.0"+Array.prototype.join.call({length:0<g?g+1:e},"0"):"#,###,###,##0",e={locale:b.locale,pattern:g};p.mixin(e,a||{});try{return h.format(c,e)}catch(r){return console.error(r),c.toLocaleString()}};z.parseNumber=function(c,a){var e={locale:b.locale};p.mixin(e,a||{});try{return h.parse(c,e)}catch(g){return console.error(g),
c}};z.localizeDate=function(c,a){var e={locale:b.locale,fullYear:!0};p.mixin(e,a||{});try{return r.format(c,e)}catch(g){return console.error(g),"date"===e.selector?c.toLocaleDateString():"time"===e.selector?c.toLocaleTimeString():c.toLocaleString()}};z.localizeNumberByFieldInfo=function(c,a){var b=null,b=p.exists("format.places",a)&&a.format.places,b=z.localizeNumber(c,{places:b});return p.exists("format.digitSeparator",a)&&!a.format.digitSeparator?b.toString().replace(RegExp("\\"+e.group,"g"),""):
b};z.localizeDateByFieldInfo=function(a,e){var b=null;try{var g={date:a instanceof Date?a.getTime():a},h=p.exists("format.dateFormat",e)?e.format.dateFormat:"longMonthDayYear",b=c.substitute(g,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+v.prototype._dateFormats[h]}})}catch(r){console.error(r),b=a}return b};z.fieldFormatter={getFormattedUrl:function(c){if(c&&"string"===typeof c){var a=c.indexOf("http:");-1===a&&(a=c.indexOf("https:"));if(-1<a&&-1===c.indexOf("href\x3d")){var e=
c.indexOf(" ",a);-1===e&&(e=c.length);var b=c.substring(a,e);c=c.substring(0,a)+'\x3cA href\x3d"'+b+'" target\x3d"_blank"\x3e'+b+"\x3c/A\x3e"+c.substring(e,c.length)}}return c||""},getFormattedNumber:function(c,a){if("number"===typeof c){var e=(c.toString().split(".")[1]||"").length;c=z.localizeNumberByFieldInfo(c,{format:{places:a&&"number"===typeof a.places?parseInt(a.places,10):e,digitSeparator:a&&a.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(c||"")+"\x3c/span\x3e"}return c},
getFormattedDate:function(c,a){if("number"===typeof c||c instanceof Date)c=z.localizeDateByFieldInfo(c,{format:a});return c||""},getCodedValue:function(a,e){if(a&&a.codedValues){for(var b=0,g=a.codedValues.length;b<g;b++){var h=a.codedValues[b];if(c.isDefined(e)&&p.exists("code",h)&&e.toString()===h.code.toString())return h.name}return e}return e||null},getTypeName:function(c,a){for(var e=a.length,b=0;b<e;b++)if(c===a[b].id)return a[b].name;return c}};z.addRelativePathInCss=M;z.url={isAbsolute:function(c){return!c?
!1:c.startWith("http")||c.startWith("/")},removeQueryParamFromUrl:function(c,a){var e=I.urlToObject(c);e.query&&delete e.query[a];var b=e.path,g;for(g in e.query)b=b===e.path?b+"?"+g+"\x3d"+e.query[g]:b+"\x26"+g+"\x3d"+e.query[g];return b},addQueryParamToUrl:function(c,a,e){c=I.urlToObject(c);c.query||(c.query={});c.query[a]=e;a=c.path;for(var b in c.query)a=a===c.path?a+"?"+b+"\x3d"+c.query[b]:a+"\x26"+b+"\x3d"+c.query[b];return a}};z.processUrlInWidgetConfig=function(c,a){if(c)return c.startWith("data:")||
c.startWith("http")||c.startWith("/")?c:c.startWith("${appPath}")?c.replace("${appPath}",window.appInfo.appPath):a+c};z.processUrlInAppConfig=function(c){if(c)return c.startWith("data:")||c.startWith("http")||c.startWith("/")?c:window.appInfo.appPath+c};z.getLocationUrlWithoutHashAndQueryParams=function(){var c=window.location,a=c.protocol+"//"+c.host+c.pathname,c=I.urlToObject(c.href);c.query&&c.query.apiurl&&(a=z.url.addQueryParamToUrl(a,"apiurl",c.query.apiurl));return a};z.getDefaultWebMapThumbnail=
function(){return require.toUrl("jimu/images/webmap.png")};z.invertColor=function(c){c=c.substring(1);3===c.length&&(c=c.slice(0,1)+c.slice(0,1)+c.slice(1,1)+c.slice(1,1)+c.slice(2,1)+c.slice(2,1));c=parseInt(c,16);return 7829367<c?"#000000":"#ffffff"};z.mixinAppConfigPosition=function(c,a){var e=p.clone(c);if(!a)return e;a=p.clone(a);var b=e.widgetOnScreen,g=a.widgetOnScreen;g&&g.widgets&&("[object Object]"===Object.prototype.toString.call(g.widgets)?f.forEach(b.widgets,function(c,a){var e;e=c.uri?
c.uri:"ph_"+a;g.widgets[e]&&g.widgets[e].position&&(g.widgets[e].position.relativeTo||(g.widgets[e].position.relativeTo="map"),c.position=g.widgets[e].position)},this):f.forEach(g.widgets,function(c,a){c.position&&!c.position.relativeTo&&(c.position.relativeTo="map");b.widgets[a]&&c.position&&(b.widgets[a].position=c.position)}));g&&g.groups&&("[object Object]"===Object.prototype.toString.call(g.groups)?f.forEach(b.groups,function(c,a){var e;e=c.label?c.label:"g_"+a;g.groups[e]&&(g.groups[e].panel&&
g.groups[e].panel.position)&&(g.groups[e].panel.position.relativeTo||(g.groups[e].panel.position.relativeTo="map"),c.panel.position=g.groups[e].panel.position)},this):f.forEach(g.groups,function(c,a){c.panel&&(c.panel.position&&!c.panel.position.relativeTo)&&(c.panel.position.relativeTo="map");b.groups[a]&&c.panel.position&&(b.groups[a].panel.position=c.panel.position)}));a.map&&a.map.position&&(e.map?e.map.position=a.map.position:e.map={position:a.map.position});a.widgetPool&&a.widgetPool.panel&&
(a.widgetPool.panel.position&&!a.widgetPool.panel.position.relativeTo&&(a.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=a.widgetPool.panel.position);a.mobileLayout&&(e.mobileLayout=a.mobileLayout);return e};z.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(c,a,e){var b=-1;a=c.search(RegExp(a));0<=a&&(c=c.slice(a,c.length),c=c.indexOf(e),b=a+c+e.length);return{firstPos:a,lastPos:b}},setConfigValue:function(c,a,
e){N(c,a,e)},getConfigValue:function(c,a){return N(c,a)},setConfigValueWithId:function(c,a,e){U(c,a,e)},getConfigValueWithId:function(c,a){return U(c,a)},getKeyInfo:function(c){var a=this.getWidgetIdByKey(c);if(null!==a)return{type:"widget",id:a};c=this.getGroupIdByKey(c);return null!==c?{type:"group",id:c}:{type:"unknow",id:null}},getWidgetIdByKey:function(c){var a=z.template.getSearchRange(c,z.template.widgetIdentification,"]");if(-1===a.firstPos)c=null;else{var e=c.slice(a.firstPos,a.lastPos);
c=c.slice(a.firstPos+e.indexOf("[")+1,a.lastPos-1)}return c},getGroupIdByKey:function(c){var a=z.template.getSearchRange(c,z.template.groupIdentification,"]");if(-1===a.firstPos)c=null;else{var e=c.slice(a.firstPos,a.lastPos);c=c.slice(a.firstPos+e.indexOf("[")+1,a.lastPos-1)}return c},getConfigedWidgetsByTemplateConfig:function(c){var a=[],e=z.template.widgetIdentification+"_config",b;f.forEach(c.configurationSettings,function(c){f.forEach(c.fields,function(c){c.fieldName&&(b=z.template.getSearchRange(c.fieldName,
e,"]"),0<=b.firstPos&&(c=z.template.getWidgetIdByKey(c.fieldName),-1===a.indexOf(c)&&a.push(c)))},this)},this);return a},mergeTemplateAppConfigToAppConfig:function(c,a,e){function b(c){var a=[];f.forEach(c,function(c){c&&a.push(c)},this);return a}var g=c.widgetOnScreen,h=c.portalUrl;a.values.webmap&&(c.map.itemId=a.values.webmap);e&&(c.map.mapOptions&&z.deleteMapOptions(c.map.mapOptions),c.map.portalUrl=h,a.values.app_title||(a.values.app_title=e.title),a.values.app_subtitle||(a.values.app_subtitle=
e.snippet));for(var r in a.values)"webmap"!==r&&z.template.setConfigValueWithId(c,r,a.values[r]);c.widgetPool.widgets=b(c.widgetPool.widgets);g.widgets=b(g.widgets);if(c.widgetPool.groups)for(a=0;a<c.widgetPool.groups.length;a++)c.widgetPool.groups[a].widgets=b(c.widgetPool.groups[a].widgets);if(g.groups)for(a=0;a<g.groups.length;a++)g.groups[a].widgets=b(g.groups[a].widgets);return c}};z.deleteMapOptions=function(c){c&&(delete c.extent,delete c.lods,delete c.center,delete c.scale,delete c.zoom,delete c.maxScale,
delete c.maxZoom,delete c.minScale,delete c.minZoom)};z.graphicsExtent=function(c,a){var e=null;try{0<c.length&&(e=K.graphicsExtent(c))&&"number"===typeof a&&0<a&&(e=e.expand(a))}catch(b){console.error(b)}return e};z.sanitizeHTML=function(c){return html_sanitize(c,function(c){return c},function(c){return c})};z.stripHTML=function(c){return!c?c:-1<c.indexOf("\x3c")&&-1<c.indexOf("\x3e")?c.replace(/<(?:.|\s)*?>/g,""):c};z.removeSuffixSlashes=function(c){return c.replace(/\/*$/g,"")};z.getBestDisplayAttributes=
function(c,a){var e={},b=null,g;for(g in c)b=z.getBestDisplayValue(g,c,a),e[g]=b;return e};z.getBestDisplayValue=function(c,a,e){var b="",g=null;p.isArrayLike(e)?g=z.getFieldInfoByFieldName(e,c):"object"===typeof e&&e.name===c&&(g=e);g&&(b=a[c],"esriFieldTypeDate"===g.type?b&&(c=new Date(parseInt(b,10)),b=z._tryLocaleDate(c)):"number"===typeof b&&(g.domain&&"codedValue"===g.domain.type?f.some(g.domain.codedValues,function(c){if(c.code===b)return b=c.name,!0}):b=z._tryLocaleNumber(b)));if(null===b||
void 0===b)b="";return b};z.getDefaultPortalFieldInfo=function(c){var a=c.name,a={fieldName:a,label:c.alias||a,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(c.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":a.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":a.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":a.format={dateFormat:"longMonthDayYear"}}return a};z._tryLocaleNumber=function(c){var a=
z.localizeNumber(c);if(null===a||void 0===a)a=c;return a};z._tryLocaleDate=function(c){var a=z.localizeDate(c);a||(a=c.toLocaleDateString());return a};z.getFieldInfoByFieldName=function(c,a){var e=null;c&&0<c.length&&f.some(c,p.hitch(this,function(c){return c.name===a?(e=c,!0):!1}));return e};z.containsNonLatinCharacter=function(c){for(var a=0;a<c.length;a++)if(255<c.charCodeAt(a))return!0;return!1};z.has=function(c){var a=d(c);if(a)return a;if("ie"===c.toLowerCase()){c=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),
b=!!navigator.userAgent.match(/Trident\/7.0/),g=navigator.userAgent.indexOf("rv:11.0");e&&(c=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(c=10);b&&-1!==g&&(c=11);return 11===c&&11||a}if("edge"===c.toLowerCase())return navigator.userAgent.split("Edge/")[1]||a};z.detectUserAgent=function(){var c={},a={},e=navigator.userAgent,b=navigator.platform,g=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),h=e.match(/(Android);?[\s\/]+([\d.]+)?/),r=!!e.match(/\(Macintosh\; Intel /),t=e.match(/(iPad).*OS\s([\d_]+)/),
l=e.match(/(iPod)(.*OS\s([\d_]+))?/),n=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/),v=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),b=/Win\d{2}|Windows/.test(b),m=e.match(/Windows Phone ([\d.]+)/),u=v&&e.match(/TouchPad/),s=e.match(/Kindle\/([\d.]+)/),d=e.match(/Silk\/([\d._]+)/),f=e.match(/(BlackBerry).*Version\/([\d.]+)/),q=e.match(/(BB10).*Version\/([\d.]+)/),A=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),k=e.match(/PlayBook/),y=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),w=e.match(/Firefox\/([\d.]+)/),
B=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),x=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),D=!y&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),p=D||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);a.webkit=!!g;a.webkit&&(a.version=g[1]);h&&(c.android=!0,c.version=h[2]);n&&!l&&(c.ios=c.iphone=!0,c.version=n[2].replace(/_/g,"."));t&&(c.ios=c.ipad=!0,c.version=t[2].replace(/_/g,"."));l&&(c.ios=c.ipod=!0,c.version=l[3]?
l[3].replace(/_/g,"."):null);m&&(c.wp=!0,c.version=m[1]);v&&(c.webos=!0,c.version=v[2]);u&&(c.touchpad=!0);f&&(c.blackberry=!0,c.version=f[2]);q&&(c.bb10=!0,c.version=q[2]);A&&(c.rimtabletos=!0,c.version=A[2]);k&&(a.playbook=!0);s&&(c.kindle=!0,c.version=s[1]);d&&(a.silk=!0,a.version=d[1]);!d&&(c.android&&e.match(/Kindle Fire/))&&(a.silk=!0);y&&(a.chrome=!0,a.version=y[1]);w&&(a.firefox=!0,a.version=w[1]);B&&(c.firefoxos=!0,c.version=B[1]);x&&(a.ie=!0,a.version=x[1]);if(p&&(r||c.ios||b))a.safari=
!0,c.ios||(a.version=p[1]);D&&(a.webview=!0);c.tablet=!(!t&&!k&&!(h&&!e.match(/Mobile/)||w&&e.match(/Tablet/)||x&&!e.match(/Phone/)&&e.match(/Touch/)));c.phone=!(c.tablet||c.ipod||!h&&!n&&!v&&!f&&!q&&!(y&&e.match(/Android/)||y&&e.match(/CriOS\/([\d.]+)/)||w&&e.match(/Mobile/)||x&&e.match(/Touch/)));return{os:c,browser:a}};z.isMobileUa=function(){var c=z.detectUserAgent();return!0===c.os.phone||!0===c.os.tablet?!0:!1};z.inMobileSize=function(){var c=k.getMarginBox(window.jimuConfig.layoutId);if(c.w<=
window.jimuConfig.breakPoints[0]||c.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};z.getObjectIdField=function(c){if(c.objectIdField)return c.objectIdField;c=c.fields;for(var a=0;a<c.length;a++){var e=c[a];if("esriFieldTypeOID"===e.type)return e.name}return null};z.isNeedHttpsButNot=function(){var c=navigator.geolocation,a=window.hasOwnProperty("isSecureContext");return!(a&&window.isSecureContext||
!a&&"https:"===window.location.protocol)||!c?!0:!1};z.toFeatureSet=function(c){var a=new F;"[object Object]"===Object.prototype.toString.call(c)&&(c=[c]);a.features=c;if(0<c.length){var e;f.some(c,function(c){if(c.geometry)return e=c,!0});if(e){c=e.getLayer();var b={};c&&(a.displayFieldName=c.displayField,f.forEach(c.fields,p.hitch(this,function(c){var a=c.name;b[a]=c.alias||a})),a.fieldAliases=b);a.geometryType=e.geometry.type;a.spatialReference=e.geometry.spatialReference}}return a};z.showValidationErrorTipForFormDijit=
function(c){try{!c.validate()&&c.domNode&&c.focusNode&&(c.focusNode.focus(),setTimeout(p.hitch(this,function(){c.focusNode.blur()}),100))}catch(a){console.error(a)}};z.getFeatureLayerDefinition=function(c){var a=null,e=c.graphics;c.graphics=[];var b=c.toJson();c.graphics=e;b&&(a=b.layerDefinition);return a};z.simulateClickEvent=function(c){if(d("safari")){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0);c.dispatchEvent(a)}else c.click()};z.getFeatureSetByLayerAndFeatures=function(c,
a){var e=new F;e.fields=p.clone(c.fields);e.features=a;e.geometryType=c.geometryType;e.fieldAliases={};f.forEach(e.fields,p.hitch(this,function(c){var a=c.name;e.fieldAliases[a]=c.alias||a}));return e};z.featureAction=function(){return{zoomTo:function(c,a,e){e||(e={});e.hasOwnProperty("extentFactor")||(e.extentFactor=1.2);if(c&&a&&0<a.length){var b=f.every(a,function(c){return c&&c.spatialReference&&c.type});if(f.every(a,function(c){return c&&c.geometry&&c.geometry.spatialReference&&c.geometry.type})||
b)b&&(a=f.map(a,function(c){return{geometry:c}})),1===a.length&&"point"===a[0].type?(e=15,e=-1<c.getMaxZoom()?c.getMaxZoom():0.1,c.centerAndZoom(a[0].geometry,e)):(a=K.graphicsExtent(a),c.setExtent(a.expand(e.extentFactor)))}},flash:function(c,a){function e(c,a){f.forEach(g,function(e,b){e.setSymbol(a?c:r[b]||t)})}function b(c){return function(){setTimeout(function(){e(l,!0);g[0]&&a&&a.redraw();setTimeout(function(){e(null,!1);g[0]&&a&&a.redraw();c()},200)},200)}}if(f.every(c||[],function(c){return c&&
c.geometry})){var g=c,h=g[0],r=f.map(g,function(c){return c.symbol}),t=h.symbol||p.getObject("renderer.symbol",!1,a),l=null;a&&"esriGeometryPoint"===a.geometryType?l=new G(require.toUrl("jimu")+"/images/flash.gif",20,20):(l=p.clone(t))&&(l.outline?l.outline.setColor("#ffc500"):l.setColor("#ffc500"));h&&(t&&l&&a)&&("esriGeometryPoint"===a.geometryType?(e(l,!0),a.redraw(),setTimeout(function(){e(null,!1);a.redraw()},2E3)):b(b(b(function(){})))())}},panTo:function(c,a){if(f.every(a||[],function(c){return c&&
c.geometry})){var e;0<a.length?e=K.graphicsExtent(a).getCenter():(e=a[0].geometry,e="polyline"===e.type||"polygon"===e.type?e.getExtent().getCenter():"extent"===e.type?e.getCenter():"multipoint"===e.type?1<e.points.length?e.getExtent().getCenter():e.getPoint(0):e);c.centerAt(e)}},showPopup:function(c,a){if(f.every(a||[],function(c){return c&&c.geometry})){var e=c.infoWindow;e.setFeatures(a);var b=a[0];"point"===b.geometry.type?e.show(b.geometry,{closetFirst:!0}):e.show(b.geometry.getExtent().getCenter(),
{closetFirst:!0})}}}}();z.isInConfigOrPreviewWindow=function(){var c=!1;try{c=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(a){console.log(a),c=!1}return!!c};z.getAppHref=function(){var c="";return c=z.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};z.getAppIdFromUrl=function(){var c=!0,a=z.getAppHref();if(-1!==a.indexOf("id\x3d")||-1!==a.indexOf("appid\x3d")||-1!==a.indexOf("apps"))c=!1;if(!0===c)return a;c=this.urlToObject(window.location.href);
if(c.query&&(c.query.id||c.query.appid))return c.query.id||c.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(c=window.appInfo.appPath.split("/"),c.length&&2<c.length)return c[c.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};z.getEditorContentHeight=function(c,a,e){var b=new n;this._content=c;this._dom=a;this._domParam=e;var g=setTimeout(p.hitch(this,function(){clearTimeout(g);g=null;var c=0,a=this._domParam.contentWidth;try{var e=
document.createElement("div");e.setAttribute("id","fakeContent");k.setStyle(e,"background-size","contain");e.innerHTML=this._content;this._dom.appendChild(e);if(e){var h=q("img",e);h&&h.length&&h.style({maxWidth:a-20+"px"});k.setStyle(e,"position","absolute");k.setStyle(e,"width",a+"px");k.setStyle(e,"left","-99999px");k.setStyle(e,"top","-99999px");k.setStyle(e,"visibility","hidden");var r=k.getContentBox(e);r.h&&(c=r.h,c+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(l){console.error("can't getEditorContentHeight"+
l),c=200}b.resolve(c)}),1500);return b};z.getBase64Data=function(c){var a=new n;if(c&&c.startWith("data:image"))a.resolve(c);else try{R({url:c,handleAs:"arraybuffer"}).then(function(c){var e=new FileReader;e.onloadend=function(){a.resolve(e.result)};e.onerror=function(){a.resolve(null)};e.readAsDataURL(new Blob([c],{type:"image/png"}))},function(){a.resolve(null)})}catch(e){console.warn(e),a.resolve(null)}return a};z.getEditorTextColor=function(c,a){return{name:"dijit.editor.plugins.EditorTextColor",
custom:{recordUID:"wab_cr_"+(c||""),forceAttr:a}}};z.getEditorBackgroundColor=function(c){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:"wab_cr_"+(c||"")}}};return z})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(p,f,k){var d=p.NodeList;f.extend(d,{_buildArrayFromCallback:function(b){for(var m=[],d=0;d<this.length;d++){var a=b.call(this[d],this[d],m);a&&(m=m.concat(a))}return m},_getUniqueAsNodeList:function(b){for(var m=
[],d=0,a;a=b[d];d++)1==a.nodeType&&-1==k.indexOf(m,a)&&m.push(a);return this._wrap(m,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(b,m){var d=this._getUniqueAsNodeList(b),d=m?p._filterResult(d,m):d;return d._stash(this)},_getRelatedUniqueNodes:function(b,m){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(m),b)},children:function(b){return this._getRelatedUniqueNodes(b,function(b,d){return f._toArray(b.childNodes)})},closest:function(b,m){return this._getRelatedUniqueNodes(null,
function(d,a){do if(p._filterResult([d],b,m).length)return d;while(d!=m&&(d=d.parentNode)&&1==d.nodeType);return null})},parent:function(b){return this._getRelatedUniqueNodes(b,function(b,d){return b.parentNode})},parents:function(b){return this._getRelatedUniqueNodes(b,function(b,d){for(var a=[];b.parentNode;)b=b.parentNode,a.push(b);return a})},siblings:function(b){return this._getRelatedUniqueNodes(b,function(b,d){for(var a=[],n=b.parentNode&&b.parentNode.childNodes,l=0;l<n.length;l++)n[l]!=b&&
a.push(n[l]);return a})},next:function(b){return this._getRelatedUniqueNodes(b,function(b,d){for(var a=b.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(b){return this._getRelatedUniqueNodes(b,function(b,d){for(var a=[],n=b;n=n.nextSibling;)1==n.nodeType&&a.push(n);return a})},prev:function(b){return this._getRelatedUniqueNodes(b,function(b,d){for(var a=b.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(b){return this._getRelatedUniqueNodes(b,
function(b,d){for(var a=[],n=b;n=n.previousSibling;)1==n.nodeType&&a.push(n);return a})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(b,m){return 0!=m%2})},odd:function(){return this.filter(function(b,m){return 0==m%2})}});return d})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(p){p=
p.getObject("dojox.encoding.base64",!0);p.encode=function(f){for(var k=[],d=f.length,b=d%3,d=d-b,m=0;m<d;){var q=f[m++]<<16|f[m++]<<8|f[m++];k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q&
63))}switch(b){case 2:q=f[m++]<<16|f[m++]<<8;k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));k.push("\x3d");break;case 1:q=f[m++]<<16,k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63)),k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>
12&63)),k.push("\x3d"),k.push("\x3d")}return k.join("")};p.decode=function(f){f=f.split("");for(var k=[],d=f.length;"\x3d"==f[--d];);for(var b=0;b<d;){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[b++])<<18;b<=d&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[b++])<<12);b<=d&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[b++])<<6);b<=d&&(m|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[b++]));
k.push(m>>>16&255);k.push(m>>>8&255);k.push(m&255)}for(;0==k[k.length-1];)k.pop();return k};return p})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(p,f,k,d,b,m,q,a){return p(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var b=k.map(this.geometries,function(a){return a.toJson()}),
l={};l.outSR=this.outSR.wkid||d.toJson(this.outSR.toJson());l.inSR=this.geometries[0].spatialReference.wkid||d.toJson(this.geometries[0].spatialReference.toJson());l.geometries=d.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:b});this.transformation&&(l.transformation=this.transformation.wkid||d.toJson(this.transformation));q.isDefined(this.transformForward)&&(l.transformForward=this.transformForward);return l}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],
function(p,f){var k=p.clone(f);k.declaredClass="jimu.portalUrlUtils";k.getPortalUrlFromLocation=function(){return k.getPortalServerFromLocation()+k.getDeployContextFromLocation()};k.getPortalSignInUrlFromLocation=function(){var d=k.getPortalUrlFromLocation()+"home/signin.html";return d=k.setHttpsProtocol(d)};k.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};k.getDeployContextFromLocation=function(){var d=window.location.href.split("?")[0],b=d.indexOf("/home");
0>b&&(b=d.indexOf("/apps"));d=d.substring(d.indexOf(window.location.host)+window.location.host.length+1,b);"/"!==d&&(d="/"+d+"/");return d};k.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+k.getDeployContextFromLocation()+"sharing/rest/"};return k})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var p={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,
"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});p.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&(f=f.slice(2));return f.split("/")[0]};p.getServerWithProtocol=function(f){var k="";if(f=(f||"").trim()){var d=
p.getServerByUrl(f);if(!d)return k;var b=p.getProtocol(f);b?k=b+"://"+d:0===f.indexOf("//")&&(k="//"+d)}return k};p.isSameServer=function(f,k){f=p.getServerByUrl(f)||"";k=p.getServerByUrl(k)||"";return f.toLowerCase()===k.toLowerCase()};p.getDomain=function(f){var k="";if(f=p.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(k=f[0],/^\d+\.\d+$/.test(k)&&(k=""));return k};p.isSameDomain=function(f,k){var d=p.getDomain(f),b=p.getDomain(k);return""!==d&&d===b};p.isOnline=
function(f){return 0<=p.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};p.isArcGIScom=function(f){f=p.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};p.getStandardPortalUrl=function(f){var k=p.getServerByUrl(f);if(""===k)return"";p.isOnline(k)?(p.isArcGIScom(k)&&(k="www.arcgis.com"),f=p.addProtocol(f),f=p.getProtocol(f)+"://"+k):(f=(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=p.addProtocol(f),f.replace(RegExp("http(s?)://"+k,"g"),"")||(f+=
"/arcgis"));return f};p.isSamePortalUrl=function(f,k){var d=/^http(s?):\/\//gi,b=/^\/\//gi;f=p.getStandardPortalUrl(f).toLowerCase().replace(d,"").replace(b,"");k=p.getStandardPortalUrl(k).toLowerCase().replace(d,"").replace(b,"");return f===k};p.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&-1>=f.toLowerCase().indexOf("https://")){var k="";"undefined"!==typeof window&&window.location?(k=window.location.protocol,f=f.startWith("//")?k+f:f.startWith("/")?k+"//"+window.location.host+
f:k+"//"+f):(k="http:",f=f.startWith("//")?k+f:k+"//"+f)}return f};p.getProtocol=function(f){var k="";f=f.toLowerCase();0===f.indexOf("https://")?k="https":0===f.indexOf("http://")&&(k="http");return k};p.updateUrlProtocolByOtherUrl=function(f,k){k=k.toLowerCase();0===k.indexOf("https://")?f=p.setHttpsProtocol(f):0===k.indexOf("http://")&&(f=p.setHttpProtocol(f));return f};p.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};p.setHttpProtocol=function(f){f=p.addProtocol(f);return f.replace(/^https:\/\//,
"http://")};p.setHttpsProtocol=function(f){f=p.addProtocol(f);return f.replace(/^http:\/\//,"https://")};p.setProtocol=function(f,k){return 0<=k.indexOf("https")?p.setHttpsProtocol(f):0<=k.indexOf("http")?p.setHttpProtocol(f):f};p.getSharingUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest");return k};p.getOAuth2Url=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2");return k};p.getAppIdUrl=function(f,k){var d="",b=p.getStandardPortalUrl(f);b&&
(d=b+"/sharing/rest/oauth2/apps/"+k);return d};p.getSignInUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/signin.html");return k};p.getBaseSearchUrl=function(f){var k="";f=p.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(k=f+"/sharing/rest/search");return k};p.getBaseItemUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/content/items");return k};p.getItemUrl=function(f,k){var d="",b=p.getBaseItemUrl(f);b&&k&&(d=b+"/"+k);return d};p.getItemDataUrl=
function(f,k){var d="",b=p.getItemUrl(f,k);b&&(d=b+"/data");return d};p.getItemGroupsUrl=function(f,k){var d="",b=p.getItemUrl(f,k);b&&(d=b+"/groups");return d};p.getGenerateTokenUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/generateToken");return k};p.getItemDetailsPageUrl=function(f,k){var d="";f&&k&&(f=p.getStandardPortalUrl(f),d=f+"/home/item.html?id\x3d"+k);return d};p.getUserProfilePageUrl=function(f,k){var d="";f&&k&&(f=p.getStandardPortalUrl(f),d=f+"/home/user.html?user\x3d"+
k);return d};p.getBaseGroupUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/groups");return k};p.getPortalSelfInfoUrl=function(f){var k="";(f=p.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/portals/self");return k};p.getCommunitySelfUrl=function(f){var k="";(f=p.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/community/self");return k};p.getBaseUserUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/users");return k};p.getUserUrl=
function(f,k){var d="",b=p.getBaseUserUrl(f);f&&k&&(d=b+"/"+k);return d};p.getUserTagsUrl=function(f,k){var d="",b=p.getUserUrl(f,k);f&&k&&(d=b+"/tags");return d};p.getUserThumbnailUrl=function(f,k,d){var b="";(f=p.getUserUrl(f,k))&&d&&(b=f+"/info/"+d);return b};p.getContentUrl=function(f){var k="";f&&(f=p.getStandardPortalUrl(f),k=f+"/sharing/rest/content");return k};p.getUserContentUrl=function(f,k,d){var b="",b="";f&&k&&(b=p.getContentUrl(f),b=d?b+"/users/"+k+"/"+d:b+"/users/"+k);return b};p.getAddItemUrl=
function(f,k,d){var b="",b="";f&&k&&(b=p.getUserContentUrl(f,k,d),b+="/addItem");return b};p.getDeleteItemUrl=function(f,k,d){var b="";(f=p.getUserItemsUrl(f,k))&&(b=f+"/"+d+"/delete");return b};p.getUserItemsUrl=function(f,k,d){var b="",b="";f&&k&&(b=p.getUserContentUrl(f,k,d),b+="/items");return b};p.getUpdateItemUrl=function(f,k,d,b){var m="",m="";f&&k&&(m=p.getUserItemsUrl(f,k,b),m=m+"/"+d+"/update");return m};p.shareItemUrl=function(f,k,d,b){var m="",m="";f&&k&&(m=p.getUserItemsUrl(f,k,b),m=
m+"/"+d+"/share");return m};p.getHomeIndexUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/index.html");return k};p.getHomeMapViewerUrl=function(f,k){var d="",b=p.getStandardPortalUrl(f);b&&(d=b+"/home/webmap/viewer.html",d=k?d+("?webmap\x3d"+k):d+"?useExisting\x3d1");return d};p.getHomeSceneViewerUrl=function(f,k){var d="",b=p.getStandardPortalUrl(f);b&&(d=b+"/home/webscene/viewer.html",k&&(d+="?webscene\x3d"+k));return d};p.getHomeGalleryUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&
(k=f+"/home/gallery.html");return k};p.getHomeGroupsUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/groups.html");return k};p.getHomeMyContentUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/content.html");return k};p.getHomeMyOrganizationUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/organization.html");return k};p.getHomeUserUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/home/user.html");return k};p.getPortalHelpUrl=function(f,
k){var d="",b=p.getStandardPortalUrl(f);b&&(d=b+"/portalhelp/"+(k||"en")+"/website/help/");return d};p.getPortalAdminHelpUrl=function(f,k){var d="",b=p.getStandardPortalUrl(f);b&&(d=b+"/portalhelp/"+(k||"en")+"/admin/help/");return d};p.getPortalProxyUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/proxy");return k};p.getOAuth2SignOutUrl=function(f){var k="";(f=p.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2/signout");return k};p.getNewPrintUrl=function(f){var k="";if(f=
p.getStandardPortalUrl(f))f=p.setHttpProtocol(f),k=f+"/sharing/tools/newPrint";return k};return p})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(p){function f(b,m){function d(a,n){var l,m,g,h,r="widgetOnScreen"===a;if(b[a]){if(b[a].groups)for(l=0;l<b[a].groups.length;l++)if(g=b[a].groups[l],n(g,{index:l,isWidget:!1,groupId:g.id,isThemeWidget:!1,isOnScreen:r}),b[a].groups[l].widgets)for(m=0;m<b[a].groups[l].widgets.length;m++)h=b[a].groups[l].widgets[m],n(h,{index:m,isWidget:!0,
groupId:g.id,isThemeWidget:h.uri&&-1<h.uri.indexOf("themes/"+b.theme.name),isOnScreen:r});if(b[a].widgets)for(l=0;l<b[a].widgets.length;l++)h=b[a].widgets[l],n(b[a].widgets[l],{index:l,isWidget:!0,groupId:a,isThemeWidget:h.uri&&-1<h.uri.indexOf("themes/"+b.theme.name),isOnScreen:r})}}d("widgetOnScreen",m);d("widgetPool",m)}var k={},d="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");
k.visitElement=f;k.getConfigElementById=function(b,m){var d;if("map"===m)return b.map;f(b,function(a){if(a.id===m)return d=a,!0});return d};k.getConfigElementByLabel=function(b,m){var d;if("map"===m)return b.map;f(b,function(a){if(a.label||a.name===m)return d=a,!0});return d};k.getConfigElementsByName=function(b,m){var d=[];if("map"===m)return[b.map];f(b,function(a){a.name===m&&d.push(a)});return d};k.getWidgetNameFromUri=function(b){b=b.split("/");b.pop();return b.pop()};k.getAmdFolderFromUri=function(b){b=
b.split("/");b.pop();return b.join("/")+"/"};k.widgetProperties=d;k.processWidgetProperties=function(b){"undefined"===typeof b.properties.isController&&(b.properties.isController=!1);"undefined"===typeof b.properties.isThemeWidget&&(b.properties.isThemeWidget=!1);"undefined"===typeof b.properties.hasVersionManager&&(b.properties.hasVersionManager=!1);d.forEach(function(m){"undefined"===typeof b.properties[m]&&(b.properties[m]=!0)})};k.getControllerWidgets=function(b){var m=[];b.visitElement(function(b){b.isController&&
m.push(b)});return m};k.addI18NLabelToManifest=function(b,m,d){function a(a,g){g[n]&&(b.i18nLabels[a]=g[n]);"theme"===b.category&&(b.layouts&&b.layouts.forEach(function(h){b["i18nLabels_layout_"+h.name]||(b["i18nLabels_layout_"+h.name]={});b["i18nLabels_layout_"+h.name][a]=g["_layout_"+h.name]}),b.styles&&b.styles.forEach(function(h){b["i18nLabels_style_"+h.name]||(b["i18nLabels_style_"+h.name]={});b["i18nLabels_style_"+h.name][a]=g["_style_"+h.name]}));"widget"===b.category&&b.featureActions&&b.featureActions.forEach(function(h){b["i18nLabels_featureAction_"+
h.name]||(b["i18nLabels_featureAction_"+h.name]={});b["i18nLabels_featureAction_"+h.name][a]=g["_featureAction_"+h.name]})}b.i18nLabels={};var n="widget"===b.category?"_widgetLabel":"_themeLabel";m&&(m.root&&m.root[n])&&(b.i18nLabels.defaultLabel=m.root[n],"theme"===b.category&&(b.layouts&&b.layouts.forEach(function(a){b["i18nLabels_layout_"+a.name]={};b["i18nLabels_layout_"+a.name].defaultLabel=m.root["_layout_"+a.name]}),b.styles&&b.styles.forEach(function(a){b["i18nLabels_style_"+a.name]={};b["i18nLabels_style_"+
a.name].defaultLabel=m.root["_style_"+a.name]})),"widget"===b.category&&b.featureActions&&b.featureActions.forEach(function(a){b["i18nLabels_featureAction_"+a.name]={};b["i18nLabels_featureAction_"+a.name].defaultLabel=m.root["_featureAction_"+a.name]}));for(var l in d)a(l,d[l])};k.isHostedService=function(b){var m=p.getServerByUrl(b)+"/[^/]+/[^/]+/rest/services";return RegExp(m,"gi").test(b)};return k})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){var c=null,u=p(q,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(m.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(m.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),m.subscribe("app/sceneViewChanged",
f.hitch(this,this._onSceneViewChanged))):(m.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),m.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(m.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(m.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));m.subscribe("userSignIn",
f.hitch(this,this._onUserSignIn));m.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));m.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));m.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(c){var a=new b,e;c=f.clone(c);(e=this.getWidgetById(c.id))?a.resolve(e):h([this.loadWidgetClass(c),this.loadWidgetManifest(c)]).then(f.hitch(this,function(c){var e=c[0],b=c[1];this.loadWidgetResources(b).then(f.hitch(this,function(c){try{var g=this.createWidget(b,
e,c);d.setAttr(g.domNode,"data-widget-name",b.name);console.log("widget ["+b.uri+"] created.")}catch(h){console.log("create ["+b.uri+"] error:"+h.stack),new t({message:window.jimuNls.widgetManager.createWidgetError+": "+b.uri}),a.reject(h)}setTimeout(f.hitch(this,function(){a.resolve(g);this.emit("widget-created",g);m.publish("widgetCreated",g)}),50)}),function(c){a.reject(c)})}),function(c){a.reject(c)});return a},loadWidgetClass:function(c){var a=new b,e;e=c.isRemote?c.uri+".js":c.uri;require(r.getRequireConfig(),
[e],f.hitch(this,function(c){a.resolve(c)}));r.checkError(c.uri,a);return a},loadWidgetResources:function(c){var a=new b,e,g,r,l=[];r=f.clone(c);c=this.tryLoadWidgetConfig(r);e=this._tryLoadResource(r,"i18n");g=this._tryLoadResource(r,"style");r=this._tryLoadResource(r,"template");l.push(c);l.push(e);l.push(r);l.push(g);h(l).then(f.hitch(this,function(c){var e={};e.config=c[0];e.i18n=c[1];e.template=c[2];e.style=c[3];a.resolve(e)}),function(c){a.reject(c)});return a},loadWidgetManifest:function(c){var a=
new b,e=r.getUriInfo(c.uri).folderUrl+"manifest.json";if(c.manifest)return a.resolve(c),a;g(e,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(e){if(e.error&&e.error.code)return a.reject(e.error);e.category="widget";f.mixin(e,r.getUriInfo(c.uri));r.manifest.addI18NLabel(e).then(f.hitch(this,function(){this._processManifest(e);r.widgetJson.addManifest2WidgetJson(c,e);a.resolve(c)}))}),function(c){a.reject(c)});return a},getWidgetMarginBox:function(c){if("string"===typeof c&&
(c=this.getWidgetById(c),!c))return{};if(c._marginBox)return c._marginBox;c.setPosition({left:-9999,top:-9999,relativeTo:c.position.relativeTo});this.openWidget(c);c._marginBox=c.getMarginBox();this.closeWidget(c);return c._marginBox},_processManifest:function(c){r.manifest.addManifestProperies(c);r.manifest.processManifestLabel(c,window.dojoConfig.locale)},createWidget:function(c,e,b){if(this.getWidgetById(c.id))return this.getWidgetById(c.id);b.config&&b.i18n&&(b.config=r.replacePlaceHolder(b.config,
b.i18n));c.rawConfig=c.config;c.config=b.config||{};this.appConfig._appData&&this._mergeAgolConfig(c);c.nls=b.i18n||{};b.template&&(c.templateString=b.template);c["class"]="jimu-widget";c.label||(c.label=c.name);this.map&&(c.map=this.map);c.appConfig=this.appConfig;b={};for(var g in c)c.hasOwnProperty(g)&&(b[g]=c[g]);b.widgetManager=this;c=new e(b);c.clazz=e;n.after(c,"startup",f.hitch(this,this._postWidgetStartup,c));n.before(c,"destroy",f.hitch(this,this._onDestroyWidget,c));a(c.domNode,"click",
f.hitch(this,this._onClickWidget,c));this.loaded.push(c);return c},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var c=k.map(this.loaded,function(c){return c.id});k.forEach(c,function(c){this.destroyWidget(c)},this);this.loaded=[]},loadWidgetSettingPage:function(c){var a=new b;c=f.clone(c);c.id+="_setting";h([this.loadWidgetSettingClass(c)]).then(f.hitch(this,function(e){var b=e[0];this.loadWidgetSettingPageResources(c).then(f.hitch(this,function(e){var g;e={nls:e.i18n,
templateString:e.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?e.sceneView=this.sceneView:e.map=this.map;for(var h in c)c.hasOwnProperty(h)&&(e[h]=c[h]);try{g=new b(e),d.setAttr(g.domNode,"data-widget-name-setting",e.name),n.before(g,"destroy",f.hitch(this,this._onDestroyWidgetSetting,g)),a.resolve(g)}catch(r){new t({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+c.uri}),a.reject(r)}}),function(c){console.log(c)})}),function(c){a.reject(c)});
return a},loadWidgetSettingClass:function(c){var a=new b,e;e=c.isRemote?c.folderUrl+"setting/Setting.js":c.amdFolder+"setting/Setting";require(r.getRequireConfig(),[e],f.hitch(this,function(c){a.resolve(c)}));r.checkError(c.folderUrl+"setting/Setting.js",a);return a},loadWidgetSettingPageResources:function(c){var a=new b,e,g,r=[];c=f.clone(c);e=this._tryLoadResource(c,"settingI18n");g=this._tryLoadResource(c,"settingTemplate");c=this._tryLoadResource(c,"settingStyle");r.push(e);r.push(g);r.push(c);
h(r).then(f.hitch(this,function(c){var e={};e.i18n=c[0]||{};e.template=c[1];e.style=c[2];a.resolve(e)}),function(c){console.log(c)});return a},getWidgetById:function(c){var a;k.some(this.loaded,function(e){if(e.id===c)return a=e,!0},this);return a},getWidgetByLabel:function(c){var a;k.some(this.loaded,function(e){if(e.label===c)return a=e,!0},this);return a},getWidgetsByName:function(c){var a=[];k.some(this.loaded,function(e){e.name===c&&a.push(e)},this);return a},changeWindowStateTo:function(c,a){"normal"===
a?this.normalizeWidget(c):"minimized"===a?this.minimizeWidget(c):"maximized"===a?this.maximizeWidget(c):console.log("error state: "+a)},closeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if("closed"!==c.state){this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);d.setStyle(c.domNode,"display","none");c.setState("closed");try{c.onClose()}catch(a){console.log(console.error("fail to close widget "+c.name+". "+a.stack))}}},
openWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if(!c.started)try{c.started=!0,c.startup()}catch(a){console.error("fail to startup widget "+c.name+". "+a.stack)}if("closed"===c.state){d.setStyle(c.domNode,"display","");c.setState("opened");try{c.onOpen()}catch(e){console.error("fail to open widget "+c.name+". "+e.stack)}}},activateWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"opened"===c.state&&this._activeWidget(c)},maximizeWidget:function(c){if("string"===
typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("maximized");try{c.onMaximize()}catch(a){console.log(console.error("fail to maximize widget "+c.name+". "+a.stack))}},minimizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("minimized");try{c.onMinimize()}catch(a){console.log(console.error("fail to minimize widget "+c.name+". "+a.stack))}},normalizeWidget:function(c){if("string"===
typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("normal");try{c.onNormalize()}catch(a){console.log(console.error("fail to normalize widget "+c.name+". "+a.stack))}},destroyWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;this._removeWidget(c);try{c.destroy()}catch(a){console.log(console.error("fail to destroy widget "+c.name+". "+a.stack))}},tryLoadWidgetConfig:function(c){return this._tryLoadWidgetConfig(c).then(f.hitch(this,
function(a){return this._upgradeWidgetConfig(c,a).then(function(a){return c.config=a})}))},triggerWidgetOpen:function(c){function a(c){var b=n.after(c,"onOpen",function(){b.remove();e.resolve(c)})}var e=new b,g=this.getWidgetById(c);if(g){if("closed"!==g.state)return e.resolve(g),e;a(g)}else var h=m.subscribe("widgetCreated",f.hitch(this,function(a){a.id===c&&(h.remove(),e.resolve(a))}));m.publish("openWidget",c);return e},_tryLoadWidgetConfig:function(c){var a=new b;if(c.config&&f.isObject(c.config))return a.resolve(c.config),
a;if(c.config){if(require.cache["url:"+c.config])return a.resolve(l.parse(require.cache["url:"+c.config])),a;a=r.processUrlInAppConfig(c.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return g(a,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(c,"config").then(function(a){c.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(c,a){var e=new b,g=c.manifest.version,h=c.version,l;if(g===h)return e.resolve(a),e;if(!1===c.hasVersionManager)return c.version=
g,e.resolve(a),e;require(r.getRequireConfig(),[c.amdFolder+"VersionManager"],f.hitch(this,function(b){b=new b;var r=b.getVersionIndex(h),t=b.getVersionIndex(g);if(r>t)e.reject("Bad widget version number, "+c.name+","+h);else try{l=b.upgrade(a,h,g),c.version=g,e.resolve(l)}catch(n){console.log("Read widget ["+c.name+"] old config error,"+n.stack),e.resolve(a)}}));return e},loadWidgetStyle:function(c){var a="widget/style/"+c.uri,e=new b,a=this._replaceId(a);return d.byId(a)?(e.resolve("load"),e):r.loadStyleLink(a,
c.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(c){var a="widget/style/"+c.uri+"/setting",e=new b,a=this._replaceId(a);return d.byId(a)?(e.resolve("load"),e):r.loadStyleLink(a,c.settingStyleFile)},loadWidgetConfig:function(c){c=require(r.getRequireConfig()).toUrl(c.configFile);if(require.cache["url:"+c]){var a=new b;a.resolve(l.parse(require.cache["url:"+c]));return a}return g(c,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(c){var a=
new b;require(r.getRequireConfig(),["dojo/i18n!"+c.i18nFile],function(c){a.resolve(c)});return a},loadWidgetSettingI18n:function(c){var a=new b;require(r.getRequireConfig(),["dojo/i18n!"+c.settingI18nFile],function(c){a.resolve(c)});return a},loadWidgetTemplate:function(c){var a=new b;require(r.getRequireConfig(),["dojo/text!"+c.templateFile],function(c){a.resolve(c)});r.checkError(c.templateFile,a);return a},loadWidgetSettingTemplate:function(c){var a=new b;require(r.getRequireConfig(),["dojo/text!"+
c.settingTemplateFile],function(c){a.resolve(c)});r.checkError(c.settingTemplateFile,a);return a},removeWidgetStyle:function(c){d.destroy(this._replaceId("widget/style/"+c.uri))},removeWidgetSettingStyle:function(c){d.destroy(this._replaceId("widget/style/"+c.uri+"/setting"))},getControllerWidgets:function(){return k.filter(this.loaded,function(c){return c.isController})},getOffPanelWidgets:function(){return k.filter(this.loaded,function(c){return!c.inPanel})},getOnScreenOffPanelWidgets:function(){return k.filter(this.loaded,
function(c){return c.isOnScreen&&!c.inPanel})},closeOtherWidgetsInTheSameGroup:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c.gid&&this.loaded[a].id!==c.id&&this.closeWidget(this.loaded[a])},closeAllWidgetsInGroup:function(c){for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c&&this.closeWidget(this.loaded[a])},_mergeAgolConfig:function(c){var a=this.appConfig._appData.values,e="widgets["+c.id+"]",b;for(b in a){var g=
b.replace(/\//g,"_").indexOf(e+"_config");0<=g&&r.template.setConfigValue(c,b.replace(/\//g,"_").substr(g,b.length).replace(e,"widget"),a[b])}},_onUserSignIn:function(c){k.forEach(this.loaded,function(a){a.onSignIn(c)},this)},_onUserSignOut:function(){k.forEach(this.loaded,function(c){c.onSignOut()},this)},_activeWidget:function(c){if(this.activeWidget){if(this.activeWidget.id===c.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&d.setStyle(this.activeWidget.domNode,"zIndex",
101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&d.setStyle(c.domNode,"zIndex","zIndex"in c.position?c.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=c;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&d.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),m.publish("widgetActived",c))},_onClickWidget:function(c,
a){var e=s(".jimu-widget",c.domNode);if(0<e.length)for(var b=0;b<e.length;b++)if(a.target===e[b]||d.isDescendant(a.target,e[b]))return;this._activeWidget(c)},_onMoveStart:function(c){k.forEach(this.loaded,function(a){a.domNode===c.node&&this._activeWidget(a)},this)},_onAppConfigLoaded:function(c){this.appConfig=c=f.clone(c);e.setPortalUrl(c.portalUrl)},_onMapLoaded:function(c){this.map=c},_onMapChanged:function(c){this.map=c},_onSceneViewLoaded:function(c){this.sceneView=c},_onSceneViewChanged:function(c){this.sceneView=
c},_onAppConfigChanged:function(c,a,e,b){var g=f.clone(c);this.appConfig=g;k.forEach(this.loaded,function(c){c&&(c.onAppConfigChanged(g,a,e,b),"widgetChange"===a&&this._onConfigChanged(e.id,e.config,b))},this)},_onConfigChanged:function(c,a){var e=this.getWidgetById(c);e&&(e.onConfigChanged(a),f.mixin(e.config,a))},_onActionTriggered:function(c){if(!("map"===c.elementId||"app"===c.elementId)){var a=this.getWidgetById(c.elementId);if(a)a.onAction(c.action,c.data);else this.missedActions.push({id:c.elementId,
action:{name:c.action,data:c.data}});k.forEach(this.getControllerWidgets(),function(a){if(a.widgetIsControlled(c.elementId))a.onAction(c.action,{widgetId:c.elementId,data:c.data})},this)}},_postWidgetStartup:function(c){c.started=!0;r.setVerticalCenter(c.domNode);n.after(c,"resize",f.hitch(this,r.setVerticalCenter,c.domNode));this.openWidget(c);var a=e.getPortalCredential(this.appConfig.portalUrl);if(a)c.onSignIn(a);else c.onSignOut();this._triggerMissedAction(c)},_triggerMissedAction:function(c){this.missedActions.forEach(function(a){if(a.id===
c.id)c.onAction(a.action.name,a.action.data)})},_remove:function(c){return k.some(this.loaded,function(a,e){if(a.id===c)return this.loaded.splice(e,1),!0},this)},_tryLoadResource:function(c,a){var e,g=new b;if("config"===a)e=c.amdFolder+"config.json",c.configFile=e,e="hasConfig";else if("style"===a)e=c.amdFolder+"css/style.css",c.styleFile=e,e="hasStyle";else if("i18n"===a)e=c.amdFolder+"nls/strings.js",c.i18nFile=c.isRemote?e:c.amdFolder+"nls/strings",e="hasLocale";else if("template"===a)e=c.amdFolder+
"Widget.html",c.templateFile=e,e="hasUIFile";else if("settingTemplate"===a)e=c.amdFolder+"setting/Setting.html",c.settingTemplateFile=e,e="hasSettingUIFile";else if("settingI18n"===a)e=c.amdFolder+"setting/nls/strings.js",c.settingI18nFile=c.isRemote?e:c.amdFolder+"setting/nls/strings",e="hasSettingLocale";else if("settingStyle"===a)e=c.amdFolder+"setting/css/style.css",c.settingStyleFile=e,e="hasSettingStyle";else return g;c[e]?function(){var e;if("config"===a)e=this.loadWidgetConfig(c);else if("style"===
a)e=this.loadWidgetStyle(c);else if("i18n"===a)e=this.loadWidgetI18n(c);else if("template"===a)e=this.loadWidgetTemplate(c);else if("settingTemplate"===a)e=this.loadWidgetSettingTemplate(c);else if("settingStyle"===a)e=this.loadWidgetSettingStyle(c);else if("settingI18n"===a)e=this.loadWidgetSettingI18n(c);else return g;e.then(function(c){g.resolve(c)},function(a){new t({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+c.uri});g.reject(a)})}.apply(this):g.resolve(null);return g},
_replaceId:function(c){return c.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(c){"closed"!==c.state&&this.closeWidget(c);this._removeWidget(c);this.emit("widget-destroyed",c.id);m.publish("widgetDestroyed",c.id);console.log("destroy widget ["+c.uri+"].")},_onDestroyWidgetSetting:function(c){this.removeWidgetSettingStyle(c)},_removeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget=null);
this._remove(c.id);0===this.getWidgetsByName(c.name).length&&this.removeWidgetStyle(c)}});u.getInstance=function(a){null===c&&(c=new u(a),window._widgetManager=c);return c};return u})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,
g,h,r,e,t){"function"!==typeof b.getAll&&(b.getAll=function(c){var a=[];(c=b(c))&&a.push(c);return a});h={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return t.isInConfigOrPreviewWindow()},isStringStartWith:function(c,a){return c.substr(0,a.length)===a},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(c){(c=e.getStandardPortalUrl(c))&&(c+="/");this.portalUrl=c},getPortalUrl:function(){return this.portalUrl},
isWebTierPortal:function(c){var b=new d,h=e.getStandardPortalUrl(c);c=h+"/sharing";var r=e.setHttpsProtocol(h+"/sharing/rest/generateToken?f\x3djson"),t=e.setHttpsProtocol(c);a.get(r,{jsonp:"callback"}).then(p.hitch(this,function(c){c.token?(this.webTierPortalUrls.push(h),this.removeWabAuthCookie(),n.id.getCredential(t).then(p.hitch(this,function(a){a.token||(a.token=c.token);a=g.canUseXhr(a.server,!0);-1<a&&l.defaults.io.corsEnabledServers.splice(a,1);this._pushCorsEnabledServerInfo({host:e.getServerByUrl(h),
withCredentials:!0});b.resolve(!0)}),p.hitch(this,function(){b.resolve(!0)}))):b.resolve(!1)}),p.hitch(this,function(c){console.error(c);b.reject(c)}));return b},addAuthorizedCrossOriginDomains:function(c){if(c&&0<c.length)for(var a=0;a<c.length;a++)this.addWithCredentialDomain(c[a])},addWithCredentialDomain:function(c){if(c&&"string"===typeof c){var a=l.defaults.io.corsEnabledServers,b=e.getServerByUrl(c);(c=e.getServerWithProtocol(c))||(c="http://"+b);c=g.canUseXhr(c,!0);-1<c&&a.splice(c,1);this._pushCorsEnabledServerInfo({host:b,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(c){if(c){var a=l.defaults.io.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof c&&"string"===typeof c.host){for(var b in c.host)c[b]="function"===typeof c.host[b]?function(){return c.host[b].apply(c.host,arguments)}:
c.host[b];c.length=c.host.length;f.forEach(e,function(a){"function"===typeof c.host[a]&&(c[a]=function(){return c.host[a].apply(c.host,arguments)})})}a.push(c)}},tryRegisterCredential:function(c){return!this.isValidCredential(c)?!1:!f.some(n.id.credentials,p.hitch(this,function(a){return c.token===a.token}))?(n.id.credentials.push(c),!0):!1},registerToken:function(c){var a=e.getSharingUrl(this.portalUrl);n.id.findCredential(a)&&f.some(n.id.credentials,p.hitch(this,function(c,a){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
c))return n.id.credentials.splice(a,1),!0}));return this._getTokenInfo(c).then(function(c){n.id.registerToken(c)})},_getTokenInfo:function(c){var b=e.getPortalSelfInfoUrl(this.portalUrl);return a.get(b+("?f\x3djson\x26token\x3d"+c),{jsonp:"callback"}).then(p.hitch(this,function(a){if(a.user)return{server:e.getSharingUrl(this.portalUrl),ssl:a.allSSL,token:c,userId:a.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(c){console.error(c);throw Error(window.jimuNls.urlParams.validateTokenError);
})},_isInvalidPortalUrl:function(c){return c&&"string"===typeof c&&p.trim(c)},signInPortal:function(c){var a=new d;if(this._isInvalidPortalUrl(c)){c=e.getStandardPortalUrl(c);var b=e.getSharingUrl(c),g=this.getPortalCredential(c);g?setTimeout(p.hitch(this,function(){a.resolve(g)}),0):a=n.id.getCredential(b)}else setTimeout(p.hitch(this,function(){a.reject("Invalid portalurl.")}),0);return a},_loadPortalSelfInfo:function(c){c=e.getPortalSelfInfoUrl(c);return s({url:c,handleAs:"json",content:{f:"json"},
callbackParamName:"callback"})},registerOAuthInfo:function(c,a){if(!c||!("string"===typeof c&&a&&"string"===typeof a))return null;var e=n.id.findOAuthInfo(c);e||(e=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",e=new r({appId:a,expiration:20160,portalUrl:c,authNamespace:"/",popup:!0,popupCallbackUrl:e}),n.id.registerOAuthInfos([e]));e.appId=a;return e},signOutAll:function(){var c=e.getStandardPortalUrl(this.portalUrl),a=!!n.id.findCredential(c+"/sharing/rest");
window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();n.id.destroyCredentials();n.id._oAuthHash=null;a&&this._publishCurrentPortalUserSignOut(c)},userHaveSignInPortal:function(c){return!!this.getPortalCredential(p.trim(c||""))},isValidCredential:function(c){var a=!1;if(c){var a=c.token,e=c.server,b=c.scope,a=a&&"string"===typeof a&&p.trim(a),e=e&&"string"===typeof e&&p.trim(e),b="portal"===b||"server"===b,g=!0;c.expires&&(c=parseInt(c.expires,10),g=(new Date).getTime(),
g=c>g);a=a&&e&&b&&g}return a},isValidPortalCredentialOfPortalUrl:function(c,a){var b=!1;if(this.isValidCredential(a))var b="portal"===a.scope,g=e.isSameServer(c,a.server),b=b&&g;return b},getPortalCredential:function(c){var a=null;c=p.trim(c||"");if(!c)return null;c=e.getStandardPortalUrl(c);return a=this._filterPortalCredential(c,n.id.credentials)},saveAndRegisterCookieToCredential:function(c){c=p.clone(c);c.referer=window.location.host;c.scope="portal";c.isAdmin=!!c.isAdmin;this.saveWabCookie(c);
var a=c.server+"/sharing/rest";c.server=a;n.id.registerToken(c);return n.id.findCredential(a,c.userId)},registerAuth2Hash:function(c){c=p.clone(c);var a=1E3*parseInt(c.expires_in,10),a=(new Date).getTime()+a,b=e.getStandardPortalUrl(c.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:b,token:c.access_token,expires:a,userId:c.username,scope:"portal",isAdmin:!!c.isAdmin})},saveWabCookie:function(c){this.removeCookie("wab_auth");b("wab_auth",m.stringify(c),
{expires:new Date(c.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(c,a){var e=null;if(a&&0<a.length){var b=f.filter(a,p.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(c,a)}));0<b.length&&(e=b[b.length-
1])}return e},_removePortalCredential:function(c){var a=p.trim(c||"");if(a){a=e.getStandardPortalUrl(a);for(c=f.filter(n.id.credentials,p.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(a,c)}));0<c.length;)c[0].destroy(),c.splice(0,1);n.id.credentials=f.filter(n.id.credentials,p.hitch(this,function(c){return!this.isValidPortalCredentialOfPortalUrl(a,c)}))}},getUserIdByToken:function(c,a){var b=new d;if(c&&"string"===typeof c&&a&&"string"===typeof a){var g=e.getStandardPortalUrl(a),
h=f.filter(n.id.credentials,p.hitch(this,function(a){var b=a.token===c&&a.userId;a=e.isSameServer(g,a.server);return b&&a}));if(0<h.length){var r=h[0];setTimeout(p.hitch(this,function(){b.resolve(r.userId)}),0);return b}h=e.getCommunitySelfUrl(g);s({url:h,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(c){b.resolve(c&&c.username||"")}),p.hitch(this,function(c){console.error(c);b.reject("fail to get userId by token")}))}else setTimeout(p.hitch(this,function(){b.reject("invalid parameters")}),
0);return b},xtGetCredentialFromCookie:function(c){var a=b("wab_auth"),g=null;if(a)try{g=m.parse(a)}catch(h){console.error(h)}if(!(g&&"object"===typeof g)||!e.isSameServer(c,g.server)||window.location.host!==g.referer)return null;g.expires=parseInt(g.expires,10);a=(new Date).getTime();if(!(g.expires>a))return this.removeCookie("wab_auth"),null;c+="/sharing/rest";g.server=c;(a=n.id.findCredential(c))||n.id.registerToken(g);return a=n.id.findCredential(c)},removeCookie:function(c){var a=this.getCookiePath();
t.removeCookie(c,a)},_getDomainsByServerName:function(c){var a=c.split("."),e=a.length;return f.map(a,p.hitch(this,function(c,b){var g=a.slice(b,e),h="",r=g.length-1;f.forEach(g,p.hitch(this,function(c,a){h+=c;a!==r&&(h+=".")}));return h}))},_publishCurrentPortalUserSignIn:function(c){if(this.isValidCredential(c))try{q.publish("userSignIn",c)}catch(a){console.error(a)}},_publishAnyUserSignIn:function(c){if(this.isValidCredential(c))try{q.publish("anyUserSignIn",c)}catch(a){console.error(a)}},_publishCurrentPortalUserSignOut:function(c){try{q.publish("userSignOut",
c)}catch(a){console.error(a)}},_signInSuccess:function(c){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,c)&&this._publishCurrentPortalUserSignIn(c),this._publishAnyUserSignIn(c)}catch(a){console.error(a)}},_bindEvents:function(){k.after(n.id,"signIn",p.hitch(this,function(c,a){console.log(a[1]);k.after(c,"callback",p.hitch(this,function(c,a){this._signInSuccess(a[0],!1)}));return c}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var c=
window.parent;if(c){var a=c.esri&&c.esri.id;a&&(n.id=a,a=window.esriConfig.defaults.io,c=c.esriConfig.defaults.io,a.corsEnabledServers=c.corsEnabledServers,a.webTierAuthServers=c.webTierAuthServers,a._processedCorsServers=c._processedCorsServers,a.corsStatus=c.corsStatus)}}this._bindEvents();this._started=!0}}};h.startup();return h})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(p,f,k,d,b,m){return p(m,
{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=k.create("div",{"class":"title"},this.domNode),this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=k.create("div",{"class":"close-btn jimu-float-trailing"},
this.titleNode),this.own(b(this.closeBtnNode,"click",f.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:d.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",501);k.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){var h=0;return p(s,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();d.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._moveToMiddle()}),50);this.own(m(window,"resize",f.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=d.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();b.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=d.create("div",{"class":"title"},this.domNode);this.titleLabeNode=d.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=d.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var b=null,b="ontouchstart"in document?a.press:"click";this.own(m(this.closeBtnNode,
b,f.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=d.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&d.place(this.content,this.contentContainerNode));this.buttonContainer=d.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&d.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var e=d.getContentBox(this.buttonContainer),b=d.getMarginExtents(this.enabledButtons[0]),c=d.getPadBorderExtents(this.enabledButtons[0]),g=0,c=8===q("ie")?c.l+c.r:0,g=(e.w-(b.l+b.r+c)*a)/a;0<g&&(k.forEach(this.enabledButtons,f.hitch(this,
function(c){d.setStyle(c,"maxWidth",g+"px")})),k.forEach(this.disabledButtons,f.hitch(this,function(c){d.setStyle(c,"maxWidth",g+"px")})))}},_moveableNode:function(a,e){this.moveable&&(this.moveable.destroy(),this.moveable=null);var b=d.getMarginBox(this.container);b.l=b.l-a+e;b.w+=2*(a-e);this.moveable=new l.boxConstrainedMoveable(this.domNode,{box:b,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(m(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(m(this.moveable,
"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===n("#header").length?{t:0,l:0,w:0,h:0}:d.getMarginBox("header")},_getFooterBox:function(){return 0===n(".footer",this.container).length?{t:0,l:0,w:0,h:0}:d.getMarginBox(n(".footer",this.container)[0])},_calculatePosition:function(){var a=d.getContentBox(this.container),e=this._getHeaderBox(),b=this._getFooterBox(),b=a.h-e.h-b.h-40,c=0;c=this._fixedHeight?this.height:this.autoHeight?b-200:this.height=b>this.maxHeight?this.maxHeight:
b;b=(b-c)/2+e.h+20;b=b<e.h?e.h:b;this.width=this.width||this.maxWidth;d.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:b+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(d.setStyle(this.domNode,"height","auto"),d.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(d.setStyle(this.domNode,"height",this.height+"px"),d.addClass(this.contentContainerNode,"content-absolute"),d.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=d.getMarginBox(this.domNode),e=d.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=e.h-b.h-c.h-40,g=0,g=a.h||c-200,a=(c-g)/2+b.h+20,a=a<b.h?b.h:a;d.setStyle(this.domNode,{left:(e.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){d.setStyle(this.domNode,"zIndex",h+200+1);d.setStyle(this.overlayNode,"zIndex",h+200);h++},setTitleLabel:function(a){this.titleNode.innerHTML=g.stripHTML(a)},onMoving:function(a){d.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){d.setStyle(a.node,"opacity",1)},close:function(){if(!(this.onClose&&!1===this.onClose())){var a=this.domNode.parentNode,e=f.clone(this.domNode);d.setStyle(this.domNode,"display","none");d.destroy(this.overlayNode);
this.destroy();this.moveable.destroy();d.place(e,a);b.animateProperty({node:e,properties:{opacity:0},duration:200,onEnd:function(){d.destroy(e)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var e=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(e+=a.classNames.join(" "));var b=d.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+e,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);
this.enabledButtons.unshift(b);e=d.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+e,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(e);this.own(m(b,"click",f.hitch(this,function(c){if(a.onClick)a.onClick(c);else this.close()})))},setButtonProps:function(a,e){"number"===typeof a&&isFinite(a)||(e=a,a=0);if(e&&0!==this.enabledButtons.length)for(var b in e)"title"===b?(d.setAttr(this.enabledButtons[a],
"title",e[b]),d.setAttr(this.disabledButtons[a],"title",e[b])):"label"===b&&(d.setProp(this.enabledButtons[a],"innerHTML",e[b]),d.setProp(this.disabledButtons[a],"innerHTML",e[b]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(d.setStyle(this.enabledButtons[a],"display","inline-block"),d.setStyle(this.disabledButtons[a],"display","none")):(k.forEach(this.enabledButtons[a],f.hitch(this,function(a){d.setStyle(a,"display","inline-block")})),k.forEach(this.disabledButtons[a],
f.hitch(this,function(a){d.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(d.setStyle(this.disabledButtons[a],"display","inline-block"),d.setStyle(this.enabledButtons[a],"display","none")):(k.forEach(this.disabledButtons,f.hitch(this,function(a){d.setStyle(a,"display","inline-block")})),k.forEach(this.enabledButtons,f.hitch(this,function(a){d.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(d.setStyle(this.disabledButtons[a],"display","none"),d.setStyle(this.enabledButtons[a],"display","none")):(k.forEach(this.disabledButtons,f.hitch(this,function(a){d.setStyle(a,"display","none")})),k.forEach(this.enabledButtons,f.hitch(this,function(a){d.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(p,f,k,d,b,m){d=p("dojo.dnd.move.constrainedMoveable",m,{constraints:function(){},within:!1,constructor:function(b,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(b){var a=this.constraintBox=this.constraints.call(this,b);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(b=f.getMarginSize(b.node),a.r-=b.w,a.b-=b.h)},onMove:function(b,a){var n=this.constraintBox,l=b.node.style;this.onMoving(b,a);a.l=a.l<n.l?n.l:n.r<a.l?n.r:a.l;a.t=a.t<n.t?n.t:n.b<a.t?n.b:a.t;l.left=
a.l+"px";l.top=a.t+"px";this.onMoved(b,a)}});b=p("dojo.dnd.move.boxConstrainedMoveable",d,{box:{},constructor:function(b,a){var n=a&&a.box;this.constraints=function(){return n}}});p=p("dojo.dnd.move.parentConstrainedMoveable",d,{area:"content",constructor:function(b,a){var n=a&&a.area;this.constraints=function(){var a=this.node.parentNode,b=k.getComputedStyle(a),g=f.getMarginBox(a,b);if("margin"==n)return g;var h=f.getMarginExtents(a,b);g.l+=h.l;g.t+=h.t;g.w-=h.w;g.h-=h.h;if("border"==n)return g;
h=f.getBorderExtents(a,b);g.l+=h.l;g.t+=h.t;g.w-=h.w;g.h-=h.h;if("padding"==n)return g;h=f.getPadExtents(a,b);g.l+=h.l;g.t+=h.t;g.w-=h.w;g.h-=h.h;return g}}});return{constrainedMoveable:d,boxConstrainedMoveable:b,parentConstrainedMoveable:p}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(p,f){function k(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(d){return d},compatible:!0},{version:"1.1",
description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(d){if(d.widgetOnScreen&&d.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===d.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===d.widgetOnScreen.panel.uri))d.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel";return d},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(d){var b=0;if(d.widgetOnScreen&&d.widgetOnScreen.widgets){for(var m=
!1,b=0;b<d.widgetOnScreen.widgets.length;b++)"widgets/Splash/Widget"===d.widgetOnScreen.widgets[b].uri&&(m=!0);m||d.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});m=!1;for(b=0;b<d.widgetOnScreen.widgets.length;b++)"widgets/TimeSlider/Widget"===d.widgetOnScreen.widgets[b].uri&&(m=!0);m||d.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});m=!1;for(b=0;b<d.widgetOnScreen.widgets.length;b++)"widgets/Swipe/Widget"===
d.widgetOnScreen.widgets[b].uri&&(m=!0);m||d.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return d},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(d){(function(b){f.visitElement(b,function(b){b.positionRelativeTo&&(b.position?b.position.relativeTo=b.positionRelativeTo:b.position={relativeTo:b.positionRelativeTo},b.panel&&(b.panel.position?b.panel.position.relativeTo=b.panel.positionRelativeTo:
b.panel.position={relativeTo:b.panel.positionRelativeTo}))});var m=b.widgetOnScreen;m&&(m.panel&&m.panel.positionRelativeTo)&&(m.panel.position?m.panel.position.relativeTo=m.panel.positionRelativeTo:m.panel.position={relativeTo:m.panel.positionRelativeTo});if((m=b.widgetPool)&&m.panel&&m.panel.positionRelativeTo)m.panel.position?m.panel.position.relativeTo=m.panel.positionRelativeTo:m.panel.position={relativeTo:m.panel.positionRelativeTo}})(d);d.widgetOnScreen&&(d.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===
d.widgetOnScreen.panel.uri)&&(d.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(b){if(b.widgetOnScreen&&b.widgetOnScreen.widgets&&b.theme&&"FoldableTheme"===b.theme.name){var m=null,d=null;if(m=b.widgetOnScreen.widgets[4])void 0!==m.position.top?(m={position:{left:205,top:45}},d={position:{left:255,top:45}}):(m={position:{left:205,bottom:55}},d={position:{left:255,bottom:55}}),b.widgetOnScreen.widgets.splice(7,0,m,d)}})(d);(function(){for(var b=0,m=0,f=!1,b=0;b<d.widgetOnScreen.widgets.length;b++)if("widgets/Geocoder/Widget"===
d.widgetOnScreen.widgets[b].uri){f=!0;break}for(var a=!1,m=0;m<d.widgetOnScreen.widgets.length;m++)if("widgets/Search/Widget"===d.widgetOnScreen.widgets[m].uri){a=!0;break}!a&&f&&(b=d.widgetOnScreen.widgets[b],b.uri="widgets/Search/Widget",b.name="Search")})(d);(function(b){for(var m=0,m=b.widgetOnScreen.widgets.length-1;0<=m;m--){var d=b.widgetOnScreen.widgets[m];if("widgets/Swipe/Widget"===d.uri&&!d.closeable&&(b.widgetOnScreen.widgets.splice(m,1),!1!==d.visible)){d.closeable=!0;var a;a:{for(a=
a=0;a<b.widgetOnScreen.widgets.length;a++)if(!b.widgetOnScreen.widgets[a].uri)break a;a=-1}0<=a&&(d.position=b.widgetOnScreen.widgets[a].position,b.widgetOnScreen.widgets[a]=d)}"widgets/TimeSlider/Widget"===d.uri&&(!1===d.visible?b.widgetOnScreen.widgets.splice(m,1):d.closeable=!0)}})(d);d.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});d.loadingPage||(d.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,
uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return d},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(d){if(d.theme){var b=d.theme.name;if(("FoldableTheme"===b||"JewelryBoxTheme"===b)&&d.widgetOnScreen){var m=d.widgetOnScreen.widgets;if(m&&0<m.length)for(var b="themes/"+b+"/widgets/HeaderController/Widget",f=null,a=0;a<m.length;a++)if((f=m[a])&&f.uri===b&&f.position&&310===f.position.paddingRight)f.position.paddingRight=
275}}return d},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(d){d.keepAppState=!0;return d},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(d){return d},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(d){return d},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(d){return d},compatible:!0},{version:"2.2",
description:"The version for Online 4.3.",upgrader:function(d){return d},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(d){function b(a,n){if(!a||!n)return!1;for(var l in n)if(n.hasOwnProperty(l))if("object"===typeof n[l]){if(!b(a[l],n[l]))return!1}else if(a[l]!==n[l])return!1;return!0}function m(a){function n(){var g=b(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),h=b(a[12],{position:{top:10,right:195}});return g&&h}function l(){var g=
b(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),h=b(a[12],{position:{left:15,top:233}});return g&&h}function m(){var g=b(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),h=b(a[12],{position:{right:15,top:195}});return g&&h}(function(){var g=b(a[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),h=b(a[12],{position:{left:240,top:53}});return g&&h})()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):
n()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):l()?a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):m()&&a.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function f(a){function n(){var l=b(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),g=b(a[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),h=b(a[4],{position:{left:7,
bottom:70}});return l&&g&&h}function l(){var l=b(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),g=b(a[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),h=b(a[4],{position:{left:7,bottom:70}});return l&&g&&h}(function(){var l=b(a[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),g=b(a[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),h=b(a[4],{position:{left:55,top:45}});return l&&g&&h}()||n()||l())&&a.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:148,left:7},version:"2.3"})}(function(a,n,l){a=a.theme&&a.theme.name;if("FoldableTheme"===a)if(b(n[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(b(n[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),l&&l.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{right:12,top:211},version:"2.3"});else{if(b(n[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(a=0;a<n.length;a++){var d=n[a];b(d,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(d.position.left=288);b(d,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(d.position.left=463)}l&&l.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===a)m(n);else if("BoxTheme"===a)n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===a)f(n);else if("LaunchpadTheme"===a){if(b(n[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||b(n[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),
l&&l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===a?(b(n[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),b(n[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===a&&b(n[11],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}})&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(d,d.widgetOnScreen.widgets,d.mobileLayout&&d.mobileLayout.widgetOnScreen&&d.mobileLayout.widgetOnScreen.widgets);return d},compatible:!0}];this.isCompatible=function(d,b){for(var m=this.getVersionIndex(d),f=this.getVersionIndex(b),m=m+1;m<=f;m++)if(!1===this.versions[m].compatible)return!1;return!0}}k.prototype=new p;return k.prototype.constructor=k})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(p,f,k){f=this.getVersionIndex(f);k=this.getVersionIndex(k);if(f>k)throw Error("New version should higher than old version.");for(f+=1;f<=k;f++)this.versions[f].upgrader&&(p=this.versions[f].upgrader(p));return p};this.getVersionIndex=function(p){p=this.fixVersion(p);var f,k;for(k=0;k<this.versions.length;k++)this.versions[k].version===p&&(f=k);null===p&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(p){return!p?null:p}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y){var x=null,w;w=p(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c,a){this._removeHash(c);this.urlParams=c||{};this.widgetManager=s.getInstance();f.mixin(this,a)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(c){var a=this.checkConfig(c);if(a)throw Error(a);this.rawAppConfig=f.clone(c);t.getInstance().setRawAppConfig(this.rawAppConfig);
c=this._upgradeAppConfig(c);this._processAfterTryLoad(c);this.appConfig=c;if(this.urlParams.id)return this.loadWidgetsManifest(c).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(c)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(c);return this.getAppConfig()}));h.setPortalUrl(c.portalUrl);y.arcgisUrl=e.getBaseItemUrl(c.portalUrl);return this._proesssWebTierAndSignin(c).then(f.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?
this._getAppConfigFromTemplateAppId(c.portalUrl,this.urlParams.appid).then(f.hitch(this,function(c){this._tryUpdateAppConfigByLocationUrl(c);return this._processInPortalAppProtocol(c)})):this._processNotInPortalAppProtocol(c).then(f.hitch(this,function(c){return this._getAppDataAddTemplateDataFromTemplateAppId(c.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){a.appData.appConfig&&(c=a.appData.appConfig);c._appData=a.appData;c.templateConfig=a.templateData;c.isTemplateApp=!0;return c}))})):
this._processNotInPortalAppProtocol(c)})).then(f.hitch(this,function(c){this._processAfterTryLoad(c);this.appConfig=c;return c.map.itemId?c:(c.map["3D"]?r.getDefaultWebScene(c.portalUrl):r.getDefaultWebMap(c.portalUrl)).then(function(a){c.map.itemId=a;return c})})).then(f.hitch(this,function(c){return this.loadWidgetsManifest(c)})).then(f.hitch(this,function(c){return c._appData?c._appData.values&&c._appData.values.webmap?r.getPortal(c.portalUrl).getItemById(c._appData.values.webmap).then(f.hitch(this,
function(a){return l.template.mergeTemplateAppConfigToAppConfig(c,c._appData,a)})):l.template.mergeTemplateAppConfigToAppConfig(c,c._appData):c})).then(f.hitch(this,function(c){return this.loadAndUpgradeAllWidgetsConfig(c)})).then(f.hitch(this,function(c){this._configLoaded=!0;this._setDocumentTitle(c);return this.getAppConfig()}))}),f.hitch(this,function(c){this.showError(c);var a=new q;a.reject(c);return a}))},_setDocumentTitle:function(c){!window.isBuilder&&(c&&c.title)&&(document.title=l.stripHTML(c.title))},
getAppConfig:function(){var c=f.clone(this.appConfig);c.getConfigElementById=function(c){return l.getConfigElementById(this,c)};c.getConfigElementsByName=function(c){return l.getConfigElementsByName(this,c)};c.visitElement=function(c){l.visitElement(this,c)};this._addAuthorizedCrossOriginDomains(this.portalSelf,c);return c},_addAuthorizedCrossOriginDomains:function(c,a){c&&c.authorizedCrossOriginDomains&&h.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains);a&&a.authorizedCrossOriginDomains&&
h.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains)},checkConfig:function(c){return(c=this._getRepeatedId(c))?"repeated id:"+c:null},processProxy:function(c){u.defaults.io.alwaysUseProxy=c.httpProxy&&c.httpProxy.useProxy&&c.httpProxy.alwaysUseProxy;u.defaults.io.proxyUrl="";u.defaults.io.proxyRules=[];c.httpProxy&&(c.httpProxy.useProxy&&c.httpProxy.url)&&(u.defaults.io.proxyUrl=c.httpProxy.url);c.httpProxy&&(c.httpProxy.useProxy&&c.httpProxy.rules)&&k.forEach(c.httpProxy.rules,function(c){v.addProxyRule(c)})},
addNeedValues:function(c){this._processNoUriWidgets(c);this._addElementId(c)},showError:function(c){c&&c.message&&d.create("div",{"class":"app-error",innerHTML:c.message},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,n(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(c){h.setPortalUrl(c.portalUrl);
c.portalUrl&&(window.portalUrl=c.portalUrl);return this.urlParams.token?h.registerToken(this.urlParams.token).then(function(){return c}):c}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var c=e.getPortalUrlFromLocation(),a=new q;h.setPortalUrl(c);window.portalUrl=c;y.arcgisUrl=e.getBaseItemUrl(c);var b;this.urlParams.token?b=h.registerToken(this.urlParams.token):(b=new q,b.resolve());b.then(f.hitch(this,function(){r.getPortal(c).loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=
b;b.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href),a.reject()):this._processSignIn(c).then(f.hitch(this,function(){this._getAppConfigFromAppId(c,this.urlParams.id).then(f.hitch(this,function(c){this._tryUpdateAppConfigByLocationUrl(c);return this._processInPortalAppProtocol(c)})).then(function(c){a.resolve(c)},function(c){a.reject(c)})}))}))}),f.hitch(this,function(c){this.showError(c)}));return a}this.configFile=
"config.json";return n(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(c){h.setPortalUrl(c.portalUrl);c.portalUrl&&(window.portalUrl=c.portalUrl);return this.urlParams.token?h.registerToken(this.urlParams.token).then(function(){return c}):c}))},_upgradeAppConfig:function(c){var a=window.wabVersion,e=c.wabVersion;if(a===e)return c;var b=this.versionManager.getVersionIndex(e),g=this.versionManager.getVersionIndex(a);if(b>g)throw Error("Bad version number, "+e);c=this.versionManager.upgrade(c,
e,a);c.wabVersion=a;return c},loadAndUpgradeAllWidgetsConfig:function(c){var e=new q,b=[];g.visitElement(c,f.hitch(this,function(c){c.uri&&(c=this.widgetManager.tryLoadWidgetConfig(c),b.push(c))}));a(b).then(f.hitch(this,function(){e.resolve(c)}),function(c){e.reject(c)});return e},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);c.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(c){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var a=e.getPortalUrlFromLocation(),a=e.getStandardPortalUrl(a);e.isOnline(a)&&(a=e.updateUrlProtocolByOtherUrl(a,c.portalUrl),c.map.portalUrl&&e.isSamePortalUrl(c.portalUrl,c.map.portalUrl)&&(c.map.portalUrl=a),c.portalUrl=a,c.httpProxy&&c.httpProxy.url&&(c.httpProxy.url=e.getPortalProxyUrl(a)))}},_processWidgetJsons:function(c){g.visitElement(c,function(c,a){a.isWidget&&c.uri&&l.widgetJson.processWidgetJson(c)})},_processNoUriWidgets:function(c){var a=
0;g.visitElement(c,function(c,e){e.isWidget&&!c.uri&&(a++,c.placeholderIndex=a)})},_addElementId:function(c){var a=0,e;g.visitElement(c,function(c){if(c.id){c.id=c.id.replace(/\//g,"_");var b=c.id.lastIndexOf("_");-1<b&&(e=c.id.substr(b+1),a=Math.max(a,e))}});g.visitElement(c,function(c){c.id||(a++,c.id=c.uri?c.uri.replace(/\//g,"_")+"_"+a:"_"+a)})},_setPortalUrl:function(c){if(c.portalUrl){var a=e.getPortalUrlFromLocation(),b=e.isOnline(a);!e.isSamePortalUrl(c.portalUrl,a)&&!b&&(window.appInfo.isRunInPortal=
!1)}else window.isXT&&m("wab_portalurl")?c.portalUrl=m("wab_portalurl"):(window.appInfo.isRunInPortal=!0,c.portalUrl=e.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(c,a){c.portalUrl=e.setProtocol(c.portalUrl,a);c.map.portalUrl&&(c.map.portalUrl=e.setProtocol(c.map.portalUrl,a));c.httpProxy&&(c.httpProxy.url=e.setProtocol(c.httpProxy.url,a),c.httpProxy&&c.httpProxy.rules&&k.forEach(c.httpProxy.rules,f.hitch(this,function(c){c.proxyUrl=e.setProtocol(c.proxyUrl,a)})))},_processInPortalAppProtocol:function(c){var a=
new q,b=r.getPortal(c.portalUrl),g=f.hitch(this,function(b){if("https:"===window.location.protocol)this._changePortalUrlProtocol(c,"https");else{if(b){console.log("redirect from http to https");window.location.href=e.setHttpsProtocol(window.location.href);a.reject();return}this._changePortalUrlProtocol(c,"http")}this._checkLocale();a.resolve(c)});b.loadSelfInfo().then(f.hitch(this,function(a){"private"===a.access?(a=0===c.portalUrl.toLowerCase().indexOf("https://"),g(a)):g(a.allSSL)}),f.hitch(this,
function(c){a.reject(c)}));return a},_processNotInPortalAppProtocol:function(c){var a=new q;c.portalUrl?r.getPortal(c.portalUrl).loadSelfInfo().then(f.hitch(this,function(b){var g="https:"===window.location.protocol;(b.allSSL||g)&&this._changePortalUrlProtocol(c,"https");0===c.portalUrl.toLowerCase().indexOf("https://")&&!g&&!h.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href),a.reject()):a.resolve(c)}),f.hitch(this,
function(c){a.reject(c)})):a.resolve(c);return a},_proesssWebTierAndSignin:function(c){var a=new q,e=!1,b=c.portalUrl;this._processWebTier(c).then(f.hitch(this,function(c){e=c;return r.getPortal(b).loadSelfInfo()})).then(f.hitch(this,function(c){this.portalSelf=c;return this._processSignIn(b,e)})).then(f.hitch(this,function(){a.resolve()}),function(c){a.reject(c)});return a},_processWebTier:function(c){var a=new q,b=c.portalUrl;c.isWebTier?(h.addAuthorizedCrossOriginDomains([b]),h.isWebTierPortal(b).then(f.hitch(this,
function(){var g=h.getPortalCredential(b);g&&g.ssl&&"http:"===window.location.protocol&&!h.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href)):a.resolve(c.isWebTier)}),f.hitch(this,function(c){a.reject(c)}))):a.resolve(!1);return a},_processSignIn:function(a,b){var g=new q,l=r.getPortal(a),t=e.getSharingUrl(a);window.appInfo.isRunInPortal?(t=c.checkSignInStatus(t),t.promise.always(f.hitch(this,function(){g.resolve()}))):
(!h.isInBuilderWindow()&&(!h.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!b)&&h.registerOAuthInfo(a,this.rawAppConfig.appId),t=c.checkSignInStatus(t),t.promise.always(f.hitch(this,function(){h.xtGetCredentialFromCookie(a);l.loadSelfInfo().then(f.hitch(this,function(c){this.portalSelf=c;this._checkLocale();g.resolve()}))})));return g},_checkLocale:function(){if(!h.isInConfigOrPreviewWindow()){var c=this.portalSelf.user&&this.portalSelf.user.culture||
b.locale,c=c.toLowerCase();!this.urlParams.locale&&l.isLocaleChanged(b.locale,c)&&(m("wab_app_locale",c),window.location.reload())}},_getAppConfigFromTemplateAppId:function(c,e){var b=r.getPortal(c);return this._getWabAppIdAndDataFromTemplateAppId(c,e).then(f.hitch(this,function(e){var g=e.appData;return a([this._getAppConfigFromAppId(c,e.appId),b.getItemData(g.source)]).then(f.hitch(this,function(c){var a;g.appConfig?(a=g.appConfig,delete g.appConfig):a=c[0];a=this._upgradeAppConfig(a);c=c[1];a._appData=
g;a.templateConfig=c;a.isTemplateApp=!0;return a}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(c,a){var e=r.getPortal(c);return e.getItemData(a).then(function(c){return e.getItemData(c.source).then(function(a){return{appData:c,templateData:a}})})},_getWabAppIdAndDataFromTemplateAppId:function(c,a){var e=new q,b=r.getPortal(c);b.getItemData(a).then(f.hitch(this,function(c){b.getItemById(c.source).then(f.hitch(this,function(a){a=v.urlToObject(a.url);e.resolve({appId:a.query.id,appData:c})}))}),
function(c){e.reject(c)});return e},_getAppConfigFromAppId:function(c,a){return r.getPortal(c).getItemData(a)},_removeHash:function(c){for(var a in c)c[a]&&(c[a]=c[a].replace("#",""))},loadWidgetsManifest:function(c){function e(a,g){return a.loadWidgetManifest(g).then(function(c){return c},function(a){a.stack?console.error(a.stack):(console.log(a),console.log("Widget is removed."));b(c,g)})}function b(c,a){function e(b){c[b]&&c[b].widgets&&(c[b].widgets=c[b].widgets.filter(function(c){if(a)return c.id!==
a.id;c.uri&&!c.manifest&&console.error("Widget is removed because it is not loaded successfully.",c.uri);return c.manifest}));c[b]&&c[b].groups&&c[b].groups.forEach(function(c){c.widgets&&(c.widgets=c.widgets.filter(function(c){if(a)return c.id!==a.id;c.uri&&!c.manifest&&console.error("Widget is removed because it is not loaded successfully.",c.uri);return c.manifest}))})}e("widgetOnScreen");e("widgetPool")}var h=[],r=new q;c._buildInfo&&c._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,
function(e){g.visitElement(c,f.hitch(this,function(c){!c.widgets&&c.uri&&(e[c.uri]?(this._addNeedValuesForManifest(e[c.uri],c.uri),l.widgetJson.addManifest2WidgetJson(c,e[c.uri])):h.push(this.widgetManager.loadWidgetManifest(c)))}));a(h).then(function(){r.resolve(c)})})):(g.visitElement(c,f.hitch(this,function(c){!c.widgets&&c.uri&&h.push(e(this.widgetManager,c))})),a(h).then(function(){r.resolve(c)}));setTimeout(function(){r.isResolved()||(b(c),r.resolve(c))},6E4);return r},_addNeedValuesForManifest:function(c,
a){f.mixin(c,l.getUriInfo(a));l.manifest.addManifestProperies(c);l.manifest.processManifestLabel(c,b.locale)},_loadMergedWidgetManifests:function(){return n(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(c){var a=[],e;g.visitElement(c,function(c){if(0<=a.indexOf(c.id))return e=c.id,!0;a.push(c.id)});return e},_processUrlParams:function(c){var a=this.urlParams.itemid||this.urlParams.webmap;a&&c.map.itemId!==a&&(c.map.mapOptions&&l.deleteMapOptions(c.map.mapOptions),
c.map.itemId=a);this.urlParams.mode&&(c.mode=this.urlParams.mode);c.map.mapOptions||(c.map.mapOptions={});this.urlParams.scale&&(c.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)c.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});w.getInstance=function(c,a){null===x?x=new w(c,a):(x.urlParams=c,x.options=a);return x};return w})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s){var g=p([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(c){this.portalUrl=l.getStandardPortalUrl(c);this.selfUrl=l.getPortalSelfInfoUrl(c)},loadSelfInfo:function(){var c=new b,e={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(e.content.token=this.credential.token);a(e).then(f.hitch(this,function(a){var e=a.user;delete a.user;
f.mixin(this,a);a.user=e;c.resolve(a)}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_checkCredential:function(){var c=s.isValidCredential(this.credential);c||this.clearCredentialAndUser();return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=s.getPortalCredential(this.portalUrl))},signIn:function(){var c=new b;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,
function(){c.resolve(this.credential)}),0):c=s.signInPortal(this.portalUrl);return c},haveSignIn:function(){return s.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var c=new b;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();c.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,
function(a){this.user=a;c.resolve(this.user)}),f.hitch(this,function(a){console.error(a);c.reject(a)})):s.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(f.hitch(this,function(a){this.user=a;c.resolve(this.user)}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(f.hitch(this,function(){c.reject("credential is null.")}),
0);return c},queryItems:function(c){this.updateCredential();var g=new b,h=l.getBaseSearchUrl(this.portalUrl),r={f:"json"};c&&(r=f.mixin(r,c));this.isValidCredential()&&(r.token=this.credential.token);!r.sortField&&!r.sortOrder&&(r.sortField="title",r.sortOrder="asc");a({url:h,handleAs:"json",content:r,callbackParamName:"callback"}).then(f.hitch(this,function(c){c.results=k.map(c.results,f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;return new e(c)}));
g.resolve(c)}),f.hitch(this,function(c){console.error(c);g.reject(c)}));return g},getItemData:function(c){this.updateCredential();c={url:l.getItemDataUrl(this.portalUrl,c),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return a(c)},_getItemById:function(c,b){var g={url:l.getItemUrl(this.portalUrl,c),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};b&&(g.content.token=b);return a(g).then(f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;
c.portal=this;return new e(c)}))},getItemById:function(c,a){this.updateCredential();return this._getItemById(c).then(f.hitch(this,function(e){return a&&e.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===e.owner?this._getItemById(c,this.credential.token):e}))},getAppById:function(c){var e=new b;this.updateCredential();this.isValidCredential()?(c=l.getAppIdUrl(this.portalUrl,c),e=a({url:c,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,
function(){e.reject("token is null.")}),0);return e},queryGroups:function(c){this.updateCredential();var e=new b,g=l.getBaseGroupUrl(this.portalUrl),h={f:"json"};c&&(h=f.mixin(h,c));this.isValidCredential()&&(h.token=this.credential.token);a({url:g,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(c){c.results=k.map(c.results,f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;return new r(c)}));e.resolve(c)}),f.hitch(this,
function(c){console.error(c);e.reject(c)}));return e},registerApp:function(c,e,g){var h=new b;this.updateCredential();if(this.isValidCredential())var r=this.credential&&this.credential.token,t=l.getOAuth2Url(this.portalUrl),h=a({url:t+"/registerApp",content:{itemId:c,appType:e,redirect_uris:q.stringify(g),token:r,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},createAndRegisterApp:function(c){var a=new b;this.updateCredential();
this.isValidCredential()?this.getUser().then(f.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",c).then(f.hitch(this,function(c){a.resolve(c)}),f.hitch(this,function(c){console.error(c);a.reject(c)})):a.reject("create app failed")}),f.hitch(this,function(c){console.error(c);a.reject(c)}))}),f.hitch(this,function(c){console.error(c);
a.reject(c)})):setTimeout(f.hitch(this,function(){a.reject("token is null.")}),0);return a},_getUser:function(c){this.updateCredential();var e=new b;c={url:l.getUserUrl(this.portalUrl,c),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential&&this.credential.token);a(c).then(f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;this.user=new h(c);e.resolve(this.user)}),f.hitch(this,function(c){console.error(c);
e.reject(c)}));return e}}),h=p([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(c){c&&f.mixin(this,c)},_checkCredential:function(){var c=s.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var c=[];
this.groups&&(c=k.map(this.groups,f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this.portal;return new r(c)})));return c},getItemsByKeywords:function(c,a){return this.portal.queryItems({start:a||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+c+'"'})},getContent:function(){this.updateCredential();var c={url:l.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&
(c.content.token=this.credential.token);return a(c)},getTags:function(){this.updateCredential();var c={url:l.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential.token);return a(c)},addItem:function(c,e){this.updateCredential();var g=new b;if(this.isValidCredential()){var h={f:"json",token:this.credential.token};c&&(h=f.mixin(h,c));a({url:l.getAddItemUrl(this.portalUrl,this.username,
e),handleAs:"json",callbackParamName:"callback",content:h},{usePost:!0}).then(f.hitch(this,function(c){g.resolve(c)}),f.hitch(this,function(c){console.error(c);g.reject(c)}))}else setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},deleteItem:function(c){this.updateCredential();var e=new b;this.isValidCredential()?(c=l.getDeleteItemUrl(this.portalUrl,this.username,c),e=a({url:c,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,
function(){e.reject("token is null.")}),0);return e},getItemById:function(c,g){this.updateCredential();var h=new b,r={url:l.getUserItemsUrl(this.portalUrl,this.username,g)+"/"+c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};a(r).then(f.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;c=new e(c);h.resolve(c)}),f.hitch(this,function(c){console.error(c);h.reject(c)}));return h},shareItem:function(c,e,g){this.updateCredential();var h=new b;
this.isValidCredential()?(e={url:l.shareItemUrl(this.portalUrl,this.username,e,g),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},c&&(e.content=f.mixin(e.content,c)),a(e,{usePost:!0}).then(f.hitch(this,function(c){h.resolve(c)}),f.hitch(this,function(c){console.error(c);h.reject(c)}))):setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},updateItem:function(c,e){this.updateCredential();var g=new b;this.isValidCredential()?this.portal.getItemById(c).then(f.hitch(this,
function(b){var h={f:"json",token:this.credential.token};e&&(h=f.mixin(h,e));a({url:l.getUpdateItemUrl(this.portalUrl,b.owner,c,b.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:h},{usePost:!0}).then(f.hitch(this,function(c){g.resolve(c)}),f.hitch(this,function(c){console.error(c);g.reject(c)}))}),f.hitch(this,function(c){console.error(c);g.reject(c)})):setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),r=p([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(c){c&&f.mixin(this,c)},_checkCredential:function(){var c=s.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(c){c.q="group:"+this.id+" AND "+c.q;return this.portal.queryItems(c)}}),e=p([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(c){c&&f.mixin(this,c);this.itemUrl=l.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&
(this.thumbnail&&this.itemUrl)&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=l.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=l.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var c=s.isValidCredential(this.credential);c||(this.credential=
null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var c={url:l.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=
this.credential.token);return a(c)}}),t={portals:[],webMapQueryStr:" "+n.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+n.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(c){for(var a=0;a<this.portals.length;a++){var e=this.portals[a];if(l.isSamePortalUrl(c,e.portalUrl))return e.updateCredential(),e}return null},getPortal:function(c){if(!c||!("string"===typeof c&&f.trim(c)))return null;c=l.getStandardPortalUrl(c);var a=this._findPortal(c);a||(a=new g(c),a.credential=
s.getPortalCredential(a.portalUrl),a.updateCredential(),this.portals.push(a));return a},getPortalSelfInfo:function(c){return this.getPortal(c).loadSelfInfo()},getBasemapGalleryGroup:function(c){return this._getPortalSelfGroup(c,"basemapGalleryGroupQuery")},getTemplatesGroup:function(c){return this._getPortalSelfGroup(c,"templatesGroupQuery")},getUnits:function(c){var a="english",e="",g=new b;this.getPortal(c).getUser().then(f.hitch(this,function(c){c&&c.units?a=c.units:(e=d.locale,a=e.startWith("en")?
"english":"metric");g.resolve(a)}),f.hitch(this,function(b){console.warn(b);this.getPortalSelfInfo(c).then(f.hitch(this,function(c){var a=null;c&&c.units?a=c.units:(e=c&&c.culture||d.locale,a=e.startWith("en")?"english":"metric");g.resolve(a)}),f.hitch(this,function(c){console.warn(c);e=d.locale;a=e.startWith("en")?"english":"metric";g.resolve(a)}))}));return g.promise},_getPortalSelfGroup:function(c,a){var e=new b,g=this.getPortal(c);g||setTimeout(f.hitch(this,function(){e.reject()}),0);this.getPortalSelfInfo(c).then(f.hitch(this,
function(c){g.queryGroups({f:"json",q:c[a]}).then(f.hitch(this,function(c){0<c.results.length?(c=c.results[0],c.portalUrl=g.portalUrl,c.credential=g.credential,c.portal=g,c=new r(c),e.resolve(c)):e.reject("Can't find portal self group.")}),f.hitch(this,function(c){console.error(c);e.reject(c)}))}),f.hitch(this,function(c){console.error(c);e.reject(c)}));return e},getWebMapsFromBasemapGalleryGroup:function(c){var a=new b;this.getBasemapGalleryGroup(c).then(f.hitch(this,function(c){c?c.queryItems({start:1,
num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,function(c){a.resolve(c)}),f.hitch(this,function(c){console.error(c);a.reject(c)})):a.reject()}),f.hitch(this,function(c){console.error(c);a.reject(c)}));return a},getDefaultWebScene:function(c){var a=l.getStandardPortalUrl(c);return this._searchWABDefaultWebScene(a).then(f.hitch(this,function(c){return c?c:this._createWABDefaultWebScene(a).then(f.hitch(this,function(c){return this.getPortal(a).getUser().then(f.hitch(this,function(a){var e=
!1;a&&(a.privileges&&0<a.privileges.length)&&(e=k.some(a.privileges,function(c){return 0<=c.indexOf("shareToPublic")}));return e?a.shareItem({everyone:!0},c).then(f.hitch(this,function(){return c}),f.hitch(this,function(){return c})):c}),f.hitch(this,function(a){console.error(a);return c}))}))}))},_searchWABDefaultWebScene:function(c){var a=new b;c=l.getStandardPortalUrl(c);this.getPortal(c).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(f.hitch(this,
function(c){c&&c.results&&0<c.results.length?a.resolve(c.results[0].id):a.resolve(null)}),f.hitch(this,function(c){console.error("_searchWABDefaultWebScene error:",c);a.reject(c)}));return a},_createWABDefaultWebScene:function(c){var a=new b;c=l.getStandardPortalUrl(c);this.getPortal(c).getUser().then(f.hitch(this,function(c){var e={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:q.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",
title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",
initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},heading:0,tilt:0.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};c.addItem(e,"").then(f.hitch(this,function(c){c.success?
a.resolve(c.id):(console.error("Can't create default web scene:",c),a.reject())}))}),f.hitch(this,function(c){console.error("Can't create default web scene");a.reject(c)}));return a},getDefaultWebMap:function(c){var a=new b;this.getPortalSelfInfo(c).then(f.hitch(this,function(e){var b=e.defaultBasemap&&e.defaultBasemap.id;b?a.resolve(b):this._getDefaultWebMapByBasemapGallery(c,e).then(f.hitch(this,function(e){e?a.resolve(e):this._getMostNumViewsWebMap(c).then(f.hitch(this,function(c){c?a.resolve(c):
a.reject()}),f.hitch(this,function(c){console.error(c);a.reject(c)}))}),f.hitch(this,function(c){console.error(c);a.reject(c)}))}),f.hitch(this,function(c){console.error(c);a.reject(c)}));return a},_getDefaultWebMapByBasemapGallery:function(c,a){var e=new b,g=this.getPortal(c),h=a.defaultBasemap&&a.defaultBasemap.title;g.queryGroups({f:"json",q:a.basemapGalleryGroupQuery}).then(f.hitch(this,function(c){c=c.results;0<c.length?g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+
c[0].id+" AND title:"+h}).then(f.hitch(this,function(c){c=c.results;c=k.filter(c,f.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));0<c.length?e.resolve(c[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+h}).then(f.hitch(this,function(c){c=c.results;c=k.filter(c,f.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));if(0<c.length){var a=c[0];g.getItemData(a.id).then(f.hitch(this,
function(c){c&&(c.operationalLayers||c.baseMap||c.version)?e.resolve(a.id):e.resolve(null)}),f.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),e.resolve(null)}),f.hitch(this,function(c){console.error(c);e.reject(c)})))}),f.hitch(this,function(c){console.error(c);e.reject(c)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),f.hitch(this,function(c){console.error(c);e.reject(c)}));return e},_getMostNumViewsWebMap:function(c){var a=
new b;this.getPortal(c).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(c){c=c.results;c=k.filter(c,f.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));0<c.length?a.resolve(c[0].id):a.reject("Can't find most-num-views web map.")}),f.hitch(this,function(c){console.error(c);a.reject(c)}));return a},comparePortalVersion:function(c,a){var e=c.split("."),b=parseInt(e[0],
10),e=1<e.length?parseInt(e[1],10):0,g=a.split("."),h=parseInt(g[0],10),g=1<g.length?parseInt(g[1],10):0;return b>h?1:b<h?-1:e>g?1:e<g?-1:0}};m.subscribe("userSignOut",function(c){(c=t._findPortal(c))&&c.clearCredentialAndUser()});return t})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(p,f,k,d,b,m,q,a,n){var l=null,s=p(null,{rawAppConfig:null,
mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=d.stringify(this.rawAppConfig.map);this.mapMd5=a(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new k,h={};if(n.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(h),
a;var l=this._getAppStateKey(),e=q.get(l);e&&e.appStateMd5===this._getAppStateMd5()?(l=e.map&&e.map.extent,e=e.map&&e.map.layers,l&&(h.extent=new b(l.xmin,l.ymin,l.xmax,l.ymax,new m(l.spatialReference))),e&&(h.layers=e)):q.remove(l);a.resolve(h);return a},saveWabAppState:function(a,b){if(a&&!n.isInConfigOrPreviewWindow()){var l=this._getAppStateKey(),e={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},
layers:{}};b&&b.traversal&&b.traversal(f.hitch(this,function(a){e.layers[a.id]={visible:a.isVisible()}}));q.set(l,{map:e,appStateMd5:this._getAppStateMd5()})}}});s.getInstance=function(a){null===l&&(l=new s);l.urlParams=a;return l};return s})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(p,f,k,d){return p(f,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);
(this.hidden=!0===this.hidden)&&k.set(this.domNode,{display:"none"});k.set(this.domNode,{width:"100%",height:"100%"});var b='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';d.place(b,this.domNode)},show:function(){this.domNode&&k.set(this.domNode,"display","block")},hide:function(){this.domNode&&k.set(this.domNode,"display","none")}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x){var w=null,B;B=p([b],{constructor:function(c,a){this.widgetManager=e.getInstance();this.panelManager=t.getInstance();this.own(m.subscribe("appConfigLoaded",f.hitch(this,this.onAppConfigLoaded)));this.own(m.subscribe("appConfigChanged",f.hitch(this,this.onAppConfigChanged)));this.own(m.subscribe("mapLoaded",f.hitch(this,this.onMapLoaded)));this.own(m.subscribe("mapChanged",f.hitch(this,this.onMapChanged)));this.own(m.subscribe("beforeMapDestory",
f.hitch(this,this.onBeforeMapDestory)));this.own(m.subscribe("preloadModulesLoaded",f.hitch(this,this._onPreloadModulesLoaded)));this.own(m.subscribe("builder/actionTriggered",f.hitch(this,this.onActionTriggered)));this.own(m.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];u.isMobileUa()||this.own(q(window,"resize",f.hitch(this,this.resize)));this.id=a;this.preloadModulesLoadDef=
new s},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){k.forEach(this.widgetManager.getAllWidgets(),function(c){!1===c.inPanel&&c.resize()},this)},onAppConfigLoaded:function(c){this.appConfig=f.clone(c);this._loadMap();this.preloadModulesLoadDef.then(f.hitch(this,function(){this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},onAppConfigChanged:function(c,
a,e){c=f.clone(c);switch(a){case "themeChange":this._onThemeChange(c);break;case "styleChange":this._onStyleChange(c);break;case "layoutChange":this._onLayoutChange(c);break;case "widgetChange":this._onWidgetChange(c,e);break;case "groupChange":this._onGroupChange(c,e);break;case "widgetPoolChange":this._onWidgetPoolChange(c,e);break;case "resetConfig":this._onResetConfig(c);break;case "loadingPageChange":this._onLoadingPageChange(c,e)}this.appConfig=c},onMapLoaded:function(c){this.map=c;this.panelManager.setMap(c);
this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadPreloadWidgets(this.appConfig)}))},onMapChanged:function(c){this.map=c;this.panelManager.setMap(c);this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},onActionTriggered:function(c){"highLight"===c.action&&(k.forEach(this.widgetPlaceholders,function(a){a.configId===c.elementId&&
this._highLight(a)},this),k.forEach(this.preloadWidgetIcons,function(a){a.configId===c.elementId&&this._highLight(a)},this),k.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.configId===c.elementId&&this._highLight(a)},this),k.forEach(this.preloadGroupPanels,function(a){a.configId===c.elementId&&this._highLight(a)},this));"removeHighLight"===c.action&&this._removeHighLight();"showLoading"===c.action&&(d.setStyle(jimuConfig.loadingId,"display","block"),d.setStyle(jimuConfig.mainPageId,
"display","none"));"showApp"===c.action&&(d.setStyle(jimuConfig.loadingId,"display","none"),d.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(c){if(c.domNode){this.hlDiv&&this._removeHighLight(c);var a=l.getMarginBox(c.domNode);this.hlDiv=n.create("div",{style:{position:"absolute",left:a.l+"px",top:a.t+"px",width:a.w+"px",height:a.h+"px"},"class":"icon-highlight"},c.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(n.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(c,
a){a=c.getConfigElementById(a.id);a.isController?this._reloadControllerWidget(c,a.id):(k.forEach(this.widgetPlaceholders,function(e){e.configId===a.id&&(e.destroy(),this._loadPreloadWidget(a,c))},this),this._removeDestroyed(this.widgetPlaceholders),k.forEach(this.preloadWidgetIcons,function(e){if(e.configId===a.id){var b=e.state;e.destroy();this._loadPreloadWidget(a,c).then(function(c){if(a.uri&&"opened"===b)c.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),k.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),
function(e){e.configId===a.id&&(e.destroy(),!1===a.visible?0>this.invisibleWidgetIds.indexOf(a.id)&&this.invisibleWidgetIds.push(a.id):this._loadPreloadWidget(a,c))},this),k.forEach(this.preloadGroupPanels,function(c){c.reloadWidget(a)},this),this._updatePlaceholder(c),k.forEach(this.invisibleWidgetIds,function(e){e===a.id&&!1!==a.visible&&(this._loadPreloadWidget(a,c),e=this.invisibleWidgetIds.indexOf(a.id),this.invisibleWidgetIds.splice(e,1))},this),a.isOnScreen||k.forEach(this.widgetManager.getControllerWidgets(),
function(e){e.widgetIsControlled(a.id)&&this._reloadControllerWidget(c,e.id)},this))},_onGroupChange:function(c,a){a=c.getConfigElementById(a.id);a.isOnScreen?(this.panelManager.destroyPanel(a.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(a,c)):(k.forEach(this.widgetManager.getControllerWidgets(),function(e){e.isControlled(a.id)&&this._reloadControllerWidget(c,e.id)},this),k.forEach(this.panelManager.panels,function(c){c.config.id===a.id&&c.updateConfig(a)},this))},
_updatePlaceholder:function(c){k.forEach(this.widgetPlaceholders,function(a){a.setIndex(c.getConfigElementById(a.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(c,a){this._reloadControllerWidget(c,a.controllerId)},_reloadControllerWidget:function(c,a){var e=this.widgetManager.getWidgetById(a);if(e){var b=e.getOpenedIds(),g=e.windowState;k.forEach(e.getAllConfigs(),function(c){if(c.widgets)this.panelManager.destroyPanel(c.id+"_panel"),k.forEach(c.widgets,function(c){this.panelManager.destroyPanel(c.id+
"_panel")},this);else{var a=this.widgetManager.getWidgetById(c.id);a&&(c.inPanel?this.panelManager.destroyPanel(a.getPanel()):this.widgetManager.destroyWidget(a))}},this);this.widgetManager.destroyWidget(e);e=c.getConfigElementById(a);!1!==e.visible&&this._loadPreloadWidget(e,c).then(f.hitch(this,function(c){this.widgetManager.changeWindowStateTo(c,g);b&&c.setOpenedIds(b)}))}},_removeDestroyed:function(c){var a=[];k.forEach(c,function(c){c._destroyed&&a.push(c)});k.forEach(a,function(a){a=c.indexOf(a);
c.splice(a,1)})},_destroyPreloadWidgetIcons:function(){k.forEach(this.preloadWidgetIcons,function(c){c.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){k.forEach(this.widgetManager.getOffPanelWidgets(),function(c){this.widgetManager.destroyWidget(c)},this)},_destroyWidgetPlaceholders:function(){k.forEach(this.widgetPlaceholders,function(c){c.destroy()},this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){k.forEach(this.preloadGroupPanels,function(c){this.panelManager.destroyPanel(c)},
this);this.preloadGroupPanels=[]},_changeMapPosition:function(c){this.map&&(u.isEqual(this.mapManager.getMapPosition(),c.map.position)||this.mapManager.setMapPosition(c.map.position))},_onThemeChange:function(c){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();this.panelManager.destroyAllPanels();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();
r(["themes/"+c.theme.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(c.theme);this._loadThemeCurrentStyle(c.theme);this._addCustomStyle(c.theme);this._changeMapPosition(c);this._loadPreloadWidgets(c)}))},_onResetConfig:function(c){var a=this.appConfig;m.publish("appConfigChanged",c,"mapChange",c);this.appConfig=a;this._updateCommonStyle(c);this._onStyleChange(c);this._changeMapPosition(c)},_onLoadingPageChange:function(c,a){if("backgroundColor"in a)d.setStyle(jimuConfig.loadingId,
"background-color",c.loadingPage.backgroundColor);else if("backgroundImage"in a){var e=c.loadingPage.backgroundImage;e.visible&&e.uri?(d.setStyle(jimuConfig.loadingImageId,"background-image","url('"+e.uri+"')"),d.setStyle(jimuConfig.loadingImageId,"width",e.width+"px"),d.setStyle(jimuConfig.loadingImageId,"height",e.height+"px")):(d.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),d.setStyle(jimuConfig.loadingImageId,"width","0px"),d.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in
a&&(e=c.loadingPage.loadingGif,e.visible&&e.uri?(d.setStyle(jimuConfig.loadingGifId,"background-image","url('"+e.uri+"')"),d.setStyle(jimuConfig.loadingGifId,"width",e.width+"px"),d.setStyle(jimuConfig.loadingGifId,"height",e.height+"px")):(d.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),d.setStyle(jimuConfig.loadingGifId,"width","0px"),d.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(c){this._removeThemeCommonStyle(this.appConfig.theme);this._loadThemeCommonStyle(c.theme)},
_onStyleChange:function(c){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(c.theme);this._removeCustomStyle();this._addCustomStyle(c.theme)},_onLayoutChange:function(c){this._changeMapPosition(c);k.forEach(this.widgetPlaceholders,function(a){a.moveTo(c.getConfigElementById(a.configId).position)},this);k.forEach(this.preloadWidgetIcons,function(a){a.moveTo(c.getConfigElementById(a.configId).position)},this);k.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){if(!a.closeable){var e=
c.getConfigElementById(a.id).position;a.setPosition(e)}},this);k.forEach(this.preloadGroupPanels,function(a){var e=c.getConfigElementById(a.config.id).panel.position;a.setPosition(e)},this)},_loadTheme:function(c){r(["themes/"+c.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(c);this._loadThemeCurrentStyle(c);this._addCustomStyle(c)}))},_loadThemeCommonStyle:function(c){u.loadStyleLink(this._getThemeCommonStyleId(c),"themes/"+c.name+"/common.css");d.addClass(this.domNode,c.name)},
_removeThemeCommonStyle:function(c){d.removeClass(this.domNode,c.name);d.destroy(this._getThemeCommonStyleId(c))},_loadThemeCurrentStyle:function(c){u.loadStyleLink(this._getThemeCurrentStyleId(c),"themes/"+c.name+"/styles/"+c.styles[0]+"/style.css");d.addClass(this.domNode,c.styles[0])},_removeThemeCurrentStyle:function(c){d.removeClass(this.domNode,c.styles[0]);d.destroy(this._getThemeCurrentStyleId(c))},_addCustomStyle:function(c){var a=f.getObject("customStyles",!1,c);if(a){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";
(c=this._getFixedThemeStyles(c))&&(e+=c);e=f.replace(e,a,/\$\{([^\}]+)\}/g);a=d.create("style",{type:"text/css"});try{a.appendChild(document.createTextNode(e))}catch(b){a.styleSheet.cssText=e}a.setAttribute("source","custom");document.head.appendChild(a)}},_getFixedThemeStyles:function(c){var a=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===c.name?(a+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}",
a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}",a+=".jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}",a+=".jimu-panel{border-color: ${mainBackgroundColor} !important;}",
a+=".jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}",a+=".jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}"):"BillboardTheme"===c.name?(a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation{background-color: ${mainBackgroundColor} !important;}",
a+=".jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}"):"BoxTheme"===c.name?a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===c.name&&(a+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}");return a},
_removeCustomStyle:function(){a('style[source\x3d"custom"]',document.head).forEach(function(c){d.destroy(c)})},_getThemeCommonStyleId:function(c){return"theme_"+c.name+"_style_common"},_getThemeCurrentStyleId:function(c){return"theme_"+c.name+"_style_"+c.styles[0]},_loadMap:function(){d.create("div",{id:this.mapId,style:f.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=c.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(c){var a;a="map"===c.position.relativeTo?this.mapId:this.id;var e=f.clone(c);e.position.width=40;e.position.height=40;var b=u.getPositionStyle(e.position);c=new y({index:e.placeholderIndex,configId:c.id});d.setStyle(c.domNode,b);d.place(c.domNode,a);this.widgetPlaceholders.push(c);return c},_createPreloadWidgetIcon:function(c){var a=new v({panelManager:this.panelManager,
widgetManager:this.widgetManager,widgetConfig:c,configId:c.id,map:this.map});"map"===c.position.relativeTo?d.place(a.domNode,this.mapId):d.place(a.domNode,this.id);d.setStyle(a.domNode,u.getPositionStyle({top:c.position.top,left:c.position.left,right:c.position.right,bottom:c.position.bottom,width:40,height:40}));a.startup();!this.openAtStartWidget&&c.openAtStart&&(a.switchToOpen(),this.openAtStartWidget=c.name);this.preloadWidgetIcons.push(a);return a},_loadPreloadWidgets:function(c){console.time("Load widgetOnScreen");
var a=new x,e=[];a.placeAt(this.id);a.startup();k.forEach(c.widgetOnScreen.widgets,function(a){!1===a.visible?this.invisibleWidgetIds.push(a.id):e.push(this._loadPreloadWidget(a,c))},this);k.forEach(c.widgetOnScreen.groups,function(a){e.push(this._loadPreloadGroup(a,c))},this);g(e).then(f.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");m.publish("preloadWidgetsLoaded");this._doPostLoad()}),f.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");
m.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){r(["dynamic-modules/postload"])},_loadPreloadWidget:function(c,a){var e=new s;if("config"===a.mode&&!c.uri){var b=this._createPreloadWidgetPlaceHolder(c);e.resolve(b);return e}if(!c.uri)return e.resolve(null),e;c.inPanel||c.closeable?(b=this._createPreloadWidgetIcon(c),e.resolve(b)):this.widgetManager.loadWidget(c).then(f.hitch(this,function(a){try{a.setPosition(a.position),this.widgetManager.openWidget(a)}catch(b){console.log(console.error("fail to startup widget "+
a.name+". "+b.stack))}a.configId=c.id;e.resolve(a)}),function(c){e.reject(c)});return e},_loadPreloadGroup:function(c,a){return!a.mode&&(!c.widgets||0===c.widgets.length)?h(null):this.panelManager.showPanel(c).then(f.hitch(this,function(a){a.configId=c.id;this.preloadGroupPanels.push(a);return a}))},_onOpenWidgetRequest:function(c){k.forEach(this.preloadWidgetIcons,function(a){a.configId===c&&a.switchToOpen()},this);k.forEach(this.widgetManager.getControllerWidgets(),function(a){a.widgetIsControlled(c)&&
a.setOpenedIds([c])},this)}});B.getInstance=function(c,a){null===w&&(w=new B(c,a),window._layoutManager=w);return w};return B})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h){var r,e=null;r=p(null,{constructor:function(){this.panels=[];this.widgetManager=h.getInstance();a(window,"resize",
f.hitch(this,this.onWindowResize));this.activePanel=null;n.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart));n.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(e){var c=new m,b=this.getPanelById(e.id+"_panel");b?("closed"===b.state&&this.openPanel(b),c.resolve(b)):q({Panel:this._loadPanelClass(e.panel.uri),nls:this._loadThemeI18N(e.panel.uri)}).then(f.hitch(this,function(b){var h=e.id+"_panel",l=this.getPanelById(h),r={label:e.label,config:e,uri:e.panel.uri,
position:e.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:h,gid:e.gid,nls:b.nls};f.mixin(r,e.panel.options);try{l=new b.Panel(r),console.log("panel ["+h+"] created.")}catch(n){console.log("create panel error: "+n+", panelId: "+h);c.reject(n);return}l.setPosition(e.panel.position);g.setVerticalCenter(l.domNode);this.openPanel(l);this.panels.push(l);a(l.domNode,"click",f.hitch(this,this._onPanelClick,l));c.resolve(l)}));return c},setMap:function(e){this.map=e;a(this.map,
"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var c=0;c<this.panels.length;c++)this.panels[c].gid===a.gid&&this.panels[c].id!==a.id&&this.closePanel(this.panels[c])},closeAllPanelsInGroup:function(a){for(var c=0;c<this.panels.length;c++)this.panels[c].gid===a&&this.closePanel(this.panels[c])},openPanel:function(a){var c=new m;if("string"===typeof a&&(a=this.getPanelById(a),!a))return c.reject(),c;
if(!a.started)try{a.started=!0,a.startup()}catch(e){console.error("fail to startup panel "+a.id+". "+e.stack)}if("opened"===a.state)return c.resolve(a),c;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){d.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var c=new m;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(c.resolve(),c):this.playClosePanelAnimation(a).then(function(){this.activePanel&&
this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&d.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(c){console.log(console.error("fail to minimize panel "+a.id+". "+c.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(c){console.log(console.error("fail to maximize panel "+a.id+". "+c.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(c){console.log(console.error("fail to noralize panel "+a.id+". "+c.stack))}},changeWindowStateTo:function(a,c){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"normal"===c?this.normalizePanel(a):"minimized"===c?this.minimizePanel(a):"maximized"===c?this.maximizePanel(a):console.log("error state: "+c)},getPanelById:function(a){for(var c=0;c<this.panels.length;c++)if(this.panels[c].id===a)return this.panels[c]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==
this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(c){console.log(console.error("fail to destroy panel "+a.id+". "+c.stack))}}},destroyAllPanels:function(){var a=k.map(this.panels,function(c){return c.id});k.forEach(a,function(c){this.destroyPanel(c)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return l();var c=new m;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(d.setStyle(a.domNode,{opacity:0,display:""}),b.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){c.resolve()}}).play()):c.resolve():c.resolve();return c},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return l();var c=new m;"string"===
typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?b.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){c.resolve()}}).play():c.resolve());return c},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var c=d.getMarginBox(window.jimuConfig.layoutId),e=c.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:c.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,
borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?c.h>c.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:c.w-c.w/2,right:0,top:"auto",bottom:0,width:c.w/2,height:a.titleHeight,contentHeight:c.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,
borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:c.h>c.w?{left:0,right:0,top:e,bottom:0,width:"auto",height:"auto",contentHeight:c.h-e-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:c.w-c.w/2,right:0,top:0,bottom:0,width:c.w/2,height:"auto",contentHeight:c.h-e-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,
borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&d.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,
"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var c=this.widgetManager.activeWidget;c&&("active"===c.state&&c.getPanel()!==a)&&(c.setState("opened"),!1===c.inPanel&&d.setStyle(c.domNode,"zIndex","undefined"!==typeof c.position.zIndex?c.position.zIndex:"auto"),c.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&
d.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var c=this.panels.indexOf(a);-1<c&&this.panels.splice(c,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){k.forEach(this.panels,function(c){c.domNode===a.node&&this._activePanel(c)},this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,
"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var c=new m;s([a],function(a){c.resolve(a)});return c},_loadThemeI18N:function(a){var c=new m;a.startWith("themes")?(a=a.split("/"),s(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){c.resolve(a)})):c.resolve({});return c}});r.getInstance=function(){null===e&&(e=new r,window._panelManager=e);return e};return r})},
"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C,E,F){var G=null,I=p(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(c,a){this.appConfig=c.appConfig;this.urlParams=c.urlParams;this.id=this.mapDivId=a;this.appStateManager=C.getInstance(this.urlParams);this.popupManager=E.getInstance(this);this.filterManager=F.getInstance();this.nls=window.jimuNls;m.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));m.subscribe("changeMapPosition",f.hitch(this,this.onChangeMapPosition));m.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));q(window,"resize",f.hitch(this,this.onWindowResize));q(window,"beforeunload",f.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(c){console.time("Load Map");this.loading=new x;this.loading.placeAt(this.mapDivId);this.loading.startup();c.map["3D"]?c.map.itemId?this._show3DWebScene(c):this._show3DLayersMap(c):
c.map.itemId?this._show2DWebMap(c):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(c){c&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&
(this._mapMobileInfoWindow.destroy(),b("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(c){d.destroy(c)}),b("div.esriMobileNavigationBar").forEach(function(c){d.destroy(c)})),this._mapMobileInfoWindow=new h(null,d.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);y.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!y.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),
this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onChangeMapPosition:function(c){var a=f.clone(this.mapPosition);f.mixin(a,c);this.setMapPosition(a)},setMapPosition:function(c){this.mapPosition=c;c=y.getPositionStyle(c);d.setStyle(this.mapDivId,c);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(a){this.map&&(a=new c(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(c,a){k.forEach(c.map.basemaps,
function(c,e){c.isOperationalLayer=!1;a(c,e)},this);k.forEach(c.map.operationallayers,function(c,e){c.isOperationalLayer=!0;a(c,e)},this)},_show3DLayersMap:function(c){v(["esri3d/Map"],f.hitch(this,function(a){var e;e=new a(this.mapDivId,{camera:c.map.mapOptions.camera});this._visitConfigMapLayers(c,f.hitch(this,function(c){this.createLayer(e,"3D",c)}));e.usePlugin=a.usePlugin;this._publishMapEvent(e)}))},_show3DWebScene:function(c){this._getWebsceneData(c.map.itemId).then(f.hitch(this,function(a){v(["esri3d/Map"],
f.hitch(this,function(e){var b=new e(this.mapDivId,c.map.mapOptions);k.forEach(a.itemData.operationalLayers,function(c){this.createLayer(b,"3D",c)},this);k.forEach(a.itemData.baseMap.baseMapLayers,function(c){c.type="tile";this.createLayer(b,"3D",c)},this);k.forEach(a.itemData.baseMap.elevationLayers,function(c){c.type="elevation";this.createLayer(b,"3D",c)},this);b.toc=a.itemData.toc;b.bookmarks=a.itemData.bookmarks;b.tours=a.itemData.tours}))}))},_publishMapEvent:function(c){window._viewerMap=c;
D.postProcessUrlParams(this.urlParams,c);console.timeEnd("Load Map");this.map?(this.map=c,this.resetInfoWindow(!0),console.log("map changed."),m.publish("mapChanged",this.map)):(this.map=c,this.resetInfoWindow(!0),m.publish("mapLoaded",this.map))},_getWebsceneData:function(c){return e({url:"http://184.169.133.166/sharing/rest/content/items/"+c+"/data",handleAs:"json"})},_show2DWebMap:function(c){c.map.mapOptions||(c.map.mapOptions={});var a=this._processMapOptions(c.map.mapOptions)||{};a.isZoomSlider=
!1;var e=c.map.portalUrl,b=c.map.itemId,a={mapOptions:a,bingMapsKey:c.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!c.mode&&c.map.appProxy&&c.map.appProxy.mapItemId===c.map.itemId){var g=[];k.forEach(c.map.appProxy.proxyItems,function(c){c.useProxy&&c.proxyUrl&&g.push({url:c.sourceUrl,mixin:{url:c.proxyUrl}})});0<g.length&&(a.layerMixins=g)}this._createWebMapRaw(e,b,this.mapDivId,a).then(f.hitch(this,function(a){var e=a.map;e.hideZoomSlider();e.infoWindow.resize(270,316);e.itemId=c.map.itemId;
e.itemInfo=a.itemInfo;e.webMapResponse=a;e.enableSnapping({snapKey:n.copyKey});d.setStyle(e.root,"zIndex",0);e._initialExtent=e.extent;w.getInstance(e,e.itemInfo).then(f.hitch(this,function(c){this.layerInfosObj=c;this._showUnreachableLayersTitleMessage();this._publishMapEvent(e);setTimeout(f.hitch(this,this._checkAppState),500);this.loading.hide();this._addDataLoadingOnMapUpdate(e)}))}),f.hitch(this,function(c){console.error(c);this._destroyLoadingShelter();this._showError(c);m.publish("mapCreatedFailed")}))},
_showError:function(c){c&&c.message&&d.create("div",{"class":"app-error",innerHTML:c.message},document.body)},_createWebMapRaw:function(c,a,e,b){return y.createWebMap(c,a,e,b).then(f.hitch(this,function(c){return c}),f.hitch(this,function(g){console.error(g);if(g&&g instanceof Error&&g.message){var h=f.getObject("arcgis.utils.baseLayerError",!1,l.cache["esri/nls/jsapi/"+s.locale]);if(h&&0<=g.message.indexOf(h))return new B({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),
t.getItem(a).then(f.hitch(this,function(a){a.itemData.spatialReference={wkid:102100,latestWkid:3857};a.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return y.createWebMap(c,a,e,b)}))}throw g;}))},_showUnreachableLayersTitleMessage:function(){var c=this.layerInfosObj.getUnreachableLayersTitle(),a="",e=window.jimuNls.map.layerLoadedError||
"The layer, ${layers} cannot be added to the map.";e&&(c&&0<c.length)&&(k.forEach(c,f.hitch(this,function(c){a=a+c+", "})),new B({message:e.replace("${layers}",a)}))},_addDataLoadingOnMapUpdate:function(c){var a=d.toDom('\x3cdiv class\x3d"load-container"\x3e\x3cdiv class\x3d"loader"\x3eLoading...\x3c/div\x3e\x3c/div\x3e');d.place(a,c.root);c.updating&&d.addClass(a,"loading");q(c,"update-start",f.hitch(this,function(){d.addClass(a,"loading")}));q(c,"update-end",f.hitch(this,function(){d.removeClass(a,
"loading")}));q(c,"unload",f.hitch(this,function(){d.destroy(a);a=null;this._destroyLoadingShelter()}))},_destroyLoadingShelter:function(){this.loading&&(this.loading.destroy(),this.loading=null)},_checkAppState:function(){var c="extent center marker find query scale level".split(" "),a=this.appConfig.keepAppState;a&&k.forEach(c,function(c){c in this.urlParams&&(a=!1)},this);a&&this.appStateManager.getWabAppState().then(f.hitch(this,function(c){if(c.extent||c.layers){var a=new A({nls:{title:this.nls.appState.title,
restoreMap:this.nls.appState.restoreMap}});a.placeAt("main-page");q(a,"applyAppState",f.hitch(this,function(){this._applyAppState(c,this.map)}));a.startup();a.show()}}))},_applyAppState:function(c,a){this.layerInfosObj.restoreState({layerOptions:c.layers||null});c.extent&&a.setExtent(c.extent);this._publishMapEvent(a)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new c(a.extent)),a.center&&!f.isArrayLike(a.center)&&
(a.center=new u(a.center)),a.infoWindow&&(a.infoWindow=new g(a.infoWindow,d.create("div",{},this.mapDivId))),a},createLayer:function(c,e,b){v([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer",
"3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[e+"_"+b.type]],f.hitch(this,function(e){var g,h={};g="label url type icon infoTemplate isOperationalLayer".split(" ");for(var l in b)0>g.indexOf(l)&&(h[l]=b[l]);b.infoTemplate?(g=new r(b.infoTemplate.title,
b.infoTemplate.content),h.infoTemplate=g,e=new e(b.url,h),b.infoTemplate.width&&b.infoTemplate.height&&a.after(e,"onClick",f.hitch(this,function(){c.infoWindow.resize(b.infoTemplate.width,b.infoTemplate.height)}),!0)):e=new e(b.url,h);e.isOperationalLayer=b.isOperationalLayer;e.label=b.label;e.icon=b.icon;c.addLayer(e)}))},onAppConfigChanged:function(c,a,e){this.appConfig=c;"mapChange"===a?this._recreateMap(c):"mapOptionsChange"===a&&e.lods&&this._recreateMap(c)},_recreateMap:function(c){this.map&&
(m.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(c)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});I.getInstance=function(c,a){null===G&&(G=new I(c,a));return G};return I})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v){var y=p([u,g,h,r,c],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:v,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(c){this.inherited(arguments);l.place(this.domNode,c.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[y.ANCHOR_UPPERRIGHT,y.ANCHOR_LOWERRIGHT,y.ANCHOR_LOWERLEFT,y.ANCHOR_UPPERLEFT];
if(7>m("ie")){var c="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+s.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",a=l.create("div",null,d.body());s.set(a,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:c});var e=setTimeout(function(){l.destroy(a);clearTimeout(e);e=a=null},100);b.query(".sprite",this.domNode).forEach(function(a){a.style.backgroundImage="none";a.style.filter=
c})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(c,a){if(c&&a){var e=s.set;e(this._topleft,{height:a+"px",marginLeft:c+"px"});e(this._topright,{width:c+"px",height:a+"px"});e(this._user,"width",c-8+"px");e(this._hide,"marginLeft",c-22+"px");e(this._title,"width",c-25+
"px");e(this._content,"height",a-37+"px");e(this._bottomleft,{marginLeft:c+"px",marginTop:a+"px"});e(this._bottomright,{width:c-5+"px",marginTop:a+"px"});this.width=c;this.height=a;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(c,a)}},_adjustPosition:function(c,a){var e=s.set;e(this._infowindow,{left:Math.round(c.x)+"px",top:Math.round(c.y)+"px"});a===y.ANCHOR_UPPERLEFT?e(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):a===y.ANCHOR_UPPERRIGHT?
e(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):a===y.ANCHOR_LOWERRIGHT?e(this._window,{left:"6px",right:null,top:"43px",bottom:null}):a===y.ANCHOR_LOWERLEFT&&e(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(c){var a=this.map;return a&&c?(c.y<a.height/2?"lower":"upper")+(c.x<a.width/2?"right":"left"):"upperright"},show:function(c,a,e){if(c){c.spatialReference?(this.mapCoords=c,c=this.coords=this.map.toScreen(c,!0)):(this.mapCoords=
null,this.coords=c);var b=this.map._getFrameWidth();if(-1!==b&&(c.x%=b,0>c.x&&(c.x+=b),this.map.width>b))for(var g=(this.map.width-b)/2;c.x<g;)c.x+=b;if(!a||-1===k.indexOf(this._ANCHORS,a))a=this._getAnchor(c);n.remove(this._pointer,this.anchor);a=this.anchor=this.fixedAnchor||a;this._adjustPosition(c,a);n.add(this._pointer,a);t.show(this.domNode);this.isShowing=!0;if(!e)this.onShow()}},hide:function(c,a){t.hide(this.domNode);this.isShowing=!1;if(!a)this.onHide()},showTitleBar:function(){t.show(this._titlebar);
t.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){t.hide(this._titlebar);t.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){t.show(this._content);t.show(this._border);this.isContentShowing=!0},hideContent:function(){t.hide(this._content);t.hide(this._border);this.isContentShowing=!1},move:function(c,a){a?c=this.coords.offset(c.x,c.y):(this.coords=c,this.mapCoords&&(this.mapCoords=this.map.toMap(c)));s.set(this._infowindow,{left:Math.round(c.x)+"px",top:Math.round(c.y)+
"px"})},setFixedAnchor:function(c){c&&-1===k.indexOf(this._ANCHORS,c)||(this.fixedAnchor=c,this.isShowing&&this.show(this.mapCoords||this.coords,c),this.onAnchorChange(c))},setTitle:function(c){this.destroyDijits(this._title);this.__setValue("_title",c);return this},setContent:function(c){this.destroyDijits(this._content);this.__setValue("_content",c);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});f.mixin(y,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return y})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w){return f([t,c],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:p.toUrl("./images/whitex.png"),dArrowIcon:p.toUrl("./images/whitedown.png"),lArrowIcon:p.toUrl("./images/whitel.png"),rArrowIcon:p.toUrl("./images/whiter.png"),constructor:function(c,a){this.initialize();k.mixin(this,c);this.domNode=l.byId(a);this._nls=k.mixin({},
w.widgets.popup);var e=this.domNode;g.add(e,"esriPopupMobile");s.set(e,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var b=q.query(".titlePane",e)[0];this._arrowButton=q.query(".arrow",b)[0];this._pointerTop=q.query(".top",e)[0];this._pointerBottom=q.query(".bottom",e)[0];this._title=q.query(".title",b)[0];this._footer=q.query(".footer",b)[0];this._prev=q.query(".prev",b)[0];this._next=q.query(".next",b)[0];this._spinner=q.query(".spinner",b)[0];this._eventConnections=[d.connect(q.query(".close",b)[0],"onclick",this,this.hide),d.connect(this._arrowButton,"onclick",this,this._toggleView),d.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),d.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();x.hide(e);this.isShowing=!1},setMap:function(c){this.inherited(arguments);h.place(this.domNode,c.root);this.highlight&&this.enableHighlight(c)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(c,a){this.destroyDijits(this._title);this.place(c,this._title);
this.destroyDijits(this._footer);this.place(a,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(c){this.destroyDijits(this._contentPane);this.place(c,this._contentPane);this.startupDijits(this._contentPane)},show:function(c){if(c){var a=this.map;c.spatialReference?(this.location=c,c=a.toScreen(c)):this.location=a.toMap(c);this._maximized?this.restore():this._setPosition(c);this.isShowing||(x.show(this.domNode),this.isShowing=!0,this.onShow())}else x.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(x.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);b.forEach(this._eventConnections,d.disconnect);h.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");g.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var c=this.selectedIndex;this._updateUI();0<=c&&(this.setContent(this.features[c].getContent()),this.updateHighlight(this.map,this.features[c]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var c=this.map;this._handles=[d.connect(c,"onPanStart",this,this._onPanStart),d.connect(c,"onPan",this,this._onPan),d.connect(c,"onZoomStart",this,this._onZoomStart),d.connect(c,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var c=this._handles;c&&(b.forEach(c,d.disconnect),this._handles=null)},_onPanStart:function(){var c=this.domNode.style;this._panOrigin={left:c.left,top:c.top,right:c.right,
bottom:c.bottom}},_onPan:function(c,a){var b=this._panOrigin,g=a.x,h=a.y,l=b.left,r=b.top,n=b.right,b=b.bottom;l&&(l=parseFloat(l)+g+"px");r&&(r=parseFloat(r)+h+"px");n&&(n=parseFloat(n)-g+"px");b&&(b=parseFloat(b)-h+"px");e.set(this.domNode,{left:l,top:r,right:n,bottom:b})},_onZoomStart:function(){x.hide(this.domNode)},_onExtentChange:function(c,a,e){e&&(x.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(c){var a=c.x;c=c.y;var b=
r.getContentBox(this.map.container),h=b.w,b=b.h,l=0,n=c+10,m=118,t=h-18;18<a&&a<t?(l=a-130,0>l?l=0:l>h-260&&(l=h-260)):18>=a?l=a-18:a>=t&&(l=h-260+(a-t));118<a&&a<h-130?m=118:118>=a?18<a?m=a-12:18>=a&&(m=6):a>=h-130&&(a<t?m=118+a-(h-130):a>=t&&(m=118+t-(h-130)));c<=b/2?(e.set(this.domNode,{left:l+"px",top:n+"px",bottom:null}),e.set(this._pointerTop,{left:m+"px"}),g.add(this._pointerBottom,"hidden"),g.remove(this._pointerTop,"hidden")):(e.set(this.domNode,{left:l+"px",top:n-64+"px",bottom:null}),e.set(this._pointerBottom,
{left:m+"px"}),g.add(this._pointerTop,"hidden"),g.remove(this._pointerBottom,"hidden"))},_showPointer:function(c){b.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(a){a===c?q.query(".pointer."+a,this.domNode).removeClass("hidden"):q.query(".pointer."+a,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();x.show(this.popupNavigationBar.container);x.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(c){this.popupInfoView.animateTo(0);switch(c.name){case "CloseButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var c={};c.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new v(c,h.create("div",{},m.body()));d.connect(this.popupNavigationBar,"onCreate",this,function(c){this._prevFeatureButton=c[3]._node;this._nextFeatureButton=c[4]._node});d.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);d.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();x.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new u({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},h.create("div",{},m.body()));g.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();d.connect(this.popupInfoView,"onCreate",this,function(c){this._contentPane=c[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});d.connect(this.popupInfoView,"onSwipeLeft",this,function(){});d.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var c="\x26nbsp;",a="\x26nbsp;",e=this.selectedIndex,b=this.features,h=this.deferreds,l=this._prevFeatureButton.parentNode,r=this._nextFeatureButton.parentNode,n=this._spinner,m=this._nls;b&&1<=b.length?(c=b[e].getTitle(),a=e+1+" of "+b.length,g.remove(this._arrowButton,"hidden"),0===e?(g.add(l,"hidden"),g.add(this._prev,"hidden")):(g.remove(l,"hidden"),g.remove(this._prev,"hidden")),e===b.length-1?(g.add(r,"hidden"),
g.add(this._next,"hidden")):(g.remove(r,"hidden"),g.remove(this._next,"hidden"))):(g.add(this._arrowButton,"hidden"),g.add(l,"hidden"),g.add(r,"hidden"),g.add(this._prev,"hidden"),g.add(this._next,"hidden"));this.setTitle(c,a);this.popupNavigationBar.getItems()[1]._node.innerHTML=a;h&&h.length?(g.remove(n,"hidden"),this.setTitle(m.NLS_searching+"...","\x26nbsp;")):(g.add(n,"hidden"),(!b||!b.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h){return p(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(b,e){var g;this.container=a.byId(e);this._touchBase=h(this.container,null);this._slideDiv=l.create("div",null,this.container,"first");this.events=[];this._items=b.items;b.sections&&(this._sections=b.sections);n.add(this.container,"esriMobileInfoView");if(0===this._sections.length)l.create("div",{},this._slideDiv);else for(g=0;g<this._sections.length;g++){var c=
l.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);l.create("div",{innerHTML:this._sections[g].title},c)}for(g=0;g<this._items.length;g++){var m,c=0;this._items[g].section&&(c=this._items[g].section);switch(this._items[g].type){case "div":m=l.create("div",{"class":"esriMobileInfoViewItem",style:this._items[g].style},this._slideDiv.childNodes[c]),m=l.create("div",{innerHTML:this._items[g].text},m)}this._items[g].className&&n.add(m,this._items[g].className);m._index=g;m._item=this._items[g];
this._items[g]._node=m}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){k.forEach(this.events,d.disconnect);this._touchBase=null;b.query("img",this.container).forEach(function(a){a._index=null;a._item=null;l.destroy(a)});this._items=null;l.destroy(this._slideDiv);l.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(d.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(d.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(d.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){d.disconnect(this.events.pop());d.disconnect(this.events.pop());d.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,e;a=s.getContentBox(this.container);var b=0>this._velocity?0.0010:-0.0010;e=-(this._velocity*this._velocity)/(2*b);var c=-this._velocity/b,b=3*0.6-0,g=1-b,h=0,l=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,l=300;else if(0<this.contentOffsetY+e){a=0;for(e=Math.floor(c/20);a<e;a++)if(h=(g*20*a^3)+(b*20*a^2)+0*20*a+0,h=0>this._velocity?-h:h,0<this.contentOffsetY+h){l=20*a;break}0===l&&(l=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+e)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(e=Math.floor(c/20);a<e;a++)if(h=(g*20*a^3)+(b*20*a^2)+0*20*a+0,h=0>this._velocity?-h:h,Math.abs(this.contentOffsetY+
h)>this._slideDiv.scrollHeight){l=20*a;break}}else l=c,this.contentOffsetY+=e;this._slideDiv.style.webkitTransition="-webkit-transform "+l+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=s.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,e){"ON"===e.toggleState?(e.toggleState=
"OFF",e.src&&(a.src=e.src.toString()),this.onUnSelect(e)):(e.toggleState="ON",e.srcAlt&&(a.src=e.srcAlt),this.onSelect(e))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(p,f,k,d,b,m){return p(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(b,a){this.domNode=d.byId(b);this.events=[k.connect(this.domNode,"touchstart",this,this._touchStartHandler),
k.connect(this.domNode,"touchmove",this,this._touchMoveHandler),k.connect(this.domNode,"touchend",this,this._touchEndHandler),k.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(b){this._preventDefault=b},disableOnClick:function(){k.disconnect(this.events.pop())},_clickHandler:function(b){if(this._moved)b.preventDefault();else this.onclick(b)},_touchStartHandler:function(b){this._moved=!1;this.client_x=b.targetTouches[0].clientX;this.client_y=b.targetTouches[0].clientY;
this.down_x=b.targetTouches[0].pageX;this.down_y=b.targetTouches[0].pageY;b.downX=this.down_x;b.downY=this.down_y;this.onTouchStart(b)},_touchMoveHandler:function(b){this._preventDefault&&b.preventDefault();this._moved=!0;this.up_x=b.targetTouches[0].pageX;this.cur_x=b.targetTouches[0].pageX-this.down_x;this.cur_y=b.targetTouches[0].pageY-this.down_y;b.curX=this.cur_x;b.curY=this.cur_y;this.onTouchMove(b)},_touchEndHandler:function(b){this._moved?(b.curX=this.cur_x,b.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?b.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(b.swipeDirection="right")):(b.clientX=this.client_x,b.clientY=this.client_y);this.onTouchEnd(b)},onTouchStart:function(b){},onTouchMove:function(b){},onTouchEnd:function(b){},onclick:function(b){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){return p(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(b,g){var e;this.container=a.byId(g);this._touchBase=s(this.container,null);this._slideDiv=l.create("div",{},this.container,"first");this.events=[k.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=b.items;n.add(this.container,"esriMobileNavigationBar");var m=l.create("div",{},this._slideDiv);for(e=0;e<this._items.length;e++){var c,d;switch(this._items[e].type){case "img":d=
l.create("div",{"class":"esriMobileNavigationItem"},m);c=l.create("img",{src:this._items[e].src.toString(),style:{width:"100%",height:"100%"}},d);break;case "span":d=l.create("div",{"class":"esriMobileNavigationItem"},m);c=l.create("span",{innerHTML:this._items[e].text},d);break;case "div":d=l.create("div",{"class":"esriMobileNavigationInfoPanel"},m),c=l.create("div",{innerHTML:this._items[e].text},d)}n.add(d,this._items[e].position);this._items[e].className&&n.add(c,this._items[e].className);c._index=
e;c._item=this._items[e];this._items[e]._node=c}},startup:function(){this.onCreate(this._items)},destroy:function(){d.forEach(this.events,k.disconnect);this._touchBase=null;b.query("img",this.container).forEach(function(a){a._index=null;a._item=null;l.destroy(a)});this._items=null;l.destroy(this._slideDiv);l.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var g=a.target,e=g._item;b.query("img",this.container).forEach(function(a){a!==g&&a._item.toggleGroup===e.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(g,e)}},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))},_markSelected:function(a,b){b.toggleState=
"ON";b.srcAlt&&(a.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(a,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(p,f,k,d,b){return p([f,k],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:d,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&b.setStyle(this.domNode,"display","none");b.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||b.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(m){this.domNode&&this.hidden&&
("string"===typeof m&&(this.textNode.innerHTML=m),b.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(b.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(p,f,k,d,b,m,q,a,n){var l=p([q],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,
_tableInfos:null,_finalTableInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,constructor:function(a,b){this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this._tables=b.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerInfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerInfos);
this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getLayerInfoArray(),function(b){for(var c=0;c<this._operLayers.length;c++)if(b.id===this._operLayers[c].id){a.push(b);break}c===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(b.id)&&a.push(b)},this);return a},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(a){return!a._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._finalTableInfos},
addFeatureCollection:function(a,b){var c=this._getUniqueTopLayerInfoId(b),g={layers:[]};f.forEach(a,function(a,e){a.id=c+"_"+e;g.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var h;try{h=n.getInstance().create({featureCollection:g,title:b||c,id:c},this.map),h.init()}catch(l){console.warn(l.message),h=null}h&&(h._extraOfWebmapLayerInfo=!0,this._layerInfos.push(h),this.update(),this._onUpdated())},addTable:function(a){var b=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);
b.push(a);this._onTableChange(b,"added");return a},removeTable:function(a){var b=-1,c=!1;f.forEach(this._tableInfos,function(c,g){a.id===c.id&&(b=g)});0<=b&&(this._tableInfos.splice(b,1),c=!0);b=-1;f.forEach(this._finalTableInfos,function(c,g){a.id===c.id&&(b=g)});0<=b&&(this._finalTableInfos.splice(b,1),c=!0);c&&this._onTableChange([a],"removed")},_addTable:function(a,b){var c;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType=
"table",c=n.getInstance().create(a),c.init()}catch(g){console.warn(g.message),c=null}c&&b&&b.push(c);return c},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,b){var c=1,g;a||(a="table");for(g=a;;){for(var h=0;h<b.length&&b[h].id!==g;h++);if(h===b.length)return g;g=a+"_"+c.toString();
c++}},_traversal:function(a,b){for(var c=0;c<b.length;c++)if(b[c].traversal(a))return!0;return!1},traversal:function(a){var b=this.getLayerInfoArray();return this._traversal(a,b)},traversalLayerInfosOfWebmap:function(a){var b=this.getLayerInfoArrayOfWebmap();return this._traversal(a,b)},traversalAll:function(a){var b=this.getLayerInfoArray(),c=this.getTableInfoArray();return this._traversal(a,b.concat(c))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var b=
null;f.some(this.getTableInfoArray(),function(c){if(c.id===a)return b=c,!0});return b},getLayerOrTableInfoById:function(a){var b=null;this.traversalAll(function(c){if(c.id===a)return b=c,!0});return b},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},moveUpLayer:function(a,b){var c=null;b=b?b:1;var g=this._getTopLayerInfoIndexById(a.id);0<=g-b&&(c=this._finalLayerInfos[g-b].obtainLayerIndexesInMap().length,this._finalLayerInfos[g].moveLayerByIndex(this._finalLayerInfos[g-
b].obtainLayerIndexesInMap()[c-1].index),c=this._finalLayerInfos[g-b],m.publish("layerInfos/layerReorder",g,b,"moveup"));return c},_reorderLayerInfosArray:function(a,b,c){"moveup"===c?(c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-b,0,c)):(c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+b+1,0,c),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode()},moveDownLayer:function(a,b){var c=null;b=b?b:1;var g=this._getTopLayerInfoIndexById(a.id);
g+b<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[g].moveLayerByIndex(this._finalLayerInfos[g+b].obtainLayerIndexesInMap()[0].index),c=this._finalLayerInfos[g+b],m.publish("layerInfos/layerReorder",g,b,"movedown"));return c},getBasemapLayers:function(){var a=[];f.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);("basemap"===b._basemapGalleryLayerType||"reference"===b._basemapGalleryLayerType)&&a.push(b)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),
function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var b=a&&a.layerOptions?a.layerOptions:null;f.forEach(this._finalLayerInfos,function(c){c.resetLayerObjectVisibility(b)},this)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},_initLayerInfos:function(){var a;this._layerInfos=[];f.forEach(this._operLayers,function(b){try{a=n.getInstance().create(b),a.init()}catch(c){console.warn(c.message),a=null,this._unreachableLayersTitleOfWebmap.push(b.title)}a&&
this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];f.forEach(this._layerInfos,function(a,b){var c;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{c=n.getInstance().create(a.originOperLayer),c.init()}catch(g){console.warn(g.message),c=null}c&&(a.destroyLayerInfo(),this._layerInfos[b]=c)}else if(a.originOperLayer.featureCollection){var h=[];f.forEach(a.getSubLayers(),
function(c){h.push(c.id)});f.forEach(h,function(c){this.map.getLayer(c)||a.removeSubLayerById(c)},this);1===a.getSubLayers().length&&(c=a.getSubLayers()[0],this.map.getLayer(c.id).title=a.title,a.removeSubLayerById(c.id),this._removedLayerInfoIdsFromFeatureCollection.push(c.id))}},this)},_initFinalLayerInfos:function(a){var b,c;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-1;0<=b;b--)c=this.map.graphicsLayerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,
a),c,!0);for(b=this.map.layerIds.length-1;0<=b;b--)c=this.map.layerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!1)},_isBasemap:function(a){for(var b=!1,c=this.getBasemapLayers(),g=0;g<c.length;g++)c[g].id===a&&(b=!0);return b},_addToFinalLayerInfos:function(a,b,c){var g;if(a)!a._addedFlag&&a.isGraphicLayer()===c&&(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(b);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"labels"!==
a.id){try{var h={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};k.mixin(h,k.getObject("_wabProperties.originOperLayer",!1,a));g=n.getInstance().create(h,this.map);g.init()}catch(l){console.warn(l.message),g=null}g&&(k.getObject("_wabProperties.isTemporaryLayer",!1,a)&&(g._isTemporaryLayerInfo=!0),this._finalLayerInfos.push(g))}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&g&&g._getLayerDefinition().then(k.hitch(this,
function(c){var a=[];f.forEach(c.tables,function(c){c.url=g.getUrl()+"/"+c.id;c.id=g.id+"_"+c.id;c.title=this._getLayerTitle(c);(c=this._addTable(c,this._finalTableInfos))&&a.push(c)},this);this._onTableChange(a,"added")}))}},_getLayerTitle:function(a){if(a.title)return a.title;var b=a.label||a.name||"";if(a.url){var c;c=a.url.indexOf("/FeatureServer");-1===c&&(c=a.url.indexOf("/MapServer"));-1===c&&(c=a.url.indexOf("/service"));-1<c&&(c=a.url.substring(0,c),c=c.substring(c.lastIndexOf("/")+1,c.length),
b=b?c+" - "+b:c)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,b){var c,g=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length;c++)if(g=b[c].findLayerInfoById(a)){g=b[c];break}return g},_findLayerInfoById:function(a,b){var c,g=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length&&!(g=b[c].findLayerInfoById(a));c++);return g},_findTopLayerInfoById:function(a){var b,c=null,g=this._finalLayerInfos.concat(this._finalTableInfos);for(b=0;b<g.length;b++)if(g[b].id===a){c=g[b];break}return c},
_getTopLayerInfoIndexById:function(a){var b,c=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){c=b;break}return c},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=
!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,b,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(c,k.hitch(this,function(c){this._basemapLayers.push({layerObject:c,id:c.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],
id:a.layers[b].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,k.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,g,c,h,l,n,r,d,s;a=b(this.map,"layer-add-result",k.hitch(this,this._onLayersChange,"added"));g=b(this.map,"layer-remove",k.hitch(this,this._onLayersChange,"removed"));r=m.subscribe("layerInfos/layerReorder",k.hitch(this,this._onLayerReorder));h=m.subscribe("layerInfos/layerInfo/isShowInMapChanged",k.hitch(this,this._onShowInMapChanged));l=
m.subscribe("layerInfos/layerInfo/visibleChanged",k.hitch(this,this._onVisibleChanged));n=m.subscribe("layerInfos/layerInfo/filterChanged",k.hitch(this,this._onFilterChanged));d=m.subscribe("layerInfos/layerInfo/rendererChanged",k.hitch(this,this._onRendererChanged));s=m.subscribe("layerInfos/layerInfo/opacityChanged",k.hitch(this,this._onOpacityChanged));c=b(this.map,"before-unload",k.hitch(this,function(){a.remove();g.remove();r.remove();h.remove();l.remove();n.remove();d.remove();c.remove();s.remove();
this._destroyLayerInfos()}))},_onLayersChange:function(a,b){var c=null,g;!b.error&&("esri.layers.GraphicsLayer"!==b.layer.declaredClass&&!b.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),c=this._findTopLayerInfoById(b.layer.id),g=this._findLayerInfoById(b.layer.id)):(c=this._findTopLayerInfoById(b.layer.id),g=this._findLayerInfoById(b.layer.id),this.update()),this.emit("layerInfosChanged",c,a,g))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",
a)},_onFilterChanged:function(a){this.emit("layerInfosFilterChanged",a)},_onLayerReorder:function(a,b,c){this._reorderLayerInfosArray(a,b,c);this.emit("layerInfosReorder")},_onRendererChanged:function(a){this.emit("layerInfosRendererChanged",a)},_onOpacityChanged:function(a){this.emit("layerInfosOpacityChanged",a)},_initTablesInfos:function(){this._tableInfos=[];f.forEach(this._tables&&this._tables.reverse(),function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=
[];f.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},this)},_onTableChange:function(a,b){this.emit("tableInfosChanged",a,b)},_onUpdated:function(){this.emit("updated")}});l.getLayerInfoArrayByType=function(b,g){var c=new d,h=[],n=[];l.getInstance(b,b.iteminfo).then(function(b){b.traversal(function(c){var a=c.getLayerType();a.layerInfo=c;h.push(a)});a(h).then(function(a){f.forEach(a,function(c,a){g===c&&n.push(h[a].layerInfo)});c.resolve(n)})});return c};var s=!0,g=null,h=null,
r=new d;l.getInstance=function(a,b){g&&g!==a&&(s=!0,h=g=null,r=new d);h?r.resolve(h):s&&(s=!1,n.getInstance(a).init().then(k.hitch(this,function(){var c=new l(a,b.itemData);g=a;h=c;r.resolve(c)})));return r};l.getInstanceSync=function(){return h};return l})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(p,f,k){var d=null,b=p(null,{constructor:function(){},init:function(){var b=new k;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
f.hitch(this,function(d,a,n,l,s,g,h,r,e,f,c,u,k){this.LayerInfoForCollection=d;this.LayerInfoForMapService=a;this.LayerInfoForKML=n;this.LayerInfoForGeoRSS=l;this.LayerInfoForDefault=s;this.LayerInfoForWMS=g;this.LayerInfoForGroup=h;this.LayerInfoForDefaultDynamic=r;this.LayerInfoForDefaultTile=e;this.LayerInfoForDefaultWMS=f;this.LayerInfoForDefaultTable=c;this.LayerInfoForDefaultImage=u;this.LayerInfoForDefaultStream=k;b.resolve()}));return b},create:function(b){if(b.featureCollection)return new this.LayerInfoForCollection(b,
this.map);if("esri.layers.KMLLayer"===b.layerObject.declaredClass)return new this.LayerInfoForKML(b,this.map);if("esri.layers.GeoRSSLayer"===b.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(b,this.map);if("esri.layers.WMSLayer"===b.layerObject.declaredClass&&!b.selfType)return new this.LayerInfoForWMS(b,this.map);if("esri.layers.ArcGISDynamicMapServiceLayer"===b.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.layerObject.declaredClass)return new this.LayerInfoForMapService(b,
this.map);if("esri.layers.ArcGISImageServiceLayer"===b.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(b,this.map);if("esri.layers.StreamLayer"===b.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(b,this.map);"Table"===b.layerObject.type&&(b.selfType="table");switch(b.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(b,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(b,
this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(b,this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(b,this.map);case "wms":return new this.LayerInfoForDefaultWMS(b,this.map);case "table":return new this.LayerInfoForDefaultTable(b,this.map);default:return new this.LayerInfoForDefault(b,this.map)}}});b.getInstance=function(m){null===d&&(d=new b);m&&(d.map=m);return d};return b})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),
function(p,f,k,d,b,m,q,a){var n=1E3,l=1E4;return p([f,a],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(a){this.inherited(arguments);"animationDuration"in a&&(n=a.animationDuration);"autoCloseInterval"in a&&(l=a.autoCloseInterval)},postCreate:function(){window.appInfo.isRunInMobile&&d.addClass(this.domNode,"mobile");var a=d.create("div",{"class":"appstate-header"});d.create("div",{"class":"appstate-title",innerHTML:this.nls.title},
a);var g=d.create("div",{"class":"appstate-close"},a);d.place(a,this.domNode);a=d.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});d.place(a,this.domNode);this.own(b(a,"click",k.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(b(g,"click",k.hitch(this,function(){this.hide()})));this.own(b(this.domNode,m.enter,k.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(b(this.domNode,m.leave,
k.hitch(this,function(){1===this.currentState&&!this.timeoutHandler&&(this.timeoutHandler=setTimeout(k.hitch(this,this.hide),l))})))},show:function(){q.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:k.hitch(this,function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(k.hitch(this,this.hide),l)},hide:function(){0!==this.currentState&&q.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?
{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:k.hitch(this,function(){this.currentState=0;d.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y){function x(c,a){var b=c.center.split(";");1===b.length&&(b=c.center.split(","));if(2===b.length||3===b.length){var e=parseFloat(b[0]),g=parseFloat(b[1]);if(isNaN(e)||isNaN(g))e=parseFloat(b[0]),g=parseFloat(b[1]);if(!isNaN(e)&&!isNaN(g)){var h=4326;3===b.length&&!isNaN(b[2])&&(h=parseInt(b[2],10));b=new m(e,g,new n(h));O(b.spatialReference,a.spatialReference)?a.centerAt(b):R(b,a.spatialReference,function(c){a.centerAt(c[0])},function(){console.error("Project center point error.")})}}}
function w(c,a){var b=c.extent.split(";");1===b.length&&(b=c.extent.split(","));if(4===b.length||5===b.length){var e=parseFloat(b[0]),g=parseFloat(b[1]),h=parseFloat(b[2]),l=parseFloat(b[3]);if(isNaN(e)||isNaN(e)||isNaN(e)||isNaN(e))e=parseFloat(b[0]),g=parseFloat(b[1]),h=parseFloat(b[2]),l=parseFloat(b[3]);if(!isNaN(e)&&!isNaN(g)&&!isNaN(h)&&!isNaN(l)){var r=4326;5===b.length&&!isNaN(b[4])&&(r=parseInt(b[4],10));b=new q(e,g,h,l,new n({wkid:r}));O(a.spatialReference,b.spatialReference)?a.setExtent(b):
R(b,a.spatialReference,function(c){a.setExtent(c[0])},function(){console.error("Project extent error.")})}else console.error("Wrong extent parameters.")}else console.error("Wrong extent parameters.")}function B(c,a){var b=null;if(c.markertemplate){b={title:"",content:"",isIncludeShareUrl:!1};try{var e=JSON.parse(decodeURIComponent(c.markertemplate));p.mixin(b,e)}catch(g){console.error("urlParams: \x26markertemplate JSON.parse error."+g.stack)}}e=c.marker.split(";");1===e.length&&(e=c.marker.split(","));
if(2<=e.length&&6>=e.length&&e[0].length&&!isNaN(e[0])&&e[1].length&&!isNaN(e[1])){var l=parseFloat(e[0]),r=parseFloat(e[1]),d=4326;3<=e.length&&(e[2].length&&!isNaN(e[2]))&&(d=parseInt(e[2],10));var s="";4<=e.length&&(s=e[3]);var f=null;5<=e.length&&0===e[4].indexOf("http")&&(f=e[4]);var t=null;6===e.length&&(t=e[5]);var q=h.fromJson({type:"esriPMS",url:f,contentType:"image/png"}),u=null;t&&(u=h.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,
xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:t}));D(q).then(function(){var c=new m(l,r,new n({wkid:d}));O(c.spatialReference,a.spatialReference)?A(c,q,u,s,b,a):R(c,a.spatialReference,function(c){A(c[0],q,u,s,b,a)},function(){console.error("Project center point error.")})})}}function A(c,a,b,g,h,l){g=new t("",g);if(h){var n=h.content;h.isIncludeShareUrl&&(h={title:h.title},p.mixin(h,c),h=y.getShareUrl(l,h,n,!0),h=y.getShareUrlContent(h),
n+=h);g.setContent(n)}n=new e({id:"marker-feature-action-layer"});l.addLayer(n);g=new r(c,a,null,g);n.add(g);b&&(b.xoffset=a.width/2,b.yoffset=a.height/2+a.yoffset,a=new r(new m(c.toJson()),b),n.add(a),g._textSymbol=a);l.centerAt(c)}function D(c){var a=new k;c.url?u.getImagesSize(c.url).then(function(b){c.width=b[0];c.height=b[1];a.resolve(c)},function(){c.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";c.width=26;c.height=26;c.setOffset(0,c.height/2);a.resolve(c)}):(c.url=require.toUrl("jimu")+
"/images/EsriBluePinCircle26.png",c.width=26,c.height=26,c.setOffset(0,c.height/2),a.resolve(c));return a}function C(c,a){var b=c.query.split(";");1===b.length&&(b=c.query.split(","));if(2!==b.length&&3!==b.length)console.error("query URL parameter is not correct.");else{var e=b[0];I("name",e,a).then(function(c){null===c?I("id",e,a).then(function(c){null===c?console.error("Invalid layer name or id."):E(a,c,b)}):E(a,c,b)})}}function E(b,e,g){var h=new c,l="";h.outSpatialReference=b.spatialReference;
if(2===g.length)h.where=g[1];else if(3===g.length&&(e.layerObject.url&&(u.isHostedService(e.layerObject.url)&&u.containsNonLatinCharacter(g[2]))&&(l="N"),f.forEach(e.layerObject.fields,function(c){c.alias.toLowerCase()!==g[1].toLowerCase()&&c.name.toLowerCase()!==g[1].toLowerCase()||(-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(c.type)?h.where=c.name+"\x3d"+g[2]:-1<["esriFieldTypeString"].indexOf(c.type)&&(h.where=g[1]+
"\x3d"+l+"'"+g[2].replace(/\'/g,"''")+"'"))},this),!h.where)){console.error("Invalid field name or type in query URL parameter.");return}e.layerObject.selectFeatures(h).then(function(c){if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===e.layerObject.geometryType&&1===c.length)b.setExtent(a.getExtentForScale(b,1E3)),b.centerAt(c[0].geometry);else{var g=u.graphicsExtent(c);b.setExtent(g)}F(b,e,c)}},function(c){console.error(c)})}function F(c,a,b){function g(h){var l=
new e;l.setRenderer(a.layerObject.renderer);c.addLayer(l);f.forEach(b,function(c){c.setInfoTemplate(h);l.add(c)})}function h(){c.infoWindow.setFeatures(b);c.infoWindow.show(G(b[0]))}if(c.getLayer(a.layerInfo.id))h();else{var l=a.layerInfo.getInfoTemplate();l?(g(l),h()):a.layerInfo.loadInfoTemplate().then(function(c){g(c);h()})}}function G(c){c=c.geometry;if("point"!==c.type)if("multipoint"===c.type)c=c.getPoint(0);else if("polyline"===c.type)c=c.getExtent().getCenter();else if("polygon"===c.type)c=
c.getExtent().getCenter();else if("extent"===c.type)c=c.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return c}function I(c,a,e){var g=new k,h=[];v.getInstance(e,e.itemInfo).then(function(e){e.traversal(function(e){if(g.isResolved())return!0;("id"===c&&e.id.toLowerCase()===a.toLowerCase()||"name"===c&&e.title.toLowerCase()===a.toLowerCase())&&h.push(b({layerType:e.getLayerType(),layerObject:e.getLayerObject()}).then(function(c){"FeatureLayer"===c.layerType&&
g.resolve({layerInfo:e,layerObject:c.layerObject})},function(c){console.error("Find layer error from query URL parameter",c);g.resolve(null)}))});b(h).then(function(){g.isResolved()||g.resolve(null)})});return g}function R(c,a,b,e){var h=[102113,102100,3857],n;if(4326===c.spatialReference.wkid&&P(h,a.wkid)){c.ymin=Math.max(c.ymin,-89.99);c.ymax=Math.min(c.ymax,89.99);c=g.geographicToWebMercator(c);if((e=c.spatialReference._getInfo())&&c.xmin>c.xmax)h=e.valid[1]-c.xmin,n=c.xmax-e.valid[0],h>n?c.xmax=
e.valid[1]+n:c.xmin=e.valid[0]-h;c.spatialReference.wkid=a.wkid;b([c],null)}else if(P(h,c.spatialReference.wkid)&&4326===a.wkid){c=g.webMercatorToGeographic(c);if((e=c.spatialReference._getInfo())&&c.xmin>c.xmax)h=e.valid[1]-c.xmin,n=c.xmax-e.valid[0],h>n?c.xmax=e.valid[1]+n:c.xmin=e.valid[0]-h;b([c],null)}else h=new l,h.geometries=[c],h.outSR=a,s.defaults.geometryService.project(h,function(c){c&&0<c.length&&c[0]&&"extent"===c[0].type&&!isNaN(c[0].xmin)&&!isNaN(c[0].ymin)&&!isNaN(c[0].xmax)&&!isNaN(c[0].ymax)?
b(c,null):c&&(0<c.length&&c[0]&&"point"===c[0].type&&!isNaN(c[0].x)&&!isNaN(c[0].y))&&b(c,null)},e)}function O(c,a){var b=[102113,102100,3857];return c&&a&&c.wkt===a.wkt&&(c.wkid===a.wkid||c.latestWkid&&c.latestWkid===a.wkid||a.latestWkid&&c.wkid===a.latestWkid||c.latestWkid&&c.latestWkid===a.latestWkid)||c&&a&&c.wkid&&a.wkid&&P(b,c.wkid)&&P(b,a.wkid)?!0:!1}function P(c,a){for(var b=c.length;b--;)if(c[b]===a)return!0;return!1}return{postProcessUrlParams:function(c,a){if("extent"in c)return w(c,a);
if("center"in c)return x(c,a);if("marker"in c)return B(c,a);if("find"in c)d.publish("publishData","framework","framework",{searchString:c.find},!0);else if("query"in c)return C(c,a)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(p,f,k,d,b,m,q,a,n,l){var s={getBaseHrefUrl:function(a){var b="HTML3D"===window.appInfo.appType?"webappviewer3d":
"webappviewer",l="";window.isXT?l=window.location.protocol+"//"+window.location.host+window.appInfo.appPath:(l=n.urlToObject(window.location.href).query||{},l=l.appid?a+"apps/"+b+"/index.html?appid\x3d"+l.appid:l.id?a+"apps/"+b+"/index.html?id\x3d"+l.id:n.getAppHref());return l},addQueryParamToUrl:function(a,b,n,e){a=l.urlToObject(a);a.query||(a.query={});a.query[b]=n;b=a.path;for(var m in a.query)n=a.query[m],!0===e&&(n=encodeURIComponent(n)),b=b===a.path?b+"?"+m+"\x3d"+n:b+"\x26"+m+"\x3d"+n;return b},
removeQueryParamFromUrl:function(a,b,n){a=l.urlToObject(a);a.query&&delete a.query[b];b=a.path;for(var e in a.query){var m=a.query[e];!0===n&&(m=encodeURIComponent(m));b=b===a.path?b+"?"+e+"\x3d"+m:b+"\x26"+e+"\x3d"+m}return b},getShareUrlContent:function(a){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+
a+"/\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(a,b,l,e){var n=s.getBaseHrefUrl(window.portalUrl),c="";b&&(b.x&&b.y&&b.spatialReference&&b.spatialReference.wkid?c=b.x+","+b.y+","+b.spatialReference.wkid:b.longitude&&b.latitude&&(c=b.longitude+","+b.latitude+","));n=s.addQueryParamToUrl(n,"marker",c,!0);n+=",,";n+=",";n=s.addQueryParamToUrl(n,"markertemplate",encodeURIComponent(JSON.stringify({title:b.title,content:l,isIncludeShareUrl:e})));b=a.getLevel();return n="number"===typeof b&&-1!==
b?s.addQueryParamToUrl(n,"level",a.getLevel(),!0):s.addQueryParamToUrl(n,"scale",a.getScale(),!0)},getXyContent:function(a){var b="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";a.longitude&&a.latitude?b+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.longitude).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+
"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.latitude).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e":a.x&&a.y&&(b+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.x).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+parseFloat(a.y).toFixed(4)+"\x3c/span\x3e\x3c/div\x3e");return b+"\x3c/div\x3e"},_isUserOwnTheApp:function(a){return a&&
a.username&&a.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(a,h,l,e){var n=new b;e=d.getStandardPortalUrl(e);e=e+"/sharing/rest/content/users/"+(h?h.username?h.username:h.email:l.email);if(m.isDefined(a.folderId)&&"/"!==a.folderId||m.isDefined(a.ownerFolder)&&"/"!==a.ownerFolder)e+="/"+(a.folderId||a.ownerFolder);e+="/items/"+a.id;f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(c){n.resolve(c)}),p.hitch(this,function(c){console.error(c);
n.reject(c)}));return n},_getProfile:function(a,h){var l=new b,e=d.getUserUrl(h,a.owner);f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(a){l.resolve(a)}),p.hitch(this,function(a){console.error(a);l.reject(a)}));return l},_unshareItemById:function(a,h,l){var e=new b;l=d.getStandardPortalUrl(l);l+="/sharing/rest/content/items/"+h+"/unshare";h={f:"json"};h=p.mixin(h,a);f({url:l,handleAs:"json",content:h,callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,
function(a){e.resolve(a)}),p.hitch(this,function(a){console.error(a);e.reject(a)}));return e},canSharePublic:function(a){return a.selfUrl&&(!0===a.canSharePublic||!1===a.canSharePublic)?a.canSharePublic:!0},unshareItemsByUser:function(a,h,l){var e=new b;l=d.getStandardPortalUrl(l);l+="/sharing/rest/content/users/"+a+"/unshareItems";a={f:"json"};a=p.mixin(a,h);f({url:l,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,function(a){e.resolve(a)}),p.hitch(this,function(a){console.error(a);
e.reject(a)}));return e},unshareItems:function(a,h,l){var e=new b;l=d.getStandardPortalUrl(l);l+="/sharing/rest/content/users/"+(h.owner||a.email)+"/unshareItems";a={f:"json"};a=p.mixin(a,h);f({url:l,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,function(a){e.resolve(a)}),p.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItemsByUser:function(a,h,l){var e=new b;l=d.getStandardPortalUrl(l);l+="/sharing/rest/content/users/"+a+"/shareItems";
a={f:"json"};a=p.mixin(a,h);f({url:l,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,function(a){e.resolve(a)}),p.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItems:function(a,h,l){var e=new b;l=d.getStandardPortalUrl(l);l+="/sharing/rest/content/users/"+(h.owner||a.email)+"/shareItems";a={f:"json"};a=p.mixin(a,h);f({url:l,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,function(a){e.resolve(a)}),
p.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getItemsGroups:function(a,h){var l=new b,e=d.getStandardPortalUrl(h),e=e+("/sharing/rest/content/items/"+a.id+"/groups");f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(p.hitch(this,function(a){l.resolve(a)}),p.hitch(this,function(a){console.error(a);l.reject(a)}));return l},isSharedToPublic:function(a){return window.isXT?!1:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&
"undefined"!==typeof a.item.access&&"public"===a.item.access?!0:!1},isShowSocialMediaLinks:function(a){return window.isXT?!0:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"private"===a.item.access?!1:!0},getItemShareInfo:function(a){var h=new b,l="";if(window.isXT)return h.resolve(null);l=n.urlToObject(n.getAppHref()).query||{};l=l.id||l.appid;if("undefined"===typeof l||""===l)return h.resolve(null);q.getPortal(a).getItemById(l).then(p.hitch(this,
function(a){var b={};b.item=a;b.item&&("undefined"===typeof b.item.sharing&&b.item.access)&&(b.item.sharing={access:b.item.access});h.resolve(b)}),p.hitch(this,function(a){console.log(a);h.resolve(null)}));return h},getShareInfo:function(a){var h=q.getPortal(a),l=new b,e="";if(window.isXT)return l.resolve(null);e=n.urlToObject(n.getAppHref()).query||{};e=e.id||e.appid;if("undefined"===typeof e||""===e)return l.resolve(null);k({getUser:h.getUser(),loadSelfInfo:h.loadSelfInfo(),getItem:h.getItemById(e)}).then(p.hitch(this,
function(b){var c={};c.item=b.getItem;c.item&&(c.item.ownerFolder&&c.item.ownerFolder.length&&"/"!==c.item.ownerFolder)&&(c.item.folderId=c.item.ownerFolder);"undefined"===typeof c.item.sharing&&c.item.access&&(c.item.sharing={access:c.item.access});c.user=b.getUser;s._setUserRole(b.loadSelfInfo,c);c.currentUser=c.user;c.isAdmin=!1;c.userRole&&(c.userRole.isAdmin()||c.userRole.isCustom()&&c.userRole.canUpdateOrgItems())?(c.isAdmin=!0,c.item.owner!==c.currentUser.name?s._getProfile(c.item,a).then(p.hitch(this,
function(a){c.itemUser=a;c.itemUser.orgId!==c.currentUser.orgId&&(c.isAdmin=!1);l.resolve(c)})):(c.itemUser=c.currentUser,l.resolve(c))):(c.currentUser&&(c.itemUser=c.currentUser),l.resolve(c))}),p.hitch(this,function(a){console.log(a);l.resolve(null)}));return l},_setUserRole:function(b,h){h.userPortalUrl=b.urlKey?b.urlKey+"."+b.customBaseUrl:this.portalUrl;b&&(!b.code&&!b.message)&&(h.organization=b);if(b&&b.user)h.userRole=new a({id:b.user.roleId?b.user.roleId:b.user.role,role:b.user.role}),h._isCustomRole=
h.userRole.isCustom(),h._roleCanShareToGroup=h._isCustomRole&&h.userRole.canShareItemToGroup(),h._roleCanShareToOrg=h._isCustomRole&&h.userRole.canShareItemToOrg(),h._roleCanSharePublic=h._isCustomRole&&h.userRole.canShareItemToPublic(),h._roleCanShare=h._roleCanShareToGroup||h._roleCanShareToOrg||h._roleCanShareToPublic,h._roleCanUpdateItems=h._isCustomRole&&h.userRole.canUpdateOrgItems(),h._roleCanShareOthersItemsToGroup=h._isCustomRole&&h.userRole.canShareOthersItemsToGroup(),h._roleCanShareOthersItemsToOrg=
h._isCustomRole&&h.userRole.canShareOthersItemsToOrg(),h._roleCanShareOthersItemsToPublic=h._isCustomRole&&h.userRole.canShareOthersItemsToPublic(),h._roleCanShareOthersItems=h._isCustomRole&&(h.userRole.canShareOthersItemsToGroup()||h.userRole.canShareOthersItemsToOrg()||h._roleCanShareOthersItemsToPublic),h._orgUserCanSharePublicOrOverride=h.organization&&(!0===h.organization.canSharePublic&&(!h._isCustomRole||h._roleCanSharePublic||h._roleCanShareOthersItemsToPublic)||h.userRole.isAdmin());else return!1},
getItemById:function(a,h){var l=new b,e=d.getStandardPortalUrl(h),e=e+("/sharing/rest/content/items/"+a.id);f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(a){l.resolve(a)}),p.hitch(this,function(a){console.error(a);l.reject(a)}));return l}};return s})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(p,f,k,d,b){return p(null,{id:null,baseRole:null,name:null,description:null,
privileges:[],privilegeObj:null,constructor:function(b){b=b||{};this.id=b.id;this.baseRole=b.role;this.name=b.name;this.description=b.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,
publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(m){b.isDefined(m)&&m instanceof
Array&&k.forEach(m,f.hitch(this,function(b){this._readPrivilege(b)}))},_readPrivilege:function(b){this._applyEffectToAction(!0,b)},_applyEffectToAction:function(b,d){switch(d){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=b;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=b;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=b;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=b;break;
case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=b;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=b;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=b;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=b;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=b;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=
b;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=b;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=b;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=b;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=b;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=b;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=
b;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=b;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=b;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=b;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=b;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=b;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=
b;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=b;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=b;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=b;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=b;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=b;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
b;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=b;break;case "features:user:edit":this.privilegeObj.features.user.edit=b;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=b;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=b;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=b;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=b;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=b;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=b;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=b;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=b;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=b;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
b;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=b;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=b}},_applyToAll:function(b){this.privilegeObj.portal.admin.inviteUsers=b;this.privilegeObj.portal.admin.disableUsers=b;this.privilegeObj.portal.admin.viewUsers=b;this.privilegeObj.portal.admin.updateUsers=b;this.privilegeObj.portal.admin.deleteUsers=b;this.privilegeObj.portal.admin.changeUserRoles=b;this.privilegeObj.portal.admin.viewGroups=
b;this.privilegeObj.portal.admin.updateGroups=b;this.privilegeObj.portal.admin.deleteGroups=b;this.privilegeObj.portal.admin.reassignGroups=b;this.privilegeObj.portal.admin.assignToGroups=b;this.privilegeObj.portal.admin.manageEnterpriseGroups=b;this.privilegeObj.portal.admin.viewItems=b;this.privilegeObj.portal.admin.updateItems=b;this.privilegeObj.portal.admin.deleteItems=b;this.privilegeObj.portal.admin.reassignItems=b;this.privilegeObj.portal.admin.manageLicenses=b;this.privilegeObj.portal.publisher.publishFeatures=
b;this.privilegeObj.portal.publisher.publishTiles=b;this.privilegeObj.portal.publisher.publishScenes=b;this.privilegeObj.portal.user.createGroup=b;this.privilegeObj.portal.user.joinGroup=b;this.privilegeObj.portal.user.joinNonOrgGroup=b;this.privilegeObj.portal.user.createItem=b;this.privilegeObj.portal.user.shareToGroup=b;this.privilegeObj.portal.user.shareToOrg=b;this.privilegeObj.portal.user.shareToPublic=b;this.privilegeObj.portal.user.shareGroupToOrg=b;this.privilegeObj.portal.user.shareGroupToPublic=
b;this.privilegeObj.features.user.edit=b;this.privilegeObj.opendata.user.openDataAdmin=b;this.privilegeObj.opendata.user.designateGroup=b;this.privilegeObj.premium.user.geocode=b;this.privilegeObj.premium.user.networkanalysis=b;this.privilegeObj.premium.user.spatialanalysis=b;this.privilegeObj.premium.user.geoenrichment=b;this.privilegeObj.premium.user.demographics=b;this.privilegeObj.premium.user.elevation=b;this.privilegeObj.marketplace.admin.purchase=b;this.privilegeObj.marketplace.admin.manage=
b;this.privilegeObj.marketplace.admin.startTrial=b},_buildPrivilegesArray:function(){var b=[];!0===this.privilegeObj.portal.admin.inviteUsers&&b.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&b.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&b.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&b.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&b.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&b.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&b.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&b.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&b.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&b.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&b.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&b.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&b.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&b.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&b.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&b.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&b.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&b.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&b.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&b.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&b.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&b.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
b.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&b.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&b.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&b.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&b.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&b.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
b.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&b.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&b.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&b.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&b.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&b.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
b.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&b.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&b.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&b.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&b.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&b.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
b.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&b.push("marketplace:admin:startTrial");return b},isUser:function(){return b.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return b.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return b.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||b.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||b.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||b.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&b.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(d){this.privileges=d;this._initPrivilegesObject();b.isDefined(d)&&this._readPrivileges(d)},stringify:function(){return d.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return d.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return d.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return d.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/PopupMenu ./RelatedRecordsPopupProjector".split(" "),function(p,f,k,d,b,m,q,a,n,l){var s=null,g=p(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){f.mixin(this,a);this.popupMenu=n.getInstance();
this.isInited=!1;this.featureActionManager=q.getInstance();d.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));d.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));d.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));d.subscribe("widgetsActionsRegistered",f.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&(this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&
this.popupUnion.mobile.domNode)&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&k.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&k.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=k.create("span",{"class":"popup-menu-button"},m(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=m("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],
a=k.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=k.create("span",{"class":"popup-menu-button"},a);b(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));b(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=k.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){b(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));
b(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){k.addClass(this.popupMenuButtonDesktop,"disabled");k.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){k.removeClass(this.popupMenuButtonDesktop,
"disabled");k.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(b){if(b){var g=a.toFeatureSet(b);this.featureActionManager.getSupportedActions(g).then(f.hitch(this,function(a){var b="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords".split(" ");a=a.filter(f.hitch(this,function(c){return 0>b.indexOf(c.name)}));0===a.length?this._disablePopupMenu():this._enablePopupMenu();a=a.map(f.hitch(this,function(c){c.data=g;return c}));this.popupMenu.setActions(a)}))}else this._disablePopupMenu(),
this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&
this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new l({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(b){console.warn(b.message)}}});g.getInstance=function(a){null===s&&(s=new g({mapManager:a}));return s};return g})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),
function(p,f,k,d,b,m,q,a){var n=null,l=p(null,{constructor:function(){this._actions=[];window.isBuilder?(d.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),d.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(d.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),d.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(d.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),d.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):
(d.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),d.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(a){a=this._getFeatureSet(a);var b=[];k.forEach(this._actions,function(h){var l=this.testActionSupportFeature(h,a);l.action=h;b.push(l)},this);return m(b).then(f.hitch(this,function(a){return a.map(f.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},
testActionSupportFeature:function(a,g){g=this._getFeatureSet(g);var h;g.features&&0<g.features.length&&(h=g.features[0].getLayer());h=a.isFeatureSupported(g,h);var l=new b;h&&"function"===typeof h.then?h.then(function(a){l.resolve(a)},function(a){console.error(a);l.resolve(!1)}):l.resolve(h);return l},registerAction:function(a){var g=new b;require([a.uri],f.hitch(this,function(b){var l=new b({map:this.map,appConfig:this.appConfig,label:a.label,name:a.name,widgetId:a.widgetId});k.some(this._actions,
function(a){return l.name===a.name&&l.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",l.name),g.reject("Feature/FeatureSet action has been registered.",l.name)):(this._actions.push(l),g.resolve(l))}));return g},removeActionsByWidgetId:function(a){this._actions=k.filter(this._actions,function(b){return b.widgetId!==a},this)},getActionsByWidgetId:function(a){return k.filter(this._actions,function(b){return b.widgetId===a},this)},getActionsByActionName:function(a){return k.filter(this._actions,
function(b){return b.name===a},this)},registerWidgetFeatureActions:function(a){var g=new b;if(!a.featureActions||!a.uri)return g.resolve(),g;var h=[];k.forEach(a.featureActions,function(b){h.push(this.registerAction({uri:a.isRemote?a.amdFolder+b.uri+".js":a.amdFolder+b.uri,widgetId:a.id,name:b.name,label:a.manifest["i18nLabels_featureAction_"+b.name][window.dojoConfig.locale]||a.manifest["i18nLabels_featureAction_"+b.name].defaultLabel}))},this);return m(h)},registerAllWidgetFeatureActions:function(a){var b=
[];a.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&b.push(this.registerWidgetFeatureActions(a))}));return m(b).then(function(){d.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(a){var b=[];k.forEach(this.getAllActions(),function(b){var g=a.getConfigElementById(b.widgetId);"framework"!==b.widgetId&&(!g||!g.uri||!1===g.visible)&&this.removeActionsByWidgetId(b.widgetId)},this);a.visitElement(f.hitch(this,function(a){a.uri&&(a.visible&&0===this.getActionsByWidgetId(a.id).length)&&
b.push(this.registerWidgetFeatureActions(a))}));0<b.length&&m(b).then(function(){d.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){k.forEach(q,function(a){this.registerAction({uri:a.uri,widgetId:"framework",label:window.jimuNls.featureActions[a.name],name:a.name})},this)},_getFeatureSet:function(b){return"[object Object]"===Object.prototype.toString.call(b)?b.features?b:a.toFeatureSet([b]):a.toFeatureSet(b)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);this._setActionsAppConfig(a);
this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(a){this.appConfig=a=f.clone(a);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(a)},_onMapLoaded:function(a){this.map=a;this._setActionsMap(a)},_onMapChanged:function(a){this.map=a;this._setActionsMap(a)},_setActionsMap:function(a){k.forEach(this._actions,function(b){b.setMap(a)},this)},_setActionsAppConfig:function(a){k.forEach(this._actions,function(b){b.setAppConfig(a)},this)}});l.getInstance=
function(){null===n&&(n=new l,window._featureActionManager=n);return n};return l})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer".split(" "),function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",
uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/utils"],function(p,f,k){return p(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(d){return 0<d.features.length&&d.features[0].geometry},onExecute:function(d){k.featureAction.zoomTo(this.map,d.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(p,f){return p(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(k){f.mixin(this,k)},
isFeatureSupported:function(f,d){return!0},onExecute:function(f,d){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(p,
f,k){return p(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(d){return 0<d.features.length&&d.geometryType},onExecute:function(d){k.featureAction.panTo(this.map,d.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(p,f,k,d){return p([k],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(b,d){if(1>b.features.length||!d)return!1;var q=b.features[0],a=f.getObject("renderer.symbol",
!1,d);return q&&q.geometry&&(q.symbol||a)&&this.map.getLayer(d.id)},onExecute:function(b,f){d.featureAction.flash(b&&b.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(p,f,k){return p([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(d,b){return d&&d.features&&1===d.features.length&&b&&b.infoTemplate},onExecute:function(d){k.featureAction.showPopup(this.map,d.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","../exportUtils"],function(p,f,k){return p(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(d){return 0<d.features.length},onExecute:function(d){d=k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:d});d.setFormat(k.FORMAT_CSV);d.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./jsonConverters".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){function c(c,a){var b="",g=a.length,h=c.length,l="",n="",r;try{k.forEach(c,function(c){b="string"===typeof c?b+l+c:b+l+(c.alias||c.name);l=","});for(var b=b+"\r\n",d=0;d<g;d++){l="";r=a[d];for(var f=0;f<h;f++){var m=c[f],n=r["string"===typeof m?m:m.name];!n&&"number"!==typeof n&&(n="");if(n)if("esriFieldTypeDate"===m.type)n=e.localizeDateByFieldInfo(n,m.fieldInfo);else if(m.fieldInfo&&("esriFieldTypeDouble"===m.type||"esriFieldTypeSingle"===m.type||"esriFieldTypeInteger"===
m.type||"esriFieldTypeSmallInteger"===m.type))n=e.localizeNumberByFieldInfo(n,m.fieldInfo);n&&/[",\r\n]/g.test(n)&&(n='"'+n.replace(/(")/g,'""')+'"');b=b+l+n;l=","}b+="\r\n"}return b}catch(s){return""}}var u={createDataSource:function(c){return c.type===u.TYPE_TABLE?new x(c):c.type===u.TYPE_FEATURESET?new y(c):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},v=p(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,
constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(c){this.format=c},download:function(){this.getExportString().then(f.hitch(this,function(c){var a=this.filename+this.suffix,b;try{b=!!new Blob}catch(e){b=!1}b?(c=new Blob([c],{type:"text/plain;charset\x3dutf-8"}),saveAs(c,a)):saveTextAs(c,a,"utf-8")}))},exportToPortal:function(c,a){}}),y=p(v,{featureSet:null,constructor:function(c){this.inherited(arguments);
this.featureSet=c.data;this.url=c.url;this.filename=c.filename},getExportString:function(){if(this.format===u.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===u.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===u.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var c=new b;c.resolve("");return c},getSupportExportFormats:function(){return[{value:u.FORMAT_CSV,label:this.nls.toCSV},{value:u.FORMAT_FEATURESET,
label:this.nls.toFeatureCollection},{value:u.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var c=new b;if(this.featureSet)c.resolve(this.featureSet);else if(this.url){var a=new m;a.returnGeometry=!0;a.outFields=["*"];this.queryTask=new q(this.url);this.queryTask.execute(a,f.hitch(this,function(a){c.resolve(a)}),f.hitch(this,function(){c.resolve(null)}))}else c.resolve(null);return c},_getSpatialReference:function(c){if(c.spatialReference)return c.spatialReference;var a;k.some(c.features,
function(c){if(c.geometry&&c.geometry.spatialReference)return a=c.geometry.spatialReference,!0});return a},_projectToWGS84:function(c){var r=new b,d=this._getSpatialReference(c);if(d)if(4326===parseInt(d.wkid,10))r.resolve(c);else if(d.isWebMercator()){var d=new a,f=[];k.forEach(c.features,function(c){var a=new n;a.attributes=c.attribues;a.geometry=h.webMercatorToGeographic(c.geometry);f.push(a)});d.features=f;r.resolve(d)}else{d=new s;d.geometries=k.map(c.features,function(c){return c.geometry});
d.outSR=new l(4326);var m=g&&g.defaults&&g.defaults.geometryService;m&&"esri.tasks.GeometryService"===m.declaredClass||(m=e.getArcGISDefaultGeometryService());m.project(d).then(function(b){var e=new a,g=[];k.forEach(c.features,function(c,a){var e=new n;e.attributes=c.attribues;e.geometry=b[a];g.push(e)});e.features=g;r.resolve(e)},function(c){console.error(c);r.resolve([])})}else r.resolve([]);return r},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(c){var a=
"";c&&(c=c.toJson())&&(a=d.stringify(c));return a}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,function(c){return this._projectToWGS84(c)})).then(f.hitch(this,function(c){var a="";c&&(c=(new t.esriConverter).toGeoJson(c))&&(a=d.stringify(c));return a}))},_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(c){var a="";c&&(a=this._createCSVFromFeatureSet(c));return a}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a);
a=k.map(a.features,function(c){return c.attributes});return c(b,a)},_generateFields:function(c){var a=c.features[0],b,e;if(a._layer){b=a._layer.fields;var g=r.getInstanceSync().getLayerInfoById(a._layer.id).getPopupInfo();k.forEach(b,f.hitch(this,function(c){c.fieldInfo=this._findFieldInfo(g,c.name)}))}else if(c.fieldAliases)for(e in b=[],c.fieldAliases)c.fieldAliases.hasOwnProperty(e)&&b.push({name:e,alias:c.fieldAliases[e]});else for(e in b=[],c=a.attributes,c)c.hasOwnProperty(e)&&b.push({name:e});
return b},_findFieldInfo:function(c,a){if(!c)return null;var b;k.some(c.fieldInfos,function(c){if(c.fieldName===a)return b=c,!0});return b}}),x=p(v,{table:null,constructor:function(c){this.inherited(arguments);this.table=c.data;this.url=c.url;this.filename=c.filename},getExportString:function(){if(this.format===u.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var c=new b;c.resolve("");return c},getSupportExportFormats:function(){return[{value:u.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var c=
new b;if(this.table)c.resolve(this.table);else if(this.url){var a=new m;a.outFields=["*"];this.queryTask=new q(this.url);this.queryTask.execute(a,f.hitch(this,function(a){var b={};b.fields=a.fields;b.datas=k.map(a.features,function(c){return c.attributes});c.resolve(b)}),f.hitch(this,function(){c.resolve(null)}))}else c.resolve(null);return c},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,function(a){var b="";a&&(b="\ufeff"+c(a.fields,a.datas));return b}))}});return u})},
"jimu/jsonConverters":function(){(function(){function p(b){var d=0,a=0,n=b.length,l=b[a],f;for(a;a<n-1;a++)f=b[a+1],d+=(f[0]-l[0])*(f[1]+l[1]),l=f;return 0<=d}function f(){function b(a){var n,l,d;if(a){if((a.x&&"NaN"!==a.x||0===a.x)&&(a.y&&"NaN"!==a.y||0===a.y))d="Point",l=[a.x,a.y];else if(a.points&&a.points.length)d="MultiPoint",l=a.points;else if(a.paths&&a.paths.length)a=a.paths,1===a.length?(d="LineString",l=a[0]):(d="MultiLineString",l=a);else if(a.rings&&a.rings.length){d=[];a=a.rings;for(n=
0;n<a.length;n++)l=a[n],p(l)?d.push([l]):0<d.length&&d[d.length-1].push(l);1<d.length?(l=d,d="MultiPolygon"):(l=d.pop(),d="Polygon")}n=l&&d?{type:d,coordinates:l}:null}return n}function d(a){var n=null,l,f;if(a&&(n={type:"Feature"},a.geometry&&(n.geometry=b(a.geometry)),a.attributes)){f={};for(l in a.attributes)f[l]=a.attributes[l];n.properties=f}return n}return{toGeoJson:function(a){var n,l,f;if(a)if(a.features){n={type:"FeatureCollection",features:[]};l=a.features;for(a=0;a<l.length;a++)(f=d(l[a]))&&
n.features.push(f)}else n=a.geometry?d(a):b(a);return n}}}function k(){function b(a){var n,g;if("Point"===a)n="esriGeometryPoint";else if("MultiPoint"===a)n="esriGeometryMultipoint",g="points";else if("LineString"===a||"MultiLineString"===a)n="esriGeometryPolyline",g="paths";else if("Polygon"===a||"MultiPolygon"===a)n="esriGeometryPolygon",g="rings";return{type:n,geomHolder:g}}function d(a){var b,g,h=[],n;b=0;for(g=a.length;b<g;b++)n=a[b],0===b!==p(n)&&(n=n.reverse()),h.push(n);return h}function a(a){var n,
g,h,r,e;if("GeometryCollection"===a.type){g=[a.geometries.shift()];n=b(g[0].type);for(h=0;h<a.geometries.length;h++){r=n.type;e=a.geometries[h].type;var f=!1;if(("esriGeometryPoint"===r||"esriGeometryMultipoint"===r)&&("Point"===e||"MultiPoint"===e))f=!0;else if("esriGeometryPolyline"===r&&("LineString"===e||"MultiLineString"===e))f=!0;else if("esriGeometryPolygon"===r&&("Polygon"===e||"MultiPolygon"===e))f=!0;f&&g.push(a.geometries[h])}}else n=b(a.type),g=[a];"esriGeometryPoint"===n.type&&1<g.length&&
(n=b("MultiPoint"));a={spatialReference:{wkid:4326}};if("esriGeometryPoint"===n.type)0===g[0].coordinates.length?(a.x=null,a.y=null):(a.x=g[0].coordinates[0],a.y=g[0].coordinates[1]);else{a[n.geomHolder]=[];for(h=0;h<g.length;h++){r=g[h];var c=f=e=void 0;if("MultiPoint"===r.type||"MultiLineString"===r.type)c=r.coordinates;else if("Point"===r.type||"LineString"===r.type)c=[r.coordinates];else if("Polygon"===r.type)c=d(r.coordinates);else if("MultiPolygon"===r.type){c=[];e=0;for(f=r.coordinates.length;e<
f;e++)c.push(d(r.coordinates[e])[0])}e=c;for(r=0;r<e.length;r++)a[n.geomHolder].push(e[r])}}return a}function n(b){var n,g,h;if(b&&(n={},b.geometry&&(n.geometry=a(b.geometry)),b.properties)){h={};for(g in b.properties)h[g]=b.properties[g];n.attributes=h}return n}return{toEsri:function(b){var d,g,h;if(b)if("FeatureCollection"===b.type){d={features:[]};g=b.features;for(b=0;b<g.length;b++)(h=n(g[b]))&&d.features.push(h)}else d="Feature"===b.type?n(b):a(b);return d}}}var d;d="undefined"!==typeof exports&&
null!==exports?exports:this;if("function"===typeof define){var b={esriConverter:f,geoJsonConverter:k};define([],function(){return b})}else d.esriConverter=f,d.geoJsonConverter=k}).call(this)},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(p,f,k){return p(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(d){return 0<d.features.length&&d.features[0].geometry},onExecute:function(d){d=
k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:d});d.setFormat(k.FORMAT_FEATURESET);d.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(p,f,k){return p(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(d){return 0<d.features.length&&d.features[0].geometry},onExecute:function(d){d=k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:d});d.setFormat(k.FORMAT_GEOJSON);
d.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(p,f,k){return p(f,{iconClass:"icon-statistics",isFeatureSupported:function(d,b){return 1<d.features.length&&b&&0<this.getNumbericFields(b).length},onExecute:function(d,b){var f=new k,q={featureSet:d,layer:b,fieldNames:this.getNumbericFields(b).map(function(a){return a.name})};f.showContentAsPopup(q)},getNumbericFields:function(d){return d.fields.filter(function(b){return-1<
["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(b.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e){return p([f],{statInfo:null,postMixInProperties:function(){this.nls=
window.jimuNls.fieldStatistics;k.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=d.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();
this._statisticsPopup=null;this._statisticsPopup=new g({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,c){var b;e.isStatFromServer(this.statInfo)&&(b=new h,b.placeAt(c),b.show());e.getStatisticsResult(this.statInfo).then(k.hitch(this,function(a){b&&b.destroy();q(".esriAGOTableStatistics",c).remove();a=this._createStatContent(a);d.place(a,c)}))},_getFieldAliaseFromStatInfo:function(a){if(this.statInfo.layer){var c=
b.filter(this.statInfo.layer.fields,function(c){return c.name===a});return c[0]?c[0].alias:""}return this.statInfo.featureSet.fieldAliases?this.statInfo.featureSet.fieldAliases[a]:a},_createFieldDom:function(a){var c;if(1<this.statInfo.fieldNames.length){c=d.create("div",{className:"header"},a);d.create("span",{innerHTML:this.nls.field+": "},c);var b=new l({options:this.statInfo.fieldNames.map(k.hitch(this,function(c){return{value:c,label:this._getFieldAliaseFromStatInfo(c)}})),style:{width:"150px"}});
this.own(m(b,"change",k.hitch(this,function(c){this.statInfo.fieldName=c;this._showOneFieldStatContent(this.statInfo,a)})));b.placeAt(c);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else c=d.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return c},_createStatContent:function(a){var c={},e="count sum min max ave stddev".split(" "),g,h,l,
n,r,f,m,s;g=d.create("div",{className:"esriAGOTableStatistics",innerHTML:""});d.create("div",{className:"hzLine",innerHTML:""},g);h=d.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},g);for(r in a)a.hasOwnProperty(r)&&(c[r.toLowerCase()]=a[r]);r=c.countfield;s=c.sumfield||"";m=c.minfield||"";f=c.maxfield||"";a=c.avgfield||"";c=c.stddevfield||"";l=d.create("tbody",{},h);var q=this;b.forEach([r,s,m,f,a,c],function(c,a){""!==c&&(n=d.create("tr",{valign:"top"},l),
d.create("td",{"class":"attrName",innerHTML:q.nls[e[a]]},n),d.create("td",{"class":"attrValue",innerHTML:c},n))});d.create("div",{className:"break",innerHTML:""},g);return g}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(p,f,k,d,b){function m(a){for(;a.childNodes[0]&&1==a.childNodes[0].nodeType;)a=a.childNodes[0];return a}function q(a,b){"string"==typeof a?(a=d.toDom(a,b&&b.ownerDocument),11==a.nodeType&&
(a=a.childNodes[0])):1==a.nodeType&&a.parentNode&&(a=a.cloneNode(!1));return a}var a=p.NodeList;f.extend(a,{_placeMultiple:function(a,b){for(var f="string"==typeof a||a.nodeType?p(a):a,g=[],h=0;h<f.length;h++)for(var r=f[h],e=this.length,m=e-1,c;c=this[m];m--)0<h&&(c=this._cloneNode(c),g.unshift(c)),m==e-1?d.place(c,r,b):r.parentNode.insertBefore(c,r),r=c;g.length&&(g.unshift(0),g.unshift(this.length-1),Array.prototype.splice.apply(this,g));return this},innerHTML:function(a){return arguments.length?
this.addContent(a,"only"):this[0].innerHTML},text:function(a){if(arguments.length){for(var l=0,d;d=this[l];l++)1==d.nodeType&&b.set(d,"textContent",a);return this}for(var g="",l=0;d=this[l];l++)g+=b.get(d,"textContent");return g},val:function(a){if(arguments.length){for(var b=f.isArray(a),d=0,g;g=this[d];d++){var h=g.nodeName.toUpperCase(),r=g.type,e=b?a[d]:a;if("SELECT"==h){h=g.options;for(r=0;r<h.length;r++){var m=h[r];m.selected=g.multiple?-1!=k.indexOf(a,m.value):m.value==e}}else"checkbox"==r||
"radio"==r?g.checked=g.value==e:g.value=e}return this}if((g=this[0])&&1==g.nodeType){a=g.value||"";if("SELECT"==g.nodeName.toUpperCase()&&g.multiple){a=[];h=g.options;for(r=0;r<h.length;r++)m=h[r],m.selected&&a.push(m.value);a.length||(a=null)}return a}},append:function(a){return this.addContent(a,"last")},appendTo:function(a){return this._placeMultiple(a,"last")},prepend:function(a){return this.addContent(a,"first")},prependTo:function(a){return this._placeMultiple(a,"first")},after:function(a){return this.addContent(a,
"after")},insertAfter:function(a){return this._placeMultiple(a,"after")},before:function(a){return this.addContent(a,"before")},insertBefore:function(a){return this._placeMultiple(a,"before")},remove:a.prototype.orphan,wrap:function(a){if(this[0]){a=q(a,this[0]);for(var b=0,d;d=this[b];b++){var g=this._cloneNode(a);d.parentNode&&d.parentNode.replaceChild(g,d);m(g).appendChild(d)}}return this},wrapAll:function(a){if(this[0]){a=q(a,this[0]);this[0].parentNode.replaceChild(a,this[0]);a=m(a);for(var b=
0,d;d=this[b];b++)a.appendChild(d)}return this},wrapInner:function(a){if(this[0]){a=q(a,this[0]);for(var b=0;b<this.length;b++){var d=this._cloneNode(a);this._wrap(f._toArray(this[b].childNodes),null,this._NodeListCtor).wrapAll(d)}}return this},replaceWith:function(a){a=this._normalize(a,this[0]);for(var b=0,d;d=this[b];b++)this._place(a,d,"before",0<b),d.parentNode.removeChild(d);return this},replaceAll:function(a){a=p(a);for(var b=this._normalize(this,this[0]),d=0,g;g=a[d];d++)this._place(b,g,"before",
0<d),g.parentNode.removeChild(g);return this},clone:function(){for(var a=[],b=0;b<this.length;b++)a.push(this._cloneNode(this[b]));return this._wrap(a,this,this._NodeListCtor)}});a.prototype.html||(a.prototype.html=a.prototype.innerHTML);return a})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v){function y(c){return function(b){this._isLoaded?this.inherited(c,arguments):this.loadDropDown(a.hitch(this,c,b))}}var x=f("dijit.form._SelectMenu",h,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(c){c.preventDefault();c.stopPropagation()}))},focus:function(){var c=!1,b=this.parentWidget.value;
a.isArray(b)&&(b=b[b.length-1]);b&&p.forEach(this.parentWidget._getChildren(),function(a){a.option&&b===a.option.value&&(c=!0,this.focusChild(a,!1))},this);c||this.inherited(arguments)}});b=f("dijit.form.Select"+(l("dojo-bidi")?"_NoBidi":""),[s,g,c],{baseClass:"dijitSelect dijitValidationTextBox",templateString:v,_buttonInputDisabled:l("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var c=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=c?c:0].value)}this.dropDown=new x({id:this.id+"_menu",parentWidget:this});d.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(c){if(!c.value&&!c.label)return new e({ownerDocument:this.ownerDocument});var b=a.hitch(this,"_setValueAttr",c);c=new r({option:c,label:("text"===this.labelType?(c.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):c.label)||this.emptyLabel,onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:c.disabled||!1});c.focusNode.setAttribute("role","option");return c},_addOptionItem:function(c){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(c))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(c){}},focusChild:function(c){c&&
this.set("value",c.option)},_getFirst:function(){var c=this._getChildren();return c.length?c[0]:null},_getLast:function(){var c=this._getChildren();return c.length?c[c.length-1]:null},childSelector:function(c){return(c=u.byNode(c))&&c.getParent()==this.dropDown},onKeyboardSearch:function(c,a,b,e){c&&this.focusChild(c)},_loadChildren:function(c){if(!0===c)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{p.forEach(this._getChildren(),
function(c){c.destroyRecursive()});var a=new r({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(a)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(c){this.inherited(arguments);k.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(c){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(c){this._set("required",c);this.focusNode.setAttribute("aria-required",c);this._refreshState()},_setOptionsAttr:function(c){this._isLoaded=!1;this._set("options",c)},_setDisplay:function(c){c=("text"===this.labelType?(c||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):c)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+c+"\x3c/span\x3e"},validate:function(c){c=this.disabled||this.isValid(c);this._set("state",c?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",c?"false":"true");var a=c?"":this._missingMsg;a&&this.focused&&this._hasBeenBlurred?t.show(a,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",a);return c},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=m.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(c){c.preventDefault();c.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var c=this._keyNavCodes;delete c[q.LEFT_ARROW];delete c[q.RIGHT_ARROW]},_setStyleAttr:function(c){this.inherited(arguments);
d.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(c){this._loadChildren(!0);this._isLoaded=!0;c()},destroy:function(c){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(c),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
l("dojo-bidi")&&(b=f("dijit.form.Select",b,{_setDisplay:function(c){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));b._Menu=x;b.prototype._onContainerKeydown=y("_onContainerKeydown");b.prototype._onContainerKeypress=y("_onContainerKeypress");return b})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h){return b("dijit.form._FormSelectWidget",h,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(n.isArrayLike(a))return p.map(a,"return this.getOptions(item);",this);n.isString(a)&&(a={value:a});n.isObject(a)&&(p.some(b,function(b,c){for(var e in a)if(!(e in b)||b[e]!=a[e])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){p.forEach(n.isArrayLike(a)?a:[a],function(a){a&&n.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(n.isArrayLike(a)?
a:[a]);p.forEach(a,function(a){a&&(this.options=p.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){p.forEach(n.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(b,e,g){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,e,g)},_deprecatedSetStore:function(a,b,h){var c=this.store;h=h||{};if(c!==a){for(var l;l=this._notifyConnections.pop();)l.remove();a.get||(n.mixin(a,{_oldAPI:!0,get:function(c){var a=new f;this.fetchItemByIdentity({identity:c,onItem:function(c){a.resolve(c)},onError:function(c){a.reject(c)}});return a.promise},query:function(c,a){var b=new f(function(){e.abort&&e.abort()});b.total=new f;var e=this.fetch(n.mixin({query:c,onBegin:function(c){b.total.resolve(c)},
onComplete:function(c){b.resolve(c)},onError:function(c){b.reject(c)}},a));return new g(b)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[k.after(a,"onNew",n.hitch(this,"_onNewItem"),!0),k.after(a,"onDelete",n.hitch(this,"_onDeleteItem"),!0),k.after(a,"onSet",n.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);h.query&&this._set("query",h.query);h.queryOptions&&this._set("queryOptions",h.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=a.query(this.query,this.queryOptions),s(this._queryRes,n.hitch(this,function(c){if(this.sortByLabel&&!h.sort&&c.length)if(a.getValue)c.sort(d.createSortFunction([{attribute:a.getLabelAttributes(c[0])[0]}],a));else{var g=this.labelAttr;c.sort(function(c,a){return c[g]>a[g]?1:a[g]>
c[g]?-1:0})}h.onFetch&&(c=h.onFetch.call(this,c,h));p.forEach(c,function(c){this._addOptionForItem(c)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(n.hitch(this,function(c,a,b){a==b?this._onSetItem(c):(-1!=a&&this._onDeleteItem(c),-1!=b&&this._onNewItem(c))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(c):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),n.hitch(this,function(c){console.error("dijit.form.Select: "+c.toString());this.onLoadDeferred.reject(c)})));return c},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=n.isArrayLike(a)?p.map(a,function(c){return n.isObject(c)?c:{value:c}}):n.isObject(a)?[a]:[{value:a}];a=p.filter(this.getOptions(a),function(c){return c&&c.value});var g=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&g.length)a[0]=
g[0];p.forEach(g,function(c){c.selected=p.some(a,function(a){return a.value===c.value})});g=p.map(a,function(c){return c.value});if(!("undefined"==typeof g||"undefined"==typeof g[0])){var c=p.map(a,function(c){return c.label});this._setDisplay(this.multiple?c:c[0]);this.inherited(arguments,[this.multiple?g:g[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=p.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(p.forEach(this._getChildren(),function(a){a.destroyRecursive()}),p.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;p.forEach(this._getChildren(),function(g){var c=p.some(a,function(c){return g.option&&
c===g.option.value});c&&!b.multiple&&(b.focusedChild=g);q.toggle(g.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),c);g.domNode.setAttribute("aria-selected",c?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=p.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?p.map(p.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,g=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:g?b.getIdentity(a):null,label:g,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);m.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?l("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+a._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);k.after(this,"onChange",n.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(p){var f={};p.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,d){var b=-1;null===f&&(f=void 0);null===d&&(d=void 0);if(f==d)b=0;else if(f>d||null==f)b=1;return b};f.createSortFunction=function(k,d){function b(a,b,e,g){return function(c,l){var n=g.getValue(c,a),d=g.getValue(l,
a);return b*e(n,d)}}for(var m=[],q,a=d.comparatorMap,n=f.basicComparator,l=0;l<k.length;l++){q=k[l];var s=q.attribute;if(s){q=q.descending?-1:1;var g=n;a&&("string"!==typeof s&&"toString"in s&&(s=s.toString()),g=a[s]||n);m.push(b(s,q,g,d))}}return function(a,b){for(var e=0;e<m.length;){var g=m[e++](a,b);if(0!==g)return g}return 0}};return f})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(p,f,k){var d=function(b){function m(a){b[a]=
function(){var n=arguments,l=k(b,function(b){Array.prototype.unshift.call(n,b);return d(p[a].apply(p,n))});if("forEach"!==a||q)return l}}if(!b)return b;var q=!!b.then;q&&(b=f.delegate(b));m("forEach");m("filter");m("map");null==b.total&&(b.total=k(b,function(a){return a.length}));return b};f.setObject("dojo.store.util.QueryResults",d);return d})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(p,f,k,d){return p("dijit.DropDownMenu",
d,{templateString:k,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(b){this._moveToPopup(b);b.stopPropagation();b.preventDefault()},_onLeftArrow:function(b){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else b.stopPropagation(),b.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e){return f("dijit._MenuBase",[g,e,r,h],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){b.toggle(this.domNode,"dijitMenuActive",a);b.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var c=s.byNode(a);return a.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var b=this,c="string"==typeof this.childSelector?this.childSelector:m.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(c,q.enter),function(){b.onItemHover(s.byNode(this))}),a(this.containerNode,a.selector(c,q.leave),function(){b.onItemUnhover(s.byNode(this))}),a(this.containerNode,a.selector(c,l),function(c){b.onItemClick(s.byNode(this),c);c.stopPropagation()}),
a(this.containerNode,a.selector(c,"focusin"),function(){b._onItemFocus(s.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,c,b,e){this.inherited(arguments);if(a&&(-1==e||a.popup&&1==e))this.onItemClick(a,c)},_keyboardSearchCompare:function(a,c){return a.shortcutKey?c==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,c){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var b=/^key/.test(c._origType||
c.type)||0==c.clientX&&0==c.clientY;this._openItemPopup(a,b)}else this.onExecute(),a._onClick?a._onClick(c):a.onClick(c)},_openItemPopup:function(b,c){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var e=b.popup;e.parentMenu=this;this.own(this._mouseoverHandle=a.once(e.domNode,"mouseover",m.hitch(this,"_onPopupHover")));var g=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&
g.focusChild(b);g._cleanUp()},onExecute:m.hitch(this,"_cleanUp",!0),onClose:function(){g._mouseoverHandle&&(g._mouseoverHandle.remove(),delete g._mouseoverHandle)}},c);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(d.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(p,f,k,d,b,m,q,a,n,l){return f("dijit._KeyNavContainer",[n,l,a],{connectKeyNavHandlers:function(a,g){var h=this._keyNavCodes={},l=m.hitch(this,"focusPrev"),e=m.hitch(this,"focusNext");p.forEach(a,function(a){h[a]=l});p.forEach(g,function(a){h[a]=e});h[b.HOME]=m.hitch(this,"focusFirstChild");h[b.END]=m.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){d.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);p.forEach(this.getChildren(),
m.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
q.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(p,f,k,d,b,m,q,a){return f("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);k.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[d.HOME]=b.hitch(this,"focusFirstChild");a[d.END]=b.hitch(this,
"focusLastChild");a[this.isLeftToRight()?d.LEFT_ARROW:d.RIGHT_ARROW]=b.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?d.RIGHT_ARROW:d.LEFT_ARROW]=b.hitch(this,"_onRightArrow");a[d.UP_ARROW]=b.hitch(this,"_onUpArrow");a[d.DOWN_ARROW]=b.hitch(this,"_onDownArrow")}var l=this,a="string"==typeof this.childSelector?this.childSelector:b.hitch(this,"childSelector");this.own(m(this.domNode,"keypress",b.hitch(this,"_onContainerKeypress")),m(this.domNode,"keydown",b.hitch(this,"_onContainerKeydown")),m(this.domNode,
"focus",b.hitch(this,"_onContainerFocus")),m(this.containerNode,m.selector(a,"focusin"),function(a){l._onChildFocus(q.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){k.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){k.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,d,g){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var d=a.domNode,d=(a.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&d==b?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var b=this._keyNavCodes[a.keyCode];b?(b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode==d.SPACE&&(this._searchTimer&&
!a.ctrlKey&&!a.altKey&&!a.metaKey)&&(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){if(!this._isFormElement(document.activeElement)&&!(a.charCode<=d.SPACE||a.ctrlKey||a.altKey||a.metaKey))a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase())},_keyboardSearch:function(a,l){var d=null,g,h=0;b.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=l;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;g=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==a||!b)if(b=this._getNextFocusableChild(b,1),!b)return;a=b;do{var n=this._keyboardSearchCompare(b,g);n&&0==h++&&(d=b);if(-1==n){h=-1;break}b=this._getNextFocusableChild(b,1)}while(b&&b!=a)})();this.onKeyboardSearch(d,a,g,h)},_onChildBlur:function(){},
_getNextFocusableChild:function(a,b){var d=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=d&&a.isFocusable())return a}while(a!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var d=q.byNode(a);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){q=p("dijit.MenuItem"+(m("dojo-bidi")?"_NoBidi":""),[a,n,l,s],{templateString:g,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",e;e=a.search(/{\S}/);if(0<=e){var b=a.charAt(e+1),g=a.substr(0,e);a=a.substr(e+3);e=g+b+a;a=g+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else e=a;this.domNode.setAttribute("aria-label",e+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);k.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&k.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==m("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){d.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){b.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){b.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,k.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});m("dojo-bidi")&&(q=p("dijit.MenuItem",q,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return q})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(p,f){return p("dijit._Contained",null,{_getSibling:function(f){var d=this.getParent();return d&&d._getSiblingOfChild&&d._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return!f||!f.getIndexOfChild?-1:f.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(p,f,k,d,b,m){return p("dijit.MenuSeparator",[k,d,b],{templateString:m,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(p,f,k,d,b,m,q,a,n){function l(a){var h;h=new b;h.outFields=[a.fieldName];h.outStatistics=[];h.geometry=a.geometry;var l=g(a);p.forEach(l,function(b){var e=new k;e.statisticType=
b;e.displayFeildName=a.fieldName;e.onStatisticField=a.fieldName;e.outStatisticFieldName=c[b];h.outStatistics.push(e)});h.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(h.geometry=a.geometry);return(new d(a.layer.url)).execute(h).then(function(c){return c&&c.features&&0<c.features.length?(c=c.features[0].attributes,e(a,c),c):[]})}function s(c){var a={countField:0,sumField:0},b=g(c),l=0,n=0;c.featureSet.features.forEach(function(e){var g=
e.attributes[c.fieldName];null===g||"undefined"===typeof g||b.forEach(function(c){switch(c){case "count":a.countField++;break;case "sum":a.sumField+=g;break;case "min":a.minField="undefined"===typeof a.minField?g:Math.min(a.minField,g);break;case "max":a.maxField="undefined"===typeof a.maxField?g:Math.max(a.maxField,g);break;case "avg":l++,n+=g}})});if(0===l)return f({countField:0});a.avgField=0===l?"":n/l;var d=c.featureSet.features.filter(function(a){a=a.attributes[c.fieldName];return null===a||
"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[c.fieldName]});a.stddevField=h(d);e(c,a);return f(a)}function g(c){return c.statisticTypes&&0<c.statisticTypes.length?t.filter(function(a){return-1<c.statisticTypes.indexOf(a)}):t}function h(c){var a=c.length;if(1>=a)return 0;var b=0;c.forEach(function(c){b+=c});var e=b/a,g=0;c.forEach(function(c){g+=Math.pow(c-e,2)});return Math.sqrt(1/(a-1)*g)}function r(c){var b=a.getInstanceSync();return c.layer?b.getLayerOrTableInfoById(c.layer.id).loadInfoTemplate().then(function(c){var a=
{};c.info&&c.info.fieldInfos&&c.info.fieldInfos.forEach(function(c){a[c.fieldName]=c});return a}):f({})}function e(c,a){if(c.fieldInfos[c.fieldName])for(var b in a)"countField"!==b&&m.isDefined(a[b])&&(a[b]=null===a[b]||"undefined"===typeof a[b]?"":q.localizeNumberByFieldInfo(a[b],c.fieldInfos[c.fieldName]))}var t="count sum min max avg stddev".split(" "),c={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};n.getStatisticsResult=function(c){return r(c).then(function(a){c.fieldInfos=
a;if(c.featureSet)return s(c);if(c.layer){if(c.layer.url)return l(c);c.featureSet=q.toFeatureSet(c.layer.graphics);return s(c)}})};n.isStatFromServer=function(c){return c.layer&&c.layer.url};n.getStddevVal=h})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h){return p(n,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a){return 1<a.features.length&&a.features[0].geometry},onExecute:function(b,e){var g,c;g={layerDefinition:{geometryType:e.geometryType,fields:f.clone(e.fields),objectIdField:e.objectIdField},featureSet:b.toJson()};g=new m(g);(c=e._json?d.parse(e._json):null)&&c.drawingInfo&&c.drawingInfo.renderer?(c=c.drawingInfo.renderer,c=q.fromJson(c)):c=q.fromJson(e.renderer.toJson());g.setRenderer(c);
(c=e.getSelectionSymbol())&&g.setSelectionSymbol(a.fromJson(c.toJson()));this._popupAddLayer(g)},_popupAddLayer:function(a){var e,g=k.create("div",{style:"padding: 0 10px 0 10px;"}),c=(new s({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(g);k.setStyle(c.searchBtn,"display","none");var n=new l({content:g,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){a.name=h.stripHTML(c.getValue());
this._addLayerToMap(a);n.close();e&&e.remove&&e.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){n.close();e&&e.remove&&e.remove()})}]});c.inputSearch.focus();n.disableButton(0);e=b(c.inputSearch,"keyup",function(){c.getValue()?n.enableButton(0):n.disableButton(0)})},_addLayerToMap:function(a){var e=g.getInstanceSync(),h=b(e,"layerInfosChanged",f.hitch(this,function(c){a.id===c.id&&(c.enablePopup(),h.remove())}));this.map.addLayer(a)}})})},
"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(p,f,k,d,b){return p([d,b],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return k.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(b){13===(void 0!==b.keyCode?b.keyCode:b.which)&&this.doSearch();b.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},
"jimu/dijit/PopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin ./PopupMenuItem".split(" "),function(p,f,k,d,b,m,q,a,n){var l=null,s=p([q,a],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(b(this.domNode,"click",k.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this.own(b(this.closeBtn,"click",k.hitch(this,this.hide)))},setActions:function(a){this.clearActions();d.forEach(a,k.hitch(this,this._addMenuItem))},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){a=new n({action:a});f.place(a.domNode,
this.menuContent);a.startup();this.menuItems.push(a);this.own(b(a,"click",k.hitch(this,this.hide)))},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(a,b){if(0===this.menuItems.length)f.setStyle(this.domNode,"display","none");else{"string"===typeof b&&""!==b?(this.labelNode.innerHTML=b,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var l,e=a.y+a.h,n;l=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display",
"");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});n=m.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?l+n.w>window.innerWidth?window.innerWidth-n.w:0>l?0:l:0>l-n.w?0:l>window.innerWidth?window.innerWidth-n.w:l-n.w)+"px",top:(n.h>window.innerHeight?0:e+n.h>window.innerHeight?window.innerHeight-n.h:e+n.h+5<window.innerHeight?e+5:e)+"px"})}}});s.getInstance=function(){null===l&&(l=new s,f.place(l.domNode,document.body),l.startup());l.setActions([]);return l};
return s})},"jimu/dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(p,f,k,d,b,m,q,a,n){return p([a,n,q],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',
action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?f.addClass(this.iconNode,this.action.iconClass):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(b(this.domNode,m.enter,k.hitch(this,this._useHoverIcon))),this.own(b(this.domNode,m.leave,k.hitch(this,this._useNormalIcon))));this.own(b(this.domNode,"click",k.hitch(this,this._clickHandler)))},_useNormalIcon:function(){this.action.iconClass?
f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(a){d.stop(a);if(this.action){var b;this.action.data.features&&0<this.action.data.features.length&&(b=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,
b)}this.emit("click")}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils jimu/utils jimu/LayerInfos/LayerInfos".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c){var u=p([a,n],{baseClass:"related-records-popup-projector",
templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new l;this.layerInfosObj=c.getInstanceSync();this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(this.originalFeature.getLayer().id);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?d.addClass(this.previouBtn,"icon-arrow-forward"):d.addClass(this.previouBtn,"icon-arrow-back");var a=this._createOperation({feature:this.originalFeature,
oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new u.PopupUIController(this):new u.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(c){c=c.data.oriJimuLayerInfo;var a=new q;c.getRelatedTableInfoArray().then(f.hitch(this,
function(c){a.resolve(c)}));return a},_getOriRelationshipByDestLayer:function(c){var a=null;k.some(c.oriJimuLayerInfo.layerObject.relationships,function(b){if(b.relatedTableId===c.destJimuLayerInfo.layerObject.layerId)return a=b,!0},this);return a},_getRelatedRecordsByRelatedQuery:function(c){var a=new q,b=new g,e=this._getOriRelationshipByDestLayer(c);b.outFields=["*"];b.returnGeometry=!0;b.outSpatialReference=this.popupManager.mapManager.map.spatialReference;b.relationshipId=e.id;var h=c.feature.attributes[c.oriJimuLayerInfo.layerObject.objectIdField];
b.objectIds=[h];c.oriJimuLayerInfo.layerObject.queryRelatedFeatures(b,f.hitch(this,function(c){(c=c[h]&&c[h].features)?a.resolve(c):a.resolve([])}),f.hitch(this,function(){a.resolve([])}));return a},_ignoreCaseToGetFieldObject:function(c,a){var b=null;a&&(c&&c.fields)&&k.some(c.fields,function(c){if(c.name.toLowerCase()===a.toLowerCase())return b=c,!0});return b},getLocaleDateTime:function(c){return t.localizeDate(new Date(c),{fullYear:!0,formatLength:"medium"})},_getDisplayTitleOfRelatedRecord:function(c,
a){var b=this._ignoreCaseToGetFieldObject(c.layerObject,c.layerObject.displayField||c.layerObject.objectIdField),e=b&&a.attributes[b.name];e?b&&(b.type&&"esriFieldTypeDate"===b.type)&&(e=this.getLocaleDateTime(e)):e="";return e},_canShowRelatedData:function(c){var a=!0;(c=c.getPopupInfo())&&c.relatedRecordsInfo&&(a=!1!==c.relatedRecordsInfo.showRelatedRecords);return a},setPopupContent:function(c){this._clearPage();c.data.destJimuLayerInfo?c.data.relatedFeature||this.showRelatedRecords(c):this.showFeature(c);
this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(c){var a=c.data,b=(f.getObject("_wabProperties.originalLayerName",!1,a.oriJimuLayerInfo.layerObject)||a.oriJimuLayerInfo.title)+": "+this._getDisplayTitleOfRelatedRecord(a.oriJimuLayerInfo,a.feature);this._setOperationTitle(b);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,a.oriJimuLayerInfo.layerObject);a.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,
function(b){a.oriJimuLayerInfo.layerObject.infoTemplate||c.data.feature.setInfoTemplate(b);this.popupUIController.setFeature(c.data.feature);a.oriJimuLayerInfo.layerObject.infoTemplate||c.data.feature.setInfoTemplate(null)}));this.showRelatedTables(c);this.popupManager.initPopupMenu([c.data.feature]);this.popupUIController.updateZoomToBtn([c.data.feature])},showRelatedRecords:function(c){var a=c.data,e=f.getObject("_wabProperties.originalLayerName",!1,a.destJimuLayerInfo.layerObject)||a.destJimuLayerInfo.title;
this._setOperationTitle(e);this._clearPage();f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",a,a.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,a.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",a.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(a).then(f.hitch(this,function(e){0<e.length?this._setTitle(window.jimuNls.popup.relatedRecords):
this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");k.forEach(e,function(e,g){e._layer=a.destJimuLayerInfo.layerObject;var h=this._getDisplayTitleOfRelatedRecord(a.destJimuLayerInfo,e),h=d.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:h},this.contentBox),h=b(h,"click",f.hitch(this,function(){this._addOperation(c);var b=this._createOperation({feature:e,oriJimuLayerInfo:a.destJimuLayerInfo});this.setPopupContent(b)}));this._temporaryData.eventHandles.push(h)},
this);this.popupManager.initPopupMenu(e);this.popupUIController.updateZoomToBtn(e)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(c){this._canShowRelatedData(c.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(c).then(f.hitch(this,function(a){0<a.length&&this._setTitle(window.jimuNls.popup.relatedTables);k.forEach(a,function(a,e){var g=d.create("div",{"class":"item table-item "+(0===e%2?"oddLine":"evenLine"),innerHTML:a.title},this.contentBox),g=b(g,"click",f.hitch(this,
function(){a.getLayerObject().then(f.hitch(this,function(){this._addOperation(c);var b=this._createOperation({feature:c.data.feature,oriJimuLayerInfo:c.data.oriJimuLayerInfo,destJimuLayerInfo:a});this.setPopupContent(b)}))}));this._temporaryData.eventHandles.push(g)},this)}))},_createOperation:function(c){return new u.Operation({feature:c.feature||null,oriJimuLayerInfo:c.oriJimuLayerInfo||null,destJimuLayerInfo:c.destJimuLayerInfo||null,relatedFeature:c.relatedFeature||null},this)},_addOperation:function(c){this.undoManager.add(c)},
_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){d.empty(this.contentBox);k.forEach(this._temporaryData.eventHandles,function(c){c&&c.remove&&c.remove()},this);this._temporaryData.eventHandles=[];k.forEach(this._temporaryData.dijits,function(c){c&&c.destroy&&c.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(c,a){c&&d.create("div",{"class":"title-box "+(a?a:""),innerHTML:c},this.contentBox)},_setOperationTitle:function(c){d.setAttr(this.operationTitle,
"innerHTML",c);d.setAttr(this.operationTitle,"title",c)}});u.Operation=p([s],{constructor:function(c,a){this.data=c;this.relatedRecordsPopupProjector=a},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});u.PopupUIController=p([],{constructor:function(c){this.rrPopupProjector=c;this.popup=c.popup;this.initTempPopup();this._initZoomToBtn()},initTempPopup:function(){this._tempPopup=new h({},d.create("div"))},destroy:function(){this._tempPopup.destroy();this._zoomToBtnClickHandle&&
this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&d.destroy(this._zoomToBtnANode)},addDomNode:function(c){setTimeout(f.hitch(this,function(){d.place(c,this._getRefDomNode(),"after")}),1)},setFeature:function(c){this._tempPopup.setFeatures([c]);if(c=m(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(c),d.place(this.rrPopupProjector.domNode,c,"after")},setContent:function(c){var a=m(".related-records-popup-projector").parent()[0];a&&a.removeChild(this.rrPopupProjector.domNode);
this.popup.setContent(c)},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return m(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var c=m(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=m(".action",c)[0];this._zoomToBtnANode=d.create("a",{"class":"action",style:"display: none",
href:"javascript:void(0)"},c);this._zoomToBtn=d.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&d.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&d.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&d.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&
d.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(c){this._hideOldZoomToBtn();!c||1>c.length||!c[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=b(this._zoomToBtn,"click",f.hitch(this,function(){var a=null;try{a=e.graphicsExtent(c)}catch(b){console.error(b)}a&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(a),this.popup.hide())})))},
changeRefDomNode:function(){d.setStyle(this.rrPopupProjector.operationBox,"display","block");d.addClass(this.rrPopupProjector.domNode,"second-page-mode");var c=this._getViewPopupDomNode();c&&d.addClass(c,"second-page-mode")},revertRefDomNode:function(){d.setStyle(this.rrPopupProjector.operationBox,"display","none");d.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});u.PopupMobileUIController=p([u.PopupUIController],{initTempPopup:function(){this._tempPopup=
new r({},d.create("div"))},setFeature:function(c){this._tempPopup.setFeatures([c]);c=m(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(c=m(".esriViewPopup",c)[0])this.setContent(c),d.place(this.rrPopupProjector.domNode,c,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return m(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var c=m(".esriMobileInfoView.esriMobilePopupInfoView")[0];return m(".esriViewPopup",
c)[0]}});return u})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented require".split(" "),function(p,f,k,d,b,m){return p([m],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(b){b=b||{};b.maxOperations&&(this.maxOperations=b.maxOperations);
this._historyStack=[]},add:function(b){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,b);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var b=this.peekUndo();this.position--;b?(b=b.performUndo(),this.onUndo(),this._checkAvailability(),d(b).then(f.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===
this._historyStack.length)return null;var b=this.peekRedo();this.position++;b?(b=b.performRedo(),this.onRedo(),this._checkAvailability(),d(b).then(f.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,
this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(b){return this._historyStack[b]},remove:function(b){0<
this._historyStack.length&&(this._historyStack.splice(b,1),0<this.position&&b<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}})})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(p,f,k){return p(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(d){d=d||{};d.label&&(this.label=d.label)},performUndo:function(){console.log("performUndo has not been implemented")},
performRedo:function(){console.log("performRedo has not been implemented")}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(p,f,k,d,b){var m=null,q=p(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(k.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",f.hitch(this,
this._onMapLoaded)),k.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));k.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(a,b){return f.getObject(a+".filterExprs."+b,!1,this._filters)},applyWidgetFilter:function(a,b,l,d,g){this._setFilterExp(a,b,l,d,g);b=this.layerInfos.getLayerInfoById(a)||this.layerInfos.getTableInfoById(a);a=this._getFilterExp(a);null!==a&&b&&b.setFilter(a)},_onMapLoaded:function(){this.layerInfos=b.getInstanceSync();this._traversalFilter()},
_onMapChanged:function(){this.layerInfos=b.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(a){for(var b in this._filters)if(this._filters[b]){var l=this._filters[b];if(l){var d=l.filterExprs,l=l.mapFilterControls;d&&delete d[a];l&&delete l[a]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,function(a){this._filters[a.id]||(this._filters[a.id]={definitionExpression:a.getFilter(),filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(a){a=
f.getObject(a+".mapFilterControls",!1,this._filters);var b=0,l;for(l in a){var d=a[l];d.priority>b&&(b=d.priority)}return b},_getMapFilterControl:function(a){a=f.getObject(a+".mapFilterControls",!1,this._filters);var b=0,l=null,d;for(d in a){var g=a[d];g.priority>b&&(b=g.priority,l=g)}return l},_setFilterExp:function(a,b,l,m,g){var h=a+".filterExprs."+b,r=a+".mapFilterControls."+b;l?(f.setObject(h,l,this._filters),d.isDefined(m)&&(a=this._getPriorityOfMapFilter(a),f.setObject(r,{enable:m,useAND:g,
priority:a+1},this._filters))):(f.getObject(h,!1,this._filters)&&delete this._filters[a].filterExprs[b],f.getObject(r,!1,this._filters)&&delete this._filters[a].mapFilterControls[b])},_getFilterExp:function(a){if(!this._filters[a])return null;var b=[],l=this._filters[a].definitionExpression,d=this._filters[a].filterExprs;a=this._getMapFilterControl(a);for(var g in d){var h=d[g];h&&b.push("("+h+")")}b=b.join(" AND ");return l&&a&&a.enable||l&&null===a?b?a&&!1===a.useAND?"("+l+") OR "+b:"("+l+") AND "+
b:l:b}});q.getInstance=function(){if(null===m)m=new q,window._filterManager=m;else return m};return q})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(p,f,k,d,b,m,q){return p(m,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=d.create("img",{src:this.widgetConfig.icon},this.domNode);d.setAttr(this.domNode,"title",this.widgetConfig.label);
d.setAttr(this.domNode,"data-widget-name",this.widgetConfig.name);this.own(b(this.domNode,"click",f.hitch(this,function(){this.onClick()})));this.position=f.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(b(this.map,"resize",f.hitch(this,function(){var a=f.clone(this.position);delete a.width;delete a.height;this.panel&&this.panel.setPosition(a)})));this.state="closed"},startup:function(){this.inherited(arguments)},onClick:function(){"closed"===this.state?
this.switchToOpen():this.switchToClose()},moveTo:function(a){var b={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},b=f.mixin(b,q.getPositionStyle(a));delete b.width;delete b.height;d.setStyle(this.domNode,b);this.position=f.clone(a);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=f.clone(a),this.widgetConfig.position=f.clone(a));this.panel&&this.panel.setPosition(f.clone(a));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},
destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);k.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&this.widgetManager.closeWidget(a)},this);d.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(f.hitch(this,
function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));this.widgetManager.openWidget(a);this.own(b(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(f.clone(this.widgetConfig)).then(f.hitch(this,function(a){this.panel=a;this.own(b(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";d.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?
this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(a){var b={relativeTo:a.position.relativeTo},l=d.getMarginBox(this.domNode);a=this.widgetManager.getWidgetMarginBox(a);var f=d.getMarginBox("map"===b.relativeTo?this.map.id:jimuConfig.layoutId),g=l.t+l.h+1;g+a.h>f.h?b.bottom=f.h-l.t+1:b.top=g;window.isRTL?b.right=0>l.l+l.w-a.w?0:l.l+l.w-a.w:l.l+a.w>f.w?b.right=0:b.left=l.l;return b},_showLoading:function(){d.setAttr(this.iconNode,
"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){d.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(p,f,k,d,b){return p(d,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=k.create("div",{"class":"inner",innerHTML:this.index},this.domNode);k.setAttr(this.domNode,"title",
window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(d){var q={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},q=f.mixin(q,b.getPositionStyle(d));delete q.width;delete q.height;k.setStyle(this.domNode,q)},setIndex:function(b){this.index=b;this.indexNode.innerHTML=b}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(p,f,k){var d=null,b;b=p(null,{constructor:function(b){k.subscribe("publishData",f.hitch(this,this.onDataPublished));
k.subscribe("fetchData",f.hitch(this,this.onFetchData));k.subscribe("clearAllData",f.hitch(this,this.onClearAllData));k.subscribe("removeData",f.hitch(this,this.onRemoveData));k.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=b},_dataStore:{},onDataPublished:function(b,d,a,n){"undefined"===typeof n&&(n=!1);this._dataStore[d]?(this._dataStore[d].current=a,n&&(this._dataStore[d].history?this._dataStore[d].history.push(a):this._dataStore[d].history=[a])):(this._dataStore[d]=
{current:a},n&&(this._dataStore[d].history=[a]))},onFetchData:function(b){var d;if(b)"framework"===b?this._dataStore[b]?k.publish("dataFetched","framework","framework",this._dataStore[b].current,this._dataStore[b].history):k.publish("noData","framework","framework"):(d=this.widgetManager.getWidgetById(b))?this._dataStore[b]?k.publish("dataFetched",d.name,b,this._dataStore[b].current,this._dataStore[b].history):k.publish("noData",d.name,b):k.publish("noData",void 0,b);else{for(var a in this._dataStore)(d=
this.widgetManager.getWidgetById(a))&&k.publish("dataFetched",d.name,a,this._dataStore[a].current,this._dataStore[a].history);d||k.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};k.publish("allDataCleared")},onRemoveData:function(b){delete this._dataStore[b];k.publish("dataRemoved",b)},onClearDataHistory:function(b){this._dataStore[b]&&(this._dataStore[b].history=[]);k.publish("dataHistoryCleared",b)}});b.getInstance=function(f){null===d&&(d=new b(f));return d};return b})},
"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h){var r=null,e=p(null,{constructor:function(){window.isBuilder?(b.subscribe("app/mapLoaded",k.hitch(this,this._onMapLoaded)),b.subscribe("app/mapChanged",
k.hitch(this,this._onMapChanged))):(b.subscribe("mapLoaded",k.hitch(this,this._onMapLoaded)),b.subscribe("mapChanged",k.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(a){var c=a.geometryType,b=new s(s.STYLE_CIRCLE,16,null,l.fromArray([0,255,255])),e=new g(g.STYLE_SOLID,l.fromArray([0,255,255]),2),d=new h(h.STYLE_SOLID,e,l.fromArray([0,255,255,0.3]));"esriGeometryPoint"===c?a.setSelectionSymbol(b):"esriGeometryPolyline"===c?a.setSelectionSymbol(e):"esriGeometryPolygon"===
c&&a.setSelectionSymbol(d)},updateSelectionByFeatures:function(a,c,b){a.getSelectionSymbol()||this.setSelectionSymbol(a);var e=new f;a._selectHandler({features:c},b,null,null,e);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return e},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,c){return this.updateSelectionByFeatures(a,c,m.SELECTION_NEW)},addFeaturesToSelection:function(a,
c){return this.updateSelectionByFeatures(a,c,m.SELECTION_ADD)},removeFeaturesFromSelection:function(a,c){return this.updateSelectionByFeatures(a,c,m.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],m.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(b,c,e){return d.filter(b.graphics,k.hitch(this,function(b){return e?a.contains(c,b.geometry):a.intersects(c,
b.geometry)}))},getUnionGeometryBySelectedFeatures:function(b){var c=null;b=b.getSelectedFeatures();0<b.length&&(c=d.map(b,k.hitch(this,function(c){return c.geometry})),c=a.union(c));return c},_createDisplayLayer:function(a){var c=new q;c.id="displayLayer_of_"+a.id;this.map.addLayer(c);return c},_updateDisplayLayer:function(a){var c=a.getSelectedFeatures(),b=this._displayLayers[a.id];this.clearDisplayLayer(a);var e=a.getSelectionSymbol();d.forEach(c,k.hitch(this,function(c){c.setSymbol(null);c=new n(c.toJson());
c.setSymbol(e);b.add(c)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});e.getInstance=function(){r||(r=new e,window._selectionManager=r);return r};return e})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(p,f,k,d,b,m,q,a,n){return p([m,q],{type:"widget",id:void 0,
label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(b.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(b.subscribe("dataFetched",f.hitch(this,this._onReceiveData)));this.own(b.subscribe("noData",f.hitch(this,
this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(b,n){this.position=b;var g=a.getPositionStyle(this.position);g.position="absolute";n||(n="map"===b.relativeTo?this.map.id:window.jimuConfig.layoutId);
d.place(this.domNode,n);d.setStyle(this.domNode,g);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return d.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,b,g){},onAction:function(a,b){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===
this.gid)return n.getInstance().getPanelById(this.id+"_panel");var a=n.getInstance().getPanelById(this.gid+"_panel");return a?a:n.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,d){"undefined"===typeof d&&(d=!1);b.publish("publishData",this.name,this.id,a,d)},fetchData:function(a){a?b.publish("fetchData",a):0!==this.listenWidgetIds.length?k.forEach(this.listenWidgetIds,function(a){b.publish("fetchData",a)},this):b.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);
k.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,b,g,h){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(a,b,g,h)},onReceiveData:function(a,b,g,h){},_onNoData:function(a,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(a,b)},onNoData:function(a,b){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(p,f,k,d){return p([d],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==this.widget.state&&f.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(b){this.loading=
b;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(b){this.widget=b;this.loading&&this.loading.destroy();k.place(b.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(b){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+b.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(p,f,k,d,b,m,q,a,n){return p([b,m],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];k.forEach(a,function(a){var b,h;!1!==a.visible&&(h=new q,b=this.createFrame(a),
this.addChild(b),b.setLoading(h),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){b.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var b=this.getChildren(),g=0;g<b.length;g++)if(b[g].getWidget()&&b[g].getWidget().id===a)return b[g].getWidget()},createFrame:function(b){return new a},setPosition:function(a,b){this.position=a;var g=n.getPositionStyle(this.position);
g.position="absolute";b||(b="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(g.display="none");d.place(this.domNode,b);d.setStyle(this.domNode,g)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){k.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){k.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){k.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){k.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){k.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===a.id&&(b.getWidget().destroy(),b.setLoading(new q),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){b.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},
this))},isWidgetInPanel:function(a){return k.some(this.getAllWidgetConfigs(),function(b){if(a.id===b.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var b=-1,g=0;g<this.config.widgets.length;g++)this.config.widgets[g].id===a.id&&(b=g);0<b&&(this.config.widgets[b]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(b){console.error("destroy widget frame error."+b.stack)}});this.inherited(arguments)}})})},
"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(p,f,k,d,b){return p([d,b],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(k(window,"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),
function(p,f,k,d,b,m){return{cloneSymbol:function(d){if(!d)return null;var a=null;try{var n=d.toJson(),a=b.fromJson(n)}catch(l){console.error(l)}return a},getDefaultMarkerSymbol:function(){return b.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return b.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return b.fromJson({tags:["opaque"],
title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return b.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return b.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",
style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return b.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var b=p.toUrl("jimu/css/images/grey_pin.png"),b=new m(b,16,16);b.setOffset(0,8);return b},createSymbolNode:function(m,a){var n=32,l=32,s=k.create("div",{},document.body);k.setStyle(s,"display","inline-block");if(a)n=a.width,l=a.height;else if(n=80,
l=30,this.isSimpleMarkerSymbol(m))l=n=Math.min(m.size+12,125);else if(this.isPictureMarkerSymbol(m)){if(!m.url||"http://"===m.url||-1===m.url.indexOf("http://")&&-1===m.url.indexOf("https://")&&-1===m.url.indexOf("data:"))return;l=n=Math.min(Math.max(m.width,m.height),125)}else if(this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m))n=190,l=20;var g=d.createSurface(s,n,l);if("vml"===d.renderer){var h=g.getEventSource();k.setStyle(h,"position","relative");k.setStyle(h.parentNode,"position",
"relative")}var h=null,h=a?b.getShapeDescriptors(m):this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m)?this._getLineShapeDesc(m):b.getShapeDescriptors(m),r;try{r=g.createShape(h.defaultShape),h.fill&&r.setFill(h.fill),h.stroke&&r.setStroke(h.stroke)}catch(e){g.clear();g.destroy();return}var g=g.getDimensions(),g={dx:g.width/2,dy:g.height/2},t=r.getBoundingBox(),h=t.width,t=t.height;if(h>n||t>l)n=((n<l?n:l)-5)/(h>t?h:t),f.mixin(g,{xx:n,yy:n});r.applyTransform(g);s&&k.addClass(s,"symbol");
return s},_getLineShapeDesc:function(b){var a=null;if(this.isSimpleLineSymbol(b)||this.isCartographicLineSymbol(b))a={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:b.getStroke()};return a},isSimpleMarkerSymbol:function(b){return b&&"esri.symbol.SimpleMarkerSymbol"===b.declaredClass},isPictureMarkerSymbol:function(b){return b&&"esri.symbol.PictureMarkerSymbol"===b.declaredClass},isSimpleLineSymbol:function(b){return b&&"esri.symbol.SimpleLineSymbol"===b.declaredClass},isCartographicLineSymbol:function(b){return b&&
"esri.symbol.CartographicLineSymbol"===b.declaredClass},isSimpleFillSymbol:function(b){return b&&"esri.symbol.SimpleFillSymbol"===b.declaredClass},isPictureFillSymbol:function(b){return b&&"esri.symbol.PictureFillSymbol"===b.declaredClass},isTextSymbol:function(b){return b&&"esri.symbol.TextSymbol"===b.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(p,
f,k,d,b,m,q){return p([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=
function(a){return this.split(a).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",
stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",
numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",
dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},prepare:function(a,b){this.isHosted=q.isHostedService(a);this.setFieldsStoreByFieldInfos(b)},isPartsObjHasError:function(a){var b=!1;a&&(b=a.parts&&0<=a.parts.length?k.every(a.parts,f.hitch(this,function(a){return a.parts?0<a.parts.length?k.every(a.parts,f.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!b},isAskForValues:function(a){var b=!1;
return b=k.some(a.parts,f.hitch(this,function(a){return a.parts?k.some(a.parts,f.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(a){a=k.filter(a,f.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));a=k.map(a,function(a,b){var d;switch(a.type){case "esriFieldTypeString":d="string";break;case "esriFieldTypeDate":d="date";break;default:d="number"}return{id:b,label:a.name,shortType:d,alias:a.alias,editable:a.editable,
name:a.name,nullable:a.nullable,type:a.type}},this);this.fieldsStore=new m({data:{identifier:"id",label:"label",items:a}});return a.length},_validatePartsObj:function(a){return a&&"object"===typeof a},_isObject:function(a){return a&&"object"===typeof a},_isString:function(a){return a&&"string"===typeof a},containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},getExprByFilterObj:function(a){if(!k.every(a.parts,function(a){return!!a}))return null;
if(!this.isPartsObjReadyToBuild(a))return a.expr="",a.expr;var d="";if(0===a.parts.length)d="1\x3d1";else if(1===a.parts.length)d=this.builtFilterString(a.parts[0]);else for(var l="",f=0;f<a.parts.length;f++){var g=this.builtFilterString(a.parts[f]);if(!b.isDefined(g))return null;d+=l+"("+g+")";l=l||" "+a.logicalOperator+" "}return a.expr=d},isPartsObjReadyToBuild:function(a){return k.every(a.parts,f.hitch(this,function(a){return a.parts?k.every(a.parts,f.hitch(this,function(a){return this._isPartReadyToBuild(a)})):
this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(a){var b=a.fieldObj.shortType,l=a.operator,d=a.valueObj;a=d.type||"value";var g=d.value,h=d.value1,d=d.value2;if("value"===a){if("string"===b)return l===this.OPERATORS.stringOperatorIsBlank||l===this.OPERATORS.stringOperatorIsNotBlank?!0:q.isNotEmptyString(g);if("number"===b)return l===this.OPERATORS.numberOperatorIsBlank||l===this.OPERATORS.numberOperatorIsNotBlank?!0:l===this.OPERATORS.numberOperatorIsBetween||l===this.OPERATORS.numberOperatorIsNotBetween?
q.isValidNumber(h)&&q.isValidNumber(d):q.isValidNumber(g);if("date"===b)return l===this.OPERATORS.dateOperatorIsBlank||l===this.OPERATORS.dateOperatorIsNotBlank?!0:l===this.OPERATORS.dateOperatorIsBetween||l===this.OPERATORS.dateOperatorIsNotBetween?q.isNotEmptyString(h)&&q.isNotEmptyString(d):q.isNotEmptyString(g)}else{if("field"===a)return q.isNotEmptyString(g);if("unique"===a){if("string"===b)return q.isNotEmptyString(g);if("number"===b)return q.isValidNumber(g)}}return!1},builtFilterString:function(a){var d=
"";if(a.parts)for(var l="",f=0;f<a.parts.length;f++){var g=a.parts[f],h=this.builtSingleFilterString(g);g.expr=h.whereClause;if(!b.isDefined(h.whereClause))return null;d+=l+h.whereClause;l=" "+a.logicalOperator+" "}else d=this.builtSingleFilterString(a).whereClause;return a.expr=d},_preBuiltSingleFilterString:function(a){if("string"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.stringOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===
this.OPERATORS.stringOperatorIsNot)return{whereClause:a.fieldObj.name+" IS NOT NULL"}}if("number"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.numberOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:a.fieldObj.name+" IS NOT NULL"}}return null},builtSingleFilterString:function(a,d){this.isHosted&&(a.caseSensitive=!1);if(b.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};
var l=this._preBuiltSingleFilterString(a);if(l)return l;var l=a.valueObj.value,f=a.valueObj.value1,g=a.valueObj.value2,h=!1;a.interactiveObj&&b.isDefined(d)&&(h=!0,b.isDefined(a.valueObj.value)&&(l="{"+d+"}"),b.isDefined(a.valueObj.value1)&&(f="{"+d+"}"),b.isDefined(a.valueObj.value2)&&(g="{"+(d+1)+"}"));var m="";if("string"===a.fieldObj.shortType)switch(f="",h&&this.isHosted?f="N":l&&"field"!==a.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(l)&&(f="N"),a.operator){case this.OPERATORS.stringOperatorIs:m=
"field"===a.valueObj.type?a.fieldObj.name+" \x3d "+l:a.fieldObj.name+" \x3d "+f+"'"+l.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:m="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+l:a.fieldObj.name+" \x3c\x3e "+f+"'"+l.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:m=a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'"+l.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+f+"'"+l.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:m=
a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'%"+l.replace(/\'/g,"''")+"'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+f+"'%"+l.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:m=a.caseSensitive?a.fieldObj.name+" LIKE "+f+"'%"+l.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+f+"'%"+l.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:m=a.caseSensitive?a.fieldObj.name+" NOT LIKE "+f+"'%"+l.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+
") NOT LIKE UPPER("+f+"'%"+l.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:m=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.OPERATORS.numberOperatorIs:m=a.fieldObj.name+" \x3d "+l;break;case this.OPERATORS.numberOperatorIsNot:m=a.fieldObj.name+" \x3c\x3e "+l;break;case this.OPERATORS.numberOperatorIsAtLeast:m=a.fieldObj.name+" \x3e\x3d "+
l;break;case this.OPERATORS.numberOperatorIsLessThan:m=a.fieldObj.name+" \x3c "+l;break;case this.OPERATORS.numberOperatorIsAtMost:m=a.fieldObj.name+" \x3c\x3d "+l;break;case this.OPERATORS.numberOperatorIsGreaterThan:m=a.fieldObj.name+" \x3e "+l;break;case this.OPERATORS.numberOperatorIsBetween:m=a.fieldObj.name+" BETWEEN "+f+" AND "+g;break;case this.OPERATORS.numberOperatorIsNotBetween:m=a.fieldObj.name+" NOT BETWEEN "+f+" AND "+g;break;case this.OPERATORS.numberOperatorIsBlank:m=a.fieldObj.name+
" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}else switch(b.isDefined(l)&&("field"!==a.valueObj.type&&"string"===typeof l)&&(l=new Date(l)),"field"!==a.valueObj.type&&(l&&(l=new Date(l)),f&&(f=new Date(f)),g&&(g=new Date(g))),a.operator){case this.OPERATORS.dateOperatorIsOn:m="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+l:h?a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+d+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(d+1)+
"}'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(l)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(l))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:m="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+l:h?a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+d+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(d+1)+"}'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(l)+"' AND "+
(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(l))+"'";break;case this.OPERATORS.dateOperatorIsBefore:m="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+l:a.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(l)+"'";break;case this.OPERATORS.dateOperatorIsAfter:m="field"===a.valueObj.type?a.fieldObj.name+" \x3e "+l:a.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(l))+"'";break;case this.OPERATORS.dateOperatorIsBetween:m=
h?a.fieldObj.name+" BETWEEN '"+f+"' AND '"+g+"'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(g))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:m=h?a.fieldObj.name+" NOT BETWEEN '"+f+"' AND '"+g+"'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(g))+"'";break;case this.OPERATORS.dateOperatorIsBlank:m=
a.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}return{whereClause:m}},formatDate:function(a){var b=d.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=d.format(a,{selector:"time",timePattern:"HH:mm:ss"});return b+" "+a},addDay:function(a){return new Date(a.getTime()+this.dayInMS)},getFilterObjByExpr:function(a){if(a&&this.fieldsStore){var b=this.replaceStrings(a);a=b.defExpr;var l=this.findParts(a,"AND");1===l.parts.length&&(l=this.findParts(a,
"OR"),1===l.parts.length&&(l.logicalOperator="AND"));k.forEach(l.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),h=b.indexOf("("),l=b.indexOf(")");if(-1===h&&-1===l||h<l)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(l);this.reReplaceStrings(b,l,f.hitch(this,function(){l&&l.parts&&
k.forEach(l.parts,f.hitch(this,function(a){a&&(a.parts?k.forEach(a.parts,f.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(l)&&(l=null);return l}},_handleParsedValuesForSinglePart:function(a){a&&(a.fieldObj&&"number"===a.fieldObj.shortType&&a.valueObj)&&(a.valueObj.hasOwnProperty("value")&&(a.valueObj.value=parseFloat(a.valueObj.value)),
a.valueObj.hasOwnProperty("value1")&&(a.valueObj.value1=parseFloat(a.valueObj.value1)),a.valueObj.hasOwnProperty("value2")&&(a.valueObj.value2=parseFloat(a.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(a){a&&a.valueObj&&!a.valueObj.type&&(a.valueObj.type="value")},replaceStrings:function(a){for(var b=a,l=function(a,c,b){var e=-1,e=a.indexOf("'",b+1);return e===b+1?(e=a.indexOf("'",e+1),l(a,c,e)):b},d=[],g=a.indexOf("'");-1<g;){var h=g,g=a.indexOf("'",g+1),f=0,g=l(a,h,g);"%"===a[h+
1]&&h++;"%"===a[g-1]&&(g-=1,f++);var e=a.substring(h+1,g);"N"===a[h-1]&&(a=a.substring(0,h-1)+a.substring(h),h-=1,g-=1);!this.isDateString(e)&&-1===e.indexOf("{")?(d.push(e),a=a.substring(0,h+1)+"#"+(d.length-1)+"#"+a.substring(g),g=a.indexOf("'",a.lastIndexOf("#")+2+f)):g=a.indexOf("'",g+1+f)}return{origDefExpr:b,defExpr:a,savedStrings:d}},reReplaceStrings:function(a,d,l){var m=a.savedStrings;if(m.length){if(m.length){var g=function(a,e){if(void 0===a.valueObj||null===a.valueObj||(void 0===a.valueObj.value||
null===a.valueObj.value)||"string"!==a.fieldObj.shortType)return!1;var g=a.valueObj.value.indexOf("#"),c=a.valueObj.value.lastIndexOf("#");return b.isDefined(a.valueObj.value)&&-1<g?(a.valueObj.value=e[parseInt(a.valueObj.value.substring(g+1,c),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},g=f.hitch(this,g),h=!1;k.forEach(d.parts,function(a){if(a.parts){var b=!1;k.forEach(a.parts,function(a){b=g(a,m)||b});b&&(h=b,a.expr=this.builtFilterString(a))}else(h=g(a,m)||h)&&this.builtFilterString(a)},
this);l&&"function"===typeof l&&l();h&&(d.expr=null,this.getExprByFilterObj(d))}}else l&&"function"===typeof l&&l()},isDateString:function(a){return 19===a.length&&"-"===a.charAt(4)&&"-"===a.charAt(7)&&" "===a.charAt(10)&&":"===a.charAt(13)&&":"===a.charAt(16)?!0:!1},findParts:function(a,b){for(var l=a.toLowerCase(),d=" "+b.toLowerCase()+" ",g=[],h=0,f=l.indexOf(d);0<f;){var e=a.substring(h,f),m=e.toLowerCase(),c=e.count("("),q=e.count(")"),k=e.count("'");c!==q||1===k%2?f=l.indexOf(d,f+1):-1<m.indexOf(" between ")&&
-1===m.indexOf(" and ")?f=l.indexOf(d,f+1):(g.push({expr:e}),h=f+d.length,f=l.indexOf(d,h))}g.push({expr:a.substring(h)});for(l=g.length-1;0<=l;l--)!this.hasOperator(g[l].expr)&&0<l&&(g[l-1].expr+=" "+b+" "+g[l].expr,g.splice(l,1));return{expr:a,parts:g,logicalOperator:b}},hasOperator:function(a){a=a.toLowerCase();return-1<a.indexOf("{")&&-1<a.indexOf("}")||-1<a.indexOf(" \x3d ")||-1<a.indexOf(" \x3c ")||-1<a.indexOf(" \x3e ")||-1<a.indexOf(" \x3c\x3e ")||-1<a.indexOf(" \x3c\x3d ")||-1<a.indexOf(" \x3e\x3d ")||
-1<a.indexOf(" like ")||-1<a.indexOf(" between ")||-1<a.indexOf(" date")||-1<a.indexOf(" is null")||-1<a.indexOf(" is not null")?!0:!1},parseExpr:function(a){k.forEach(a.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(a){var b=null;try{if(b=f.clone(a),b.expr=b.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(b.expr)){var l=a="",d=b.expr.match(/^UPPER\((.*)\)\s+/i);if(d&&2<=d.length)a=d[1];else return null;var g=b.expr.match(/UPPER\(N?'(.*)'\)$/i);
if(g&&2<=g.length)l="'"+g[1]+"'";else return null;b.expr=b.expr.replace(/^UPPER\((.*)\)\s+/i,a+" ");b.expr=b.expr.replace(/UPPER\(N?'(.*)'\)$/i,l);b.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(b.expr)&&(b.caseSensitive=!0)}catch(h){return console.log(h),null}b&&this.isHosted&&(b.caseSensitive=!1);return b},parseSingleExpr:function(a){var d=this._preParseSingleExpr(a);d&&(a=f.mixin(a,d));var d=a.expr.trim(),l=d.indexOf(" "),m=d.substring(0,l);a.fieldObj={name:m};a.valueObj={};
this.getFieldItemByName({name:m},function(b){a.fieldObj.shortType=b.shortType[0];a.fieldObj.label=b.label[0]},function(){a.error={msg:"unknown field name ("+m+")",code:1}});d=d.substring(l+1).trim();l=d.toLowerCase();l.startsWith("\x3d ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(12).trim():d.substring(2).trim(),this.storeValue(d,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):
l.startsWith("\x3c ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(12).trim():d.substring(2).trim(),this.storeValue(d,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsBefore:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsLessThan:a.error={msg:"operator ("+l+") not supported for string",code:3}):l.startsWith("\x3e ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(12).trim():d.substring(2).trim(),this.storeValue(d,a),"date"===
a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsAfter:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsGreaterThan:a.error={msg:"operator ("+l+") not supported for string",code:3}):l.startsWith("\x3c\x3e ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(13).trim():d.substring(3).trim(),this.storeValue(d,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:
this.OPERATORS.numberOperatorIsNot):l.startsWith("\x3c\x3d ")?(this.storeValue(d.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtMost):l.startsWith("\x3e\x3d ")?(this.storeValue(d.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtLeast):l.startsWith("like ")?(d=d.substring(5).trim(),d.startsWith("N'")&&(d=d.substring(1,d.length)),d.startsWith("'%")&&d.endsWith("%'")?(this.storeValue(d.substring(2,d.length-2),a),a.operator=this.OPERATORS.stringOperatorContains):
d.startsWith("'%")&&d.endsWith("'")?(this.storeValue(d.substring(2,d.length-1),a),a.operator=this.OPERATORS.stringOperatorEndsWith):d.startsWith("'")&&d.endsWith("%'")?(this.storeValue(d.substring(1,d.length-2),a),a.operator=this.OPERATORS.stringOperatorStartsWith):a.error={msg:"value ("+l+") not supported for LIKE",code:3}):l.startsWith("not like ")?(d=d.substring(9).trim(),d.startsWith("N'")&&(d=d.substring(1,d.length)),d.startsWith("'%")&&d.endsWith("%'")?(this.storeValue(d.substring(2,d.length-
2),a),a.operator=this.OPERATORS.stringOperatorDoesNotContain):a.error={msg:"value ("+l+") not supported for NOT LIKE",code:3}):l.startsWith("between ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(18).trim():d.substring(8).trim(),l=d.toLowerCase().indexOf(" and "),-1<l?(this.storeValue1(d.substring(0,l).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(d.substring(l+15).trim(),a):this.storeValue2(d.substring(l+5).trim(),a)):a.error={msg:"missing AND operator for BETWEEN",
code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsOn):a.operator=this.OPERATORS.dateOperatorIsBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsBetween:a.error=
{msg:"string field not supported for BETWEEN",code:3}):l.startsWith("not between ")?(d="date"===a.fieldObj.shortType&&!this.isHosted?d.substring(22).trim():d.substring(12).trim(),l=d.toLowerCase().indexOf(" and "),-1<l?(this.storeValue1(d.substring(0,l).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(d.substring(l+15).trim(),a):this.storeValue2(d.substring(l+5).trim(),a)):a.error={msg:"missing AND operator for NOT BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===
typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsNotOn):a.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsNotBetween:a.error={msg:"string field not supported for NOT BETWEEN",
code:3}):"is null"===l?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===l?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):a.error={msg:"unknown operator ("+l+")",
code:2};if(b.isDefined(a.valueObj.value)&&"string"===typeof a.valueObj.value&&a.valueObj.value.startsWith("{")&&a.valueObj.value.endsWith("}")||b.isDefined(a.valueObj.value1)&&"string"===typeof a.valueObj.value1&&a.valueObj.value1.startsWith("{")&&a.valueObj.value1.endsWith("}"))a.isInteractive=!0},getFieldItemByName:function(a,b,d){this.fieldsStore.fetch({query:a,onComplete:f.hitch(this,function(a){a&&a.length?b(a[0]):d()})})},subtractDay:function(a){return new Date(a.getTime()-this.dayInMS)},storeValue:function(a,
b){if(a.startsWith("{")&&a.endsWith("}"))b.valueObj.value=a;else if(a.startsWith("'{")&&a.endsWith("}'"))b.valueObj.value=a.substring(1,a.length-1);else if("date"===b.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);b.valueObj.value=this.parseDate(d)}else b.valueObj.value=a,b.valueObj.type="field";else"string"===b.fieldObj.shortType?(a.startsWith("#")||a.startsWith("%#"))&&(a.endsWith("#")||a.endsWith("#%"))?b.valueObj.value=a:a.startsWith("'")&&a.endsWith("'")?
b.valueObj.value=a.substring(1,a.length-1).replace(/\'\'/g,"'"):(b.valueObj.value=a,b.valueObj.type="field",this.getFieldItemByName({name:a},function(a){b.valueObj.label=a.label[0]},function(){b.error={msg:"unknown field name ("+a+")",code:1}})):(b.valueObj.value=a,isNaN(a)&&(b.valueObj.type="field",this.getFieldItemByName({name:a},function(a){b.valueObj.label=a.label[0]},function(){b.error={msg:"unknown field name ("+a+")",code:1}})))},storeValue1:function(a,b){if(a.startsWith("{")&&a.endsWith("}"))b.valueObj.value1=
a;else if(a.startsWith("'{")&&a.endsWith("}'"))b.valueObj.value1=a.substring(1,a.length-1);else if("date"===b.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);b.valueObj.value1=this.parseDate(d)}else b.valueObj.value1=a,b.valueObj.type="field";else b.valueObj.value1=a,isNaN(a)&&(b.valueObj.type="field")},storeValue2:function(a,b){if(a.startsWith("{")&&a.endsWith("}"))b.valueObj.value2=a;else if(a.startsWith("'{")&&a.endsWith("}'"))b.valueObj.value2=a.substring(1,
a.length-1);else if("date"===b.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);b.valueObj.value2=this.parseDate(d)}else b.valueObj.value2=a,b.valueObj.type="field";else b.valueObj.value2=a,isNaN(a)&&(b.valueObj.type="field")},parseDate:function(a){var b=d.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});b||(b=d.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(b=d.parse(a.replace(" "," - "),{datePattern:"yyyy-MM-dd",
timePattern:"HH:mm:ss"}));return b}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(p,f,k,d,b,m,q){return f("dojo.data.ItemFileWriteStore",m,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=
function(a){return q.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(a,b){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");
var d=null,f=this._getIdentifierAttribute();if(f===Number)d=this._arrayOfAllItems.length;else{d=a[f];if("undefined"===typeof d)throw Error("newItem() was not passed an identity for the new item");if(p.isArray(d))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[d]);this._assert("undefined"===typeof this._pending._newItems[d]);this._assert("undefined"===typeof this._pending._deletedItems[d]);var g={};g[this._storeRefPropName]=
this;g[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[d]=g,g[f]=[d]);this._arrayOfAllItems.push(g);f=null;if(b&&b.parent&&b.attribute){var f={item:b.parent,attribute:b.attribute,oldValue:void 0},h=this.getValues(b.parent,b.attribute);if(h&&0<h.length){var m=h.slice(0,h.length);f.oldValue=1===h.length?h[0]:h.slice(0,h.length);m.push(g);this._setValueOrValues(b.parent,b.attribute,m,!1);f.newValue=this.getValues(b.parent,b.attribute)}else this._setValueOrValues(b.parent,
b.attribute,g,!1),f.newValue=g}else g[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(g);this._pending._newItems[d]=g;for(var e in a){if(e===this._storeRefPropName||e===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");d=a[e];p.isArray(d)||(d=[d]);g[e]=d;if(this.referenceIntegrity)for(h=0;h<d.length;h++)m=d[h],this.isItem(m)&&this._addReferenceToMap(m,g,e)}this.onNew(g,f);return g},_removeArrayElement:function(a,b){var d=k.indexOf(a,b);return-1!=d?(a.splice(d,
1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var b=a[this._itemNumPropName],d=this.getIdentity(a);if(this.referenceIntegrity){var f=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=p.clone(a[this._reverseRefMap]));k.forEach(f,function(c){k.forEach(this.getValues(a,c),function(b){this.isItem(b)&&(a["backupRefs_"+this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(b),
attr:c}),this._removeReferenceFromMap(b,a,c))},this)},this);if(f=a[this._reverseRefMap])for(var g in f){var h=null;if(h=this._itemsByIdentity?this._itemsByIdentity[g]:this._arrayOfAllItems[g])for(var m in f[g]){var e=this.getValues(h,m)||[],q=k.filter(e,function(a){return!(this.isItem(a)&&this.getIdentity(a)==d)},this);this._removeReferenceFromMap(a,h,m);q.length<e.length&&this._setValueOrValues(h,m,q,!0)}}}this._arrayOfAllItems[b]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[d];
this._pending._deletedItems[d]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,b,d){return this._setValueOrValues(a,b,d,!0)},setValues:function(a,b,d){return this._setValueOrValues(a,b,d,!0)},unsetAttribute:function(a,b){return this._setValueOrValues(a,b,[],!0)},_setValueOrValues:function(a,b,d,f){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(p.isString(b));this._assert("undefined"!==typeof d);
var g=this._getIdentifierAttribute();if(b==g)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var g=this._getValueOrValues(a,b),h=this.getIdentity(a);if(!this._pending._modifiedItems[h]){var m={},e;for(e in a)m[e]=e===this._storeRefPropName||e===this._itemNumPropName||e===this._rootItemPropName?a[e]:e===this._reverseRefMap?p.clone(a[e]):a[e].slice(0,a[e].length);this._pending._modifiedItems[h]=m}h=!1;if(p.isArray(d)&&0===d.length){if(h=delete a[b],
d=void 0,this.referenceIntegrity&&g){e=g;p.isArray(e)||(e=[e]);for(var q=0;q<e.length;q++)m=e[q],this.isItem(m)&&this._removeReferenceFromMap(m,a,b)}}else{h=p.isArray(d)?d.slice(0,d.length):[d];if(this.referenceIntegrity)if(g){e=g;p.isArray(e)||(e=[e]);var c={};k.forEach(e,function(a){this.isItem(a)&&(a=this.getIdentity(a),c[a.toString()]=!0)},this);k.forEach(h,function(e){if(this.isItem(e)){var g=this.getIdentity(e);c[g.toString()]?delete c[g.toString()]:this._addReferenceToMap(e,a,b)}},this);for(q in c)this._removeReferenceFromMap(this._itemsByIdentity?
this._itemsByIdentity[q]:this._arrayOfAllItems[q],a,b)}else for(q=0;q<h.length;q++)m=h[q],this.isItem(m)&&this._addReferenceToMap(m,a,b);a[b]=h;h=!0}if(f)this.onSet(a,b,g,d);return h},_addReferenceToMap:function(a,b,d){b=this.getIdentity(b);var f=a[this._reverseRefMap];f||(f=a[this._reverseRefMap]={});(a=f[b])||(a=f[b]={});a[d]=!0},_removeReferenceFromMap:function(a,b,d){b=this.getIdentity(b);var f=a[this._reverseRefMap],g;if(f){for(g in f)g==b&&(delete f[g][d],this._isEmpty(f[g])&&delete f[g]);this._isEmpty(f)&&
delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++){var b=this._arrayOfAllItems[a];b&&b[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(b)+"] is referenced by: "+d.toJson(b[this._reverseRefMap]))}},_getValueOrValues:function(a,b){var d=void 0;this.hasAttribute(a,b)&&(d=this.getValues(a,b),d=1==d.length?d[0]:d);return d},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var b in this._datatypeMap){var d=
this._datatypeMap[b];if(p.isObject(d)&&!p.isFunction(d)){if(a instanceof d.type){if(!d.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+b+"]");return{_type:b,_value:d.serialize(a)}}}else if(a instanceof d)return{_type:b,_value:a.toString()}}return a},_getNewFileContentString:function(){var a={},b=this._getIdentifierAttribute();b!==Number&&(a.identifier=b);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(b=0;b<this._arrayOfAllItems.length;++b){var l=this._arrayOfAllItems[b];
if(null!==l){var f={},g;for(g in l)if(g!==this._storeRefPropName&&g!==this._itemNumPropName&&g!==this._reverseRefMap&&g!==this._rootItemPropName){var h=this.getValues(l,g);if(1==h.length)f[g]=this._flatten(h[0]);else for(var m=[],e=0;e<h.length;++e)m.push(this._flatten(h[e])),f[g]=m}a.items.push(f)}}return d.toJson(a,!0)},_isEmpty:function(a){var b=!0;if(p.isObject(a))for(var d in a){b=!1;break}else p.isArray(a)&&0<a.length&&(b=!1);return b},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=
!0;var d=this,l=function(){d._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};d._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||b.global)},f=function(g){d._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||b.global,g)};if(this._saveEverything){var g=this._getNewFileContentString();this._saveEverything(l,f,g)}this._saveCustom&&this._saveCustom(l,f);!this._saveEverything&&!this._saveCustom&&l()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var b=
this._pending._modifiedItems[a],d=null,d=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];b[this._storeRefPropName]=this;for(var f in d)delete d[f];p.mixin(d,b)}var g;for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],g[this._storeRefPropName]=this,b=g[this._itemNumPropName],g["backup_"+this._reverseRefMap]&&(g[this._reverseRefMap]=g["backup_"+this._reverseRefMap],delete g["backup_"+this._reverseRefMap]),this._arrayOfAllItems[b]=g,this._itemsByIdentity&&(this._itemsByIdentity[a]=
g),g[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(g);for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],g["backupRefs_"+this._reverseRefMap]&&(k.forEach(g["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],g,a.attr)},this),delete g["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)b=this._pending._newItems[a],b[this._storeRefPropName]=null,this._arrayOfAllItems[b[this._itemNumPropName]]=
null,b[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,b),this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},
onSet:function(a,b,d,f){},onNew:function(a,b){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(p,f,k,d,b,m,q,a,n){k=k("dojo.data.ItemFileReadStore",[m],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return n.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,b,g){a=this.getValues(a,b);return 0<a.length?a[0]:g},getValues:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);return(a[b]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var b=[],g;for(g in a)g!==this._storeRefPropName&&(g!==this._itemNumPropName&&g!==this._rootItemPropName&&g!==this._reverseRefMap)&&
b.push(g);return b},hasAttribute:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);return b in a},containsValue:function(a,b,g){var h=void 0;"string"===typeof g&&(h=q.patternToRegExp(g,!1));return this._containsValue(a,b,g,h)},_containsValue:function(a,b,g,h){return d.some(this.getValues(a,b),function(a){if(null!==a&&!f.isObject(a)&&h){if(a.toString().match(h))return!0}else if(g===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===
a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,b,g){var h=[],d,e;if(a.query){var f;d=a.queryOptions?a.queryOptions.ignoreCase:!1;var c={};for(e in a.query)f=a.query[e],"string"===typeof f?c[e]=q.patternToRegExp(f,
d):f instanceof RegExp&&(c[e]=f);for(d=0;d<b.length;++d){var m=!0,n=b[d];if(null===n)m=!1;else for(e in a.query)f=a.query[e],this._containsValue(n,e,f,c[e])||(m=!1);m&&h.push(n)}}else for(d=0;d<b.length;++d)e=b[d],null!==e&&h.push(e);g(h,a)},_fetchItems:function(a,d,g){var h=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),d);else if(this._jsonFileUrl!==this._ccUrl?(p.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,filter:f.hitch(h,"filter"),findCallback:f.hitch(h,d)});else{this._loadInProgress=!0;var m=b.get({url:h._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});m.addCallback(function(c){try{h._getItemsFromLoadedData(c),
h._loadFinished=!0,h._loadInProgress=!1,h.filter(a,h._getItemsArray(a.queryOptions),d),h._handleQueuedFetches()}catch(b){h._loadFinished=!0,h._loadInProgress=!1,g(b,a)}});m.addErrback(function(c){h._loadInProgress=!1;g(c,a)});var e=null;a.abort&&(e=a.abort);a.abort=function(){m&&-1===m.fired&&m.cancel();e&&e.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,h.filter(a,this._getItemsArray(a.queryOptions),d)}catch(n){g(n,a)}else g(Error(this.declaredClass+
": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var b=this._queuedFetches[a],g=b.args,h=b.filter,b=b.findCallback;h?h(g,this._getItemsArray(g.queryOptions),b):this.fetchItemByIdentity(g)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&
!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function b(a){return null!==
a&&"object"===typeof a&&(!f.isArray(a)||h)&&!f.isFunction(a)&&(a.constructor==Object||f.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&d.hierarchical}function g(a){d._arrayOfAllItems.push(a);for(var c in a){var e=a[c];if(e)if(f.isArray(e))for(var h=0;h<e.length;++h){var l=e[h];b(l)&&g(l)}else b(e)&&g(e)}}var h=!1,d=this;this._labelAttr=a.label;var e,m;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(e=0;e<this._arrayOfTopLevelItems.length;++e)m=
this._arrayOfTopLevelItems[e],f.isArray(m)&&(h=!0),g(m),m[this._rootItemPropName]=!0;var c={},n;for(e=0;e<this._arrayOfAllItems.length;++e)for(n in m=this._arrayOfAllItems[e],m){if(n!==this._rootItemPropName){var q=m[n];null!==q?f.isArray(q)||(m[n]=[q]):m[n]=[null]}c[n]=n}for(;c[this._storeRefPropName];)this._storeRefPropName+="_";for(;c[this._itemNumPropName];)this._itemNumPropName+="_";for(;c[this._reverseRefMap];)this._reverseRefMap+="_";if(c=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=
c;for(e=0;e<this._arrayOfAllItems.length;++e)if(m=this._arrayOfAllItems[e],a=m[c],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+c+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+
c+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=m}else this._features["dojo.data.api.Identity"]=Number;for(e=0;e<this._arrayOfAllItems.length;++e)m=this._arrayOfAllItems[e],m[this._storeRefPropName]=this,m[this._itemNumPropName]=e;for(e=0;e<this._arrayOfAllItems.length;++e)for(n in m=this._arrayOfAllItems[e],m){a=m[n];for(c=0;c<a.length;++c)if(q=a[c],null!==q&&"object"==typeof q){if("_type"in q&&"_value"in q){var k=q._type,p=this._datatypeMap[k];if(p)if(f.isFunction(p))a[c]=new p(q._value);
else if(f.isFunction(p.deserialize))a[c]=p.deserialize(q._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+k+"'");}if(q._reference){q=q._reference;if(f.isObject(q))for(k=0;k<this._arrayOfAllItems.length;++k){var p=this._arrayOfAllItems[k],w=!0,B;for(B in q)p[B]!=q[B]&&
(w=!1);w&&(a[c]=p)}else a[c]=this._getItemByIdentity(q);this.referenceIntegrity&&(q=a[c],this.isItem(q)&&this._addReferenceToMap(q,m,n))}else this.isItem(q)&&this.referenceIntegrity&&this._addReferenceToMap(q,m,n)}}},_addReferenceToMap:function(a,b,g){},getIdentity:function(a){var b=this._features["dojo.data.api.Identity"];return b===Number?a[this._itemNumPropName]:(a=a[b])?a[0]:null},fetchItemByIdentity:function(a){var d,g;if(this._loadFinished)d=this._getItemByIdentity(a.identity),a.onItem&&(g=
a.scope?a.scope:p.global,a.onItem.call(g,d));else{var h=this;this._jsonFileUrl!==this._ccUrl?(p.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):
(this._loadInProgress=!0,g=b.get({url:h._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),g.addCallback(function(b){var e=a.scope?a.scope:p.global;try{h._getItemsFromLoadedData(b),h._loadFinished=!0,h._loadInProgress=!1,d=h._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(e,d),h._handleQueuedFetches()}catch(g){h._loadInProgress=!1,a.onError&&a.onError.call(e,g)}}),g.addErrback(function(b){h._loadInProgress=!1;a.onError&&a.onError.call(a.scope?
a.scope:p.global,b)})):this._jsonData&&(h._getItemsFromLoadedData(h._jsonData),h._jsonData=null,h._loadFinished=!0,d=h._getItemByIdentity(a.identity),a.onItem&&(g=a.scope?a.scope:p.global,a.onItem.call(g,d)))}},_getItemByIdentity:function(a){var b=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(b=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,a)&&(b=this._arrayOfAllItems[a]);void 0===b&&(b=null);return b},getIdentityAttributes:function(a){a=
this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(p.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=b.get({url:this._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(b){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(b),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(h){throw console.log(h),h;}});d.addErrback(function(a){throw a;})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=
!0)}});f.extend(k,a);return k})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(p){var f={};p.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,d){for(var b="^",m=null,q=0;q<f.length;q++)switch(m=f.charAt(q),m){case "\\":b+=m;q++;b+=f.charAt(q);break;case "*":b+=".*";break;case "?":b+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":b+="\\";default:b+=m}b+="$";return d?RegExp(b,"mi"):RegExp(b,
"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(p,f,k){var d={};p.setObject("dojo.data.util.simpleFetch",d);d.errorHandler=function(b,d){d.onError&&d.onError.call(d.scope||f.global,b,d)};d.fetchHandler=function(b,d){var q=d.abort||null,a=!1,n=d.start?d.start:0,l=d.count&&Infinity!==d.count?n+d.count:b.length;d.abort=function(){a=!0;q&&q.call(d)};var s=d.scope||f.global;d.store||(d.store=this);d.onBegin&&d.onBegin.call(s,
b.length,d);d.sort&&b.sort(k.createSortFunction(d.sort,this));if(d.onItem)for(var g=n;g<b.length&&g<l;++g){var h=b[g];a||d.onItem.call(s,h,d)}d.onComplete&&!a&&(g=null,d.onItem||(g=b.slice(n,l)),d.onComplete.call(s,g,d))};d.fetch=function(b){b=b||{};b.store||(b.store=this);this._fetchItems(b,p.hitch(this,"fetchHandler"),p.hitch(this,"errorHandler"));return b};return d})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(p,f,k){return p(null,
{constructor:function(){this.panelManager=k.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(d){},getConfigById:function(d){for(var b=this.getAllConfigs(),f=0;f<b.length;f++)if(b[f].id===d)return b[f]},getAllConfigs:function(){var d=[],d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs()),d=f.filter(d,function(b){return b.visible});return d.sort(function(b,
d){return b.index-d.index})},getAllConfigsIncludeInvisible:function(){var d=[],d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());return d.sort(function(b,d){return b.index-d.index})},isControlled:function(d){return f.some(this.getAllConfigsIncludeInvisible(),function(b){return b.id===d})},widgetIsControlled:function(d){return f.some(this.getAllConfigsIncludeInvisible(),function(b){return b.id===d?!0:f.some(b.widgets,function(b){return b.id===d})})},getGroupConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;
this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(b){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(b.id)&&d.push(b):"all"===this.controlledGroups&&d.push(b))},this);return d},getWidgetConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(b){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(b.id)&&
d.push(b):"all"===this.controlledWidgets&&d.push(b))},this);return d}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(p,f,k,d,b,m,q,a){var n=null,l=null,s=!1;p=p(null,function(){});var g=require.toUrl("jimu"),h=m(g+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),r=m(g+"/SpatialReference/transform.json",{handleAs:"json"});p.loadResource=
function(){var a=new d;if(n&&l)return a.resolve(),a;b([h,r]).then(function(b){n=b[0];l=b[1];s=!0;a.resolve()},function(b){console.error(b);s=!1;a.reject(b)});return a};p.getAllCSUnits=function(){if(s){var a=[];k.forEach(n.wkids,f.hitch(this,function(b){b=this.getCSUnit(b);-1===k.indexOf(a,b)&&a.push(b)}));return a}};p.convertUnit=function(b,g,c){if(s)return a.convertUnit(b,g,c)};p.getUnitRate=function(b,g){if(s)return a.getUnitRate(b,g)};p.isProjectUnit=function(b){if(s)return a.isProjectUnit(b)};
p.isGeographicUnit=function(b){if(s)return a.isGeographicUnit(b)};p.getGeographicUnits=function(){if(s)return a.getGeographicUnits()};p.getProjectUnits=function(){if(s)return a.getProjectUnits()};p.getCSUnit=function(a){if(s){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),c=a.indexOf(",",b);return a.slice(b+6,c-1)}};p.isSameSR=function(a,b){if(s){var c=this.indexOfWkid(a),g=this.indexOfWkid(b);return n.labels[c]===n.labels[g]}};p.isValidWkid=function(a){if(s)return-1<this.indexOfWkid(a)};
p.getSRLabel=function(a){if(s&&this.isValidWkid(a))return a=this.indexOfWkid(a),n.labels[a]};p.indexOfWkid=function(a){if(s)return k.indexOf(n.wkids,a)};p.isWebMercator=function(a){return q.prototype._isWebMercator?q.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new q(parseInt(a,10))).isWebMercator()};p.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};p.isValidTfWkid=function(a){if(s)return-1<this.indexOfTfWkid(a)};p.getTransformationLabel=function(a){if(s)return this.isValidTfWkid(a)?
(a=this.indexOfTfWkid(a),l.labels[a]):""};p.indexOfTfWkid=function(a){if(s)return k.indexOf(l.tfWkids,a)};p.isGeographicCS=function(a){if(s)return this.isValidWkid(a)?n.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};p.isProjectedCS=function(a){if(s)return this.isValidWkid(a)?n.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};p.getGeoCSByProj=function(a){if(s&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=k.indexOf(n.details,a),n.wkids[a]};p.getSpheroidStr=function(a){if(s){if(this.isGeographicCS(a))return n.details[this.indexOfWkid(a)];
if(this.isProjectedCS(a)){a=n.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};p.getCSStr=function(a){if(s)return n.details[this.indexOfWkid(a)]};p.isSameSpheroid=function(a,b){if(s){var c=this.getSpheroidStr(a),g=this.getSpheroidStr(b);return c&&g&&c===g?!0:!1}};return p})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(p,f){var k="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
d="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),b={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,
FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},m=p(null,function(){});m.convertUnit=function(d,a,f){return b[d.toUpperCase()]/b[a.toUpperCase()]*f};m.getUnitRate=function(d,a){return b[d.toUpperCase()]/b[a.toUpperCase()]};m.isProjectUnit=function(b){return-1<f.indexOf(k,b.toUpperCase())};
m.isGeographicUnit=function(b){return-1<f.indexOf(d,b.toUpperCase())};m.getGeographicUnits=function(){return d};m.getProjectUnits=function(){return k};return m})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(p,f,k,d,b,m,q,a){return p(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,
constructor:function(){},postCreate:function(){q.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&m.add(this.domNode,"jimu-radio-checked");this.own(b(this.domNode,"click",k.hitch(this,function(){this.checked||this.check()})))},check:function(a){void 0===a&&(a=!0);this.checked=!0;m.add(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(a){void 0===a&&(a=!0);this.checked=!1;m.remove(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);
this.onStateChange()},_changeOthersState:function(b){null!==this.group&&d.forEach(a.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(b?a.check(!1):a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented".split(" "),function(p,f,k,d,b,m,q){return p([f,q],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",
checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=d.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.labelNode=d.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&d.addClass(this.checkNode,"checked");this.status||d.addClass(this.domNode,"jimu-state-disabled");this.own(m(this.checkNode,"click",k.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.own(m(this.labelNode,"click",
k.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass()},setLabel:function(a){this.label=a;this.labelNode.innerHTML=this.label;this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?d.removeClass(this.labelNode,"not-visible"):d.addClass(this.labelNode,"not-visible"))},setValue:function(a){this.status&&(!0===a?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(a){a=
!!a;var d=this.status!==a;(this.status=a)?b.remove(this.domNode,"jimu-state-disabled"):b.add(this.domNode,"jimu-state-disabled");d&&this.emit("status-change",a)},getStatus:function(){return this.status},check:function(){this.status&&(this.checked=!0,d.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(a){if(this.status&&(this.checked=!1,d.removeClass(this.checkNode,"checked"),!a))this.onStateChange()},onStateChange:function(){if(this.onChange&&k.isFunction(this.onChange))this.onChange(this.checked);
this.emit("change",this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency dijit/form/Select dijit/form/NumberSpinner".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B){return p([f,k,d,m],{templateString:b,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(l(document.body,
"click",q.hitch(this,this._onBodyClicked)));(this._isIE8=8===s("ie"))&&a.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var c=a&&a.declaredClass;c&&("string"===typeof c&&0<=c.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",
this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===
this.type&&this._initTextSection()},getSymbol:function(){var a=null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var c=null;a&&(c=this._cloneSymbol(a));return c},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),c=0,b=a.length;c<b;c++){var e=a[c];this[e]&&
this[e].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(c,b){var e=b.domNode,g=b.dropDown.domNode,e=c===e||a.isDescendant(c,e),g=c===g||a.isDescendant(c,g);if(!e&&!g)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){g(".symbol-section",this.domNode).style("display",
"none")},_showSection:function(a){this._hideAllSections();g("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,c,b){return r.getAncestorDom(a,c,b)},_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var c=a;try{var b=a.toJson(),c=t.fromJson(b)}catch(e){console.error(e)}return c},_createSymbolIconTable:function(c,b,e){var h=this.type+"-icon-table";c=a.toDom('\x3ctable class\x3d"'+
("icon-table "+h+" "+(h+"-"+c))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var h=g("tbody",c)[0],d=Math.ceil(b.length/8),f=0;f<d;f++)a.create("tr",{},h);var l=g("tr",c);n.forEach(b,q.hitch(this,function(c,b){var g=q.clone(c),h=t.fromJson(c),d=a.create("td",{},l[Math.floor(b/8)]);a.addClass(d,"symbol-td-item");h=this._createSymbolNode(h);a.addClass(h,"symbol-div-item");var f=h.firstChild;a.addClass(f,"svg-node");if(this._isIE8&&"point"===e)if(window.isRTL){if("Cross"===c.name||"X"===c.name)a.setStyle(f,
"right","-20px"),a.setStyle(h,"marginTop","20px")}else("Cross"===c.name||"X"===c.name)&&a.setStyle(h,"marginTop","20px");h.symbol=g;a.place(h,d)}));return c},_updatePreview:function(c){var b=this._cloneSymbol(this.symbol);a.empty(c);(b=e.createSymbolNode(b))||(b=a.create("div"));a.place(b,c)},_createSymbolNode:function(c){(c=e.createSymbolNode(c,{width:36,height:36}))||(c=a.create("div"));a.setStyle(c,{width:"36px",height:"36px"});return c},_getLineShapeDesc:function(a){var c=null;if(this.isSimpleLineSymbol(a)||
this.isCartographicLineSymbol(a))c={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return c},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new c({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,
0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(l(this.pointIconTables,".symbol-div-item:click",q.hitch(this,this._onPointSymIconItemClick)));this.own(l(this.pointSymClassSelect,"change",q.hitch(this,this._onPointSymClassSelectChange)));this.own(l(this.pointSize,"change",q.hitch(this,this._onPointSymbolChange)));this.own(l(this.pointColor,"change",q.hitch(this,
this._onPointSymbolChange)));this.own(l(this.pointAlpha,"change",q.hitch(this,this._onPointSymbolChange)));this.own(l(this.pointOutlineColor,"change",q.hitch(this,this._onPointSymbolChange)));this.own(l(this.pointOutlineWidth,"change",q.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",
a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===
a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a);
a=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=a?a.label:""}},_hideAllPointSymIconTable:function(){g(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var a=this.pointSymClassSelect.get("value"),a=g(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(c){var b="def"+c,e=this.pointSymClassSelect[b];e||(e=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
c+".json"),e=h(e,{handleAs:"json"}),this.pointSymClassSelect[b]=e,e.then(q.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(c,b,"point"),a.place(b,this.pointIconTables),this._showSelectedPointSymIconTable())}),q.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(c){if(c=this._getAncestor(c.target||c.srcElement,function(c){return a.hasClass(c,"symbol-div-item")},5))if(g(".selected-symbol-div-item",c.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
a.addClass(c,"selected-symbol-div-item"),c=c.symbol){this.symbol=t.fromJson(c);c=a.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var b=a.getStyle(this.pointColorTr,"display");c!==b&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){a.addClass(this.pointCustomImageTr,"hidden");a.removeClass(this.pointIconTablesTr,"hidden");a.removeClass(this.pointColorTr,
"hidden");a.removeClass(this.pointOpacityTr,"hidden");a.removeClass(this.pointOutlineColorTr,"hidden");a.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){a.addClass(this.pointCustomImageTr,"hidden");a.removeClass(this.pointIconTablesTr,"hidden");a.addClass(this.pointColorTr,"hidden");a.addClass(this.pointOpacityTr,"hidden");a.addClass(this.pointOutlineColorTr,"hidden");a.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){a.removeClass(this.pointCustomImageTr,
"hidden");a.addClass(this.pointIconTablesTr,"hidden");a.addClass(this.pointColorTr,"hidden");a.addClass(this.pointOpacityTr,"hidden");a.addClass(this.pointOutlineColorTr,"hidden");a.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);var a=this.pointColor.getColor(),c=this.pointAlpha.getAlpha();a.a=c;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),
c=parseFloat(this.pointOutlineWidth.get("value")),b=new v;b.setStyle(v.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new B({cropImage:!1,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});a.addClass(this.imageChooser.domNode,
"custom-image-chooser");this.own(l(this.imageChooser,"change",q.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(a,c){this.imageNameNode.innerHTML=c.fileName;a=a.replace(/^data:image\/.*;base64,/,"");var b=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new u({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:b,height:b,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},
_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(l(this.lineIconTables,".symbol-div-item:click",q.hitch(this,this._onLineSymIconItemClick)));this.own(l(this.lineColor,"change",q.hitch(this,this._onLineSymbolChange)));this.own(l(this.lineStylesSelect,"change",q.hitch(this,this._onLineSymbolChange)));
this.own(l(this.lineAlpha,"change",q.hitch(this,this._onLineSymbolChange)));this.own(l(this.lineWidth,"change",q.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",
a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(c){var b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+c+".json");h(b,{handleAs:"json"}).then(q.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(c,b,"line"),a.place(b,this.lineIconTables))}),q.hitch(this,function(a){console.error("get line symbol failed",
a)}))},_onLineSymIconItemClick:function(c){if(c=this._getAncestor(c.target||c.srcElement,function(c){return a.hasClass(c,"symbol-div-item")},5))if(g(".selected-symbol-div-item",c.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(c,"selected-symbol-div-item"),c=c.symbol)c=t.fromJson(c),this._initLineSettings(c),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new v;var a=this.lineColor.getColor(),c=this.lineStylesSelect.get("value");a.a=
this.lineAlpha.getAlpha();var b=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(c);this.symbol.setColor(a);this.symbol.setWidth(b);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(l(this.fillIconTables,".symbol-div-item:click",
q.hitch(this,this._onFillSymIconItemClick)));this.own(l(this.fillColor,"change",q.hitch(this,this._onFillSymbolChange)));this.own(l(this.fillAlpha,"change",q.hitch(this,this._onFillSymbolChange)));this.own(l(this.fillOutlineColor,"change",q.hitch(this,this._onFillSymbolChange)));this.own(l(this.fillOutlineWidth,"change",q.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(c){var b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+c+".json");h(b,{handleAs:"json"}).then(q.hitch(this,
function(b){this.domNode&&(b=this._createSymbolIconTable(c,b,"fill"),a.place(b,this.fillIconTables))}),q.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(c){if(c=this._getAncestor(c.target||c.srcElement,function(c){return a.hasClass(c,"symbol-div-item")},5))if(g(".selected-symbol-div-item",c.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(c,"selected-symbol-div-item"),c=c.symbol)c=t.fromJson(c),this._initFillSettings(c),
this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=new y;var a=this.fillColor.getColor();a.a=this.fillAlpha.getAlpha();var c=this.fillOutlineColor.getColor(),b=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(y.STYLE_SOLID);a=new v;a.setStyle(v.STYLE_SOLID);a.setColor(c);a.setWidth(b);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||
(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(l(this.inputText,"change",q.hitch(this,this._onTextSymbolChange)));this.own(l(this.textColor,"change",q.hitch(this,this._onTextSymbolChange)));this.own(l(this.textFontSize,"change",q.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var c=this.textColor.getColor().toHex(),b=parseInt(this.textFontSize.get("value"),10)+"px";a.setStyle(this.textPreview,{color:c,fontSize:b});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=
new x;var a=this.inputText.value,c=this.textColor.getColor(),b=parseInt(this.textFontSize.get("value"),10),e=new w;e.setSize(b);this.symbol.setText(a);this.symbol.setColor(c);this.symbol.setFont(e);this._updateTextPreview();return this.symbol}})})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff dojo/request esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){var c=0;p=f([k,d,p],{templateString:a,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();
!g.file.supportHTML5()&&(!n("safari")&&g.file.isEnabledFlash())&&g.file.loadFileAPI().then(b.hitch(this,function(){m.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){m.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&m.addClass(this.displayText,"disable-label");m.removeAttr(this.domNode,"title")},enableChooseImage:function(){m.setStyle(this.fileForm,"display","block");this.label&&
"string"===typeof this.label&&m.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._processProperties();this._porcessMaskClick();this._setupFileInput();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,m.setStyle(this.hintText,"display",
"block"));this.showSelfImg&&m.setStyle(this.hintImage,"display","block");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));m.setAttr(this.fileInput,"accept",a)}!g.file.supportHTML5()&&(!n("safari")&&g.file.isEnabledFlash())&&m.setStyle(this.fileInput,{width:"100%",
height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_porcessMaskClick:function(){m.setAttr(this.fileInput,"id","imageChooser_"+c);m.setAttr(this.mask,"for","imageChooser_"+c);c++;this.maskHandle=q(this.mask,"click",b.hitch(this,function(a){a.stopPropagation();if(n("safari")&&7>n("safari"))new e({message:this.nls.unsupportReaderAPI}),a.preventDefault();else{if(!g.file.supportHTML5()){if(!g.file.isEnabledFlash()){var c=m.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,
target:"_blank"});new e({message:c});a.preventDefault();return}if(!g.file.supportFileAPI()){new e({message:this.nls.unsupportReaderAPI});a.preventDefault();return}}m.setStyle(this.fileInput,"display","none");setTimeout(b.hitch(this,function(){m.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=s.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);m.setAttr(this.domNode,"title",a)}else m.setAttr(this.domNode,"title",
"")},_setupFileInput:function(){if(9>=n("ie"))this.own(q(this.fileInput,"change",b.hitch(this,this._onFileInputChange)));else q.once(this.fileInput,"change",b.hitch(this,this._onFileInputChange))},_onFileInputChange:function(a){var c=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(c.type))new e({message:this.nls.invalidType}),(!n("ie")||9<n("ie"))&&this._recreateFileForm();else{var h=9>n("ie")?23552:1024*this.maxSize;g.file.readFile(a,"image/*",h,b.hitch(this,
function(a,b,g){a?(b=this.nls[a.errCode],"exceed"===a.errCode&&(b=b.replace("1024",h/1024)),new e({message:b})):(this.fileProperty.fileName=b,window.isXT&&this.cropImage&&"image/gif"!==c.type?this._cropImageByUser(g):this._readFileData(g));(!n("ie")||9<n("ie"))&&this._recreateFileForm()}))}},_recreateFileForm:function(){var a=b.clone(this.mask),c=b.clone(this.fileInput);m.destroy(this.mask);m.destroy(this.fileInput);var e=b.clone(this.fileForm);m.place(a,e);m.place(c,e);m.place(e,this.fileForm,"replace");
this.maskHandle.remove();this.mask=a;this.fileInput=c;m.destroy(this.fileForm);this.fileForm=e;this._porcessMaskClick();this._setupFileInput()},_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&m.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?m.setAttr(this.selfImg,"src",a):this.selfImg.src=a)},_cropImageByUser:function(a){var c=new h({imageSrc:a,nls:b.clone(this.nls),realWidth:this.goldenWidth,realHeight:this.goldenHeight}),g=new t({hidden:!0}),
d=new r({titleLabel:this.nls.cropImage,content:c,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:b.hitch(this,function(){var h=c.getImageSize(),f=c.getCropSize();g.show();l("/webappbuilder/rest/cropimage",{data:{imageData:a,imageDisplaySize:h.w+","+h.h,cropRectangle:f.w+","+f.h+","+f.t+","+f.l},method:"POST",handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(a){a.success?(this._readFileData(a.imageData),d.close()):(new e({message:this.nls.unknowError}),
g.hide())}),b.hitch(this,function(a){console.error(a);new e({message:this.nls.unknowError});g.hide()}))})}]});g.placeAt(d.domNode);c.startup();m.addClass(d.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});p.GIF="image/gif";p.JPEG="image/jpeg";p.PNG="image/png";return p})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message esri/lang dojo/NodeList-dom".split(" "),
function(p,f,k,d,b,m,q,a,n,l){return p([m,q],{templateString:a,inDrag:!1,inSlider:!1,realWidth:30,realHeight:30,ratio:null,imageSrc:null,_currentX:null,_currentY:null,_currentTop:0,_currentLeft:0,postCreate:function(){this._dragingHandlers=[];this.setImageSrc(this.imageSrc);this.own(d(this.ownerDocument,"mousemove",k.hitch(this,"_onMouseMove")));this.own(d(this.ownerDocument,"mouseup",k.hitch(this,"_onMouseUp")));this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.own(d(this.baseImage,
"load",k.hitch(this,function(){this._init();f.setStyle(this.loadingImg,"display","none")})))},setImageSrc:function(a){f.setAttr(this.viewerImage,"src",a);f.setAttr(this.baseImage,"src",a)},getImageSize:function(){return{w:this._currentImageWidth,h:this._currentImageHeight}},getCropSize:function(){return{l:-this._currentLeft,t:-this._currentTop,w:this.idealWidth,h:this.idealHeight}},_init:function(){var a=this._getComputedStyle(this.cropSection),g=f.getContentBox(this.cropSection),h=this._getComputedStyle(this.baseImage),
d=parseFloat(h.width)||this.baseImage.offsetWidth,h=parseFloat(h.height)||this.baseImage.offsetHeight,e=d/h;this._maxImageWidth=d;this._maxImageHeight=h;if(h<this.realHeight&&d<this.realWidth)a=l.substitute({width:this.realWidth,height:this.realHeight},this.nls.cropWaining),setTimeout(k.hitch(this,function(){this.popup.close()}),50),new n({message:a});else{this.idealWidth=this.realWidth;this.idealHeight=this.realHeight;var m=this.ratio=this.ratio?this.ratio:this.realWidth/this.realHeight;1<=this.ratio?
g.h*this.ratio<=g.w?(this.idealHeight=g.h,this.idealWidth=g.h*this.ratio):(this.idealHeight=this._findProperlyValue(0,g.h,g.w-5,function(a){return a*m}),this.idealWidth=this.idealHeight*this.ratio):g.w/this.ratio<=g.h?(this.idealWidth=g.w,this.idealHeight=g.w/this.ratio):(this.idealWidth=this._findProperlyValue(0,g.w,g.h-5,function(a){return a/m}),this.idealHeight=this.idealWidth/this.ratio);f.setStyle(this.viewerBox,{width:this.idealWidth+"px",height:this.idealHeight+"px"});a=Math.abs((parseFloat(a.height)-
this.idealHeight)/2);f.setStyle(this.cropSection,{paddingTop:a+"px",paddingBottom:a+"px"});1<=e?this.idealHeight*e>=this.idealWidth?(f.setStyle(this.viewerImage,"height",this.idealHeight+"px"),f.setStyle(this.baseImage,"height",this.idealHeight+"px")):(a=this._findProperlyValue(0,this.idealWidth,this.idealWidth,function(a){return a*e}),f.setStyle(this.viewerImage,"height",a+"px"),f.setStyle(this.baseImage,"height",a+"px")):this.idealWidth/e>=this.idealHeight?(f.setStyle(this.viewerImage,"width",this.idealWidth+
"px"),f.setStyle(this.baseImage,"width",this.idealWidth+"px")):(a=this._findProperlyValue(0,this.idealHeight,this.idealHeight,function(a){return a/e}),f.setStyle(this.viewerImage,"width",a+"px"),f.setStyle(this.baseImage,"width",a+"px"));b(".hide-status",this.domNode).removeClass("hide-status");h=this._getComputedStyle(this.baseImage);d=parseFloat(h.width)||this.baseImage.offsetWidth;h=parseFloat(h.height)||this.baseImage.offsetHeight;this._minImageWidth=d;this._minImageHeight=h;this._currentImageWidth=
d;this._currentImageHeight=h;this._currentTop=-(h-this.idealHeight)/2;this._currentLeft=-(d-this.idealWidth)/2;f.setStyle(this.baseImage,{top:this._currentTop+"px",left:this._currentLeft+"px"});f.setStyle(this.viewerImage,{top:this._currentTop+"px",left:this._currentLeft+"px"});this._zoomRatio=this._maxImageWidth/this._minImageWidth;1>=this._zoomRatio&&f.addClass(this.zoomInBtn,"disable-zoom");f.addClass(this.zoomOutBtn,"disable-zoom");this._latestPercentage=window.isRTL?100:0}},_findProperlyValue:function(a,
b,h,d,e){e=isFinite(e)?parseFloat(e):1;h=0>h-e||0>h+e?e:h;var f=(a+b)/2,c=d(f);if(c<=h+e&&c>=h-e)return f;if(c>h)return this._findProperlyValue(a,f,h,d);if(c<h)return this._findProperlyValue(f,b,h,d)},_getComputedStyle:function(a){a=f.getMarginBox(a);return{width:a.w,height:a.h,left:a.l,top:a.t}},_onViewerMouseDown:function(a){var b=this._getComputedStyle(this.baseImage),h=this._getComputedStyle(this.viewerContent);this._maxOffsetLeft=parseFloat(h.width)-parseFloat(b.width);this._maxOffsetTop=parseFloat(h.height)-
parseFloat(b.height);this._maxOffsetLeft=0<this._maxOffsetLeft?0:this._maxOffsetLeft;this._maxOffsetTop=0<this._maxOffsetTop?0:this._maxOffsetTop;this.inDrag=!0;this._currentX=a.clientX;this._currentY=a.clientY;this._stopSelect()},_stopSelect:function(){this._dragingHandlers=this._dragingHandlers.concat([d(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),d(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_removeStopSelect:function(){for(var a=
this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_onViewerMouseUp:function(a){this.inDrag&&(this.inDrag=!1,this._resetImagePosition(a.clientX,a.clientY),this._removeStopSelect(),a.stopPropagation())},_onSliderMouseDown:function(a){if(!(1>=this._zoomRatio)){this.inSlider=!0;this._currentX=a.clientX;this._currentY=a.clientY;var b=f.position(this.sliderNode);this._startSliderLeft=b.x;this._sliderWidth=b.w;this._stopSelect();a.stopPropagation()}},_onSliderMouseUp:function(a){if(!(1>=
this._zoomRatio)&&this.inSlider){this.inSlider=!1;this._resetSliderButtonPosition(a.clientX);var b=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(b.left);this._currentTop=parseFloat(b.top);this._latestPercentage=100*((a.clientX-this._startSliderLeft)/this._sliderWidth);this._latestPercentage=this._normalizePercentage(this._latestPercentage);this._removeStopSelect();a.stopPropagation()}},_onMouseMove:function(a){this.inDrag&&this._resetImagePosition(a.clientX,a.clientY);this.inSlider&&
!(1>=this._zoomRatio)&&this._resetSliderButtonPosition(a.clientX,a.clientY)},_onMouseUp:function(a){this.inDrag&&this._onViewerMouseUp(a);this.inSlider&&this._onSliderMouseUp(a)},_onZoomOutClick:function(){1>=this._zoomRatio||this._zoomImage("out")},_onZoomInClick:function(){1>=this._zoomRatio||this._zoomImage("in")},_zoomImage:function(a){var b=0;this._latestPercentage=this._normalizePercentage(this._latestPercentage);"in"===a?b=window.isRTL?this._latestPercentage-20:this._latestPercentage+20:"out"===
a&&(b=window.isRTL?this._latestPercentage+20:this._latestPercentage-20);a=this._normalizePercentage(b);this._moveSliderButton(a,this._latestPercentage);this._latestPercentage=a;a=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(a.left);this._currentTop=parseFloat(a.top)},_resetImagePosition:function(a,b){var h=a-this._currentX,d=b-this._currentY;0<=this._currentTop+d?(f.setStyle(this.baseImage,"top",0),f.setStyle(this.viewerImage,"top",0),this._currentY=b,this._currentTop=0):this._currentTop+
d<=this._maxOffsetTop?(f.setStyle(this.baseImage,"top",this._maxOffsetTop+"px"),f.setStyle(this.viewerImage,"top",this._maxOffsetTop+"px"),this._currentY=b,this._currentTop=this._maxOffsetTop):(f.setStyle(this.baseImage,"top",this._currentTop+d+"px"),f.setStyle(this.viewerImage,"top",this._currentTop+d+"px"),this._currentY=b,this._currentTop+=d);0<=this._currentLeft+h?(f.setStyle(this.baseImage,"left",0),f.setStyle(this.viewerImage,"left",0),this._currentX=a,this._currentLeft=0):this._currentLeft+
h<=this._maxOffsetLeft?(f.setStyle(this.baseImage,"left",this._maxOffsetLeft+"px"),f.setStyle(this.viewerImage,"left",this._maxOffsetLeft+"px"),this._currentX=a,this._currentLeft=this._maxOffsetLeft):(f.setStyle(this.baseImage,"left",this._currentLeft+h+"px"),f.setStyle(this.viewerImage,"left",this._currentLeft+h+"px"),this._currentX=a,this._currentLeft+=h)},_normalizePercentage:function(a){a=0>a?0:a;return 100<a?100:a},_resetSliderButtonPosition:function(a){a=100*((a-this._startSliderLeft)/this._sliderWidth);
a=this._normalizePercentage(a);this._moveSliderButton(a,this._latestPercentage)},_moveSliderButton:function(a,b){0>=a?f.addClass(this.zoomOutBtn,"disable-zoom"):f.removeClass(this.zoomOutBtn,"disable-zoom");100<=a?f.addClass(this.zoomInBtn,"disable-zoom"):f.removeClass(this.zoomInBtn,"disable-zoom");f.setStyle(this.sliderButton,"left",a+"%");window.isRTL&&(a=100-a,b=100-b);var d=this._minImageWidth*(this._zoomRatio-1)*a/100,l=this._minImageHeight*(this._zoomRatio-1)*a/100,e=this._getComputedStyle(this.baseImage);
this._currentLeft=parseFloat(e.left);this._currentTop=parseFloat(e.top);var e=(Math.abs(this._currentLeft)+this.idealWidth/2)*((this._minImageWidth+d)/this._currentImageWidth-1),m=(Math.abs(this._currentTop)+this.idealHeight/2)*((this._minImageWidth+d)/this._currentImageWidth-1);f.setStyle(this.baseImage,{width:this._minImageWidth+d+"px",height:this._minImageHeight+l+"px"});f.setStyle(this.viewerImage,{width:this._minImageWidth+d+"px",height:this._minImageHeight+l+"px"});this._currentImageWidth=this._minImageWidth+
d;this._currentImageHeight=this._minImageHeight+l;if(0<=a-b)f.setStyle(this.baseImage,{top:this._currentTop-m+"px",left:this._currentLeft-e+"px"}),f.setStyle(this.viewerImage,{top:this._currentTop-m+"px",left:this._currentLeft-e+"px"});else{var c=0,n=0,c=0<=this._currentTop-m?0:this._currentTop-m+this._minImageHeight+l<=this.idealHeight?this.idealHeight-this._minImageHeight-l:this._currentTop-m,n=0<=this._currentLeft-e?0:this._currentLeft-e+this._minImageWidth+d<=this.idealWidth?this.idealWidth-this._minImageWidth-
d:this._currentLeft-e;f.setStyle(this.baseImage,{top:c+"px",left:n+"px"});f.setStyle(this.viewerImage,{top:c+"px",left:n+"px"})}this._latestPercentage=a}})})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker jimu/utils".split(" "),function(p,f,k,d,b,m,q,a,n,l,s){return p([f,k],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",
templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof q||(this.color=new q(this.color)):this.color=new q("#ccc");b.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},
destroy:function(){n.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var d=this.tooltipDialog.domNode;return a===d||b.isDescendant(a,d)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){n.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){n.close(this.tooltipDialog);this._isTooltipDialogOpened=
!1},_createTooltipDialog:function(){var g=b.create("div");this.tooltipDialog=new a({content:g});b.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var h=new l({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:d.hitch(this,function(a){this.ensureMode||(a=new q(a),this.setColor(a))})});h.placeAt(g);h.startup();if(this.ensureMode){var f=b.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},
g);this.own(m(f,"click",d.hitch(this,function(){this._hideTooltipDialog()})));if("undefined"===typeof this.showOk||!0===typeof this.showOk)f=b.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},g),this.own(m(f,"click",d.hitch(this,function(){var a=this.picker.get("value");this.setColor(new q(a));this._hideTooltipDialog()})));g=b.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},g);this.own(m(g,"click",
d.hitch(this,function(){var a=this.picker.get("value");this.setColor(new q(a))})))}this.own(m(this.domNode,"click",d.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(m(document.body,"click",d.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=h},setColor:function(a,d){if(a instanceof q){var f=this.color,e="";f&&(e=f.toHex());f=a.toHex();
this.color=a;b.setStyle(this.domNode,"backgroundColor",f);if(e!==f&&(this.picker.set("value",f),!1!==d))this.onChange(new q(f))}},getColor:function(){return this.color},_changeLabel:function(a){b.empty(this.domNode);b.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:s.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)},getPopup:function(){return this.tooltipDialog||null},setLabel:function(a){b.empty(this.domNode);b.create("span",
{innerHTML:a||"",className:"text-label"},this.domNode)}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B){p.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",c,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:B,postMixInProperties:function(){s.contains(a.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=e.getUniqueId(this.id);k.mixin(this,y.getLocalization("dojox.widget","ColorPicker"));k.mixin(this,y.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>q("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new r.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new r.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(m.subscribe("/dnd/move/stop",k.hitch(this,"_clearTimer"))),this._subs.push(m.subscribe("/dnd/move/start",
k.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:g.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:g.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:g.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:g.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:g.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:g.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,c){this._started&&this.setColor(a,c)},setColor:function(a,c){a=v.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,c)},_setTimer:function(a){a.node!=this.cursorNode&&a.node!=this.hueCursorNode||(t.focus(a.node),l.setSelectable(this.domNode,!1),this._timer=setInterval(k.hitch(this,"_updateColor"),45))},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),l.setSelectable(this.domNode,!0))},_setHue:function(a){b.style(this.colorUnderlay,"backgroundColor",v.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,c,e){if(-1!==a){a=b.style(this.hueCursorNode,"top");c=this.PICKER_HUE_SELECTOR_H/2;a+=c;var d=!1;e.charOrCode==g.UP_ARROW?0<a&&(a-=1,d=!0):e.charOrCode==g.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,d=!0);d&&b.style(this.hueCursorNode,"top",a-c+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
c,e){c=this.PICKER_SAT_SELECTOR_H/2;var d=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=b.style(this.cursorNode,"top");var h=b.style(this.cursorNode,"left");a+=c;var h=h+d,f=!1;e.charOrCode==g.UP_ARROW?0<a&&(a-=1,f=!0):e.charOrCode==g.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,f=!0):e.charOrCode==g.LEFT_ARROW?0<h&&(h-=1,f=!0):e.charOrCode==g.RIGHT_ARROW&&h<this.PICKER_SAT_VAL_W&&(h+=1,f=!0);f&&(h-=d,b.style(this.cursorNode,"top",a-c+"px"),b.style(this.cursorNode,"left",h+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var c=this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/2,g=this.PICKER_SAT_SELECTOR_W/2,c=b.style(this.hueCursorNode,"top")+c,e=b.style(this.cursorNode,"top")+e,g=b.style(this.cursorNode,"left")+g,c=Math.round(360-360*(c/this.PICKER_HUE_H)),g=v.fromHsv(c,100*(g/this.PICKER_SAT_VAL_W),100-100*(e/this.PICKER_SAT_VAL_H));this._updateColorInputs(g);this._updateValue(g,a);c!=this._hue&&this._setHue(c)},_colorInputChange:function(a){var c,b=!1;switch(a.target){case this.hexCode:c=
v.fromString(a.target.value);b=!0;break;case this.Rval:case this.Gval:case this.Bval:c=v.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);b=!0;break;case this.Hval:case this.Sval:case this.Vval:c=v.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),b=!0}b&&(this._updatePickerLocations(c),this._updateColorInputs(c),this._updateValue(c,!0))},_updateValue:function(a,c){var b=a.toHex();this.value=this.valueNode.value=b;if(c&&(!this._timer||this.liveUpdate))this.onChange(b)},_updatePickerLocations:function(a){var c=
this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/2,g=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();c=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-c;g=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-g;e=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-e;this.animatePoint?(h.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:c,left:0}).play(),h.slideTo({node:this.cursorNode,duration:this.slideDuration,top:e,left:g}).play()):(b.style(this.hueCursorNode,"top",c+"px"),
b.style(this.cursorNode,{left:g+"px",top:e+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var c=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=c);this.previewNode.style.backgroundColor=c;this.webSafe&&(this.safePreviewNode.style.backgroundColor=c)},_setHuePoint:function(a){a=a.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?h.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:k.hitch(this,function(){this._updateColor(!1);t.focus(this.hueCursorNode)})}).play():(b.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var c=a.layerY-this.PICKER_SAT_SELECTOR_H/2,e=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&t.focus(a.target);this.animatePoint?h.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:e,onEnd:k.hitch(this,
function(){this._updateColor(!0);t.focus(this.cursorNode)})}).play():(b.style(this.cursorNode,{left:e+"px",top:c+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||t.focus(this.focusNode)},_stopDrag:function(a){n.stop(a)},destroy:function(){this.inherited(arguments);d.forEach(this._subs,function(a){m.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(p){return p})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(p,f,k,d){p=f.getObject("color",!0,p);p.Color=k;p.blend=k.blendColors;p.fromRgb=k.fromRgb;p.fromHex=k.fromHex;p.fromArray=k.fromArray;p.fromString=k.fromString;p.greyscale=d.makeGrey;f.mixin(p,{fromCmy:function(b,d,q){f.isArray(b)?(d=b[1],q=b[2],b=b[0]):f.isObject(b)&&(d=b.m,q=b.y,b=b.c);d=1-d/100;q=1-q/100;return new k({r:Math.round(255*(1-b/100)),g:Math.round(255*d),b:Math.round(255*q)})},fromCmyk:function(b,d,q,a){f.isArray(b)?(d=b[1],
q=b[2],a=b[3],b=b[0]):f.isObject(b)&&(d=b.m,q=b.y,a=b.b,b=b.c);d/=100;q/=100;a/=100;b=1-Math.min(1,b/100*(1-a)+a);d=1-Math.min(1,d*(1-a)+a);q=1-Math.min(1,q*(1-a)+a);return new k({r:Math.round(255*b),g:Math.round(255*d),b:Math.round(255*q)})},fromHsl:function(b,d,q){f.isArray(b)?(d=b[1],q=b[2],b=b[0]):f.isObject(b)&&(d=b.s,q=b.l,b=b.h);d/=100;for(q/=100;0>b;)b+=360;for(;360<=b;)b-=360;var a,n;120>b?(a=(120-b)/60,n=b/60,b=0):240>b?(a=0,n=(240-b)/60,b=(b-120)/60):(a=(b-240)/60,n=0,b=(360-b)/60);a=2*
d*Math.min(a,1)+(1-d);n=2*d*Math.min(n,1)+(1-d);b=2*d*Math.min(b,1)+(1-d);0.5>q?(a*=q,n*=q,b*=q):(a=(1-q)*a+2*q-1,n=(1-q)*n+2*q-1,b=(1-q)*b+2*q-1);return new k({r:Math.round(255*a),g:Math.round(255*n),b:Math.round(255*b)})}});p.fromHsv=function(b,d,q){f.isArray(b)?(d=b[1],q=b[2],b=b[0]):f.isObject(b)&&(d=b.s,q=b.v,b=b.h);360==b&&(b=0);d/=100;q/=100;var a,n,l;if(0==d)n=l=a=q;else{var s=b/60;b=Math.floor(s);var g=s-b,s=q*(1-d),h=q*(1-d*g);d=q*(1-d*(1-g));switch(b){case 0:a=q;n=d;l=s;break;case 1:a=
h;n=q;l=s;break;case 2:a=s;n=q;l=d;break;case 3:a=s;n=h;l=q;break;case 4:a=d;n=s;l=q;break;case 5:a=q,n=s,l=h}}return new k({r:Math.round(255*a),g:Math.round(255*n),b:Math.round(255*l)})};f.extend(k,{toCmy:function(){var b=1-this.g/255,d=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*b),y:Math.round(100*d)}},toCmyk:function(){var b,d,f,a=this.r/255;b=this.g/255;d=this.b/255;f=Math.min(1-a,1-b,1-d);b=(1-b-f)/(1-f);d=(1-d-f)/(1-f);return{c:Math.round(100*((1-a-f)/(1-f))),m:Math.round(100*
b),y:Math.round(100*d),b:Math.round(100*f)}},toHsl:function(){var b=this.r/255,d=this.g/255,f=this.b/255,a=Math.min(b,f,d),n=Math.max(b,d,f),l=n-a,k=0,g=0,a=(a+n)/2;0<a&&1>a&&(g=l/(0.5>a?2*a:2-2*a));0<l&&(n==b&&n!=d&&(k+=(d-f)/l),n==d&&n!=f&&(k+=2+(f-b)/l),n==f&&n!=b&&(k+=4+(b-d)/l),k*=60);return{h:k,s:Math.round(100*g),l:Math.round(100*a)}},toHsv:function(){var b=this.r/255,d=this.g/255,f=this.b/255,a=Math.min(b,f,d),n=Math.max(b,d,f),a=n-a,l=null,k=0==n?0:a/n;0==k?l=0:(l=b==n?60*(d-f)/a:d==n?120+
60*(f-b)/a:240+60*(b-d)/a,0>l&&(l+=360));return{h:l,s:Math.round(100*k),v:Math.round(100*n)}}});return p})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(p,f,k,d){var b={};f.setObject("dojo.colors",b);var m=function(a,b,d){0>d&&++d;1<d&&--d;var f=6*d;return 1>f?a+(b-a)*f:1>2*d?b:2>3*d?a+6*(b-a)*(2/3-d):a};p.colorFromRgb=k.fromRgb=function(a,b){var f=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(f){var q=f[2].split(/\s*,\s*/),
g=q.length,f=f[1];if("rgb"==f&&3==g||"rgba"==f&&4==g)return f=q[0],"%"==f.charAt(f.length-1)?(f=d.map(q,function(a){return 2.56*parseFloat(a)}),4==g&&(f[3]=q[3]),k.fromArray(f,b)):k.fromArray(q,b);if("hsl"==f&&3==g||"hsla"==f&&4==g){var f=(parseFloat(q[0])%360+360)%360/360,h=parseFloat(q[1])/100,r=parseFloat(q[2])/100,h=0.5>=r?r*(h+1):r+h-r*h,r=2*r-h,f=[256*m(r,h,f+1/3),256*m(r,h,f),256*m(r,h,f-1/3),1];4==g&&(f[3]=q[3]);return k.fromArray(f,b)}}return null};var q=function(a,b,d){a=Number(a);return isNaN(a)?
d:a<b?b:a>d?d:a};k.prototype.sanitize=function(){this.r=Math.round(q(this.r,0,255));this.g=Math.round(q(this.g,0,255));this.b=Math.round(q(this.b,0,255));this.a=q(this.a,0,1);return this};b.makeGrey=k.makeGrey=function(a,b){return k.fromArray([a,a,a,b])};f.mixin(k.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],
cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],
darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,
92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,
153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,
245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return k})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){return p([f,k,d,b],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:m,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x){var w=f("dijit.form._SliderMover",
s,{onMouseMove:function(c){var e=this.widget,g=e._abspos;g||(g=e._abspos=b.position(e.sliderBarContainer,!0),e._setPixelValue_=a.hitch(e,"_setPixelValue"),e._isReversed_=e._isReversed());c=c[e._mousePixelCoord]-g[e._startingPixelCoord];e._setPixelValue_(e._isReversed_?g[e._pixelCount]-c:c,g[e._pixelCount],!1)},destroy:function(a){s.prototype.destroy.apply(this,arguments);var c=this.widget;c._abspos=null;c._setValueAttr(c.value,!0)}});k=f("dijit.form.HorizontalSlider",[v,y],{templateString:x,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:e.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){!this.disabled&&(!this.readOnly&&!a.altKey&&
!a.ctrlKey&&!a.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!this.disabled&&!this.readOnly&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.keyCode){case q.HOME:this._setValueAttr(this.minimum,!1);break;case q.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW:case !1===this._descending?q.DOWN_ARROW:q.UP_ARROW:case !1===this._descending?q.PAGE_DOWN:q.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
q.LEFT_ARROW:q.RIGHT_ARROW:case !1===this._descending?q.UP_ARROW:q.DOWN_ARROW:case !1===this._descending?q.PAGE_UP:q.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){!this.disabled&&!this.readOnly&&(n("ie")||t.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){t.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var c=b.position(this.sliderBarContainer,!0),e=a[this._mousePixelCoord]-c[this._startingPixelCoord];this._setPixelValue(this._isReversed()?c[this._pixelCount]-e:e,c[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,c,b){if(!this.disabled&&!this.readOnly){var e=this.discreteValues;if(1>=e||Infinity==e)e=c;e--;a=Math.round(a/(c/e));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*a/e+this.minimum,this.maximum),this.minimum),b)}},_setValueAttr:function(a,
c){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var b=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,e=!1===this._descending?this.remainingBar:this.progressBar,g=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(c&&0<this.slideDuration&&e.style[this._progressPixelSize]){var h=this,f={},l=parseFloat(e.style[this._progressPixelSize]),
m=this.slideDuration*(b-l/100);0!=m&&(0>m&&(m=0-m),f[this._progressPixelSize]={start:l,end:100*b,units:"%"},this._inProgressAnim=d.animateProperty({node:e,duration:m,onAnimate:function(a){g.style[h._progressPixelSize]=100-parseFloat(a[h._progressPixelSize])+"%"},onEnd:function(){delete h._inProgressAnim},properties:f}),this._inProgressAnim.play())}else e.style[this._progressPixelSize]=100*b+"%",g.style[this._progressPixelSize]=100*(1-b)+"%"},_bumpValue:function(a,c){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var e=m.getComputedStyle(this.sliderBarContainer),g=b.getContentBox(this.sliderBarContainer,e),e=this.discreteValues;if(1>=e||Infinity==e)e=g[this._pixelCount];e--;g=Math.round((this.value-this.minimum)*e/(this.maximum-this.minimum))+a;0>g&&(g=0);g>e&&(g=e);g=g*(this.maximum-this.minimum)/e+this.minimum;this._setValueAttr(g,c)}},_onClkBumper:function(a){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==q.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==q.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},startup:function(){this._started||(p.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,c,b){if(-1==a)this._setValueAttr(this.value,!0);else this[c==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](b)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=g('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(c.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),c.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(r(this.domNode,h.wheel,a.hitch(this,"_mouseWheeled")));var b=f(w,{widget:this});this._movable=
new l(this.sliderHandle,{mover:b});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});k._Mover=w;return k})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(p,f,k,d,b,m){p=p("dijit.form.HorizontalRuleLabels",m,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(b){return b},_genHTML:function(b,a){var d=this.labels[a];return this._positionPrefix+this._calcPosition(b)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(d)+this._labelPrefix+
d+this._suffix},_genDirectionHTML:function(b){return""},getLabels:function(){var b=this.labels;!b.length&&this.srcNodeRef&&(b=d("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!b.length&&1<this.count)for(var b=[],a=this.minimum,f=(this.maximum-a)/(this.count-1),l=0;l<this.count;l++)b.push(l<this.numericMargin||l>=this.count-this.numericMargin?"":k.format(a,this.constraints)),a+=f;return b},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});f("dojo-bidi")&&p.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),d(".dijitRuleLabelContainer",this.domNode).forEach(b.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(b){return this.textDir?"direction:"+this.getTextDir(b)+";":""}});return p})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(p,f,k){return p("dijit.form.HorizontalRule",
[f,k],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(d){return this._positionPrefix+d+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var d;if(1==this.count)d=this._genHTML(50,0);else{var b,
f=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){d=this._genHTML(0,0);for(b=1;b<this.count-1;b++)d+=this._genHTML(f*b,b);d+=this._genHTML(100,this.count-1)}else{d=this._genHTML(100,0);for(b=1;b<this.count-1;b++)d+=this._genHTML(100-f*b,b);d+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=d}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(p,f,k,d){return p("dijit.form.NumberSpinner",[k,d.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",
adjust:function(b,d){var f=this.constraints,a=isNaN(b),n=!isNaN(f.max),l=!isNaN(f.min);a&&0!=d&&(b=0<d?l?f.min:n?f.max:0:n?this.constraints.max:l?f.min:0);var k=b+d;if(a||isNaN(k))return b;n&&k>f.max&&(k=f.max);l&&k<f.min&&(k=f.min);return k},_onKeyDown:function(b){if(!this.disabled&&!this.readOnly&&(b.keyCode==f.HOME||b.keyCode==f.END)&&!b.ctrlKey&&(!b.altKey&&!b.metaKey)&&"undefined"!=typeof this.get("value")){var d=this.constraints[b.keyCode==f.HOME?"min":"max"];"number"==typeof d&&this._setValueAttr(d,
!1);b.stopPropagation();b.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(p,f,k,d,b,m,q,a,n,l){return p("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:n,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",
downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,b,d){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),b*d),!1),l.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,d){var l=this.smallDelta;b==this.textbox&&(b=d.keyCode,l=b==f.PAGE_UP||b==f.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==f.UP_ARROW||b==f.PAGE_UP?this.upArrowNode:this.downArrowNode);
-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,l)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var d=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);
this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(m(this.domNode,b.wheel,k.hitch(this,
"_mouseWheeled")),q.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,
shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(p,f,k){return p("dijit.form.RangeBoundTextBox",
k,{rangeMessage:"",rangeCheck:function(d,b){return("min"in b?0<=this.compare(d,b.min):!0)&&("max"in b?0>=this.compare(d,b.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var d=this.get("value");if(null==d)return!1;var b=!1;"min"in this.constraints&&(b=this.constraints.min,b=0>this.compare(d,"number"==typeof b&&0<=b&&0!=d?0:b));!b&&"max"in this.constraints&&(b=this.constraints.max,b=0<this.compare(d,"number"!=typeof b||0<
b?b:0));return b},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(d))},getErrorMessage:function(d){var b=this.get("value");return null!=b&&""!==b&&("number"!=typeof b||!isNaN(b))&&!this.isInRange(d)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=
f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(p,f,k,d){return p("dijit.form.MappedTextBox",d,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(b){return b.toString?b.toString():""},toString:function(){var b=this.filter(this.get("value"));
return null!=b?"string"==typeof b?b:this.serialize(b,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=k.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(p,f,k,d,b,m){var q=function(a){a=a||{};var b=k.getLocalization("dojo.cldr","number",k.normalizeLocale(a.locale)),d=a.pattern?a.pattern:b[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:a}},a=p("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(a,
this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:b.format,_regExpGenerator:b.regexp,_decimalInfo:q(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var b="number"==typeof a.places?a.places:0;b&&b++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-b));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-b));this.inherited(arguments,[a]);this.focusNode&&(this.focusNode.value&&
!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=q(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"==typeof a&&!isNaN(a)&&(a=this.format(a,this.constraints),void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,b){var d=String(a);if("number"!=typeof a)return d;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&
(b=f.mixin({},b,this.editOptions));return this._formatter(a,b)},_parser:b.parse,parse:function(a,b){var d=f.mixin({},b,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var g=d.places,g="number"===typeof g?g:Number(g.split(",").pop());d.places="0,"+g}d=this._parser(a,d);this.editOptions&&(this.focused&&isNaN(d))&&(d=this._parser(a,b));return d},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==
a||"string"==typeof a&&""==a)return NaN;"number"==typeof a&&(!isNaN(a)&&0!=a)&&(a=b.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,b){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(a,!0)},_setValueAttr:function(a,b,d){if(void 0!==a&&void 0===d)if(d=String(a),"number"==typeof a)if(isNaN(a))d="";else{if("rangeCheck"in this&&this.rangeCheck(a,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else a?a=void 0:(d="",a=NaN);this.inherited(arguments,[a,b,d])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+b._realNumberRegexp(f.delegate(this.constraints))+"$").test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,b="number"==typeof this.constraints.max,f=this.get("value");if(isNaN(f)||!a&&!b)return this.inherited(arguments);var g=f|0,h=0>f,m=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
e=(this.maxLength||20)-this.textbox.value.length,k=m?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",g=m?g+"."+k:g+"",e=d.rep("9",e),m=f;h?m=Number(g+e):f=Number(g+e);return!(a&&f<this.constraints.min||b&&m>this.constraints.max)}});p=p("dijit.form.NumberTextBox",[m,a],{baseClass:"dijitTextBox dijitNumberTextBox"});p.Mixin=a;return p})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(p,f,k,d,b,m,q,a){return p([a],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(d(this,"Change",k.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(a,b){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof a&&(this._fetchHandle=m.after(this,"onFetch",a),this.own(this._fetchHandle));"function"===typeof b&&(this._fetchErrHandle=m.after(this,"onFetchError",b),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(a){return a},onFetchError:function(a){},getStatus:function(){return this._status},_onServiceUrlChange:function(a){var d=new b;d.then(k.hitch(this,function(){this._valid()}),k.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();a?q({url:k.trim(a||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(k.hitch(this,function(a){this.onFetch({url:this.getValue(),data:a})?d.resolve("success"):d.reject("error")}),k.hitch(this,function(a){d.reject(a)})):d.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){return p([f,k,d],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(s.bindClickAndDblclickEvents(this.tableInBodySection,b.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return m.hasClass(a,"simple-table-row")&&m.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),b.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return m.hasClass(a,"simple-table-row")&&m.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var d=Math.random().toString();this._name="jimu_table_"+d.slice(2,d.length);if(this.fields&&0<this.fields.length){var f=m.create("tr",{},this.thead);q.forEach(this.fields,b.hitch(this,function(e){var d="auto";"actions"===e.type&&(e.name="actions");e.hidden?d=1:void 0!==e.width&&null!==e.width?d=e.width:"actions"===e.type&&!e.name&&(e.width=this._calculateActionsWidth(e)+20,d=e.width);m.create("col",{width:d},this.headColgroup);
m.create("col",{width:d},this.bodyColgroup);d=m.create("th",{innerHTML:e.title,title:e.title},f);if("checkbox"===e.type){d.innerHTML="";var c=new g({label:e.title}),h=n(".checkbox",c.domNode)[0];h&&(h.style.marginTop="10px");this.own(a(c.domNode,"click",b.hitch(this,function(){c.getValue()?this._checkAllTdCheckBoxes(e.name):this._uncheckAllTdCheckBoxes(e.name)})));c.placeAt(d)}m.addClass(d,"simple-table-field");e.hidden&&m.addClass(d,"hidden-column");e["class"]&&m.addClass(d,e["class"]);m.addClass(d,
e.name)}))}else this.fields=null},_getThCheckBox:function(a){var b=null;a=n(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return b=l.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=n(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=q.map(a,function(a){return l.byNode(a)});return a=q.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(b.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var g=this._getAllEnabledTdCheckBoxes(a),g=q.filter(g,b.hitch(this,function(a){return a.getStatus()}));0!==g.length&&(a=this._getThCheckBox(a),q.every(g,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),g=q.map(a,b.hitch(this,function(a){return this.getRowData(a)}));m.empty(this.tbody);q.forEach(a,b.hitch(this,function(a,b){this._onDeleteRow(a,g[b])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var g=[];this.fields&&(a&&0<a.length)&&q.forEach(a,b.hitch(this,function(a){g.push(this.addRow(a,-1,!0))}));this.updateUI();return g},addRow:function(a,g,e){this._rowIndex++;var d={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return d;var c=q.filter(this.fields,b.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),c=q.filter(c,b.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,a[c.name]).length}));if(0<c.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=c,d;var f=m.create("tr",{"class":"simple-table-row not-empty"},this.tbody);m.setAttr(f,"rowId","row"+this._rowIndex);
q.forEach(this.fields,b.hitch(this,function(c){var b=a[c.name],e=c.type,g=null;"actions"===e?this._createActionsTd(f,c):("text"===e?g=this._createTextTd(f,c,b):"radio"===e?g=this._createRadioTd(f,c,b):"checkbox"===e?g=this._createCheckboxTd(f,c,b):"empty"===e?g=this._createEmptyTd(f,c):"extension"===e&&(g=this._createExtensionTd(f,c,b)),c.hidden&&m.addClass(g,"hidden-column"))}));e||(this.updateUI(),e=this.getRows(),"number"===typeof g&&(0<=g&&g<e.length)&&m.place(f,e[g],"before"));d.success=!0;d.tr=
f;d.errorMessage=null;this._onAddRow(f);return d},deleteRow:function(a){if(a){var b=this.getRowData(a);m.destroy(a);this.updateUI();this._onDeleteRow(a,b)}},selectRow:function(a){this.selectable&&(n(".simple-table-row",this.tbody).removeClass("jimu-state-active"),m.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();m.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
m.addClass(this.domNode,this._classVerticalScroll);q.forEach(this.fields,b.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=m.getContentBox(this.tableInBodySection).w,b="100%";"number"===typeof a&&0<a&&(b=a+"px");m.setStyle(this.tableInHeadSection,"width",b)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();m.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=n("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=n("."+this._classRowUpDiv,a)[0])&&m.removeClass(a,this._classJimuStateDisabled);if(a=n("."+this._classLastSimpleTableRow,this.tbody)[0])(a=n("."+this._classRowDownDiv,a)[0])&&m.removeClass(a,this._classJimuStateDisabled);a=n("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);
q.forEach(a,b.hitch(this,function(a,b){0===b%2?m.addClass(a,"odd"):m.addClass(a,"even")}));if(0<a.length){var g=a[0];m.addClass(g,this._classFirstSimpleTableRow);(g=n("."+this._classRowUpDiv,g)[0])&&m.addClass(g,this._classJimuStateDisabled);a=a[a.length-1];m.addClass(a,this._classLastSimpleTableRow);(a=n("."+this._classRowDownDiv,a)[0])&&m.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,e){var g=null;return g=b.editable?this._createEditableTextTd(a,b,e):this._createNormalTextTd(a,
b,e)},_createNormalTextTd:function(a,b,e){var g=m.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');m.addClass(g,b.name);var c=n("div",g)[0];c.innerHTML=e||"";c.title=e||"";b["class"]&&m.addClass(g,b["class"]);m.place(g,a);return g},_createEditableTextTd:function(g,d,e){var f=m.toDom('\x3ctd class\x3d"editable-text-td '+d.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');
m.addClass(f,"simple-table-cell");m.place(f,g);d["class"]&&m.addClass(f,d["class"]);var c=n("div",f)[0],l=n("input",f)[0];c.innerHTML=e||"";""!==c.innerHTML&&(c.title=c.innerText||c.innerHTML);l.value=c.innerHTML;this.own(a(c,"dblclick",b.hitch(this,function(a){a.stopPropagation();l.value=c.innerText||c.innerHTML;m.setStyle(c,"display","none");m.setStyle(l,"display","inline");l.focus()})));this.own(a(l,"blur",b.hitch(this,function(){l.value=b.trim(l.value);var a=c.innerText||c.innerHTML,e=l.value;
""!==e?d.unique?0<this.getRowDataArrayByFieldValue(d.name,e,g).length?l.value=a:c.innerHTML=e:c.innerHTML=e:l.value=a;m.setStyle(l,"display","none");m.setStyle(c,"display","block")})));return f},_createRadioTd:function(a,b,e){var g=m.toDom('\x3ctd class\x3d"radio-td '+b.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');m.addClass(g,"simple-table-cell");m.place(g,a);b["class"]&&m.addClass(g,b["class"]);a=n("input",g)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;
a.checked=!0===e;return g},_createCheckboxTd:function(d,f,e){var l=m.toDom('\x3ctd class\x3d"checkbox-td '+f.name+'"\x3e\x3c/td\x3e');m.addClass(l,"simple-table-cell");m.place(l,d);f["class"]&&m.addClass(l,f["class"]);var c=new g({onChange:b.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(f.name);"function"===typeof f.onChange&&setTimeout(b.hitch(this,function(){f.onChange(d,c)}),200)})});this.own(a(c,"status-change",b.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(f.name)})));
this._setValueForCheckBox(c,e);c.placeAt(l);return l},_createActionsTd:function(g,d){var e=m.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');m.addClass(e,"simple-table-cell");var f=n(".action-item-parent",e)[0];m.place(e,g);d["class"]&&m.addClass(e,d["class"]);q.forEach(d.actions,b.hitch(this,function(c){"up"===c?(c=m.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},f),c.title=this.nls.moveUp,
this.own(a(c,"click",b.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(g)){a=n(".simple-table-row",this.tbody);var c=q.indexOf(a,g);if(0<c&&(a=a[c-1]))m.place(g,a,"before"),this.updateUI(),this.emit("row-up",g)}})))):"down"===c?(c=m.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},f),c.title=this.nls.moveDown,this.own(a(c,"click",b.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(g)){a=n(".simple-table-row",this.tbody);
var c=q.indexOf(a,g);if(c<a.length-1&&(a=a[c+1]))m.place(g,a,"after"),this.updateUI(),this.emit("row-down",g)}})))):"edit"===c?(c=m.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},f),c.title=this.nls.edit,this.own(a(c,"click",b.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(g)&&this._onActionsEdit(g)})))):"delete"===c&&(c=m.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},f),c.title=this.nls.deleteRow,
this.own(a(c,"click",b.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(g)&&this.deleteRow(g)}))))}));var c=this._calculateActionsWidth(d)+"px";m.setStyle(f,"width",c);return e},_calculateActionsWidth:function(a){return 20*q.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,b){var e=m.create("td",{"class":b.name},a);m.addClass(e,"simple-table-cell");m.addClass(e,"empty-text-td");b["class"]&&m.addClass(e,b["class"]);
return e},_createExtensionTd:function(a,b,e){a=m.create("td",{"class":b.name},a);m.addClass(a,"simple-table-cell");m.addClass(a,"extension-td");b["class"]&&m.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&"function"===typeof b.setValue&&b.setValue(a,e);return a},editRow:function(a,g){var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof g||!m.isDescendant(a,this.tbody))return e;var d=b.mixin([],this.fields),
d=q.filter(d,b.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),d=q.filter(d,b.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,g[c.name],a).length}));if(0<d.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=d,e;var c=n(".simple-table-cell",a);q.forEach(this.fields,b.hitch(this,function(a,b){if(g.hasOwnProperty(a.name)){var e=c[b],d=g[a.name],h=a.type;"text"===h?a.editable?this._editEditableText(e,a,d):this._editNormalText(e,
a,d):"radio"===h?this._editRadio(e,a,d):"checkbox"===h?this._editCheckbox(e,a,d):"extension"===h&&this._editExtension(e,a,d)}}));e.success=!0;e.tr=a;e.errorMessage=null;this._onEditRow(a);return e},_editNormalText:function(a,b,e){a=n("div",a)[0];a.innerHTML=e||"";a.title=a.innerHTML},_editEditableText:function(a,b,e){b=n("div",a)[0];b.innerHTML=e||"";n("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,e){n("input",a)[0].checked=!0===e},_editCheckbox:function(a,b,e){a=n(".jimu-checkbox",a)[0];
a=l.byNode(a);this._setValueForCheckBox(a,e)},_setValueForCheckBox:function(a,b){null===b?a.setStatus(!1):(a.setStatus(!0),b!==a.getValue()&&a.setValue(b))},_editExtension:function(a,b,e){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,e)},_getAllRows:function(){return n(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return q.filter(a,b.hitch(this,function(a){return!m.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return q.filter(a,
b.hitch(this,function(a){return m.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,g=n(".simple-table-row",this.tbody),g=q.filter(g,b.hitch(this,function(a){return!m.hasClass(a,"empty")&&m.hasClass(a,"jimu-state-active")}));0<g.length&&(a=g[0]);return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var g=this._getNotEmptyRows();a&&(g=q.filter(g,b.hitch(this,
function(b){return b!==a})));return q.map(g,b.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var g=null;if(a)g={};else return null;q.forEach(this.fields,b.hitch(this,function(b){var d=b.type;if("actions"!==d){var c=b.name;g[c]=null;var f=n(".simple-table-cell."+c,a)[0];f&&("text"===d?(b=n("div",f)[0],g[c]=b.innerText||b.innerHTML):"radio"===d?(b=n("input",f)[0],g[c]=b.checked):"checkbox"===d?(b=n(".jimu-checkbox",
f)[0],b=l.byNode(b),b.getStatus()?g[c]=b.getValue():g[c]=null):"extension"===d&&b.getValue&&"function"===typeof b.getValue&&(g[c]=b.getValue(f,b)))}}));return g},getRowDataArrayByFieldValue:function(a,g,e){var d=[];if(!this.fields||!q.some(this.fields,b.hitch(this,function(c){return c.name===a})))return[];e=this.getData(e);return d=q.filter(e,b.hitch(this,function(c){return c[a]==g}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&m.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",
a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,b){this.emit("row-delete",a,b)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},
onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(p,f,k,d,b,m,q,a,n,l){return p([q,a,m],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new n(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&d.addClass(this.domNode,"nested");k.forEach(this.tabs,function(b){this._createTab(b,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);l.setVerticalCenter(this.domNode)},_createTab:function(a,g){var h;h=d.create("div",{innerHTML:a.title,
"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":g+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);this.own(b(h,"click",f.hitch(this,this.onSelect,a.title)));h.label=a.title;this.controlNodes.push(h)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){k.forEach(this.controlNodes,
function(b){d.removeClass(b,"jimu-state-selected");b.label===a&&d.addClass(b,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(p,f,k,d,b){return p(b,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);d.forEach(this.views,f.hitch(this,function(b){1===b.nodeType?(k.place(b,
this.domNode),k.addClass(b,"view"),k.setStyle(b,"display","none")):b.domNode&&(k.place(b.domNode,this.domNode),k.addClass(b.domNode,"view"),k.setStyle(b.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var b="",d=this.getSelectedView();d&&(b=d.label);return b},getViewByLabel:function(b){for(var d=0;d<this.views.length;d++)if(b===this.views[d].label)return this.views[d];
return null},addView:function(b){this.views.push(b);1===b.nodeType?(k.place(b,this.domNode),k.addClass(b,"view")):b.domNode&&(k.place(b.domNode,this.domNode),k.addClass(b.domNode,"view"))},removeView:function(b){var f=this.views.length;this.views=d.filter(this.views,function(a){return b!==a});f!==this.views.length&&(1===b.nodeType?k.destroy(b):b.domNode&&b.destroyRecursive())},switchView:function(b){var d,a;d="number"===typeof b?this.views[b]:"string"===typeof b?this.getViewByLabel(b):b;this.views.forEach(f.hitch(this,
function(b){b&&(1===b.nodeType?a=b:b.domNode&&(a=b.domNode),b===d?(k.setStyle(a,"display","block"),b.domNode&&!b._started&&(b.startup(),b._started=!0)):k.setStyle(a,"display","none"))}));this._currentView=d;this.onViewSwitch(d)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s){return p([a,n,m],{templateString:l,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var b=q("td",this.tabTr);k.forEach(b,f.hitch(this,function(b,e){d.removeClass(b,"jimu-state-active");b.label===a&&(d.addClass(b,"jimu-state-active"),
this._currentIndex=e)}));this.controlNode.removeChild(this.controlTable);d.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=q("td:last-child",this.tabTr);0<b.length&&d.destroy(b[0])}0<k.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(b=d.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),
d.place(b,this.tabTr)))},removeTab:function(a){var b=-1;if(k.some(this.tabs,function(c,e){if(c.title===a)return b=e,!0})){var f=this.tabs.splice(b,1)[0],e=q("td",this.tabTr),l;k.some(e,function(c){if(c.label===a)return l=c,!0})&&d.destroy(l);this.viewStack.removeView(f.content)}},showShelter:function(){d.setStyle(this.shelter,"display","block")},hideShelter:function(){d.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new s(null,this.containerNode);k.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=d.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');d.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var h=d.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
h.label=a.title||"";d.place(h,this.tabTr);var l=q(".tab-item-div",h)[0];l.innerHTML=h.label;l.label=h.label;a.content.label=h.label;this.viewStack.addView(a.content);this.own(b(h,"click",f.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(p,f,k,d){return p([d],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(b){this._placeItem(b)}));this.resize()},_placeItem:function(b){b.domNode?k.place(b.domNode,this.domNode):k.place(b,this.domNode)},addItem:function(b){this.items.push(b);this._placeItem(b);this.resize()},addItems:function(b){this.items=this.items.concat(b);this.items.forEach(f.hitch(this,function(b){this._placeItem(b)}));this.resize()},removeItem:function(b){var d;
for(d=0;d<this.items.length;d++)if(this.items[d].label===b){this.items[d].domNode?this.items[d].destroy():k.destroy(this.items[d]);this.items.splice(d,1);this.resize();break}},empty:function(){var b;for(b=0;b<this.items.length;b++)this.items[b].domNode?this.items[b].destroy():k.destroy(this.items[b]);this.items=[]},resize:function(){var b,d,q;b=k.getMarginBox(this.domNode);d=this.getItemSize(b);q=Math.floor((b.w+this.hmargin)/(d.width+this.hmargin));this.items.forEach(f.hitch(this,function(a,b){this.setItemPosition(a,
b,d,q)}))},getItemSize:function(b){var d={},f;if("fixWidth"===this.strategy)d.width=this.itemSize.width,d.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(f=0;f<this.itemSize.length;f++){if(b.w<=this.itemSize[f].screenWidth){d.width=this.itemSize[f].width;d.height=this.itemSize[f].height;break}}else"fixCols"===this.strategy&&(d.width=(b.w-this.hmargin*(this.maxCols-1))/this.maxCols,d.height="number"===typeof this.itemSize.height?this.itemSize.height:d.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return d},setItemPosition:function(b,d,f,a){d++;var n=d%a;d=Math.ceil(d/a);0===n&&(n=a);a={position:"absolute",top:(this.vmargin+f.height)*(d-1)+"px"};a[window.isRTL?"right":"left"]=(this.hmargin+f.width)*(n-1)+"px";0<=f.width&&(a.width=f.width+"px");0<=f.height&&(a.height=f.height+"px");k.setStyle(b.domNode?b.domNode:b,a)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){return p([f,k,d,s],{templateString:b,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var a={};this.drawLayerId&&(a.id=this.drawLayerId);this.drawLayer=new h(a);this._initDefaultSymbols();this._initTypes();a=l(".draw-item",this.domNode);this.own(a.on("click",m.hitch(this,this._onItemClick)));this.own(n(this.btnClear,"click",m.hitch(this,this._onClickClear)));this.own(n(document.body,"keydown",m.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(n(document.body,"keyup",m.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);q.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable()},enable:function(){this._isDisabled=!1;q.addClass(this.domNode,"enabled");q.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;q.addClass(this.domNode,"disabled");q.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=l(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&
(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new r(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(n(this.drawToolBar,"draw-end",m.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=
a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();l(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var b=null,e=l(".draw-item",this.domNode);"TEXT"===a?(a="POINT",b=this.textIcon):(e=e.filter(function(b){return b.getAttribute("data-geotype")===
a}),0<e.length&&(b=e[0]));b&&this._activate(b)},onIconSelected:function(a,b,e){this.emit("icon-selected",a,b,e)},onDrawEnd:function(a,b,e,g,d,f){this.emit("draw-end",a,b,e,g,d,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){q.removeClass(this.domNode,
"hidden")},hide:function(){q.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return l(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},g={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",
outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=e.fromJson(a));this.polylineSymbol||(this.polylineSymbol=e.fromJson(b));this.polygonSymbol||(this.polygonSymbol=e.fromJson(g))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&
(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var c=l(".draw-item",this.domNode);c.style("display","none");a.forEach(c,m.hitch(this,function(c){var b=c.getAttribute("data-geotype"),b=0<=a.indexOf(this.geoTypes,b);q.setStyle(c,"display",b?"block":"none")}))},
_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,q.hasClass(a,"draw-item")&&(q.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){l(".draw-item",this.domNode).removeClass("jimu-state-active");q.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),e=a.getAttribute("data-commontype"),g=r[b];"TEXT"===b&&(g=r.POINT);this.disableWebMapPopup();this.drawToolBar.activate(g);this.emit("draw-activate",g);this.onIconSelected(a,b,e)},
_onDrawEnd:function(a){var b=l(".draw-item.jimu-state-active",this.domNode)[0],e=b.getAttribute("data-geotype"),b=b.getAttribute("data-commontype"),d=null,d="extent"===a.geometry.type?t.fromExtent(a.geometry):a.geometry;d.geoType=e;d.commonType=b;a=d.type;var f=null,f="point"===a||"multipoint"===a?q.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,d=new g(d,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();
this.drawLayer.add(d);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(d,e,b,this._shiftKey,this._ctrlKey,this._metaKey)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C){var E=p(e,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(e,g){this.markerSymbol=new t(t.STYLE_SOLID,10,new c(c.STYLE_SOLID,new b([255,0,0]),2),new b([0,0,0,0.25]));this.lineSymbol=new c(c.STYLE_SOLID,new b([255,0,0]),2);this.fillSymbol=new u(u.STYLE_SOLID,new c(c.STYLE_SOLID,new b([255,0,0]),2),new b([0,0,0,0.25]));this._points=[];this._mouse=!q("esri-touch")&&!q("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),g||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,c){this._geometryType&&this.deactivate();var b=this.map,e=d.connect,g=E;this._options=f.mixin(f.mixin({},this._options),c||{});b.navigationManager.setImmediateClick(!1);switch(a){case g.ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:case g.UP_ARROW:case g.DOWN_ARROW:case g.TRIANGLE:case g.CIRCLE:case g.ELLIPSE:case g.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=e(b,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=e(b,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(b,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(b,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=e(b,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(b,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(b,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&
(this._onMouseDownHandler2_connect=e(b,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(b,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(b,"onSwipeEnd",this._onMouseUpHandler));break;case g.POINT:this._onClickHandler_connect=e(b,"onClick",this._onClickHandler);break;case g.LINE:case g.EXTENT:case g.FREEHAND_POLYLINE:case g.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=e(b,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=e(b,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(b,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=e(b,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(b,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(b,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&(this._onMouseDownHandler2_connect=e(b,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=e(b,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(b,"onSwipeEnd",this._onMouseUpHandler));break;case g.POLYLINE:case g.POLYGON:case g.MULTI_POINT:b.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=e(b,"onClick",this._onClickHandler);this._onDblClickHandler_connect=e(b,"onDblClick",this._onDblClickHandler);this._dblClickZoom=b.isDoubleClickZoom;b.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=e(b,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=e(b,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);b.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(b.snappingManager._startSelectionLayerQuery(),b.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var c=d.disconnect;c(this._onMouseMoveHandler_connect);
c(this._onMouseDownHandler_connect);c(this._onMouseDragHandler_connect);c(this._onMouseUpHandler_connect);c(this._onMouseDownHandler2_connect);c(this._onMouseDragHandler2_connect);c(this._onMouseUpHandler2_connect);c(this._onClickHandler_connect);c(this._onDblClickHandler_connect);c(this._onKeyDown_connect);c(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case E.CIRCLE:case E.ELLIPSE:case E.TRIANGLE:case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.RECTANGLE:case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case E.POLYLINE:case E.POLYGON:case E.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}c=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(c)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,c=this._points,b=this.map.spatialReference,e=E,c=c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length)return;a=new w(b);a.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||3>c.length)return;a=new B(b);c=[].concat(c,[c[0].offset(0,0)]);!B.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse());
a.addRing(c);break;case e.MULTI_POINT:a=new A(b),k.forEach(c,function(c){a.addPoint(c)})}d.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var c=this.map.spatialReference,b;this.onDrawEnd(a);c&&(c.isWebMercator()?b=x.webMercatorToGeographic(a,!0):4326===c.wkid&&(b=y.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:b})}},_normalizeRect:function(a,c,b){var e=a.x;a=a.y;var g=c.x;c=c.y;var d=Math.abs(e-
g),f=Math.abs(a-c);return{x:Math.min(e,g),y:Math.max(a,c),width:d,height:f,spatialReference:b}},_onMouseDownHandler:function(a){this._dragged=!1;var c;this.map.snappingManager&&(c=this.map.snappingManager._snappingPoint);var b=c||a.mapPoint,e=E;c=this.map;var g=c.spatialReference;this._points.push(b.offset(0,0));switch(this._geometryType){case e.LINE:this._graphic=c.graphics.add(new v(new w({paths:[[[b.x,b.y],[b.x,b.y]]],spatialReference:g}),this.lineSymbol),!0);c.snappingManager&&c.snappingManager._setGraphic(this._graphic);
break;case e.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;b=new w(g);b.addPath(this._points);this._graphic=c.graphics.add(new v(b,this.lineSymbol),!0);c.snappingManager&&c.snappingManager._setGraphic(this._graphic);break;case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:case e.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,b=new B(g),b.addRing(this._points),this._graphic=c.graphics.add(new v(b,this.fillSymbol),
!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic)}q("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var c;this.map.snappingManager&&(c=this.map.snappingManager._snappingPoint);var b=this._points[this._points.length-1];a=c||a.mapPoint;c=this._tGraphic;var e=c.geometry;switch(this._geometryType){case E.POLYLINE:case E.POLYGON:e.setPoint(0,0,{x:b.x,y:b.y}),e.setPoint(0,1,{x:a.x,y:a.y}),c.setGeometry(e)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(q("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var c;this.map.snappingManager&&(c=this.map.snappingManager._snappingPoint);var b=this._points[0],e=c||a.mapPoint,g=this.map,d=g.spatialReference;c=this._graphic;var h=E,l=g.toScreen(b),m=g.toScreen(e),n=[],n=m.x-l.x,m=m.y-l.y,k=Math.sqrt(n*n+m*m);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();c.geometry=B.createCircle({center:l,r:k,numberOfPoints:60,map:g});c.setGeometry(c.geometry);break;case h.ELLIPSE:this._hideTooltip();
c.geometry=B.createEllipse({center:l,longAxis:n,shortAxis:m,numberOfPoints:60,map:g});c.setGeometry(c.geometry);break;case h.TRIANGLE:this._hideTooltip();n=[[0,-k],[0.8660254037844386*k,0.5*k],[-0.8660254037844386*k,0.5*k],[0,-k]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.ARROW:this._hideTooltip();b=m/k;g=n/k;e=0.25*g*k;d=0.25*k/(m/n);k*=0.25*b;n=[[n,m],[n-e*(1+24/d),m+24*g-k],[n-e*(1+12/d),m+12*g-k],[-12*b,12*g],[12*b,-12*g],[n-e*(1-12/d),m-12*g-k],[n-e*(1-24/d),
m-24*g-k],[n,m]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.LEFT_ARROW:this._hideTooltip();n=0>=n?[[n,0],[0.75*n,m],[0.75*n,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*n,-0.5*m],[0.75*n,-m],[n,0]]:[[0,0],[0.25*n,m],[0.25*n,0.5*m],[n,0.5*m],[n,-0.5*m],[0.25*n,-0.5*m],[0.25*n,-m],[0,0]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();n=0<=n?[[n,0],[0.75*n,m],[0.75*n,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*n,-0.5*m],[0.75*
n,-m],[n,0]]:[[0,0],[0.25*n,m],[0.25*n,0.5*m],[n,0.5*m],[n,-0.5*m],[0.25*n,-0.5*m],[0.25*n,-m],[0,0]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.UP_ARROW:this._hideTooltip();n=0>=m?[[0,m],[-n,0.75*m],[-0.5*n,0.75*m],[-0.5*n,0],[0.5*n,0],[0.5*n,0.75*m],[n,0.75*m],[0,m]]:[[0,0],[-n,0.25*m],[-0.5*n,0.25*m],[-0.5*n,m],[0.5*n,m],[0.5*n,0.25*m],[n,0.25*m],[0,0]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.DOWN_ARROW:this._hideTooltip();
n=0<=m?[[0,m],[-n,0.75*m],[-0.5*n,0.75*m],[-0.5*n,0],[0.5*n,0],[0.5*n,0.75*m],[n,0.75*m],[0,m]]:[[0,0],[-n,0.25*m],[-0.5*n,0.25*m],[-0.5*n,m],[0.5*n,m],[0.5*n,0.25*m],[n,0.25*m],[0,0]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.RECTANGLE:this._hideTooltip();n=[[0,0],[n,0],[n,m],[0,m],[0,0]];c.geometry=this._toPolygon(n,l.x,l.y);c.setGeometry(c.geometry);break;case h.LINE:c.setGeometry(f.mixin(c.geometry,{paths:[[[b.x,b.y],[e.x,e.y]]]}));break;case h.EXTENT:c&&g.graphics.remove(c,
!0);c=new D(this._normalizeRect(b,e,d));c._originOnly=!0;this._graphic=g.graphics.add(new v(c,this.fillSymbol),!0);g.snappingManager&&g.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));c.geometry._insertPoints([e.offset(0,0)],0);c.setGeometry(c.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&
a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));c.geometry._insertPoints([e.offset(0,0)],0);c.setGeometry(c.geometry)}q("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var c=this._oldPoint.x-a.screenPoint.x,b=this._oldPoint.y-a.screenPoint.y,e=this._options.tolerance;if((0>c?-1*c:c)<e&&(0>b?-1*b:b)<e)return!1;c=new Date;if(c-this._startTime<this._options.drawTime)return!1;this._startTime=c;this._oldPoint=a.screenPoint;return!0},
_onMouseUpHandler:function(a){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var c;this.map.snappingManager&&(c=this.map.snappingManager._snappingPoint);var b=this._points[0];c=c||a.mapPoint;var e=this.map.spatialReference,g=E,d;switch(this._geometryType){case g.CIRCLE:case g.ELLIPSE:case g.TRIANGLE:case g.ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:case g.UP_ARROW:case g.DOWN_ARROW:case g.RECTANGLE:d=this._graphic.geometry;break;
case g.LINE:d=new w({paths:[[[b.x,b.y],[c.x,c.y]]],spatialReference:e});break;case g.EXTENT:d=(new D(this._normalizeRect(b,c,e))).getExtent();break;case g.FREEHAND_POLYLINE:d=new w(e);d.addPath([].concat(this._points,[c.offset(0,0)]));break;case g.FREEHAND_POLYGON:d=new B(e),b=[].concat(this._points,[c.offset(0,0),this._points[0].offset(0,0)]),!B.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
b.reverse()),d.addRing(b)}q("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(d)}},_onClickHandler:function(a){var c;this.map.snappingManager&&(c=this.map.snappingManager._snappingPoint);a=c||a.mapPoint;c=this.map;var b=c.toScreen(a),e=E;this._points.push(a.offset(0,0));switch(this._geometryType){case e.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case e.POLYLINE:1===this._points.length?(b=new w(c.spatialReference),b.addPath(this._points),this._graphic=c.graphics.add(new v(b,
this.lineSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=d.connect(c,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=c.graphics.add(new v(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:c.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),c=this._tGraphic,b=c.geometry,b.setPoint(0,0,a.offset(0,0)),b.setPoint(0,
1,a.offset(0,0)),c.setGeometry(b));break;case e.POLYGON:1===this._points.length?(b=new B(c.spatialReference),b.addRing(this._points),this._graphic=c.graphics.add(new v(b,this.fillSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=d.connect(c,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=c.graphics.add(new v(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:c.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),c=this._tGraphic,b=c.geometry,b.setPoint(0,0,a.offset(0,0)),b.setPoint(0,1,a.offset(0,0)),c.setGeometry(b));break;case e.MULTI_POINT:a=this._points;1===a.length?(b=new A(c.spatialReference),b.addPoint(a[a.length-1]),this._graphic=c.graphics.add(new v(b,this.markerSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case e.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],b.x,b.y);break;case e.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],b.x,b.y);break;case e.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],b.x,b.y);break;case e.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],b.x,b.y);break;case e.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],b.x,b.y);break;case e.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],b.x,b.y);break;case e.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],b.x-48,b.y+48);break;case e.CIRCLE:this._clear();this._drawEnd(B.createCircle({center:b,r:48,numberOfPoints:60,map:c}));break;case e.ELLIPSE:this._clear(),this._drawEnd(B.createEllipse({center:b,longAxis:48,shortAxis:24,numberOfPoints:60,
map:c}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,c,b){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,c,b))},_toPolygon:function(a,c,b){var e=this.map,g=new B(e.spatialReference);g.addRing(k.map(a,function(a){return e.toMap({x:a[0]+c,y:a[1]+b})}));return g},_onDblClickHandler:function(a){var c,b=this._points,e=this.map.spatialReference,g=E;q("esri-touch")&&b.push(a.mapPoint);var f=b[b.length-1],h=b[b.length-2],b=f&&h&&f.x===h.x&&f.y===h.y?b.slice(0,
b.length-1):b.slice(0,b.length);switch(this._geometryType){case g.POLYLINE:if(!this._graphic||2>b.length){d.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}c=new w(e);c.addPath([].concat(b));break;case g.POLYGON:if(!this._graphic||2>b.length){d.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}c=new B(e);a=[].concat(b,[b[0].offset(0,0)]);!B.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());c.addRing(a);break;case g.MULTI_POINT:c=new A(e),k.forEach(b,function(a){c.addPoint(a)})}d.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(c)},_onKeyDownHandler:function(a){a.keyCode===n.ESCAPE&&(d.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||
(this._tooltip=l.create("div",{"class":"tooltip"},this.map.container),g.isBodyLtr()||s.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=d.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=d.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=d.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(d.disconnect(this._onTooltipMouseEnterHandler_connect),d.disconnect(this._onTooltipMouseLeaveHandler_connect),d.disconnect(this._onTooltipMouseMoveHandler_connect),l.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var c=this._tooltip;if(c){var b="";switch(this._geometryType){case E.POINT:b=C.toolbars.draw.addPoint;break;case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.TRIANGLE:case E.RECTANGLE:case E.CIRCLE:case E.ELLIPSE:b=
C.toolbars.draw.addShape;break;case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:b=C.toolbars.draw.freehand;break;case E.POLYLINE:case E.POLYGON:b=C.toolbars.draw.start;1===a?b=C.toolbars.draw.resume:2<=a&&(b=C.toolbars.draw.complete);break;case E.MULTI_POINT:b=C.toolbars.draw.addMultipoint,1<=a&&(b=C.toolbars.draw.finish)}c.innerHTML=b}},_updateTooltip:function(a){var c=this._tooltip;if(c){var b;a.clientX||a.pageY?(b=a.clientX,a=a.clientY):(b=a.clientX+m.body().scrollLeft-
m.body().clientLeft,a=a.clientY+m.body().scrollTop-m.body().clientTop);c.style.display="none";s.set(c,{left:b+this._options.tooltipOffset+"px",top:a+"px"});c.style.display=""}},_redrawGraphic:function(a,c,b,e){if(b||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});f.mixin(E,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return E})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(p,f,k,d,b){return p([b],{declaredClass:"esri.toolbars._Toolbar",constructor:function(b){this.map=
b},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(b,d,a,f){var l=this.map;b&&(this._mapNavState={isDoubleClickZoom:l.isDoubleClickZoom,isClickRecenter:l.isClickRecenter,isPan:l.isPan,isRubberBandZoom:l.isRubberBandZoom,isKeyboardNavigation:l.isKeyboardNavigation,isScrollWheelZoom:l.isScrollWheelZoom},l.disableDoubleClickZoom(),
l.disableClickRecenter(),l.disablePan(),l.disableRubberBandZoom(),l.disableKeyboardNavigation());d&&l.hideZoomSlider();a&&l.hidePanArrows();f&&l.graphics.disableMouseEvents()},_activateMapTools:function(b,d,a,f){var l=this.map,k=this._mapNavState;b&&k&&(k.isDoubleClickZoom&&l.enableDoubleClickZoom(),k.isClickRecenter&&l.enableClickRecenter(),k.isPan&&l.enablePan(),k.isRubberBandZoom&&l.enableRubberBandZoom(),k.isKeyboardNavigation&&l.enableKeyboardNavigation(),k.isScrollWheelZoom&&l.enableScrollWheelZoom());
d&&l.showZoomSlider();a&&l.showPanArrows();f&&l.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(p,f,k,d){return p([k],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(b){if(isFinite(b))return!1;var f="^"+d.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=RegExp(f,"g").test(b);return this.rest?(b=/\/rest\/services/gi.test(b),f&&b):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(p,f,k){var d=p.getObject("validate.regexp",!0,k);return d=k.validate.regexp={ipAddress:function(b){b=
"object"==typeof b?b:{};"boolean"!=typeof b.allowDottedDecimal&&(b.allowDottedDecimal=!0);"boolean"!=typeof b.allowDottedHex&&(b.allowDottedHex=!0);"boolean"!=typeof b.allowDottedOctal&&(b.allowDottedOctal=!0);"boolean"!=typeof b.allowDecimal&&(b.allowDecimal=!0);"boolean"!=typeof b.allowHex&&(b.allowHex=!0);"boolean"!=typeof b.allowIPv6&&(b.allowIPv6=!0);"boolean"!=typeof b.allowHybrid&&(b.allowHybrid=!0);var d=[];b.allowDottedDecimal&&d.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
b.allowDottedHex&&d.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");b.allowDottedOctal&&d.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");b.allowDecimal&&d.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");b.allowHex&&d.push("0[xX]0*[\\da-fA-F]{1,8}");b.allowIPv6&&d.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");b.allowHybrid&&d.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
b="";0<d.length&&(b="("+d.join("|")+")");return b},host:function(b){b="object"==typeof b?b:{};"boolean"!=typeof b.allowIP&&(b.allowIP=!0);"boolean"!=typeof b.allowLocal&&(b.allowLocal=!1);"boolean"!=typeof b.allowPort&&(b.allowPort=!0);"boolean"!=typeof b.allowNamed&&(b.allowNamed=!1);var f=b.allowPort?"(\\:\\d+)?":"",k="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";b.allowIP&&(k+="|"+d.ipAddress(b));b.allowLocal&&(k+="|localhost");
b.allowNamed&&(k+="|^[^-][a-zA-Z0-9_-]*");return"("+k+")"+f},url:function(b){b="object"==typeof b?b:{};"scheme"in b||(b.scheme=[!0,!1]);return f.buildGroupRE(b.scheme,function(b){return b?"(https?|ftps?)\\://":""})+d.host(b)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(b){b="object"==typeof b?b:{};"boolean"!=typeof b.allowCruft&&(b.allowCruft=!1);b.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+d.host(b);
b.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(b){b="object"==typeof b?b:{};"string"!=typeof b.listSeparator&&(b.listSeparator="\\s;,");var f=d.emailAddress(b);return"("+f+"\\s*["+b.listSeparator+"]\\s*)*"+f+"\\s*["+b.listSeparator+"]?\\s*"},numberFormat:function(b){b="object"==typeof b?b:{};"undefined"==typeof b.format&&(b.format="###-###-####");return f.buildGroupRE(b.format,function(b){return f.escapeString(b,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(b){b="object"==typeof b?b:{};"boolean"!=typeof b.allowTerritories&&(b.allowTerritories=!0);"boolean"!=typeof b.allowMilitary&&(b.allowMilitary=!0);var d="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";b.allowTerritories&&(d+="|AS|FM|GU|MH|MP|PW|PR|VI");
b.allowMilitary&&(d+="|AA|AE|AP");return"("+d+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/EditorColorPalette jimu/dijit/ColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r){return p([f,k,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",
_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",appearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showCoustomRecord:!0},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);this.value=this.value?new a(this.value):new a("#fff");this._createContent()},_createContent:function(){var a=m.create("div",{"class":"jimu-colorpalette"},this.domNode);this.appearance.showTransparent&&this._createSpecialColors(a);this.appearance.showColorPalette&&
this._createDojoColorPalette(a);this.appearance.showCoustom&&this._createJimuColorPicker(a);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(a)},setColor:function(b,g,c){if(!this._isColorEqual(b)||c){this.value=new a(b);this._setSpatialColor(this.value);if("undefined"!==typeof this.value.a&&0===this.value.a){if(this.palette.set("value",new a("transparent")),this.picker.setColor(new a("#fff"),!1),"undefined"===typeof g||!0===g)this.onChange(this.value)}else if(this.picker.setColor(this.value,
!1),this.palette.set("value",this.value.toHex()),"undefined"===typeof g||!0===g)this.onChange(this.value.toHex());this.colorRecords&&this.colorRecords.selecteColor(this.value)}},getColor:function(){return this.value},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){h.close(this.tooltipDialog);this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(a){a=m.create("div",{"class":"special-color"},a);this.transparentBtn=m.create("div",
{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(q(this.transparentBtn,"click",b.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new a("transparent"))},_setSpatialColor:function(a){if(this.transparentBtn){var b=n(".btn-wapper",this.transparentBtn)[0];
m.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&m.addClass(b,"selected")}},_createDojoColorPalette:function(e){this.palette=new l({});this.palette.placeAt(e);this.own(q(this.palette,"change",b.hitch(this,function(b){b=new a(b);this.setColor(b)})))},_createJimuColorPicker:function(e){this.coustomtBtn=m.create("div",{"class":"coustom btn"},e);e='\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+
this.nls.custom+"\x3c/div\x3e\x3c/div\x3e";this.picker=new s({ensureMode:!0,showOk:!1,showLabel:!1,value:this.value.toHex(),onChange:b.hitch(this,function(b){b=new a(b);this.setColor(b);this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(b)})});this.picker.placeAt(this.coustomtBtn);this.picker.setLabel(e);this.picker.setColor(this.value,!1)},_createCoustomRecord:function(e){this.colorRecords=new g({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(e);this.own(q(this.colorRecords,
"choose",b.hitch(this,function(b){this.setColor(new a(b))})))},_isColorEqual:function(b){return this.value.toString()===(new a(b)).toString()?!0:!1},_changeLabel:function(a){m.empty(this.domNode);m.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:r.invertColor(a.toHex())}},this.domNode)}})})},"jimu/dijit/EditorColorPalette":function(){define("require dojo/text!./templates/EditorColorPalette.html dijit/_Widget dijit/_TemplatedMixin dijit/_PaletteMixin dijit/hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s){var g=n("dijit.ColorPalette",[k,d,b],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,e,g){return new this._dyeClass(a,b,e,g)},buildRendering:function(){this.inherited(arguments);this._dyeClass=n(g._Color,
{palette:this.palette});this._preparePalette(this._palettes[this.palette],q.getLocalization("dojo","colors",this.lang))}});g._Color=n("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch'style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}'style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":p.toUrl("./themes/a11y/colors7x10.png"),"3x4":p.toUrl("./themes/a11y/colors3x4.png")},constructor:function(b,g,e,d){this._row=g;this._col=e;d?(this._title=d,this.setColor(a.named[b])):"rgb(0,0,1)"===b&&(this._title="black",this.setColor([0,0,1]))},getValue:function(){return this.toHex()},fillCell:function(a,b){var e=s.substitute(m("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:b,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),
left:-20*this._col-5,top:-20*this._row-5,size:"7x10"===this.palette?"height: 145px; width: 206px":"height: 64px; width: 86px"});l.place(e,a)}});return g})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(p,f,k,d,b,m,q,a,n,l,s){return p("dijit._PaletteMixin",a,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",
cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==typeof this.dyeClass?m.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,f){this._cells=[];var l=this._blankGif;this.own(q(this.gridNode,n,m.hitch(this,"_onCellClick")));for(var e=0;e<a.length;e++)for(var k=d.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),c=0;c<a[e].length;c++){var u=a[e][c];if(u){var p=this._dyeFactory(u,e,c,f[u]),u=d.create("td",{"class":this.cellClass,tabIndex:"-1",
title:f[u],role:"gridcell"},k);p.fillCell(u,l);u.idx=this._cells.length;this._cells.push({node:u,dye:p})}}this._xDim=a[0].length;this._yDim=a.length;var y={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},x;for(x in y)this.own(s.addKeyListener(this.domNode,{keyCode:b[x],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=y[x];return function(c){this._navigateByKey(a,c)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);
this._setCurrent(this._cells[0].node)},focus:function(){l.focus(this._currentFocus)},_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var d=this._getDye(b).getValue();this._setCurrent(b);l.focus(b);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&f.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,
b){0<=this._selectedCell&&k.remove(this._cells[this._selectedCell].node,this.cellClass+"Selected");this._selectedCell=-1;if(a)for(var d=0;d<this._cells.length;d++)if(a==this._cells[d].dye.getValue()){this._selectedCell=d;k.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,b){if(-1!=b){var d=this._currentFocus.idx+a;d<this._cells.length&&-1<d&&(d=this._cells[d].node,
this._setCurrent(d),this.defer(m.hitch(l,"focus",d)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g){return f([k,d,b,p],{templateString:g,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",
uid:"",recordsLength:10,colorList:null,postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new l(a);for(var b=null,e=n("td",this.domNode),g=0,c=e.length;g<c;g++)q.removeClass(e[g],"dijitPaletteCellSelected");g=0;for(c=e.length;g<c;g++)if(a.toString()===
q.getAttr(e[g],"title")){b=e[g];break}b&&(q.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var e=this.colorList[a].toString();q.setAttr(b,"title",e);b=this._findImg(b);q.setStyle(b,"background-color",e);q.setAttr(b,"alt",e);q.setAttr(b,"title",e)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var b=
0;b<this.recordsLength;b++){this["record"+b]=q.create("td",{"class":"dijitPaletteCell",tabindex:b,title:"",role:"gridcell"},this.container);var g=q.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);q.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},g);this.own(a(this["record"+b],"click",m.hitch(this,this.onRecordClick)))}},onRecordClick:function(a){var b="";if(a=this._findImg(a.srcElement||a.targe||
a.currentTarget))b=q.getStyle(a,"background-color"),b=(new l(b)).toString(),this.onChoose(b)},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=n(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],e=0,g=this.recordsLength;e<g;e++){var c=this.colorList[e];c&&c.toString&&(b[e]=c.toString())}this._cleanCookie(a);try{var d=JSON.stringify(b);s(a,d,{expires:1E3,path:"/"})}catch(f){console.error("ColorRecords: cookieList JSON.stringify error."+
f.stack)}},_getCookie:function(a){a=s(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var e=this.recordsLength;a<e;a++){var g=b[a];g&&g.toString&&(this.colorList[a]=new l(g.toString()))}}}catch(c){console.error("ColorRecords: cookieList JSON.parse error."+c.stack)}},_cleanCookie:function(a){s(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(p,f,k,d,b,m,q,a,n){return p([q,m],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(k.removeClass(this.foldableNode,"fold-down"),k.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation();"touchstart"===a.type&&a.preventDefault()},_normalizePositionObj:function(a){var b=
this._getLayoutBox();a.left=isFinite(a.left)?a.left:b.w-a.right;a.top=isFinite(a.top)?a.top:b.h-a.bottom;delete a.right;delete a.bottom;this.position=f.mixin(f.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new n({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,m){this.disableMoveable();var g=k.getMarginBox(jimuConfig.layoutId);g.l=g.l-a+m;g.w+=2*(a-m);this.moveable=new b.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(d(this.moveable,
"Moving",f.hitch(this,this.onMoving)));this.own(d(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){k.removeClass(this.titleNode,"title-normal");k.addClass(this.titleNode,"title-full");k.setStyle(this.foldableNode,"display",
"block");k.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down")):(k.removeClass(this.foldableNode,"fold-down"),k.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){k.removeClass(this.titleNode,"title-full");k.addClass(this.titleNode,"title-normal");k.setStyle(this.foldableNode,"display","none");k.setStyle(this.maxNode,"display","none")},resize:function(a){var b=this._getPositionInfo(),
g={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,g.left=isFinite(a.l)?a.l:g.left,g.top=isFinite(a.t)?a.t:g.top,g.width=isFinite(a.w)?a.w:g.width,g.height=isFinite(a.h)?a.h:g.height,this._normalizePositionObj(f.clone(g)),this.makePositionInfoBox(),g.width=this._positionInfoBox.w,g.height=this._positionInfoBox.h);b.position=g;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return k.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},b=this._getLayoutBox(),g=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;window.isRTL?(a.position.left=b.w-g,a.position.left+this._positionInfoBox.w>b.w&&(a.position.left-=this._positionInfoBox.w,0>a.position.left&&(a.position.left=b.w-this._positionInfoBox.w))):(a.position.left=g,a.position.left+
this._positionInfoBox.w>b.w&&(a.position.left=b.w>this._positionInfoBox.w?b.w-this._positionInfoBox.w:0));g=this._positionInfoBox.t;b=b.h-g;g>=b?g>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):b>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t+40+3);return a},_setMobilePosition:function(){window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.layoutId))&&k.place(this.domNode,jimuConfig.layoutId);var b=
this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(b.zIndex=this.position.zIndex);var d=a.getPositionStyle(b);f.mixin(d,b.borderRadiusStyle);k.setStyle(this.domNode,d)},_setDesktopPosition:function(a){!window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.mapId))&&k.place(this.domNode,jimuConfig.mapId);k.setStyle(this.domNode,{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||
this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){k.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){k.setStyle(a.node,"opacity",1);a=k.getMarginBox(a.node);this._normalizePositionObj(f.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c){p.experimental("dojox.layout.ResizeHandle");var u=h("dojox.layout._ResizeHelper",t,{show:function(){g.set(this.domNode,"display","")},hide:function(){g.set(this.domNode,"display","none")},resize:function(a){s.setMarginBox(this.domNode,a)}});return h("dojox.layout.ResizeHandle",[t,c],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,r.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=e.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new u({id:"dojoxGlobalResizeHelper"})).placeAt(q.body()),
l.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(l.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(k.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=e.byId(this.targetId))?this.targetWidget.domNode:n.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var c=s.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:c.x,t:c.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var c=g.getComputedStyle(this.targetDomNode),d="border-model"===s.boxModel?{w:0,h:0}:s.getPadBorderExtents(this.targetDomNode,c),f=s.getMarginExtents(this.targetDomNode,c);this.startSize={w:g.get(this.targetDomNode,"width",c),h:g.get(this.targetDomNode,"height",c),pbw:d.w,pbh:d.h,mw:f.w,mh:f.h};!this.isLeftToRight()&&"absolute"==g.get(this.targetDomNode,"position")&&(c=s.position(this.targetDomNode,!0),this.startPosition={l:c.x,t:c.y});this._pconnects=[k.connect(q.doc,r.move,this,"_updateSizing"),
k.connect(q.doc,r.release,this,"_endSizing")];b.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var c=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===c)return;this._resizeHelper.resize(c)}a.preventDefault()},_getNewCoords:function(a,c,b){try{if(!a.clientX||!a.clientY)return!1}catch(e){return!1}this._activeResizeLastEvent=a;var g=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),d=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
g:0);d=this._checkConstraints(a,this.startSize.h-(this._resizeY?d:0));if((b=b||this.startPosition)&&this._resizeX)d.l=b.l+g,d.w!=a&&(d.l+=a-d.w),d.t=b.t;switch(c){case "margin":d.w+=this.startSize.mw,d.h+=this.startSize.mh;case "border":d.w+=this.startSize.pbw,d.h+=this.startSize.pbh}return d},_checkConstraints:function(a,c){if(this.minSize){var b=this.minSize;a<b.w&&(a=b.w);c<b.h&&(c=b.h)}this.constrainMax&&this.maxSize&&(b=this.maxSize,a>b.w&&(a=b.w),c>b.h&&(c=b.h));if(this.fixedAspect){var b=this.startSize.w,
e=this.startSize.h,g=b*c-e*a;0>g?a=c*b/e:0<g&&(c=a*e/b)}return{w:a,h:c}},_changeSizing:function(c){var b=this.targetWidget&&f.isFunction(this.targetWidget.resize),e=this._getNewCoords(c,b&&"margin");if(!1!==e&&(b?this.targetWidget.resize(e):this.animateSizing?a[this.animateMethod]([m.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:e.w}},duration:this.animateDuration}),m.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:e.h}},
duration:this.animateDuration})]).play():g.set(this.targetDomNode,{width:e.w+"px",height:e.h+"px"}),this.intermediateChanges))this.onResize(c)},_endSizing:function(a){d.forEach(this._pconnects,k.disconnect);var c=f.partial(k.publish,this.endTopic,[this]);this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils ./LayerInfo ./LayerInfoFactory".split(" "),
function(p,f,k,d,b,m){return p(b,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var b=[],a;f.forEach(this.originOperLayer.featureCollection.layers,function(a){b=b.concat(a.layerObject.graphics)});0===b.length?a=null:(a=1===b.length?b[0].getLayer().fullExtent:d.graphicsExtent(b),a=this._convertGeometryToMapSpatialRef(a));return a},_resetLayerObjectVisiblity:function(b){var a=b?b[this.id]:null;a&&(f.forEach(this.newSubLayers,
function(a){var d=b?b[a.id]:null;d&&a.layerObject.setVisibility(d.visible)},this),this._setTopLayerVisible(a.visible))},initVisible:function(){var b=!1,a;for(a=0;a<this.newSubLayers.length;a++)b=b||this.newSubLayers[a].layerObject.visible;b&&(this._visible=!0)},_setTopLayerVisible:function(b){this._visible=b?!0:!1;f.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var b=[];f.forEach(this.originOperLayer.featureCollection.layers,
function(a){this._getLayerIndexesInMapByLayerId(a.layerObject.id)&&(k.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,a.layerObject),a=m.getInstance().create({layerObject:a.layerObject,title:a.layerObject.label||a.layerObject.title||a.layerObject.name||a.layerObject.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:this.originOperLayer.featureCollection.showLegend,parentLayerInfo:this}),b.push(a),a.init())},this);
b.reverse();return b},_obtainLayerIndexesInMap:function(){var b=[],a,d;for(d=0;d<this.newSubLayers.length;d++)(a=this._getLayerIndexesInMapByLayerId(this.newSubLayers[d].layerObject.id))&&b.push(a);return b},moveLeftOfIndex:function(b){var a;for(a=this.newSubLayers.length-1;0<=a;a--)this.map.reorderLayer(this.newSubLayers[a].layerObject,b)},moveRightOfIndex:function(b){var a;for(a=0;a<this.newSubLayers.length;a++)this.map.reorderLayer(this.newSubLayers[a].layerObject,b)},_getShowLegendOfWebmap:function(){return void 0!==
this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var b=this.getSubLayers();return b[0]?b[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect jimu/portalUrlUtils jimu/portalUtils esri/request esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e){var t=p(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,constructor:function(a,b){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;this._eventHandles=[]},init:function(){this.newSubLayers=
this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=
this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){f.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),e=0;e<b.length;e++)if(b[e].traversal(a))return!0},findLayerInfoById:function(a){var b=null,e=0;if(this.id&&this.id===a)return this;
for(e=0;e<this.newSubLayers.length&&!(b=this.newSubLayers[e].findLayerInfoById(a));e++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer&&b&&this._resetLayerObjectVisiblity(a)},initVisible:function(){},isVisible:function(){return this._visible?!0:!1},
_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(a){var b=new d;if(this.map.spatialReference.equals(a.spatialReference))return b.resolve([a]),
b;if(this.map.spatialReference.isWebMercator()&&a.spatialReference.equals(new r(4326)))return b.resolve([e.geographicToWebMercator(a)]),b;if(this.map.spatialReference.equals(new r(4326))&&a.spatialReference.isWebMercator())return b.resolve([e.webMercatorToGeographic(a)]),b;b=new h;b.geometries=[a];b.outSR=this.map.spatialReference;return g.defaults.geometryService.project(b)},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&
(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});q.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){q.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return m.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},
_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new d;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=
!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new d;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new d;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:
null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new d,e={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},g=this.getLayerType(),f=this.getLayerObject();b({type:g,layerObject:f}).then(k.hitch(this,function(b){var g=b.type;b=b.layerObject;
e.layerType=g;0<=this._getLayerTypesOfSupportTable().indexOf(g)&&(e.isSupportedLayer=!0);if(b)if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())e.isSupportQuery=!1;else{if(!b.url||b.capabilities&&0<=b.capabilities.indexOf("Query"))e.isSupportQuery=!0}else e.isSupportQuery=!1;a.resolve(e)}),function(){a.resolve(e)});return a},getRelatedTableInfoArray:function(a){a=new d;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];f.forEach(this.newSubLayers,function(e){e.id!==
a&&b.push(e)});this.newSubLayers=b},destroy:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.inherited(arguments)},destroyLayerInfo:function(){f.forEach(this.newSubLayers,function(a){a.destroyLayerInfo()});this.destroy()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&
0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>b)&&(0===a.maxScale||b>a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&!(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,!a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},
getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},getItemInfo:function(){var a=new d,b=this.getRootLayerInfo();if(b.isItemLayer()){var e=new t.ItemInfo(b);e.onLoad().then(k.hitch(this,function(){a.resolve(e)}))}else a.resolve(null);return a},isHostedLayer:function(){var a=new d,b=this.getUrl();b?s({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(k.hitch(this,
function(b){a.resolve(b&&b.serviceItemId?!0:!1)})):a.resolve(!1);return a},_bindEvent:function(){var c;this.layerObject&&!this.layerObject.empty&&(c=this.layerObject.on("visibility-change",k.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(c),c=a.after(this.layerObject,"setDefinitionExpression",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(c),c=a.after(this.layerObject,"setRenderer",k.hitch(this,this._onRendererChanged)),this._eventHandles.push(c),this.isRootLayer()&&
(c=this.layerObject.on("opacity-change",k.hitch(this,this._onOpacityChanged)),this._eventHandles.push(c)))},_onVisibilityChanged:function(){this.initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),b=b?b:null;a!==b&&(q.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=b)},_onRendererChanged:function(){q.publish("layerInfos/layerInfo/rendererChanged",[this])},
_onOpacityChanged:function(){q.publish("layerInfos/layerInfo/opacityChanged",[this])}});t.ItemInfo=p(null,{originItemInfo:null,_itemInfoLoadedDef:null,_layerDefinition:null,constructor:function(a){this._itemInfoLoadedDef=new d;if(a=a.isItemLayer()){var b=window.appConfig||window.getAppConfig(),b=n.getStandardPortalUrl(b&&b.map.portalUrl||window.portalUrl);l.getPortal(b).getItemById(a).then(k.hitch(this,function(a){this.originItemInfo=a;this._itemInfoLoadedDef.resolve(this)}),k.hitch(this,function(a){a&&
a.message&&console.log(a.message);this._itemInfoLoadedDef.resolve(this)}))}else this._itemInfoLoadedDef.resolve(this)},onLoad:function(){return this._itemInfoLoadedDef}});return t})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),function(p,f,k,d,b,m,q,a,n,l,s){return p(a,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,
_jsapiLayerInfos:null,_oldFilter:null,_subLayerInfoIndex:null,constructor:function(a,b){this._initJsapiLayerInfos();this.initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup()},init:function(){this.inherited(arguments);this._initSubLayerInfoIndex()},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var a=f.filter(this.originOperLayer.layers,function(a){return l.isDefined(a.id)&&
l.isDefined(a.name)&&l.isDefined(a.minScale)&&l.isDefined(a.maxScale)&&l.isDefined(a.parentLayerId)&&l.isDefined(a.defaultVisibility)});this._jsapiLayerInfos=0<a.length?a:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:k.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=k.clone(this.layerObject.infoTemplates);m.after(this.layerObject,"setInfoTemplates",k.hitch(this,function(){this.layerObject._infoTemplates=k.clone(this.layerObject.infoTemplates);
this.controlPopupInfo.infoTemplates=k.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new d}},initSubLayerVisible:function(a){this.subLayerVisible={};for(var b=0;b<this._jsapiLayerInfos.length;b++)this.subLayerVisible[this._jsapiLayerInfos[b].id]=0;a?f.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?
f.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):f.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&this.subLayerVisible[a.id]++},this)},_initSubLayerInfoIndex:function(){var a={};this.traversal(function(b){b.originOperLayer.mapService&&(a[b.originOperLayer.mapService.subId]=b)});this._subLayerInfoIndex=a},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},
_resetLayerObjectVisiblity:function(a){var b=a?a[this.id]:null;if(a&&(b&&this.layerObject.setVisibility(b.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var d=!1,e=[];f.forEach(this._jsapiLayerInfos,function(c){var b=this.id+"_"+c.id;l.isDefined(a[b])&&(d=!0,a[b].visible&&e.push(c.id))},this);if(d){this.initSubLayerVisible(e);this.traversal(function(a){a.initVisible()});var m={};this.traversal(function(a){0===a.getSubLayers().length&&(m[a.originOperLayer.mapService.subId]=
a.isVisbleOrInvisilbe())});this.setSubLayerVisible(m)}}},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var b=[-1,-1,-1],d,e=[],l=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(l,function(a){if(!this._isGroupLayerBySubId(a)){var c=this._subLayerInfoIndex[a];c&&c.isVisbleOrInvisilbe()&&e.push(a)}},
this);var l=e,c;for(c in a)if(a.hasOwnProperty(c)&&"function"!==typeof a[c]){var m=Number(c);a[c]?(d=f.indexOf(l,m),0>d&&l.push(m)):(d=f.indexOf(l,m),0<=d&&l.splice(d,1))}b=b.concat(l);this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[],b=this.originOperLayer.layerObject,d=null,d="esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(e){var c=null,c=b.url+"/"+e.id,f=b.id+"_"+e.id;e.subLayerIds&&
0<e.subLayerIds.length?(c={url:c,empty:!0},this._addNewSubLayer(a,c,f,e,d+"_group")):(c={url:c,empty:!0},this._addNewSubLayer(a,c,f,e,d))},this);var e=[];f.forEach(this._jsapiLayerInfos,function(b,c){var e=b.parentLayerId;if(-1!==e){for(var d=null,f=0;f<a.length;f++)if(a[f].mapService.subId===e){d=a[f];break}(e=d)&&e.subLayers.push(a[c])}},this);f.forEach(this._jsapiLayerInfos,function(b,c){var d;-1===b.parentLayerId&&(d=s.getInstance().create(a[c]),e.push(d),d.init())},this);return e},_addNewSubLayer:function(a,
b,d,e,f){a.push({layerObject:b,title:e.name||e.id||" ",id:d||" ",subLayers:[],mapService:{layerInfo:this,subId:e.id},selfType:"mapservice_"+f,parentLayerInfo:this})},_handleErrorSubLayer:function(a,b,d,e,f,c){a[b]={layerObject:null,title:c.name||c.id||" ",id:d||" ",subLayers:[],mapService:{layerInfo:this,subId:e}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},getLegendInfo:function(a){var b=
new d;this._legendInfo?b.resolve(this._legendInfo):this._legendRequest(a).then(k.hitch(this,function(a){this._legendInfo=a.layers;b.resolve(this._legendInfo)}),function(){b.reject()});return b},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",d={f:"json"};this.layerObject._params.dynamicLayers&&(d.dynamicLayers=b.stringify(this._createDynamicLayers(this.layerObject)),
"[{}]"===d.dynamicLayers&&(d.dynamicLayers="[]"));return n({url:a,content:d,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return n({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(a){var b=[],d;f.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){d={id:e.id};d.source=e.source&&e.source.toJson();var f;a.layerDefinitions&&a.layerDefinitions[e.id]&&(f=a.layerDefinitions[e.id]);
f&&(d.definitionExpression=f);var c;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(c=a.layerDrawingOptions[e.id]);c&&(d.drawingInfo=c.toJson());d.minScale=e.minScale||0;d.maxScale=e.maxScale||0;b.push(d)});return b},_getLayerDefinition:function(){var a=new d;this._request(this.layerObject.url).then(k.hitch(this,function(b){a.resolve(b)}),function(b){console.error(b.message||b);a.resolve(null)});return a},_getSublayerDefinition:function(a){var b;this._sublayerIdent.definitions[a]?(b=new d,b.resolve(this._sublayerIdent.definitions[a])):
b=this._layerAndTableRequest(a);return b},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var b=new d,l=this.layerObject.url+"/layers";this._sublayerIdent.empty?(this._sublayerIdent.empty=!1,this._request(l).then(k.hitch(this,function(e){f.forEach(e.layers,function(a){this._sublayerIdent.definitions[a.id]=a},this);this._sublayerIdent.defLoad.resolve();b.resolve(this._sublayerIdent.definitions[a])}),
k.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new d;this._sublayerIdent.empty=!0;b.resolve(null)}))):this._sublayerIdent.defLoad.then(k.hitch(this,function(){b.resolve(this._sublayerIdent.definitions[a])}),function(a){console.error(a.message||a);b.resolve(null)});return b},_allLayerAndTable:function(a){var b=new d;this._request(this.layerObject.url+"/"+a).then(k.hitch(this,function(d){this._sublayerIdent.definitions[a]=d;b.resolve(d)}),
function(a){console.error(a.message||a);b.resolve(null)});return b},_request:function(a){return n({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var b=f.filter(this.originOperLayer.layers,function(b){return b.id===a});return 1===b.length?b[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==a.showLegend?a.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(a){return null===this._getJsapiLayerInfoById(a)?
!1:!0},_getJsapiLayerInfoById:function(a){for(var b=null,d=0;d<this._jsapiLayerInfos.length;d++)this._jsapiLayerInfos[d].id===a&&(b=this._jsapiLayerInfos[d]);return b},_isGroupLayerBySubId:function(a){return(a=this._getJsapiLayerInfoById(a))&&a.subLayerIds&&0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(b){a.push(b)});q.publish("layerInfos/layerInfo/visibleChanged",a)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&
(a=this.layerObject.on("visible-layers-change",k.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(a),a=m.after(this.layerObject,"setLayerDefinitions",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(a))},_onVisibleLayersChanged:function(a){var b=a.visibleLayers;if(-1===b[0]&&-1===b[1]&&-1===b[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{a=[];var d=[-1,-1,-1],b=this._converVisibleLayers(b);a=b.visibleLayersForUpdateSubLayerVisible;d=d.concat(b.visibleLayersForSetVisibleLayers);
this.initSubLayerVisible(a);this.traversal(function(a){a.initVisible()});this.layerObject.setVisibleLayers(d)}},_converVisibleLayers:function(a){var b={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(a,function(b){var e=this.findLayerInfoById(this.id+"_"+b);if(this._isGroupLayerBySubId(b))e.traversal(function(b){a.push(b.originOperLayer.mapService.subId)});else for(;e&&e.originOperLayer.mapService;)a.push(e.originOperLayer.mapService.subId),e=e.parentLayerInfo},
this);f.forEach(a,function(a){0>b.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&b.visibleLayersForUpdateSubLayerVisible.push(a)},this);f.forEach(b.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||b.visibleLayersForSetVisibleLayers.push(a)},this);return b},_onFilterChanged:function(){for(var a,b=[],d=this.layerObject.layerDefinitions,e=d.length>this._oldFilter.length?d.length:this._oldFilter.length,f=0;f<e;f++)if((d[f]?d[f]:null)!==(this._oldFilter[f]?this._oldFilter[f]:
null))(a=this.findLayerInfoById(this.id+"_"+f))&&a.isLeaf()&&b.push(a);0<b.length&&(q.publish("layerInfos/layerInfo/filterChanged",b),this._oldFilter=d)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault ./LayerInfoFactory dojo/Deferred".split(" "),function(p,f,k,d,b,m,q,a,n){return p(m,{constructor:function(){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),
b=null,d;f.forEach(a,function(a){d=this._convertGeometryToMapSpatialRef(a.initialExtent);b=b?b.union(d):d},this);return b},_resetLayerObjectVisiblity:function(a){var b=a?a[this.id]:null;b&&(f.forEach(this.newSubLayers,function(b){var d=a?a[b.id]:null;d&&b.layerObject.setVisibility(d.visible)},this),this._setTopLayerVisible(b.visible))},initVisible:function(){var a=!1,b;for(b=0;b<this.newSubLayers.length;b++)a=a||this.newSubLayers[b].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=
a?!0:!1;f.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var b=[],d=this.originOperLayer.layerObject.getLayers();f.forEach(d,function(d){this._getLayerIndexesInMapByLayerId(d.id)&&(d=a.getInstance().create({layerObject:d,title:d.label||d.title||d.name||d.id||" ",id:d.id||" ",collection:{layerInfo:this},selfType:"kml",parentLayerInfo:this}),b.push(d),d.init())},this);return b}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo ./LayerInfos dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/utils esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){var c=p(b,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName()},_updateLayerObjectName:function(){this.layerObject&&(!this.layerObject.empty&&this.layerObject.name&&!k.getObject("_wabProperties.originalLayerName",!1,this.layerObject))&&(k.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=this.title)},_initOldFilter:function(){this._oldFilter=
this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var c=[],b=this.getInfoTemplate();b&&b.info&&b.info.fieldInfos?f.forEach(b.info.fieldInfos,function(a){a.visible&&c.push(a.fieldName)},this):c=["*"];a.outFields=c;return a},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);
a=new d;a.resolve(null);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,c=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=c?!0:!1;a._onVisibilityChanged()}else this._visible=a=
this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;s.after(this.layerObject,"setInfoTemplate",k.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||
(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&
this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var c=a.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);a.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},c);return c},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(c){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&
this.layerObject.loaded){a.empty(c);l.remove(c,"jimu-legends-div-flag");var b=new t({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:t.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},a.create("div",{},c));b.startup();c._legendDijit=b}},_initLegendsNode:function(c){var b=[],e=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))a.empty(c),e.renderer&&(e.renderer.infos?b=k.clone(e.renderer.infos):
b.push({label:e.renderer.label,symbol:e.renderer.symbol}),e.renderer&&(e.renderer.defaultSymbol&&0<b.length)&&b.push({label:e.renderer.defaultLabel||"others",symbol:e.renderer.defaultSymbol}),f.forEach(b,function(b){b.legendDiv=a.create("div",{"class":"legend-div"},c);b.symbolDiv=a.create("div",{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=a.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},b.legendDiv);if("textsymbol"===b.symbol.type)n.set(b.symbolDiv,
"innerHTML",b.symbol.text);else{var e=q.createSurface(b.symbolDiv,50,50);b=r.getShapeDescriptors(b.symbol);e.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(q.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&f.forEach(this.originOperLayer.subLayers,function(b){b=new c(b,this.map);a.push(b);b.init()},this);return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:
1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupInfo:function(a){var c=null;a&&a.fields&&(c={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(b){if(b.name!==a.objectIdField&&"globalid"!==b.name.toLowerCase()&&"shape"!==b.name.toLowerCase()){var e=h.getDefaultPortalFieldInfo(b);e.visible=!0;e.isEditable=b.editable;c.fieldInfos.push(e)}}));return c},_getDefaultPopupTemplate:function(a){var c=
null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(c=new e(a));return c},enablePopup:function(){return this.loadInfoTemplate().then(k.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?
!0:!1},loadInfoTemplate:function(){var a=new d;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(k.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),k.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a,c){var b=[];if(!a||!a.url||!a.relationships)return b;
var e=a.url.lastIndexOf("/"),d=a.url.slice(0,e);f.forEach(a.relationships,function(a){(!c||!a.role||c===a.role)&&b.push(d+"/"+a.relatedTableId.toString())},this);return b},getRelatedTableInfoArray:function(a){var c=[],b=new d;this.getLayerObject().then(k.hitch(this,function(e){var d=this._getRelatedUrls(e,a);0!==d.length&&m.getInstanceSync().traversalAll(k.hitch(this,function(a){var b=-1;if(0===d.length)return!0;f.forEach(d,function(e,d){k.getObject("layerObject.url",!1,a)&&g.removeProtocol(e.toString().replace(/\/+/g,
"/").toLowerCase())===g.removeProtocol(a.layerObject.url.toString().replace(/\/+/g,"/").toLowerCase())&&(c.push(a),b=d)},this);0<=b&&d.splice(b,1);return!1}));b.resolve(c)}),k.hitch(this,function(){b.resolve(c)}));return b},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&(!this.layerObject.empty&&this.layerObject.setDefinitionExpression)&&this.layerObject.setDefinitionExpression(a)}});
return c})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C,E,F,G,I,R,O,P,K,J,L,Q,M,H,N,U){var z=f([N,u],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new q([64,64,64]),defaultText:"Aa",sizeRampLightColor:new q([255,255,255]),sizeRampDarkColor:new q([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,
_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(c,b){k.mixin(this,U.widgets.legend);this._i18n=U.widgets.legend;c=c||{};c.map?b?(this.map=c.map,this.layerInfos=c.layerInfos,this._respectCurrentMapScale=!1===c.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===c.respectVisibility?!1:!0,this.arrangement=c.arrangement===z.ALIGN_RIGHT?z.ALIGN_RIGHT:z.ALIGN_LEFT,this.arrangement===z.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===c.autoUpdate?!1:!0,this._surfaceItems=
[],this.hideLayersInLegend={},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],c,b;for(c=0;c<a.length;c+=1)b=a[c],p.locale&&-1!==p.locale.indexOf(b)&&(-1!==p.locale.indexOf("-")?-1!==p.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=
this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>n("ie")&&(this._repaintItems=k.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?
(this.layerInfos=a,this.layers=[],d.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=
this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)e.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],d.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,
this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],c=[];d.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);var e;this._isSupportedLayerType(b)&&(b.arcgisProps&&b.arcgisProps.title&&(b._titleForLegend=b.arcgisProps.title),this.layers.push(b));"esri.layers.KMLLayer"==
b.declaredClass&&(e=b.getLayers(),d.forEach(e,function(c){a.push(c.id)},this));"esri.layers.GeoRSSLayer"==b.declaredClass&&(e=b.getFeatureLayers(),d.forEach(e,function(a){c.push(a.id)},this))},this);d.forEach(this.map.graphicsLayerIds,function(b){var e=this.map.getLayer(b);-1==d.indexOf(a,b)&&-1==d.indexOf(c,b)&&(this._isSupportedLayerType(e)&&e._params&&e._params.drawMode)&&(e.arcgisProps&&e.arcgisProps.title&&(e._titleForLegend=e.arcgisProps.title),this.layers.push(e))},this)}this._createLegend()},
_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=b.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=b.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=b.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=b.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),d.forEach(this.layers,function(a){var c={};c.ovcConnect=b.connect(a,"onVisibilityChange",
this,"_refreshLayers");c.oocConnect=b.connect(a,"onOpacityChange",this,"_refreshLayers");c.oscConnect=b.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(c.odcConnect=b.connect(a,"_onDynamicLayersChange",k.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(c.oirConnect=b.connect(a,"onRenderingChange",k.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&(c.oivrConnect=b.connect(a,"onRendererChange",k.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=c},this))},_deactivate:function(){this._ozeConnect&&b.disconnect(this._ozeConnect);this._olaConnect&&b.disconnect(this._olaConnect);this._olroConnect&&b.disconnect(this._olroConnect);this._olrConnect&&b.disconnect(this._olrConnect);d.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.ovcConnect&&b.disconnect(a.ovcConnect);a.oocConnect&&b.disconnect(a.oocConnect);a.oscConnect&&
b.disconnect(a.oscConnect);a.odcConnect&&b.disconnect(a.odcConnect);a.oirConnect&&b.disconnect(a.oirConnect);a.oivrConnect&&b.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,c){delete c.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];d.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&
this.layers.push(a)},this);d.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,c=!1;t.set(this.domNode,"position","relative");e.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var f=[];d.forEach(this.layers,function(g){if("esri.layers.KMLLayer"==g.declaredClass||"esri.layers.GeoRSSLayer"==
g.declaredClass){var h;g.loaded?("esri.layers.KMLLayer"==g.declaredClass?h=g.getLayers():"esri.layers.GeoRSSLayer"==g.declaredClass&&(h=g.getFeatureLayers(),this.hideLayersInLegend[g.id]&&(h=d.filter(h,function(a){return-1==d.indexOf(this.hideLayersInLegend[g.id],a.id)},this))),d.forEach(h,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&g._titleForLegend&&(a._titleForLegend=g._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==
a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),f.push(a))},this)):b.connect(g,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===g.declaredClass)if(g.loaded){if((!this._respectVisibility||this._respectVisibility&&g.visible)&&0<g.layerInfos.length&&d.some(g.layerInfos,function(a){return a.legendURL})){var l=!1;d.forEach(g.layerInfos,function(c){if(c.legendURL&&-1<d.indexOf(g.visibleLayers,
c.name)){l||(e.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(g._titleForLegend||g.name||g.id)+"\x3c/span\x3e"},this.domNode),l=!0);var b;c=c.legendURL;if(g.customParameters||g.customLayerParameters){var f=k.clone(g.customParameters||{});k.mixin(f,g.customLayerParameters||{});for(b in f)c+=(-1===c.indexOf("?")?"?":"\x26")+b+"\x3d"+f[b]}e.create("div",{innerHTML:"\x3cimg src\x3d'"+c+"'/\x3e"},this.domNode);a=!0}},this)}}else b.connect(g,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}));
else"esri.layers.WFSLayer"===g.declaredClass&&!g.renderer?(h=e.create("div",{id:this.id+"_"+g.id,"class":"esriLegendService"}),e.create("span",{innerHTML:this._getServiceTitle(g),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},h))))),e.place(h,this.id,"first"),tableNode=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},h),tableBody=e.create("tbody",{},tableNode),"esriGeometryComplex"===
g.geometryType?(this._buildRow_Renderer(g,g._pointSymbol,null,this.NLS_points,null,tableBody),this._buildRow_Renderer(g,g._lineSymbol,null,this.NLS_lines,null,tableBody),this._buildRow_Renderer(g,g._polygonSymbol,null,this.NLS_areas,null,tableBody)):"esriGeometryPoint"===g.geometryType?this._buildRow_Renderer(g,g._pointSymbol,null,"",null,tableBody):"esriGeometryPolyline"===g.geometryType?this._buildRow_Renderer(g,g._lineSymbol,null,"",null,tableBody):"esriGeometryPolygon"===g.geometryType&&this._buildRow_Renderer(g,
g._polygonSymbol,null,"",null,tableBody),c=!0):f.push(g)},this);var h=[];d.forEach(f,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var c=e.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});e.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",
{},e.create("table",{width:"95%"},c)))));e.place(c,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(k.hitch(this,function(a){this._createLegendForLayer(a)}),k.hitch(this,function(a){h.push(this._legendRequest(a))})):h.push(this._legendRequest(a))}}else var d=b.connect(a,"onLoad",this,function(a){b.disconnect(d);d=null;this.refresh()})},this);0===h.length&&!a&&!c?(r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):
(new g(h)).addCallback(k.hitch(this,function(b){!a&&!c?r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend:r.byId(this.id+"_msg").innerHTML="";this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var c=!1;if(a.legendResponse||this.isHostedTileService(a)){var b=a.dynamicLayerInfos||a.layerInfos;b&&b.length?d.forEach(b,function(b,e){if(!this.hideLayersInLegend[a.id]||-1===d.indexOf(this.hideLayersInLegend[a.id],b.id)){var g=this._buildLegendItems(a,
b,e);c=c||g}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(c=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(b=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,c=this._buildLegendItems(a,{id:b,name:null,subLayerIds:null,parentLayerId:-1},0));c&&(t.set(r.byId(this.id+"_"+a.id),"display","block"),t.set(r.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=
a.version?this._legendRequestServer(a):this._legendRequestTools(a);b.connect(a,"onLoad",k.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var c=a.url,b=c.indexOf("?"),c=-1<b?c.substring(0,b)+"/legend"+c.substring(b):c+"/legend";(b=a._getToken())&&(c+="?token\x3d"+b);var e=k.hitch(this,"_processLegendResponse"),g={f:"json"};a._params.dynamicLayers&&(g.dynamicLayers=h.stringify(this._createDynamicLayers(a)),"[{}]"===g.dynamicLayers&&(g.dynamicLayers="[]"));a._params.bandIds&&(g.bandIds=
a._params.bandIds);a._params.renderingRule?g.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&d.forEach(a.rasterFunctionInfos,function(a){a&&(a.name&&"none"===a.name.toLowerCase())&&(g.renderingRule=h.stringify({rasterFunction:a.name}))});return A({url:c,content:g,callbackParamName:"callback",load:function(c,b){e(a,c,b)},error:B.defaults.io.errorHandler})},_legendRequestTools:function(a){var c=a.url.toLowerCase().indexOf("/rest/"),c=a.url.substring(0,c)+
a.url.substring(c+5,a.url.length),c=this._legendUrl+"?soapUrl\x3d"+window.escape(c);if(!n("ie")||8<n("ie"))c+="\x26returnbytes\x3dtrue";var b=k.hitch(this,"_processLegendResponse");return A({url:c,content:{f:"json"},callbackParamName:"callback",load:function(c,e){b(a,c,e)},error:B.defaults.io.errorHandler})},_processLegendResponse:function(a,c){c&&c.layers?(a.legendResponse=c,r.byId(this.id+"_"+a.id)&&e.empty(r.byId(this.id+"_"+a.id)),e.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},
e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},r.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+m.toJson(c))},_buildLegendItems:function(a,c,b){var g=!1,f=r.byId(this.id+"_"+a.id),h=c.parentLayerId;if(c.subLayerIds)a=e.create("div",{id:this.id+"_"+a.id+"_"+c.id+"_group",style:{display:"none"},"class":-1==h?0<b?"esriLegendGroupLayer":"":this._legendAlign},-1==h?f:r.byId(this.id+
"_"+a.id+"_"+h+"_group")),e.create("td",{innerHTML:x.encode(c.name),align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(b=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===d.indexOf(a.visibleLayers,c.id))return g}else{if(b=this._getReallyVisibleLayers(b,a.visibleLayers),-1===d.indexOf(b,c.id))return g}else if(-1===d.indexOf(a.visibleLayers,c.id))return g;
f=e.create("div",{id:this.id+"_"+a.id+"_"+c.id,style:{display:"none"},"class":-1<h?this._legendAlign:""},-1==h?f:r.byId(this.id+"_"+a.id+"_"+h+"_group"));e.create("td",{innerHTML:x.encode(c.name)||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},f))));b=a.dynamicLayerInfos||a.layerInfos;h=!1;b&&b.length&&(h=d.some(b,function(a){return!!a.drawingInfo}));if(a.legendResponse)g=g||this._buildLegendItems_Tools(a,c,f);else if(a.renderer||
h)g=g||this._buildLegendItems_Renderer(a,c,f)}return g},_getReallyVisibleLayers:function(a,c){if(!a||!c||!c.length)return[];var b=[],e=[],g;for(g=0;g<a.length;g++)if(a[g].subLayerIds){if(-1===d.indexOf(c,a[g].id)||-1<d.indexOf(e,a[g].id))e=e.concat(a[g].subLayerIds)}else-1<d.indexOf(c,a[g].id)&&-1===d.indexOf(e,a[g].id)&&b.push(a[g].id);return b},_buildLegendItems_Tools:function(a,c,b){var g=c.parentLayerId,f=this.map.getScale(),h=!1,l=function(a,c){var b,e;for(b=0;b<a.length;b++)if(c.dynamicLayerInfos)for(e=
0;e<c.dynamicLayerInfos[e].length;e++){if(c.dynamicLayerInfos[e].mapLayerId==a[b].layerId)return a[b]}else if(c.id==a[b].layerId)return a[b];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,c,f)){var m=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var n=this._getEffectiveScale(a,c);if(n.minScale&&n.minScale<f||n.maxScale&&n.maxScale>f)m=!1}if(m){var f=
l(a.legendResponse.layers,c),k=f.legendType,q=f.layerType,s=f.legend;if(s){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,f,c);b=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b);var p=e.create("tbody",{},b);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(b,a,c);d.forEach(s,function(b){if(!(10.1<=a.version&&!b.values&&1<s.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===b.label||!b.label&&!("esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.3<=a.version||"Raster Layer"===q))))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)h=!0,this._buildRow_Tools(b,p,a,c.id,k)},this)}}}h&&(t.set(r.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<g&&(t.set(r.byId(this.id+"_"+a.id+"_"+g+"_group"),"display","block"),this._findParentGroup(a.id,a,g)));return h},_getLayerInfos:function(a){var c=new s,b=a.dynamicLayerInfos||a.layerInfos;if(b&&b.length)if(d.some(b,function(a){return!!a.drawingInfo}))c.resolve(a);
else{var e=a.url,g=e.indexOf("?"),e=-1==g?e+"/layers":e.substring(0,g)+"/layers"+e.substring(g,e.length);A({url:e,content:{f:"json"},callbackParamName:"callback",load:function(e,g){e.layers?(d.forEach(b,function(a){var c=d.filter(e.layers,function(c){return a.source?c.id===a.source.mapLayerId:c.id===a.id});c&&(c[0]&&c[0].drawingInfo)&&(a.drawingInfo=c[0].drawingInfo,a.fields=c[0].fields)}),c.resolve(a)):c.reject(a)},error:function(b){c.reject(a)}})}return c},_sanitizeLegendResponse:function(a,c,b){var e=
c.legend;if(10.1<=a.version&&1<e.length&&!c._sanitized){a=k.getObject("layerDefinition.drawingInfo.renderer",!1,b);var g,f;a||(a=k.getObject("drawingInfo.renderer",!1,b));d.some(e,function(a){if(a.values)return!0})&&d.some(e,function(a,c){a.values||(f=c,g=a);return!!g});a?"uniqueValue"===a.type?g&&(e.splice(f,1),e.push(g)):"classBreaks"===a.type&&(g&&e.splice(f,1),e.reverse(),g&&e.push(g)):g&&(e.splice(f,1),e.push(g));c._sanitized=!0}},_buildRow_Tools:function(a,c,b,d,g){var f=e.create("tr",{},c),
h;this.alignRight?(c=e.create("td",{align:this._isRightToLeft?"left":"right"},f),h=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},f)):(h=e.create("td",{width:35,align:"center"},f),c=e.create("td",{},f));f=a.url;(!n("ie")||9<=n("ie")||9>n("ie")&&"esri.layers.ArcGISImageServiceLayer"===b.declaredClass)&&a.imageData&&0<a.imageData.length?f="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(f=b.url+"/"+d+"/images/"+a.url,(d=b._getToken())&&(f+="?token\x3d"+d));d=e.create("img",
{src:f,border:0,style:"opacity:"+b.opacity},h);a=e.create("td",{innerHTML:x.encode(a.label),align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%",dir:"ltr"},c))));g&&("Stretched"===g&&10.3<=b.version&&"esri.layers.ArcGISImageServiceLayer"===b.declaredClass)&&(a.style.verticalAlign="top",a.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",c.style.verticalAlign="top");9>n("ie")&&(d.style.filter="alpha(opacity\x3d"+100*b.opacity+")")},_getVariable:function(a,
c,b){var e;a&&(e=(a=a.getVisualVariablesForType(c,b))&&a[0]);return e},_getVariables:function(a,c,b){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return c?d.filter(a,function(a){return!(!a||!(a.field===c&&a.normalizationField==b))}):a},_getFieldAlias:function(a,c,b){var e=c.infoTemplate,e=e&&e.getFieldInfo&&e.getFieldInfo(a);a=k.isFunction(a)?null:this.getField(c,a,b);c=e||a;b="";c&&(b=e&&e.label||a&&a.alias||c.name||c.fieldName);
return b},_getRampTitle:function(a,c,b){var e,d=a.field,g=a.normalizationField,f=!1,h=!1,l=!1,d=k.isFunction(d)?null:d,g=k.isFunction(g)?null:g;if(a.legendOptions&&a.legendOptions.title)e=a.legendOptions.title;else if(a.valueExpressionTitle)e=a.valueExpressionTitle;else{if(c.renderer&&c.renderer.authoringInfo&&c.renderer.authoringInfo.visualVariables){var m=c.renderer.authoringInfo.visualVariables;for(a=0;a<m.length;a++){var n=m[a];if("colorInfo"===n.type&&"ratio"===n.style){f=!0;break}else if("colorInfo"===
n.type&&"percent"===n.style){h=!0;break}else if("colorInfo"===n.type&&"percentTotal"===n.style){l=!0;break}}}(f=l&&"showRatioPercentTotal"||h&&"showRatioPercent"||f&&"showRatio"||g&&"showNormField"||d&&"showField"||null)&&(e=D.substitute({field:d&&this._getFieldAlias(d,c,b),normField:g&&this._getFieldAlias(g,c,b)},this._i18n[f]))}return e},_getRendererTitle:function(a,c,b){var e;if(a){var d,g,f;a instanceof I&&(d=a.attributeField,g=a.normalizationField,f="percent-of-total"===a.normalizationType);
d=k.isFunction(d)?null:d;g=k.isFunction(g)?null:g;a.legendOptions&&a.legendOptions.title?e=a.legendOptions.title:a.valueExpressionTitle?e=a.valueExpressionTitle:(a=g&&"showNormField"||(f?"showNormPct":null)||d&&"showField"||null)&&(e=D.substitute({field:d&&this._getFieldAlias(d,c,b),normField:g&&this._getFieldAlias(g,c,b)},this._i18n[a]))}return e},_buildLegendItems_Renderer:function(a,c,b){var g=c.parentLayerId,f=this.map,h=f.getScale(),l,m=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,
c,h)){var n,q,s,p,u,w,v,y;s="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:c&&c.drawingInfo?H.fromJson(k.clone(c.drawingInfo.renderer)):a.renderer;if(s instanceof R&&(s=(s="zoom"===s.rangeType?s.getRendererInfoByZoom(f.getZoom()):s.getRendererInfoByScale(h))&&s.renderer,!s))return!1;var B=this._getVariables(s),A=d.filter(B,function(a){return!!a}).length,h=B[0],f=B[1],B=B[2],D,C,E,z,N;h&&(p=this._getMedianColor(s,h),h.field&&(w=k.isFunction(h.field)?null:this.getField(a,
h.field,c)),D=!(h.legendOptions&&!1===h.legendOptions.showLegend));f&&(f.field&&(y=k.isFunction(f.field)?null:this.getField(a,f.field,c)),C=!(f.legendOptions&&!1===f.legendOptions.showLegend));B&&(B.field&&(v=k.isFunction(B.field)?null:this.getField(a,B.field,c)),E=!(B.legendOptions&&!1===B.legendOptions.showLegend));if(s instanceof J)l=m=!0,this._showHeatRamp(a,c,s,b);else if(s instanceof O)l=m=!0,this._showDotDensityLegend(a,c,s,b);else if(s instanceof P)l=m=!0,q=e.create("table",{cellpadding:0,
cellspacing:0,width:"95%","class":"esriLegendLayer"},b),n=e.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c),s.latestObservationRenderer&&s.latestObservationRenderer instanceof F&&this._buildRow_Renderer(a,s.latestObservationRenderer.symbol,p,x.encode(s.latestObservationRenderer.label)||this.NLS_currentObservations,null,n),s.observationRenderer&&s.observationRenderer instanceof F&&this._buildRow_Renderer(a,s.observationRenderer.symbol,p,x.encode(s.observationRenderer.label)||
this.NLS_previousObservations,null,n);else if(s instanceof G){if(s.infos&&0<s.infos.length){l=m=!0;if(s.legendOptions&&s.legendOptions.title||s.valueExpressionTitle)q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),n=e.create("tbody",{},q),A=s.legendOptions&&s.legendOptions.title?s.legendOptions.title:s.valueExpressionTitle,this._buildRow_Renderer(a,null,p,x.encode(A),null,n);q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
b);n=e.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c);s.attributeField&&B&&this._addSubHeader(n,this._getFieldAlias(s.attributeField,a,c));var L=[];d.forEach(s.infos,function(c){var b=null;a._editable&&a.types&&(b=this._getTemplateFromTypes(a.types,c.value));var e=c.label;null==e&&(e=c.value);-1===d.indexOf(L,e)&&(L.push(e),this._buildRow_Renderer(a,c.symbol,p,x.encode(e),b,n))},this)}N=this._displayDefaultSymbol(a,s,b)}else if(s instanceof I){if(s.infos&&0<s.infos.length||
"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){l=m=!0;z=this._isUnclassedRenderer(s);!h&&1===s.infos.length&&(u=(u=s.infos[0])&&u.symbol);z||(q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),n=e.create("tbody",{},q),A=this._getRendererTitle(s,a,c),this._buildRow_Renderer(a,null,p,x.encode(A),null,n));q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b);n=e.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&
this._createHoverAction(q,a,c);if(!z||!B||!E)A=s.infos.slice(0).reverse(),d.forEach(A,function(c){var b=c.label;null==b&&!z&&(b=c.minValue+" - "+c.maxValue);this._buildRow_Renderer(a,c.symbol,p,x.encode(b),null,n)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===K.STYLE_SCALAR||a.renderer.style===K.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,s.defaultSymbol,null,"",null,n),a._hideDefaultSymbol=!0}z||(N=this._displayDefaultSymbol(a,s,b))}else s instanceof
F&&(l=m=!0,q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),n=e.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c),u=null,a._editable&&(a.templates&&0<a.templates.length)&&(u=a.templates[0]),q=1<A?null:w&&D||y&&C||v&&E,this._buildRow_Renderer(a,s.symbol,p,x.encode(q?this._getRampTitle(1<A?null:h||f||B,a,c):s.label),u,n),u=h?null:s.symbol,q&&(w=y=v=null));if(l){if(h&&D&&(h.field||h.valueExpression))this._showGradientRamp(a,
c,s,null,b,h,w,null,B&&E?!0:!1);if(B&&E&&(B.field||B.valueExpression))l=h&&D||s instanceof G?!1:!0,this._showSizeLegend(a,c,s,B,p,b,v,null,l);if(f&&C&&(f.field||f.valueExpression))v=u&&!u.url&&u.color?u.color:this.transparencyRampColor,this._showGradientRamp(a,c,s,v,b,f,y,null,!1)}if(!N&&(!z||D||E||C))N=this._displayDefaultSymbol(a,s,b);m=m||N}m&&(t.set(r.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<g&&(t.set(r.byId(this.id+"_"+a.id+"_"+g+"_group"),"display","block"),this._findParentGroup(a.id,
g)));return m},_isUnclassedRenderer:function(a,c){var b;if(a instanceof I&&a.infos&&1===a.infos.length){b=a.attributeField;var e=a.normalizationField;b=c?b===c:!!this._getVariables(a,b,e).length}return b},_displayDefaultSymbol:function(a,c,b){var d;!a._hideDefaultSymbol&&c.defaultSymbol&&(d=!0,b=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),b=e.create("tbody",{},b),this._buildRow_Renderer(a,c.defaultSymbol,null,x.encode(c.defaultLabel)||"others",null,b));
return d},_showGradientRamp:function(a,c,b,d,g,f,h,l,m){m=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!m?" esriLegendSubFragment":"")},g);g=e.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(m,a,c,l);(h||f.valueExpression)&&this._addSubHeader(g,this._getRampTitle(f,a,c));h=f.field;var n;h&&(n=k.isFunction(h)?null:this.getField(a,h,c));(c=this._getRampStops(b,f,d,n&&"esriFieldTypeDate"===n.type))&&c.length&&this._drawGradientRamp(g,
c,!0,a,this._getRampBorderColor(b),!!d)},_getMedianColor:function(a,c){var b,e;c.colors?(b=c.minDataValue,e=c.maxDataValue):c.stops&&(b=c.stops[0].value,e=c.stops[c.stops.length-1].value);return a.getColor(b+(e-b)/2,{colorInfo:c})},_getRampStops:function(a,c,b,e){var g,f,h,l,m=!1;c.colors||c.opacityValues?(f=c.maxDataValue-c.minDataValue,g=d.map([0,0.25,0.5,0.75,1],function(a){h=c.minDataValue+a*f;return Number(h.toFixed(6))}),this._checkPrecision(0,4,g)):c.stops&&(g=d.map(c.stops,function(a){return a.value}),
(m=d.some(c.stops,function(a){return!!a.label}))&&(l=d.map(c.stops,function(a){return a.label})));var n=g[0],k,r;f=g[g.length-1]-n;return d.map(g,function(d,h){b?(k=new q(b.toRgba()),r=a.getOpacity(d,{opacityInfo:c}),null!=r&&(k.a=r)):k=a.getColor(d,{colorInfo:c});var s="";if(m)s=l[h];else{var s=e?E.formatDate(d,E.timelineDateFormatOptions):C.format(d),t="";0===h?t=this._specialChars.lt+" ":h===g.length-1&&(t=this._specialChars.gt+" ");s=t+s}return{value:d,color:k,offset:1-(d-n)/f,label:s}},this).reverse()},
_checkPrecision:function(a,c,b){var e=a+(c-a)/2,d=b[a],g=b[e],f=b[c],h=Math.floor(d),l=Math.floor(g),m=Math.floor(f);h===d&&(m===f&&l!==g&&h!==l&&m!==l)&&(b[e]=l);a+1!==e&&this._checkPrecision(a,e,b);e+1!==c&&this._checkPrecision(e,c,b)},_getRampBorderColor:function(a){var c;if(a instanceof F)c=a.symbol;else if(a instanceof G||a instanceof I)c=a.infos[0].symbol;return(a=c&&-1===c.type.indexOf("linesymbol")?c.getStroke():null)&&a.color},_drawGradientRamp:function(a,c,b,g,f,h){var l=e.create("tr",{},
a),m,k,r,s,p,u=c.length-1,w;s=0;this.alignRight?(a=e.create("td",{align:this._isRightToLeft?"left":"right"},l),m=e.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},l)):(m=e.create("td",{width:this.gradientWidth,align:"center"},l),a=e.create("td",{},l));l=f&&0<f.a&&!(240<=f.r&&240<=f.g&&240<=f.b);k=e.create("div",{"class":l?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},m);m=e.create("div",{"class":"esriLegendColorRamp"+
(h?" esriLegendTransparencyRamp":"")},k);h=t.get(m,"width");l&&(f=9>n("ie")?f.toHex():"rgba("+f.toRgba().join(",")+")",t.set(m,"border",this.colorRampBorder+" "+f));b?(f=this.gradientHeight*u,t.set(m,"height",f+"px")):f=t.get(m,"height");t.set(k,"height",f+"px");l=v.createSurface(m,h,f);9>n("ie")&&(s=l.getEventSource(),t.set(s,"position","relative"),t.set(s.parentNode,"position","relative"),s=1);try{b&&d.forEach(c,function(a,c){a.offset=c/u}),p=l.createRect({x:-s,y:-s,width:h+s,height:f+s}),p.setFill({type:"linear",
x1:0,y1:0,x2:0,y2:f,colors:c}).setStroke(null),l.createRect({width:h,height:f}).setFill(new q([255,255,255,1-g.opacity])).setStroke(null),this._surfaceItems.push(l)}catch(y){l.clear(),l.destroy()}d.forEach(c,function(a,b){if(a.label){w="top:"+100*a.offset+"%;";var d="";0===b&&(d+=" esriLegendColorRampTickFirst");b===c.length-1&&(d+=" esriLegendColorRampTickLast");e.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",style:w},k)}});r=e.create("div",{"class":"esriLegendColorRampLabels",
style:{height:f+this.gradientHeight+"px"}},a);b?d.forEach(c,function(a){e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:x.encode(a.label)||"\x26nbsp;"},r)}):(e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},r),e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(f+this.gradientHeight-2*this.gradientHeight)+"px;"},r))},_showHeatRamp:function(a,c,b,d,g){var f,h=b.field;f=e.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},d);d=e.create("tbody",{},f);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(f,a,c,g);(h=h&&this.getField(a,h,c))&&this._addSubHeader(d,this._getFieldAlias(h.name,a,c));c=this._getHeatmapStops(b);c.length&&this._drawGradientRamp(d,c,!1,a)},_getHeatmapStops:function(a){var c=a.colorStops;a=a.colors;var b,e,g,f;if(c&&c[0])if(b=c.length-1,a=c[0]&&null!=c[0].ratio){if((a=c[b])&&1!==a.ratio)c=c.slice(0),c.push({ratio:1,color:a.color}),b++}else e=c[0].value,g=c[b].value-
e,c=d.map(c,function(a){return{color:a.color,ratio:(a.value-e)/g}});else a&&a[0]&&(b=a.length-1,f=1/(a.length-1),c=d.map(a,function(a,c){return{color:a,ratio:c*f}}));c=d.map(c,function(a,c){var e="";0===c?e="Low":c===b&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});return c.reverse()},_showDotDensityLegend:function(a,c,b,g){var f=b.legendOptions,h,l,m,n,q,r,s,t=this.dotDensitySwatchSize,p=Math.round(t/2);f&&(l=f.backgroundColor,m=f.outline,n=f.valueUnit,q=f.dotCoverage);q=(q||this.dotCoverage)/
100;s=Math.round(t*t/Math.pow(b.dotSize,2)*q);g=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);r=e.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,c);this._addSubHeader(r,D.substitute({value:b.dotValue,unit:n||""},this.NLS_dotValue));d.forEach(b.fields,function(e){e=k.mixin({},e);e.numPoints=s;h=new L(b._generateImageSrc(t,t,[e],{x:0,y:0},{x:t,y:t},l),m||b.outline,t,t);e=this.getField(a,e.name,c)||e;this._buildRow_Renderer(a,
h,null,x.encode(this._getFieldAlias(e.name,a,c)),null,r,{type:"path",path:"M "+-p+","+-p+" L "+p+","+-p+" L "+p+","+p+" L "+-p+","+p+" L "+-p+","+-p+" E"})},this)},_showSizeLegend:function(a,c,b,d,g,f,h,l,m){var n=d.legendOptions,n=n&&n.customValues;g=this._getSizeSymbol(b,g);if(!(d.valueUnit&&"unknown"!==d.valueUnit||!g||!n&&(null==d.minSize||null==d.maxSize||null==d.minDataValue||null==d.maxDataValue)&&(!d.stops||1>=d.stops.length))){m=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+
(!m?" esriLegendSubFragment":"")},f);f=e.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(m,a,c,l);(h||d.valueExpression)&&this._addSubHeader(f,this._getRampTitle(d,a,c));h=d.field;var q;h&&(q=k.isFunction(h)?null:this.getField(a,h,c));c=q&&"esriFieldTypeDate"===q.type;n=n||this._getDataValues(b,g,d,c);for(q=m=n.length-1;0<=q;q--)h=n[q],g=M.fromJson(g.toJson()),this._applySize(g,b,d,h),h=c?E.formatDate(h,E.timelineDateFormatOptions):C.format(h),l="",q===m?l=this._specialChars.gt+
" ":0===q&&(l=this._specialChars.lt+" "),l="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+x.encode(l+h)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,l,null,f)}},_getSizeSymbol:function(a,c){var b,e;if(a instanceof F)b=a.symbol;else if(a instanceof K)b=a.defaultSymbol;else if(a instanceof G||a instanceof I)b=a.infos[0].symbol,e=1<a.infos.length;if(b=b&&-1!==b.type.indexOf("fillsymbol")?null:b)if(b=M.fromJson(b.toJson()),c||e)-1!==b.type.indexOf("linesymbol")?b.setColor(new q(this.sizeRampDarkColor)):
(b.setColor(new q(this.sizeRampLightColor)),b.setOutline&&(e=new Q,e.setColor(new q(this.sizeRampDarkColor)),e.setWidth(1.5),b.setOutline(e)));return b},_getDataValues:function(a,c,b,e,g,f){g=null==g?5:g;f=null==f?20:f;var h=a.getSizeRangeAtScale(b,this.map.getScale());g=this._interpolateSizeRange(h,g);var l=this._getDataRange(b),m=d.map(g,function(a){return this._getDataValueFromSize(a,l,h)},this);if(!e){var n,m=C.round(m);for(e=1;e<m.length-1;e++)if(n=this._roundDataValue(a,c,b,m[e],m[e-1],f))m[e]=
n[0],g[e]=n[1]}return m},_getDataRange:function(a){var c=a.stops;return c?{min:c[0].value,max:c[c.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,c){var b=a.minSize,e=(a.maxSize-b)/(c-1),d,g=[];for(d=0;d<c;d++)g.push(b+e*d);return g},_getDataValueFromSize:function(a,c,b){var e=b.minSize;b=b.maxSize;var d=c.min;c=c.max;return a=a<=e?d:a>=b?c:(a-e)/(b-e)*(c-d)+d},_roundDataValue:function(a,c,b,e,d,g){var f=this._getSize(c,a,b,e);d=this._getSize(c,a,b,d);var h,
l=C.getDigits(e),m=l.integer,l=l.fractional,n,k,q,r,s,t,p,u,w,v,y;0<e&&1>e&&(h=Math.pow(10,l),e*=h,m=C.getDigits(e).integer);for(m-=1;0<=m&&!(n=Math.pow(10,m),l=Math.floor(e/n)*n,n*=Math.ceil(e/n),null!=h&&(l/=h,n/=h),k=(l+n)/2,k=C.round([l,k,n],{indexes:[1]})[1],q=this._getSize(c,a,b,l),r=this._getSize(c,a,b,n),s=this._getSize(c,a,b,k),t=C.getPctChange(f,q,d,null),p=C.getPctChange(f,r,d,null),u=C.getPctChange(f,s,d,null),w=t.prev<=g,v=p.prev<=g,w&&v&&(t.prev<=p.prev?(w=!0,v=!1):(v=!0,w=!1)),w?y=
[l,q]:v?y=[n,r]:u.prev<=g&&(y=[k,s]),y);m--);return y},_applySize:function(a,c,b,e){var d=a.type;c=this._getSize(a,c,b,e);switch(d){case "simplemarkersymbol":a.setSize(c);break;case "picturemarkersymbol":d=a.width;b=a.height;a.setHeight(c);a.setWidth(c*(d/b));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(c);break;case "textsymbol":a.font&&a.font.setSize(c)}},_getSize:function(a,c,b,e){return c.getSize(e,{sizeInfo:b,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?
a.style:null})},_buildRow_Renderer:function(a,c,b,d,g,f,h){var l=e.create("tr",{},f),m;this.alignRight?(f=e.create("td",{align:this._isRightToLeft?"left":"right"},l),c&&(m=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},l))):(c&&(m=e.create("td",{width:35,align:"center"},l)),f=e.create("td",{},l));var n=l=30,k;if(c){if("simplemarkersymbol"==c.type)l=Math.min(Math.max(l,c.size+12),125),n=Math.min(Math.max(n,c.size+12),125);else if("picturemarkersymbol"==c.type)l=Math.min(Math.max(l,
c.width),125),n=Math.min(c.height||n,125);else if("textsymbol"==c.type){var q,r;c.text||(q=c.text,r=!0,c.setText(this.defaultText));l=Math.min(Math.max(l,c.getWidth()+12),125);n=Math.min(Math.max(n,c.getHeight()+12),125);r&&c.setText(q)}k=e.create("div",{style:"width:"+l+"px;height:"+n+"px;"},m)}D.isDefined(d)&&"number"===typeof d&&(d=""+d);e.create("td",{innerHTML:d||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},f))));c&&(a=this._drawSymbol(k,c,b,l,n,g,
a,h),this._surfaceItems.push(a))},_addSubHeader:function(a,c){var b=e.create("tr",{},a),b=e.create("td",{align:this._align,colspan:2},b);e.create("td",{innerHTML:x.encode(c)||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},b))))},_drawSymbol:function(a,c,b,e,d,g,f,h){c=M.fromJson(c.toJson());var l=f.opacity;b&&c.setColor(new q(b.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;b=c.color.toRgba();
b[3]*=l;c.color.setColor(b)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(b=c.color.toRgba(),b[3]*=l,c.color.setColor(b)),c.outline&&c.outline.color&&(b=c.outline.color.toRgba(),b[3]*=l,c.outline.color.setColor(b))):"picturemarkersymbol"===c.type&&(a.style.opacity=l,a.style.filter="alpha(opacity\x3d("+100*l+"))");a=v.createSurface(a,e,d);9>n("ie")&&(b=a.getEventSource(),t.set(b,"position","relative"),t.set(b.parentNode,"position","relative"));g=this._getDrawingToolShape(c,
g)||M.getShapeDescriptors(c);var m,l=(b=g.defaultShape)&&"text"===b.type;try{l&&!b.text&&(b.text=this.defaultText),m=a.createShape(h||b).setFill(g.fill).setStroke(g.stroke),l&&m.setFont(g.font)}catch(r){a.clear();a.destroy();return}var s=m.getBoundingBox();h=s.width;g=s.height;var l=-(s.x+h/2),p=-(s.y+g/2);b=a.getDimensions();l={dx:l+b.width/2,dy:p+b.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)e=f._getScaleMatrix(s,c.size),m.applyTransform(y.scaleAt(e.xx,e.yy,{x:b.width/2,y:b.height/
2}));else if(h>e||g>d)f=h/e>g/d,e=((f?e:d)-5)/(f?h:g),k.mixin(l,{xx:e,yy:e});m.applyTransform(l);return a},_getDrawingToolShape:function(a,c){var b;switch(c?c.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){d.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(c){}a.children&&k.isArray(a.children)&&
d.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,c,d,g){if(g=c._hoverLabel||c._hoverLabels&&c._hoverLabels[d.id]||g)g=x.encode(g),c.mouseMoveHandler=c.mouseMoveHandler||{},c.mouseMoveHandler[d.id]=b.connect(a,"onmousemove",k.hitch(this,function(a,c){this.mouseX=c.clientX;this.mouseY=c.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(r.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(k.hitch(this,function(a,c,b){if(a==this.mouseX&&c==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,r.byId(this.id+"_hoverLabel")){var d=r.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+b+"\x3c/span\x3e";t.set(d,"top",c+"px");t.set(d,"left",a+15+"px");t.set(d,"display","")}else e.create("div",{innerHTML:"\x3cspan\x3e"+b+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:c+"px",left:a+15+"px"}},document.body)},c.clientX,c.clientY,a),500)},g)),c.mouseOutHandler=c.mouseOutHandler||{},c.mouseOutHandler[d.id]=b.connect(a,"onmouseout",k.hitch(this,function(a){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(r.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;d.forEach(this.layers,function(c){if(c.mouseMoveHandler)for(a in c.mouseMoveHandler)b.disconnect(c.mouseMoveHandler[a]);if(c.mouseOutHandler)for(a in c.mouseOutHandler)b.disconnect(c.mouseOutHandler[a])})},_createDynamicLayers:function(a){var c=[],b;d.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){b={id:e.id};b.source=e.source&&e.source.toJson();
var d;a.layerDefinitions&&a.layerDefinitions[e.id]&&(d=a.layerDefinitions[e.id]);d&&(b.definitionExpression=d);var g;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(g=a.layerDrawingOptions[e.id]);g&&(b.drawingInfo=g.toJson());b.minScale=e.minScale||0;b.maxScale=e.maxScale||0;c.push(b)});return c},_getTemplateFromTypes:function(a,c){var b;for(b=0;b<a.length;b++)if(a[b].id==c&&a[b].templates&&0<a[b].templates.length)return a[b].templates[0];return null},_findParentGroup:function(a,c,b){var e,d=
c.dynamicLayerInfos||c.layerInfos;for(e=0;e<d.length;e++)if(b==d[e].id){-1<d[e].parentLayerId&&(t.set(r.byId(this.id+"_"+a+"_"+d[e].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,c,d[e].parentLayerId));break}},_addSubLayersToHide:function(a){function c(b,e){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,f,h;for(f=0;f<g.length;f++)if(g[f].id===b&&g[f].subLayerIds)for(h=0;h<g[f].subLayerIds.length;h++){var l=g[f].subLayerIds[h];-1===d.indexOf(e,l)&&(e.push(l),c(l,e))}}a.layer.layerInfos&&
d.forEach(this.hideLayersInLegend[a.layer.id],function(b){c(b,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,c,b){var e,d=!0;if(a.legendResponse&&a.legendResponse.layers)for(e=0;e<a.legendResponse.layers.length;e++){var g=a.legendResponse.layers[e];if(c.id==g.layerId){var f,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(f=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(f=Math.min(a.minScale,
g.minScale)||a.minScale||g.minScale,h=Math.max(a.maxScale,g.maxScale));if(0<f&&f<b||h>b)d=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<b||a.maxScale&&a.maxScale>b)d=!1;return d},_getServiceTitle:function(a){var c=a._titleForLegend;c||((c=a.url)?-1<a.url.indexOf("/MapServer")?(c=a.url.substring(0,a.url.indexOf("/MapServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):-1<a.url.indexOf("/ImageServer")?(c=a.url.substring(0,a.url.indexOf("/ImageServer")),c=c.substring(c.lastIndexOf("/")+
1,c.length)):-1<a.url.indexOf("/FeatureServer")&&(c=a.url.substring(0,a.url.indexOf("/FeatureServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):c="",a.name&&(c=0<c.length?c+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],D.isDefined(a)&&(c+=" ("+a+")"));return x.encode(c)},_getEffectiveScale:function(a,
c){var b=c.minScale,e=c.maxScale;if(D.isDefined(c.parentLayerId)){var d=a.layerInfos,g=c.parentLayerId,f;for(f=d.length-1;0<=f;f--)if(d[f].id==g)if(0==b&&0<d[f].minScale?b=d[f].minScale:0<b&&0==d[f].minScale||0<b&&0<d[f].minScale&&(b=Math.min(b,d[f].minScale)),e=Math.max(e||0,d[f].maxScale||0),-1<d[f].parentLayerId)g=d[f].parentLayerId;else break}return{minScale:b,maxScale:e}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var c=
/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&c.test(a.url)?!0:!1},getField:function(a,c,b){if(a.getField)return a.getField(c);if(b&&b.fields){var e;d.forEach(b.fields,function(a){a.name===c&&(e=a)});return e}return null}});k.mixin(z,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return z})},"dojo/debounce":function(){define([],function(){return function(p,f){var k;return function(){k&&clearTimeout(k);var d=this,b=arguments;k=setTimeout(function(){p.apply(d,
b)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(p,f,k,d){var b=function(b,a){return b-a},m={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(b){var a=String(b),d=a.match(m._reNumber);b={integer:0,fractional:0};d&&d[1]?(b.integer=d[1].split("").length,b.fractional=d[3]?d[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(d=a.split("e"),a=d[0],d=d[1],a&&d&&(a=Number(a),d=Number(d),(b=0<d)||(d=Math.abs(d)),a=m.getDigits(a),
b?(a.integer+=d,a.fractional=d>a.fractional?0:a.fractional-d):(a.fractional+=d,a.integer=d>a.integer?1:a.integer-d),b=a));return b},getFixedNumbers:function(b,a){var d,f;d=Number(b.toFixed(a));d<b?f=d+1/Math.pow(10,a):(f=d,d-=1/Math.pow(10,a));d=Number(d.toFixed(a));f=Number(f.toFixed(a));return[d,f]},getPctChange:function(b,a,d,f){var m={prev:null,next:null},g;null!=d&&(g=b-d,d=a-d-g,m.prev=Math.floor(Math.abs(100*d/g)));null!=f&&(g=f-b,d=f-a-g,m.next=Math.floor(Math.abs(100*d/g)));return m},round:function(d,
a){var f=d.slice(0),l,k,g,h,r,e,t,c,p,v=!a||null==a.tolerance?2:a.tolerance,y=a&&a.indexes,x=!a||null==a.strictBounds?!1:a.strictBounds;if(y)y.sort(b);else{y=[];for(e=0;e<f.length;e++)y.push(e)}for(e=0;e<y.length;e++)if(p=y[e],l=f[p],k=0===p?null:f[p-1],g=p===f.length-1?null:f[p+1],h=m.getDigits(l),h=h.fractional){t=0;for(c=!1;t<=h&&!c;)r=m.getFixedNumbers(l,t),r=x&&0===e?r[1]:r[0],c=m.hasMinimalChange(l,r,k,g,v),t++;c&&(f[p]=r)}return f},hasMinimalChange:function(b,a,d,f,k){b=m.getPctChange(b,a,
d,f);a=null==b.prev||b.prev<=k;d=null==b.next||b.next<=k;return a&&d||b.prev+b.next<=2*k},_reAllZeros:RegExp("\\"+k.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(b,a){a=a||{places:20,round:-1};var d=f.format(b,a);d&&(d=d.replace(m._reSomeZeros,"$1").replace(m._reAllZeros,""));return d}};return m})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(p,f,k,d,b,m,q,a,n){function l(a){return a&&f.map(a,function(a){return new q(a)})}function s(a,c,b){var e="";0===c?e=h.lt+" ":c===b&&(e=h.gt+" ");return e+a}var g={},h={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},r={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},e={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},t={formatLength:"short",fullYear:!0},c={formatLength:"short"};p.mixin(g,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var e,g=[];null!=a&&!(a instanceof
Date)&&(a=new Date(a));b=b||{};b=p.mixin({},b);var h=b.selector?b.selector.toLowerCase():null;e=!h||-1<h.indexOf("time");h=!h||-1<h.indexOf("date");e&&(b.timeOptions=b.timeOptions||c,b.timeOptions&&(b.timeOptions=p.mixin({},b.timeOptions),b.timeOptions.selector=b.timeOptions.selector||"time",g.push(b.timeOptions)));h&&(b.dateOptions=b.dateOptions||t,b.dateOptions&&(b.dateOptions=p.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",g.push(b.dateOptions)));g&&g.length?(g=
f.map(g,function(c){return d.format(a,c)}),e=1==g.length?g[0]:n["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,c){return g[c]})):e=d.format(a);return e},createColorStops:function(a){var c=a.values,b=a.colors,e=a.labelIndexes,d=a.isDate,h=a.dateFormatOptions;a=[];return a=f.map(c,function(a,l){var n=null;if(!e||-1<f.indexOf(e,l)){var k;(k=d?g.formatDate(a,h):m.format(a))&&(n=s(k,l,c.length-1))}return{value:a,color:b[l],label:n}})},updateColorStops:function(a){var c=a.stops,
b=a.changes,e=a.isDate,d=a.dateFormatOptions,h=[],l,n=f.map(c,function(a){return a.value});f.forEach(b,function(a){h.push(a.index);n[a.index]=a.value});l=m.round(n,{indexes:h});f.forEach(c,function(a,b){a.value=n[b];if(null!=a.label){var f,h=null;(f=e?g.formatDate(l[b],d):m.format(l[b]))&&(h=s(f,b,c.length-1));a.label=h}})},createClassBreakLabel:function(c){var b=c.minValue,e=c.maxValue,d=c.isFirstBreak?"":h.gt+" ";c="percent-of-total"===c.normalizationType?h.pct:"";b=null==b?"":m.format(b);e=null==
e?"":m.format(e);return d+b+c+" "+a.smartMapping.minToMax+" "+e+c},setLabelsForClassBreaks:function(a){var c=a.classBreaks,b=a.classificationMethod,e=a.normalizationType,d=[];c&&c.length&&("standard-deviation"===b?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(d.push(c[0].minValue),f.forEach(c,function(a){d.push(a.maxValue)}),d=m.round(d),f.forEach(c,function(a,c){a.label=g.createClassBreakLabel({minValue:0===c?d[0]:
d[c],maxValue:d[c+1],isFirstBreak:0===c,normalizationType:e})})):f.forEach(c,function(a,c){a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===c,normalizationType:e})}))},updateClassBreak:function(a){var c=a.classBreaks,b=a.normalizationType,e=a.change,d=e.index,e=e.value,f=-1,h=-1,l=c.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===d?
f=d:d===l?h=d-1:(h=d-1,f=d),-1<f&&f<l&&(a=c[f],a.minValue=e,a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===f,normalizationType:b})),-1<h&&h<l&&(a=c[h],a.maxValue=e,a.label=g.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:b})))},calculateDateFormatInterval:function(a){var c,b,e=a.length,d,g,h,l,m,n,k=Infinity,q;a=f.map(a,function(a){return new Date(a)});for(c=0;c<e-1;c++){d=a[c];h=[];m=Infinity;n="";for(b=
c+1;b<e;b++)g=a[b],g=d.getFullYear()!==g.getFullYear()&&"year"||d.getMonth()!==g.getMonth()&&"month"||d.getDate()!==g.getDate()&&"day"||d.getHours()!==g.getHours()&&"hour"||d.getMinutes()!==g.getMinutes()&&"minute"||d.getSeconds()!==g.getSeconds()&&"second"||"millisecond",l=r[g],l<m&&(m=l,n=g),h.push(g);m<k&&(k=m,q=n)}return q},createUniqueValueLabel:function(a){var c=a.value,b=a.fieldInfo,d=a.domain;a=a.dateFormatInterval;var f=String(c);(d=d&&d.codedValues?d.getName(c):null)?f=d:"number"===typeof c&&
(f=b&&"esriFieldTypeDate"===b.type?g.formatDate(c,a&&e[a]):m.format(c));return f},cloneColorInfo:function(a){var c;a&&(c=p.mixin({},a),c.colors=l(c.colors),c.stops=c.stops&&f.map(c.stops,function(a){a=p.mixin({},a);a.color&&(a.color=new q(a.color));return a}),c.legendOptions&&(c.legendOptions=p.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(a){var c;if(a){c=p.mixin({},a);if(a=c.opacityValues)c.opacityValues=a.slice(0);if(a=c.stops)c.stops=f.map(a,function(a){return p.mixin({},a)});
if(a=c.legendOptions)c.legendOptions=p.mixin({},a)}return c},cloneSizeInfo:function(a){var c;if(a){c=p.mixin({},a);c.stops&&(c.stops=f.map(c.stops,function(a){return p.mixin({},a)}));if((a=c.minSize)&&"object"===typeof a)c.minSize=g.cloneSizeInfo(a);if((a=c.maxSize)&&"object"===typeof a)c.maxSize=g.cloneSizeInfo(a);if(a=c.legendOptions)if(c.legendOptions=p.mixin({},a),a=a.customValues)c.legendOptions.customValues=a.slice(0)}return c}});return g})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(p,f,k,d,b){return p(d,{constructor:function(){},getExtent:function(){var b=this.layerObject.items;if(0===b.length)return null;b=k.graphicsExtent(b);return this._convertGeometryToMapSpatialRef(b)},_resetLayerObjectVisiblity:function(b){var d=b?b[this.id]:null;d&&(f.forEach(this.newSubLayers,function(a){var d=b?b[a.id]:null;d&&a.layerObject.setVisibility(d.visible)},this),this._setTopLayerVisible(d.visible))},initVisible:function(){var b=
!1,d;for(d=0;d<this.newSubLayers.length;d++)b=b||this.newSubLayers[d].layerObject.visible;b&&(this._visible=!0)},_setTopLayerVisible:function(b){this._visible=b?!0:!1;f.forEach(this.newSubLayers,function(b){b.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var d=[],k=this.layerObject.getFeatureLayers();f.forEach(k,function(a){a=b.getInstance().create({layerObject:a,title:a.label||a.title||a.name||a.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"geo_rss",
parentLayerInfo:this});d.push(a);a.init()},this);return d},_obtainLayerIndexesInMap:function(){var b=[],d,a;for(a=0;a<this.newSubLayers.length;a++)(d=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&b.push(d);return b},moveLeftOfIndex:function(b){var d;for(d=this.newSubLayers.length-1;0<=d;d--)this.map.reorderLayer(this.newSubLayers[d].layerObject,b)},moveRightOfIndex:function(b){var d;for(d=0;d<this.newSubLayers.length;d++)this.map.reorderLayer(this.newSubLayers[d].layerObject,
b)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer esri/lang".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g){return p(a,{constructor:function(a,b){},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},_resetLayerObjectVisiblity:function(a){var b=a?
a[this.id]:null;if(a){b&&this.layerObject.setVisibility(b.visible);var e=[],d=!1;f.forEach(this.layerObject.layerInfos,function(c){var b=this.id+"_"+c.name;g.isDefined(a[b])&&(d=!0,a[b].visible&&e.push(c.name))},this);if(0<e.length||d)this.layerObject.setVisibleLayers(e),this.traversal(function(a){a.initVisible()})}},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var b=
[],e,b=k.clone(this.originOperLayer.layerObject.visibleLayers),d;for(d in a)if(a.hasOwnProperty(d)&&"function"!==typeof a[d]){var c=a[d],g=d.toString();e=f.indexOf(b,g);c?0>e&&b.push(g):0<=e&&b.splice(e,1)}this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[];f.forEach(this.layerObject.layerInfos,function(b,e){var d;d=l.getInstance().create({layerObject:this.layerObject,title:b.label||b.title||b.name||" ",id:this.id+"_"+(b.name||" "),wms:{layerInfo:this,subId:b.name,
wmsLayerInfo:b},selfType:"wms",parentLayerInfo:this});a.push(d);d.init()},this);return a},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&q.after(this.layerObject,"setVisibleLayers",k.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(b){b.initVisible();a.push(b)});d.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(p,f,k,d,b,m,q){return p(q,{constructor:function(a,b){this.layerObject=a.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},initVisible:function(){var a=[],a=!1,a=k.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=a=0<=f.indexOf(a,this.originOperLayer.wms.subId)?!0:!1},_setTopLayerVisible:function(a){var b=this.originOperLayer.wms;this._visible=a?!0:!1;var d={};d[b.subId]=a;b.layerInfo.setSubLayerVisible(d)},drawLegends:function(a){this._initLegendsNode(a)},
_initLegendsNode:function(a){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var f=b.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});m(f,"load",function(){b.empty(a);var l=b.create("div",{"class":"legend-div"},a);d.place(f,l)})}else b.empty(a)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(a){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},
"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),function(p,f,k,d,b,m,q){return p(m,{constructor:function(a,b,d){this.noLegend=d},getExtent:function(){},initVisible:function(){var a=!1,b=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<b.layerInfo.subLayerVisible[b.subId]&&(a=!0);this._visible=a},_setTopLayerVisible:function(a){var b;if(this.originOperLayer.mapService&&
(b=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){a?b.layerInfo.subLayerVisible[b.subId]++:b.layerInfo.subLayerVisible[b.subId]--;this._visible=a;var d={};this.traversal(function(a){0===a.getSubLayers().length&&(d[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});b.layerInfo.setSubLayerVisible(d)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(a){},_sevVisible:function(a){this.visible=a},obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,
function(b){b.parentLayerInfo=this;b=q.getInstance().create(b);a.push(b);b.init()},this);return a},getOpacity:function(){},setOpacity:function(a){},getLayerObject:function(){var a=new d;this.layerObject.empty?b({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(k.hitch(this,function(b){var d=this.layerObject.url;this.layerObject=b;this.layerObject.url=d;this.layerObject.id=this.id;a.resolve(this.layerObject)}),function(b){a.reject(b)}):a.resolve(this.layerObject);
return a},getLayerType:function(){var a=new d;a.resolve("GroupLayer");return a},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var a=this.originOperLayer.mapService;return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare",
"./LayerInfoForDefaultService"],function(p,f){return p(f,{constructor:function(f,d){},initVisible:function(){var f=!1,d=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<d.layerInfo.subLayerVisible[d.subId]&&(f=!0);this._visible=f},_setTopLayerVisible:function(f){var d;this.originOperLayer.mapService&&(d=this.originOperLayer.mapService,f?d.layerInfo.subLayerVisible[d.subId]++:d.layerInfo.subLayerVisible[d.subId]--,this._visible=f,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var f=
this.originOperLayer.mapService,d={};d[f.subId]=this.isVisbleOrInvisilbe();f.layerInfo.setSubLayerVisible(d)},isVisbleOrInvisilbe:function(){for(var f=this.originOperLayer.mapService,d=-1,b=f.subId,m=0;;){d++;m+=f.layerInfo.subLayerVisible[b];b=f.layerInfo._getJsapiLayerInfoById(b);if(-1===b.parentLayerId)return m>d?!0:!1;b=b.parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s){return p(m,{_legendsNode:null,_layerObjectLoadingIndicator:null,constructor:function(){this._layerObjectLoadingIndicator={loadingFlag:!1,loadedDef:new d}},_resetLayerObjectVisiblity:function(){},_loadLegends:function(a){var b=new d;this.originOperLayer.mapService.layerInfo.getLegendInfo(a).then(k.hitch(this,function(a){b.resolve(a)}));return b},drawLegends:function(a,b){this._loadLegends(b).then(k.hitch(this,function(b){this._initLegendsNode(b,a)}))},_initLegendsNode:function(a,
d){var l=this.originOperLayer.mapService;if(a){b.empty(d);for(var e=null,m=0;m<a.length;m++)if(a[m].layerId===l.subId){e=a[m];break}if(e){var c=b.create("table",{"class":"legend-table",style:"font-size: 12px"},d);f.forEach(e.legend,function(a){if("\x3call other values\x3e"!==a.label){var e=b.create("tr",{"class":"legend-tr",style:"border: 1px solid"},c),d=b.create("td",{"class":"legend-symbol-td",style:""},e),g=null,g=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;b.create("img",{"class":"legend-symbol-image",
style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:g},d);b.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},e)}},this)}}},_initControlPopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:a.infoTemplates&&a.infoTemplates[b]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,
b=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&a.infoTemplates&&delete a.infoTemplates[b]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getLayerObject:function(){var b=new d,f,m;this.getLayerType().then(k.hitch(this,function(e){this.layerObject.empty?("RasterLayer"===e?this.layerObject=new a(this.layerObject.url):"FeatureLayer"===e?this.layerObject=new q(this.layerObject.url,
this._getLayerOptionsForCreateLayerObject()):"StreamLayer"===e?this.layerObject=new n(this.layerObject.url):"ArcGISImageServiceLayer"===e?this.layerObject=new l(this.layerObject.url):"ArcGISImageServiceVectorLayer"===e&&(this.layerObject=new s(this.layerObject.url)),this.layerObject.empty?b.resolve():(this._layerObjectLoadingIndicator.loadingFlag=!0,f=this.layerObject.on("load",k.hitch(this,function(){!this.layerObject.empty&&(this.layerObject.name&&!k.getObject("_wabProperties.originalLayerName",
!1,this.layerObject))&&(k.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=this.title);this.layerObject.id=this.id;b.resolve(this.layerObject);this._layerObjectLoadingIndicator.loadedDef.resolve(this.layerObject);f.remove&&f.remove()})),m=this.layerObject.on("error",k.hitch(this,function(){b.resolve(null);this._layerObjectLoadingIndicator.loadedDef.resolve(null);m.remove&&m.remove()})))):this._layerObjectLoadingIndicator.loadingFlag?this._layerObjectLoadingIndicator.loadedDef.then(k.hitch(this,
function(a){b.resolve(a)})):b.resolve(this.layerObject)}),k.hitch(this,function(){b.resolve(null)}));return b},getPopupInfo:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var d=0;d<b.length;d++)if(b[d].id===this.originOperLayer.mapService.subId){a=b[d].popupInfo;break}return a},getFilterOfWebmap:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var d=0;d<b.length;d++)if(b[d].id===this.originOperLayer.mapService.subId){a=
b[d].layerDefinition?b[d].layerDefinition.definitionExpression:null;break}return a},getFilter:function(){var a=this.originOperLayer.mapService;return a.layerInfo.layerObject&&a.layerInfo.layerObject.layerDefinitions?a.layerInfo.layerObject.layerDefinitions[a.subId]:null},setFilter:function(a){var b,d=this.originOperLayer.mapService;d.layerInfo.layerObject&&d.layerInfo.layerObject.setLayerDefinitions&&(b=d.layerInfo.layerObject.layerDefinitions?f.map(d.layerInfo.layerObject.layerDefinitions,function(a){return a}):
[],b[d.subId]=a,d.layerInfo.layerObject.setLayerDefinitions(b))},getLayerType:function(){var a=new d,b=this.originOperLayer.mapService;b.layerInfo._getSublayerDefinition(b.subId).then(k.hitch(this,function(b){b?a.resolve(b.type.replace(/\ /g,"")):a.resolve(null)}),function(){a.resolve(null)});return a},getSupportTableInfo:function(){var a=new d,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(k.hitch(this,function(d){b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&
(b.isSupportedLayer=!0);d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(k.hitch(this,function(e){e&&0<=e.capabilities.indexOf("Data")&&(b.isSupportQuery=!0);a.resolve(b)}),function(){a.resolve(b)})}),function(){a.resolve(b)});return a},enablePopup:function(){var a=this.originOperLayer.mapService.layerInfo,b=a.layerObject,d=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(k.hitch(this,function(){return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[d]?
(this.controlPopupInfo.enablePopup=!0,b.infoTemplates||(b.infoTemplates={}),b.infoTemplates[d]=a.controlPopupInfo.infoTemplates[d],!0):!1}))},disablePopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;a.infoTemplates&&delete a.infoTemplates[b]},loadInfoTemplate:function(){var a=new d,b=this.originOperLayer.mapService.layerInfo,f=this.originOperLayer.mapService.subId;b.controlPopupInfo.infoTemplates&&
b.controlPopupInfo.infoTemplates[f]&&b.controlPopupInfo.infoTemplates[f].infoTemplate?a.resolve(b.controlPopupInfo.infoTemplates[f].infoTemplate):(b.controlPopupInfo.infoTemplates||(b.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(k.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);b.controlPopupInfo.infoTemplates[f]={infoTemplate:e,layerUrl:null};a.resolve(e)}),k.hitch(this,function(){a.resolve(null)})));return a},getInfoTemplate:function(){var a=this.originOperLayer.mapService.layerInfo,
b=this.originOperLayer.mapService.subId;return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[b]&&a.controlPopupInfo.infoTemplates[b].infoTemplate?a.controlPopupInfo.infoTemplates[b].infoTemplate:null},getScaleRange:function(){var a=this.originOperLayer.mapService;return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e){return p([s,g],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,c){this.pixelData=null;(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!(this._isVectorData()||this.pixelFilter&&!this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var a,c;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){a=[];for(c=0;c<this.minValues.length;c++)a.push([this.minValues[c],this.maxValues[c],this.meanValues[c],this.stdvValues[c]]);this.bandCount!==a.length&&(a=null)}c=0;var b=!1;"U8"===this.pixelType?(c=5,b=a?!1:!0):a?(c=5,b=!1):(c=6,b=!0);this.renderingRule&&(c=5,b=!0);this.pixelFilter=(new h({stretchType:c,min:0,max:255,dra:b,minPercent:0.25,maxPercent:0.25,useGamma:!1,computeGamma:!1,
statistics:a,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r){var e=l.defaults.map.zoomDuration;return p([r],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,
opacity:1,constructor:function(a,c){this.drawMode=c&&void 0!==c.drawMode?c.drawMode:!0;this.drawType=c&&c.drawType?c.drawType:"2d";this.pixelData=null;this._initialize(a,c)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>b("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;q.set(this._div,n._css.names.transform,n._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new h((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,c){this.pixelFilter=a;c||this.redraw()},_toggleTime:function(){},_setMap:function(a,c){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var b=this._div=m.create("div",null,c),e={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(e[n._css.names.transform]=n._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;q.set(b,e);this._canvas=m.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},b);s.isDefined(this.opacity)&&q.set(b,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(k.connect(a,"onPan",this,this._panHandler));this._connects.push(k.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(k.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(k.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(k.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(k.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(k.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(k.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(k.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var d=k.connect(a,"onLoad",this,function(){k.disconnect(d);d=null;this.evaluateSuspension()});return b},_unsetMap:function(a,c){d.forEach(this._connects,k.disconnect,this);var b=this._div;b&&(c.removeChild(b),m.destroy(b));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!(!this._map||!this._canvas||!this._context)},
_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();if((a||!this.drawMode)&&"css-transforms"===this._map.navigationMode)this._tdx=this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,n._css.names.transform,n._css.translate(this._left,this._top)),q.set(this._canvas,n._css.names.transform,n._css.translate(-this._left,
-this._top)),this._dragOrigin={x:0,y:0};if(this._canDraw&&this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(!this.pixelData||!this.pixelData.pixelBlock)this.clear();else{var a=this.pixelData.pixelBlock,c=this._context,b=c.createImageData(a.width,a.height);b.data.set(a.getAsRGBA());var e=this.pixelData.extent,d=this._map.extent,g=this.getCurrentResolution(),f=0,h=0;Math.abs(e.xmin-d.xmin)>g.x&&(f=Math.round((e.xmin-d.xmin)/g.x));Math.abs(d.ymax-e.ymax)>g.y&&(h=Math.round((d.ymax-e.ymax)/
g.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,n._css.names.transform,n._css.translate(this._left,this._top)),q.set(this._canvas,n._css.names.transform,n._css.translate(-this._left,-this._top))):(q.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),q.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin=
{x:0,y:0};c.putImageData(b,f,h,0,0,a.width,a.height);this._fireUpdateEnd()}},_panHandler:function(a,c){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+c.x,this._top=this._map.__visibleDelta.y+c.y,q.set(this._div,n._css.names.transform,n._css.translate(this._left,this._top))):q.set(this._div,{left:this._startRect.left+c.x+"px",top:this._startRect.top+c.y+"px"})},_panEndHandler:function(a,c){c&&(this._startRect.left+=c.x,this._startRect.top+=c.y)},_onScaleHandler:function(b,
c){var d={},g=n._css.names;q.set(this._canvas,g.transition,c?"none":g.transformName+" "+e+"ms ease");this._matrix=b;b=this._multiply?a.multiply(b,this._multiply):b;if(this._tdx||this._tdy)b=a.multiply(b,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});d[g.transform]=n._css.matrix(b);q.set(this._canvas,d)},_onZoomHandler:function(a,c,b){var e=this._startRect;a=e.width*c;c*=e.height;var d=e.left-(a-e.width)*(b.x-e.left)/e.width;b=e.top-(c-e.height)*(b.y-e.top)/e.height;q.set(this._canvas,{left:d+
"px",top:b+"px",width:a+"px",height:c+"px"});this._endRect={left:d,top:b,width:a,height:c}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,c,b){q.set(this._div,{width:c+"px",height:b+"px"});q.set(this._canvas,{width:c+"px",height:b+"px"});this._startRect.width=this._canvas.width=c;this._startRect.height=this._canvas.height=b},_extentChangeHandler:function(b,c,e,d){if(!this.suspended&&(!c||!(0===c.x&&0===c.y&&!e)))"css-transforms"===this._map.navigationMode&&
(c&&(this._dragOrigin.x+=c.x,this._dragOrigin.y+=c.y),e||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,q.set(this._div,n._css.names.transform,n._css.translate(this._left,this._top))),e&&(q.set(this._canvas,n._css.names.transition,"none"),this._multiply=this._multiply?a.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),b=this._map,this._requestData(b.extent,b.width,b.height)},_visibilityChangeHandler:function(a){a?g.show(this._div):g.hide(this._div)},
_opacityChangeHandler:function(a){q.set(this._div,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C,E,F,G,I){return p(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0},constructor:function(a,c){this.useMapTime=c&&c.hasOwnProperty("useMapTime")?!!c.useMapTime:!0},_initialize:function(a,c){this._url=e.urlToObject(a);this.raster=new w(this._url.path);this.infoTemplate=
c&&c.infoTemplate;var b=c&&c.imageServiceParameters;this.format=b&&b.format;this.compressionTolerance=b&&b.compressionTolerance?b.compressionTolerance:0.01;this.interpolation=b?b.interpolation:null;this.compressionQuality=b?b.compressionQuality:null;this.bandIds=b?b.bandIds:null;this.mosaicRule=b?b.mosaicRule:null;this.renderingRule=b?b.renderingRule:null;this.useMapDimensionValue=c&&c.hasOwnProperty("useMapDimensionValue")?!!c.useMapDimensionValue:!0;this.activeMapDimensions=c&&c.activeMapDimensions;
this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},b?b.toJson():{});this.pixelFilter=c&&c.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,
this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=c&&c.loadCallback;(b=c&&c.resourceInfo)?this._initLayer(b):h({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},
disableClientCaching:!1,_initLayer:function(a,c){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var b=this.minScale,e=this.maxScale;f.mixin(this,a);this.minScale=b;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=new t(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var d=this.minValues,h=this.maxValues,
l=this.meanValues,m=this.stdvValues,n=this.bands=[],b=0,e=this.bandCount;b<e;b++)n[b]={min:d[b],max:h[b],mean:l[b],stddev:m[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new C(b):null;e=this.fields=[];if(d=a.fields)for(b=0;b<d.length;b++)e.push(new E(d[b]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);g.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);g.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);
b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=a.sortValue):b.method=v.METHOD_NONE;this.defaultMosaicRule=new v(b);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&
this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=f.clone(a.fields))}));this._isVectorData()&&!g.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new A,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===
this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",c=new k(r._dfdCanceller);10<this.version?(c._pendingDfd=h({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},
function(a){c.errback(a)})):(a=Error("Layer does not have key properties"),a.log=m.isDebug,c.errback(a));return c},getRasterAttributeTable:function(a){var c=this._url.path+"/rasterAttributeTable",e=new k(r._dfdCanceller),d={f:"json"},g=this.hasRasterAttributeTable;a&&a.renderingRule&&(d.renderingRule=b.toJson(a.renderingRule.toJson()),g=!0);10<this.version&&g?(e._pendingDfd=h({url:c,content:d,handleAs:"json",callbackParamName:"callback"}),e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})):
(a=Error("Layer does not support raster attribute table"),a.log=m.isDebug,e.errback(a));return e},_getRenderingRuleAttributeTable:function(a){var c=new k(r._dfdCanceller);if(!a||!a.renderingRule)return c.errback(Error("Rendering rule is not specified")),c;a=a.renderingRule;var b=a.functionName;this._renderingRuleAttributeTable&&b&&this._renderingRuleAttributeTable.hasOwnProperty(b)?c.resolve(this._renderingRuleAttributeTable[b]):c=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,
function(a){var c;a&&(a.features&&a.features.length&&a.fields&&a.fields.length)&&(c={features:f.clone(a.features),fields:f.clone(a.fields)},b&&(this._renderingRuleAttributeTable[b]=c));return c}));return c},_getRasterAttributeTableFeatures:function(){var a=new k;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return!a?(a=new k,a.errback(Error("Rendering rule is not specified")),a):this._getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features})},getCustomRasterFields:function(a){var c=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;
a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var b={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},e={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},h={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},l=this.fields?f.clone(this.fields):[];a=l.length;
l[a]=e;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))a++,l[a]=h;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,l[a]=b;if(g.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))b={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},e={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,l[a]=b,a++,l[a]=e;a=this._rasterAttributeTableFields;if((b=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(b))a=this._renderingRuleAttributeTable[b].fields;a&&0<a.length&&(a=d.filter(a,function(a){return"esriFieldTypeOID"!==
a.type&&"value"!==a.name.toLowerCase()}),a=d.map(a,function(a){var b=f.clone(a);b.name=c+a.name;return b}),l=l.concat(a));var m=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&d.forEach(this.rasterFunctionInfos,function(a){a&&(a.name&&"none"!==a.name.toLowerCase())&&(a={name:m+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},l.push(a))});return l},_prepareGetImageParameters:function(a,c,e,d){d=g.isDefined(d)?
d:this._params;var h=a.spatialReference.wkid||b.toJson(a.spatialReference.toJson(!1));delete d._ts;f.mixin(d,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:c+","+e},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete d.compressionTolerance;d.format&&"LERC"===d.format.toUpperCase()&&(d.compressionTolerance=this.compressionTolerance);d.token=this._getToken()},getImageUrl:function(a,c,b,d,l){l=g.isDefined(l)?l:this._params;this._prepareGetImageParameters(a,c,b,l);a=
f.clone(l);this._cleanupRequestParams(a);c=this._url.path+"/exportImage?";b=e.addProxy(c+n.objectToQuery(f.mixin(a,{f:"image"})));var m=a.token;b.length>s.defaults.io.postLength||this.useMapImage?this._jsonRequest=h({url:c,content:f.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,c){var b=a.href;m&&(b+=-1===b.indexOf("?")?"?token\x3d"+m:"\x26token\x3d"+m);d(e.addProxy(b))},error:this._errorHandler}):d(b)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
c){this.interpolation=this._params.interpolation=a;c||this.refresh(!0)},setCompressionQuality:function(a,c){this.compressionQuality=this._params.compressionQuality=a;c||this.refresh(!0)},setCompressionTolerance:function(a,c){this.compressionTolerance=a;c||this.refresh(!0)},setBandIds:function(a,c){var b=!1;this.bandIds!==a&&(b=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(b&&!c)this.onRenderingChange();c||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;
a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,c){var e=!1;this.mosaicRule!==a&&(e=!0);this.mosaicRule=a;this._params.mosaicRule=b.toJson(a.toJson());if(e&&!c)this.onMosaicRuleChange();c||this.refresh(!0)},setRenderingRule:function(a,c){var e=!1;this.renderingRule!==a&&(e=!0);this.renderingRule=a;this._params.renderingRule=a?b.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:a});
if(e)this.onRenderingChange();this._setDefaultFilter();c||this.refresh(!0)},setImageFormat:function(a,c){this.format=this._params.format=a;this._setDefaultFilter();c||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,c){var b=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?b=this.defaultMosaicRule.toJson():b.method=v.METHOD_NONE);b.where=a;b=new v(b);this.setMosaicRule(b,c);return this},getDefinitionExpression:function(){return this.mosaicRule?
this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,b,e,g){var h=this._map,l=r._fixDfd(new k(r._dfdCanceller));
this._visibleRasters=[];var m,n,q=!0,s=this.infoTemplate?this.infoTemplate.info:null,p=s?f.clone(this.infoTemplate.info.fieldInfos):null;b=b||{};if(s&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var t=[];d.forEach(this.infoTemplate.info.mediaInfos,function(a){t=t.concat(a&&a.value&&a.value.fields||[])});t.length&&d.forEach(p,function(a){a&&-1<t.indexOf(a.fieldName)&&(a.visible=!0)})}if(p&&0<p.length){q=!1;for(m=0;m<p.length;m++)if((n=p[m])&&n.fieldName.toLowerCase()!==
this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(n.visible||s.title&&-1<s.title.toLowerCase().indexOf(n.fieldName.toLowerCase()))){q=!0;break}}var w=(n=this._removeVisualizationStretchFunction(this.renderingRule))&&n.functionName,u=[];if(10.4<=this.version){var v=!1;if(this.rasterFunctionInfos&&p){var x=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(this.rasterFunctionInfos,function(a){var c=x+a.name.replace(/ /gi,"_");d.some(p,function(a){return a.visible&&a.fieldName===
c})&&(v=v||w&&w===a.name,u.push(new y({rasterFunction:a.name})))})}n&&!v&&u.push(n)}m=new I;m.geometry=a.geometry;m.returnGeometry=this._map.spatialReference.equals(this.spatialReference);m.returnCatalogItems=q;m.timeExtent=a.timeExtent;m.mosaicRule=this.mosaicRule||null;m.renderingRule=10.4>this.version&&n||null;m.renderingRules=u||null;h&&(a=new c((h.extent.xmax-h.extent.xmin)/h.width,(h.extent.ymax-h.extent.ymin)/h.height,h.extent.spatialReference),m.pixelSize=a);b.requestParams=m;var B=this;a=
new G(this.url);(l._pendingDfd=a.execute(m)).addCallbacks(function(a){B._queryVisibleRastersHandler(a,b,e,g,l)},function(a){B._resolve([a],null,g,l,!0)});return l},_queryVisibleRastersHandler:function(a,c,e,l,m){function n(){var a=this.getCustomRasterFields(c),b=this._getDomainFields(a),h=c?c.returnDomainValues:!1,l=c&&c.rasterAttributeTableFieldPrefix,p,w,u,y,v,x,A,C,F,E;this._useRenderingRuleAttributeTable&&this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
E=k):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(p=0;p<s.length;p++){S=s[p];S.setInfoTemplate(this.infoTemplate);S._layer=this;if(k){F=k.replace(/ /gi,"").split(",");w=k;u=F;r&&r.length>=p&&(w=r[p].replace(/ /gi,", "),u=r[p].split(" "));S.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=u;S.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=F;q&&(S.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=q.replace(/ /gi,"").split(","));if(this.pixelFilter){var c=
new B({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});d.forEach(u,function(a){c.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:c,extent:new t(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)S.attributes[this._rasterFieldPrefix+"Magnitude"]=c.pixels[0][0],S.attributes[this._rasterFieldPrefix+"Direction"]=c.pixels[1][0]}d.forEach(D,
function(a){S.attributes[a.name]=a.value});var n=E||w;if(a&&0<a.length&&(y=d.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==n:a.attributes.VALUE==n}),0<y.length&&(v=f.clone(y[0]),l&&v))){C={};for(x in v.attributes)v.attributes.hasOwnProperty(x)&&(A=l+x,C[A]=v.attributes[x]);v.attributes=C;S.attributes=f.mixin(S.attributes,v.attributes)}}h&&(b&&0<b.length)&&d.forEach(b,function(a){if(a){var c=S.attributes[a.name];g.isDefined(c)&&(c=this._getDomainValue(a.domain,
c),g.isDefined(c)&&(S.attributes[a.name]=c))}},this);Z.push(S);this._visibleRasters.push(S)}this._resolve([Z,null,!0],null,e,m)}))}var k=a.value,q=a.value,r,s,p=0,w=0,y=this,v=this.objectIdField,x,A,D=[];l=c.requestParams.renderingRules;var C=a.processedValues,E=this.renderingRule&&b.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(l&&C&&l.length===C.length){var G=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(l,function(a,c){if(a.functionName){var e=
{name:G+a.functionName.replace(/ /gi,"_"),value:C[c].replace(/ /gi,"").split(",")};D.push(e);E&&E===b.toJson(a.toJson())&&(k=C[c])}})}l=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var I=0,$,V,X=a.catalogItems.features.length;A=0;s=Array(X);r=Array(X);x=Array(X);for(p=0;p<X;p++)-1<a.properties.Values[p].toLowerCase().indexOf("nodata")&&
A++;$=X-A;for(p=0;p<X;p++)A=!0,-1<a.properties.Values[p].toLowerCase().indexOf("nodata")?(V=$++,l||(A=!1,s.length--,r.length--,x.length--)):V=I++,A&&(s[V]=a.catalogItems.features[p],r[V]=a.properties.Values[p],x[V]=s[V].attributes[v])}this._visibleRasters=[];var S;if((a=-1<k.toLowerCase().indexOf("nodata"))&&!l)s=[],r=[],x=[];k&&(!s&&!a)&&(v="ObjectId",s=[],S=new F(new t(this.fullExtent),null,{ObjectId:0}),s.push(S));var Z=[];s?!this._map.spatialReference.equals(this.spatialReference)&&x&&0<x.length?
h({url:this._url.path+"/query",content:{f:"json",objectIds:x.join(","),returnGeometry:!0,outSR:b.toJson(y._map.spatialReference.toJson()),outFields:v},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)y._resolve([Z,null,null],null,e,m);else{for(p=0;p<a.features.length;p++)for(w=0;w<s.length;w++)s[w].attributes[v]==a.features[p].attributes[v]&&(s[w].geometry=new u(a.features[p].geometry),s[w].geometry.setSpatialReference(y._map.spatialReference));n.call(y)}},error:function(a){y._resolve([Z,
null,null],null,e,m)}}):n.call(this):this._resolve([Z,null,null],null,e,m)},getVisibleRasters:function(){var a=this._visibleRasters,c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c},_getDomainFields:function(a){if(a){var c=[];d.forEach(a,function(a){if(a.domain){var b={};b.name=a.name;b.domain=a.domain;c.push(b)}});return c}},_getDomainValue:function(a,c){if(a&&a.codedValues){var b;d.some(a.codedValues,function(a){return a.code===c?(b=a.name,!0):!1});return b}},_requestData:function(a,
c,b){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var e=a._normalize(!0);this._prepareGetImageParameters(e,c,b);c=f.clone(this._params);this._cleanupRequestParams(c);c.extent=a;c.format=c.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===c.format.toLowerCase()&&(!c.lercVersion&&10.5<=this.version)&&(c.lercVersion=2);b=null;this._useBrowserDecoding()&&(b=new D({ctx:this._context}));c={imageServiceParameters:c,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,
decodeFunc:b?f.hitch(b,"decode"):null};this._rasterReadPromise=this.raster.read(c,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),
this._rasterReadPromise=null},_clonePixelData:function(a){if(null===a||void 0===a)return a;var c={};a.extent&&(c.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return c;c.pixelBlock=a.clone();return c},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,c,b){a=a.getImageData(0,0,c,b).data;for(var e=c*b,d=0,g=0,f=new Uint8Array(e),h=new Uint8Array(e),l=new Uint8Array(e),m=new Uint8Array(e),n=Infinity,k=Infinity,q=Infinity,r=-Infinity,s=-Infinity,p=-Infinity,t,w,u,d=
0;d<e;d++)t=a[g++],w=a[g++],u=a[g++],n=n<t?n:t,r=r>t?r:t,k=k<w?k:w,s=s>w?s:w,q=q<u?q:u,p=p>u?p:u,f[d]=t,h[d]=w,l[d]=u,m[d]=a[g++]&1;return new B({width:c,height:b,pixels:[f,h,l],pixelType:"U8",mask:m,statistics:[{minValue:n,maxValue:r},{minValue:k,maxValue:s},{minValue:q,maxValue:p}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",c=new k(r._dfdCanceller);if(this._multidimensionalInfo)return c.resolve(this._multidimensionalInfo),c;10.3<=this.version&&this.hasMultidimensions?(c._pendingDfd=h({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;c.callback(a.multidimensionalInfo)}),function(a){c.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=m.isDebug,
c.errback(a));return c},getDefaultMultidimensionalDefinition:function(){var a,c,b,e=[],d=new k(r._dfdCanceller);if(this._defaultMultidimensionalDefinition)return d.resolve(this._defaultMultidimensionalDefinition),d;d._pendingDfd=this.getMultidimensionalInfo();d._pendingDfd.then(f.hitch(this,function(g){a=g;c=a.variables[0].dimensions;for(b in c)c.hasOwnProperty(b)&&(c[b].hasRanges?e.push(new x({variableName:"",dimensionName:c[b].name,isSlice:!1,values:[c[b].values[0]]})):e.push(new x({variableName:"",
dimensionName:c[b].name,isSlice:!0,values:[c[b].extent[0]]})));this._defaultMultidimensionalDefinition=e;d.callback(e)}),function(a){d.errback(a)});return d},_setDefaultMultidimensionalDefinition:function(a){var c,b={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(e){c=e;0<c.length&&(this.mosaicRule?(b=f.clone(this.mosaicRule),b.multidimensionalDefinition=c):this.defaultMosaicRule?(b=f.clone(this.defaultMosaicRule),b.multidimensionalDefinition=c):b=new v({multidimensionalDefinition:c}),
this.setMosaicRule(b,a))}))},_setDefaultRenderingRule:function(a){var c={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())c.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version){var b="esriImageServiceDataTypeVector-UV"===this.serviceDataType?
7:10;c.rasterFunction="Resample";c.rasterFunctionArguments={ResamplingType:b,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}c.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new y(c),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var c=new v(b.fromJson(a.mosaicRule));if(c&&c.multidimensionalDefinition&&0<c.multidimensionalDefinition.length){var e=d.filter(c.multidimensionalDefinition,function(a){return"StdTime"!==
a.dimensionName});c.multidimensionalDefinition=e;a.mosaicRule=b.toJson(c.toJson())}}var c="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),g;for(g in c)a.hasOwnProperty(c[g])&&delete a[c[g]];return a},_removeVisualizationStretchFunction:function(a){var c=a&&a.functionName;if(!c||"stretch"!==c.toLowerCase())return a;var b=a.functionArguments.Raster;return b&&b.functionName&&d.some(this.rasterFunctionInfos,function(a){return b.functionName===a.name})?
b:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return d.some(a&&(this.rasterFunctionInfos||[]),function(c){return c&&c.name&&
c.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new B({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var c=this.fullExtent.getCenter(),c=new t(c.x,c.y,c.x+this.pixelSizeX,c.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:c}},_resolve:function(a,c,b,e,d){c&&this[c].apply(this,a);b&&b.apply(null,a);e&&r._resDfd(e,a,d)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=
q.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(q.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,c){this.useMapTime=a;this._toggleTime();!c&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}})})},
"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(p,f,k,d,b,m){var q=p(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){f.isObject(a)&&(f.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,
4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new m(a.viewpoint)),this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=null,d=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(d)for(var a=[],f=
0;f<d;f++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[f].declaredClass?this.multidimensionalDefinition[f].toJson():this.multidimensionalDefinition[f]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return b.filter(a,function(a){if(null!==
a)return!0})},_getMethodEnum:function(a){if(a){var b=q.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":b=q.METHOD_ATTRIBUTE;break;case "center":b=q.METHOD_CENTER;break;case "lockraster":b=q.METHOD_LOCKRASTER;break;case "nadir":b=q.METHOD_NADIR;break;case "northwest":b=q.METHOD_NORTHWEST;break;case "seamline":b=q.METHOD_SEAMLINE;break;case "viewpoint":b=q.METHOD_VIEWPOINT}return b}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return q.OPERATION_FIRST;case "last":return q.OPERATION_LAST;
case "max":return q.OPERATION_MAX;case "min":return q.OPERATION_MIN;case "blend":return q.OPERATION_BLEND;case "mean":return q.OPERATION_MEAN;case "sum":return q.OPERATION_SUM}}});f.mixin(q,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",
OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return q})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(p,f,k,d,b){var m=p(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(b){if(f.isObject(b)){var a=
0;this.functionName=b.rasterFunction;this.functionArguments=f.clone(b.rasterFunctionArguments||b.arguments);f.mixin(this,b);if(b=this.functionArguments)if(b.Raster=this._toRasterFunction(b.Raster),b.Raster2=this._toRasterFunction(b.Raster2),b.DEM=this._toRasterFunction(b.DEM),b.FillRaster=this._toRasterFunction(b.FillRaster),b.Rasters&&b.Rasters.length)for(a=0;a<b.Rasters.length;a++)b.Rasters[a]=this._toRasterFunction(b.Rasters[a])}},_toRasterFunction:function(b){return b&&(b.rasterFunction||b.functionName)?
new m(b):b},_rfToJson:function(b){b&&"esri.layers.RasterFunction"===b.declaredClass&&(b=b.toJson());return b},toJson:function(){var d=f.clone(this.functionArguments||this.arguments);if(d&&(d.Raster=this._rfToJson(d.Raster),d.Raster2=this._rfToJson(d.Raster2),d.DEM=this._rfToJson(d.DEM),d.FillRaster=this._rfToJson(d.FillRaster),d.Rasters&&d.Rasters.length)){var a,m=[];for(a=0;a<d.Rasters.length;a++)m.push(this._rfToJson(d.Rasters[a]));d.Rasters=m}return b.filter({rasterFunction:this.functionName,rasterFunctionArguments:d,
variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return m})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(p,f,k,d,b){return p(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(b){f.isObject(b)&&f.mixin(this,b)},toJson:function(){return b.filter({variableName:this.variableName,
dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(b){return null!==b})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c){var u,v,y,x,w,B,A=null,
D=null,C=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",D=Math.pow(2,8)-1,A=Uint8Array):"U16"===a?(D=D||Math.pow(2,16)-1,A=Uint16Array):"U32"===a?(D=D||Math.pow(2,32)-1,A=Uint32Array):"S8"===a?(D=D||0-Math.pow(2,7),A=Int8Array):"S16"===a?(D=D||0-Math.pow(2,15),A=Int16Array):"S32"===a?(D=D||0-Math.pow(2,31),A=Int32Array):A=Float32Array;return a},E=function(a,c){return a.height!==c.height||a.width!==c.width?!1:!0};return f(l,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),
validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(c,e,g){var f=this,h=new d(r._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!c.imageServiceParameters)throw"Insufficient parameters to read data";var l=k.clone(c.imageServiceParameters),m=c.pixelType;b.some(this.validPixelTypes,
function(a){return a===m})||(l.pixelType="F32");b.some(this.validFormats,function(a){return a.toLowerCase()===l.format.toLowerCase()})||(l.format="lerc");var n=c.decodeFunc,q;this._prepareGetImageParameters(l);var p=l.width,t=l.height,w=l.extent;delete l.width;delete l.height;delete l.extent;h._pendingDfd=s({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:k.mixin(l,{f:"image"}),load:function(a){f.decode(a,{width:p,height:t,planes:null,pixelType:m,noDataValue:l.noData,format:l.format,
decodeFunc:n}).then(function(a){q={pixelBlock:a,extent:w};f._resolve([q,l],"onRasterReadComplete",e,h)},function(a){f._resolve([a],null,g,h,!0)})},error:function(a){f._resolve([a],null,g,h,!0)}});return h.promise},decode:function(a,c){if(void 0===c||null===c)throw"missing decode options";var b,e;c.format&&(b=c.format.toUpperCase());"BSQ"!==b&&"BIP"!==b&&(b=this._getFormat(a));e=c.decodeFunc;if(void 0===e||null===e)e=this._getFormatDecoderDfd(b);return e(a,c)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&
a.bbox){var c=a.size.split(",");a.width=parseFloat(c[0]);a.height=parseFloat(c[1]);a.extent||(c=a.bbox.split(","),a.extent=new g(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]),new h(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var c=a.extent,b=c.spatialReference.wkid||q.toJson(c.spatialReference.toJson());
delete a._ts;k.mixin(a,{bbox:c.xmin+","+c.ymin+","+c.xmax+","+c.ymax,imageSR:b,bboxSR:b,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,c,b){var e=a.ymax-a.ymin,d=a.xmax-a.xmin;b>=c?a.ymax=a.ymin+d*c/b:(d=e*b/c,a.xmax=a.xmin+d);return a},_resolve:function(a,c,b,e,d){c&&this[c].apply(this,a);b&&b.apply(null,a);e&&r._resDfd(e,a,d)},_getFormatDecoderDfd:function(a){var c=null;switch(a){case "LERC":c=this._decodeLerc;break;case "LERC2":c=this._decodeLerc2;
break;case "JPEG":c=this._decodeJpeg;break;case "PNG":c=this._decodePng;break;case "BSQ":c=this._decodeBsq;break;case "BIP":c=this._decodeBip;break;case "TIFF":c=this._decodeTiff;break;default:c=function(a,c){throw"The raster format is not supported";}}c=k.hitch(this,c);return function(b,e){var g=new d;try{var f;"LERC"===a||!0===w?(f=c(b,e),g.resolve(f)):B.then(function(){f=c(b,e);g.resolve(f)})}catch(h){g.reject(h)}return g}},_getFormat:function(a){a=new Uint8Array(a,0,10);var c="";if(255===a[0]&&
216===a[1])c="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])c="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])c="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])c="LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))c="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])c="TIFF";return c},_validateDecodeParams:function(a){if(!a.height||
Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,c){if(!u)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);var b=(new u).decode(a);if(!E(b,c))throw"The decoded image dimensions are incorrect.";var d=[],g,f;for(g=0;g<b.pixels.length;g++)f=b.pixels[g],d.push(this._calculateBandStatistics(f));return new e({width:b.width,height:b.height,pixels:b.pixels,pixelType:"U8",mask:b.mask,
statistics:d})},_decodePng:function(a,c){if(!v)throw"The png decoder module is not loaded.";this._validateDecodeParams(c);var b=new Uint8Array(a),d=new v(b),b=new Uint8Array(4*c.width*c.height);d.copyToImageData(b,d.decodePixels());for(var g=d=0,f,g=new Uint8Array(c.width*c.height),d=0;d<c.width*c.height;d++)g[d]=b[4*d+3];for(var h=new e({width:c.width,height:c.height,pixels:[],pixelType:"U8",mask:g,statistics:[]}),d=0;3>d;d++){f=new Uint8Array(c.width*c.height);for(g=0;g<c.width*c.height;g++)f[g]=
b[4*g+d];h.addData({pixels:f,statistics:this._calculateBandStatistics(f)})}return h},_decodeBsq:function(a,c){if(!y)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(c);D=c.noDataValue;c.pixelType=C(c.pixelType);var b=y.decodeBSQ(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:A,noDataValue:D}),d=[],g,f=null;for(g=0;g<b.pixels.length;g++)f=b.pixels[g],d.push(this._calculateBandStatistics(f));return new e({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,
mask:b.maskData,statistics:d})},_decodeBip:function(a,c){this._validateDecodeParams(c);D=c.noDataValue;c.pixelType=C(c.pixelType);var b=y.decodeBIP(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:A,noDataValue:D}),d=[],g,f=null;for(g=0;g<b.pixels.length;g++)f=b.pixels[g],d.push(this._calculateBandStatistics(f));return new e({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,mask:b.maskData,statistics:d})},_decodeTiff:function(a,c){this._validateDecodeParams(c);D=c.noDataValue;
c.pixelType=C(c.pixelType);var b=x.decode(a),d=[],g,f=null;for(g=0;g<b.pixels.length;g++)f=b.pixels[g],d.push(this._calculateBandStatistics(f,b.maskData));return new e({width:b.width,height:b.height,pixels:b.pixels,pixelType:b.pixelType,mask:b.maskData,statistics:d})},_decodeLerc:function(a,c){this._validateDecodeParams(c);D=c.noDataValue;c.pixelType=C(c.pixelType);for(var b=0,d,g=0,f,h=a.byteLength-10;g<h;){var l=t.decode(a,{inputOffset:g,encodedMaskData:d,returnMask:0===b?!0:!1,returnEncodedMask:0===
b?!0:!1,returnFileInfo:!0,pixelType:A,noDataValue:D}),g=l.fileInfo.eofOffset;0===b&&(d=l.encodedMaskData,f=new e({width:c.width,height:c.height,pixels:[],pixelType:c.pixelType,mask:l.maskData,statistics:[]}));b++;if(!E(l,c))throw"The decoded image dimensions are incorrect";f.addData({pixels:l.pixelData,statistics:{minValue:l.minValue,maxValue:l.maxValue,noDataValue:l.noDataValue}})}return f},_decodeLerc2:function(a,b){this._validateDecodeParams(b);D=b.noDataValue;b.pixelType=C(b.pixelType);for(var d=
0,g,f,h=0,l,m=a.byteLength-10;h<m;){f=c.decode(a,{inputOffset:h,maskData:g,returnFileInfo:!0});h=f.fileInfo.eofOffset;0===d&&(g=f.maskData,l=new e({width:b.width,height:b.height,pixels:[],pixelType:f.fileInfo.pixelType,mask:f.maskData,statistics:[]}));d++;if(!E(f,b))throw"The decoded image dimensions are incorrect";l.addData({pixels:f.pixelData,statistics:{minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue}})}return l},_calculateBandStatistics:function(a,c){var b=Infinity,e=-Infinity,
d=a.length,g,f=0;if(c)for(g=0;g<d;g++)c[g]&&(f=a[g],b=f<b?f:b,e=f>e?f:e);else for(g=0;g<d;g++)f=a[g],b=f<b?f:b,e=f>e?f:e;return{minValue:b,maxValue:e}},_loadRasterFormatModules:function(){w||(B||(B=new d),10>a("ie")?B.isRejected()||B.reject("unsupported browser version"):p(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,c,b,e){u=a;v=c;y=b;x=e;w=!0;B.isResolved()||B.resolve(!0)}))}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(p,f,k,d){return p([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(b){if(b){if(!b.width||Math.floor(b.width)!==b.width)throw"PixelBlock: incorrect width";if(!b.height||Math.floor(b.height)!==b.height)throw"PixelBlock: incorrect height";if(!b.pixels||!b.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=b.width;this.height=b.height;this.pixels=
b.pixels;this.pixelType=b.pixelType||null;this.statistics=b.statistics;this.mask=b.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(b){if(!b.pixels||!b.statistics)throw"Pixel data or statistics are not present";if(b.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(b.statistics);this.pixels.push(b.pixels)},getAsRGBA:function(){var b=
new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(b);break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)},getAsRGBAFloat:function(){var b=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(b);return b},clone:function(){var b=new this.constructor;b.width=this.width;b.height=this.height;b.pixelType=this.pixelType;this.mask&&(b.mask=new Uint8Array(this.mask));var d,
k;if(this.pixels){b.pixels=[];k=this.pixels.length;for(d=0;d<k;d++)b.pixels[d]=new Float32Array(this.pixels[d])}if(this.statistics){b.statistics=[];k=this.statistics.length;for(d=0;d<k;d++)b.statistics[d]=f.clone(this.statistics[d])}return b},_fillFrom8Bit:function(b){var d=this.pixels,f=this.mask;if(!b||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,n,l;a=n=l=d[0];3<=d.length&&(n=d[1],l=d[2]);var d=new Uint32Array(b),k=this.width*this.height;
if(a.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(f&&f.length===k)for(b=0;b<k;b++)f[b]&&(d[b]=-16777216|l[b]<<16|n[b]<<8|a[b]);else for(b=0;b<k;b++)d[b]=-16777216|l[b]<<16|n[b]<<8|a[b]},_fillFromNon8Bit:function(b){var d=this.pixels,f=this.mask,a=this.statistics;if(!b||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var n=1,l=0;a&&0<a.length?(l=a[0].minValue,n=255/(a[0].maxValue-a[0].minValue)):(n=255,
"S8"===this.pixelType?(l=-128,n=127):"U16"===this.pixelType?n=65535:"S16"===this.pixelType?(l=-32768,n=32767):"U32"===this.pixelType?n=4294967295:"S32"===this.pixelType?(l=-2147483648,n=2147483647):"F32"===this.pixelType?(l=-3.4*1E39,n=3.4*1E39):"F64"===this.pixelType&&(l=-Number.MAX_VALUE,n=Number.MAX_VALUE),n=255/(n-l));b=new Uint32Array(b);var a=this.width*this.height,k,g,h;k=d[0];if(k.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=d.length)if(g=
d[1],h=d[2],f&&f.length===a)for(d=0;d<a;d++)f[d]&&(b[d]=-16777216|(h[d]-l)*n<<16|(g[d]-l)*n<<8|(k[d]-l)*n);else for(d=0;d<a;d++)b[d]=-16777216|(h[d]-l)*n<<16|(g[d]-l)*n<<8|(k[d]-l)*n;else if(f&&f.length===a)for(d=0;d<a;d++)g=(k[d]-l)*n,f[d]&&(b[d]=-16777216|g<<16|g<<8|g);else for(d=0;d<a;d++)g=(k[d]-l)*n,b[d]=-16777216|g<<16|g<<8|g},_fillFrom32Bit:function(b){var d=this.pixels,f=this.mask;if(!b||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,
n,l;a=n=l=d[0];3<=d.length&&(n=d[1],l=d[2]);var k=this.width*this.height;if(a.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var g=0;if(f&&f.length===k)for(d=0;d<k;d++)b[g++]=a[d],b[g++]=n[d],b[g++]=l[d],b[g++]=f[d];else for(d=0;d<k;d++)b[g++]=a[d],b[g++]=n[d],b[g++]=l[d],b[g++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var p={defaultNoDataValue:-3.4027999387901484E38,decode:function(k,d){var b;d=d||{};var m=d.inputOffset||
0,q=d.encodedMaskData||null===d.encodedMaskData,a={},n=new Uint8Array(k,m,10);a.fileIdentifierString=String.fromCharCode.apply(null,n);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;m+=10;n=new DataView(k,m,24);a.fileVersion=n.getInt32(0,!0);a.imageType=n.getInt32(4,!0);a.height=n.getUint32(8,!0);a.width=n.getUint32(12,!0);a.maxZError=n.getFloat64(16,!0);m+=24;if(!q)if(n=new DataView(k,m,16),a.mask={},a.mask.numBlocksY=n.getUint32(0,
!0),a.mask.numBlocksX=n.getUint32(4,!0),a.mask.numBytes=n.getUint32(8,!0),a.mask.maxValue=n.getFloat32(12,!0),m+=16,0<a.mask.numBytes){var q=new Uint8Array(Math.ceil(a.width*a.height/8)),n=new DataView(k,m,a.mask.numBytes),l=n.getInt16(0,!0),s=2,g=0;do{if(0<l)for(;l--;)q[g++]=n.getUint8(s++);else for(var h=n.getUint8(s++),l=-l;l--;)q[g++]=h;l=n.getInt16(s,!0);s+=2}while(s<a.mask.numBytes);if(-32768!==l||g<q.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=q;m+=a.mask.numBytes}else 0===
(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(q=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=q);n=new DataView(k,m,16);a.pixels={};a.pixels.numBlocksY=n.getUint32(0,!0);a.pixels.numBlocksX=n.getUint32(4,!0);a.pixels.numBytes=n.getUint32(8,!0);a.pixels.maxValue=n.getFloat32(12,!0);m+=16;q=a.pixels.numBlocksX;n=a.pixels.numBlocksY;q+=0<a.width%q?1:0;l=n+(0<a.height%n?1:0);a.pixels.blocks=Array(q*l);for(g=s=0;g<l;g++)for(h=0;h<q;h++){var r=0,n=new DataView(k,m,Math.min(10,k.byteLength-
m)),e={};a.pixels.blocks[s++]=e;var t=n.getUint8(0);r++;e.encoding=t&63;if(3<e.encoding)throw"Invalid block encoding ("+e.encoding+")";if(2===e.encoding)m++;else{if(0!==t&&2!==t){t>>=6;e.offsetType=t;if(2===t)e.offset=n.getInt8(1),r++;else if(1===t)e.offset=n.getInt16(1,!0),r+=2;else if(0===t)e.offset=n.getFloat32(1,!0),r+=4;else throw"Invalid block offset type";if(1===e.encoding)if(t=n.getUint8(r),r++,e.bitsPerPixel=t&63,t>>=6,e.numValidPixelsType=t,2===t)e.numValidPixels=n.getUint8(r),r++;else if(1===
t)e.numValidPixels=n.getUint16(r,!0),r+=2;else if(0===t)e.numValidPixels=n.getUint32(r,!0),r+=4;else throw"Invalid valid pixel count type";}m+=r;if(3!=e.encoding)if(0===e.encoding){t=(a.pixels.numBytes-1)/4;if(t!==Math.floor(t))throw"uncompressed block has invalid length";n=new ArrayBuffer(4*t);r=new Uint8Array(n);r.set(new Uint8Array(k,m,4*t));n=new Float32Array(n);e.rawData=n;m+=4*t}else 1===e.encoding&&(t=Math.ceil(e.numValidPixels*e.bitsPerPixel/8),n=Math.ceil(t/4),n=new ArrayBuffer(4*n),r=new Uint8Array(n),
r.set(new Uint8Array(k,m,t)),e.stuffedData=new Uint32Array(n),m+=t)}}a.eofOffset=m;var m=null!=d.noDataValue?d.noDataValue:p.defaultNoDataValue,l=d.encodedMaskData,c=d.returnMask,s=0,g=a.pixels.numBlocksX,h=a.pixels.numBlocksY,e=Math.floor(a.width/g),r=Math.floor(a.height/h),t=2*a.maxZError,q=Number.MAX_VALUE,u,l=l||(a.mask?a.mask.bitset:null),v,n=new (d.pixelType||Float32Array)(a.width*a.height);c&&l&&(v=new Uint8Array(a.width*a.height));for(var c=new Float32Array(e*r),y,x,w=0;w<=h;w++){var B=w!==
h?r:a.height%h;if(0!==B)for(var A=0;A<=g;A++){var D=A!==g?e:a.width%g;if(0!==D){var C=w*a.width*r+A*e,E=a.width-D,F=a.pixels.blocks[s],G,I;if(2>F.encoding){if(0===F.encoding)G=F.rawData;else{G=F.stuffedData;I=F.bitsPerPixel;u=F.numValidPixels;y=F.offset;x=t;var R=c,O=a.pixels.maxValue,P=(1<<I)-1,K=0,J=void 0,L=0,Q=void 0,M=void 0,H=Math.ceil((O-y)/x),J=4*G.length-Math.ceil(I*u/8);G[G.length-1]<<=8*J;for(J=0;J<u;J++)0===L&&(M=G[K++],L=32),L>=I?(Q=M>>>L-I&P,L-=I):(L=I-L,Q=(M&P)<<L&P,M=G[K++],L=32-L,
Q+=M>>>L),R[J]=Q<H?y+Q*x:O;G=c}I=0}else b=2===F.encoding?0:F.offset;var N;if(l)for(x=0;x<B;x++){C&7&&(N=l[C>>3],N<<=C&7);for(y=0;y<D;y++)C&7||(N=l[C>>3]),N&128?(v&&(v[C]=1),u=2>F.encoding?G[I++]:b,q=q>u?u:q,n[C++]=u):(v&&(v[C]=0),n[C++]=m),N<<=1;C+=E}else if(2>F.encoding)for(x=0;x<B;x++){for(y=0;y<D;y++)u=G[I++],q=q>u?u:q,n[C++]=u;C+=E}else{q=q>b?b:q;for(x=0;x<B;x++){for(y=0;y<D;y++)n[C++]=b;C+=E}}if(1===F.encoding&&I!==F.numValidPixels)throw"Block and Mask do not match";s++}}}b=v;v={width:a.width,
height:a.height,pixelData:n,minValue:q,maxValue:a.pixels.maxValue,noDataValue:m};b&&(v.maskData=b);d.returnEncodedMask&&a.mask&&(v.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(d.returnFileInfo&&(v.fileInfo=f(a),d.computeUsedBitDepths)){b=v.fileInfo;N=a.pixels.numBlocksX*a.pixels.numBlocksY;G={};for(I=0;I<N;I++)m=a.pixels.blocks[I],0===m.encoding?G.float32=!0:1===m.encoding?G[m.bitsPerPixel]=!0:G[0]=!0;a=Object.keys(G);b.bitDepths=a}return v}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,
fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return p})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var p={unstuff:function(d,
b,f,k,a,n,l,s){var g=(1<<f)-1,h=0,r,e=0,p,c;r=4*d.length-Math.ceil(f*k/8);d[d.length-1]<<=8*r;if(a)for(r=0;r<k;r++)0===e&&(c=d[h++],e=32),e>=f?(p=c>>>e-f&g,e-=f):(e=f-e,p=(c&g)<<e&g,c=d[h++],e=32-e,p+=c>>>e),b[r]=a[p];else{a=Math.ceil((s-n)/l);for(r=0;r<k;r++)0===e&&(c=d[h++],e=32),e>=f?(p=c>>>e-f&g,e-=f):(e=f-e,p=(c&g)<<e&g,c=d[h++],e=32-e,p+=c>>>e),b[r]=p<a?n+p*l:s}},unstuffLUT:function(d,b,f,k,a,n){var l=(1<<b)-1,s=0,g=0,h=0,r=h=0,e,p=[],g=4*d.length-Math.ceil(b*f/8);d[d.length-1]<<=8*g;for(var c=
Math.ceil((n-k)/a),g=0;g<f;g++)0===h&&(e=d[s++],h=32),h>=b?(r=e>>>h-b&l,h-=b):(h=b-h,r=(e&l)<<h&l,e=d[s++],h=32-h,r+=e>>>h),p[g]=r<c?k+r*a:n;p.unshift(k);return p},unstuff2:function(d,b,f,k,a,n,l,s){var g=(1<<f)-1,h=0,r,e=0,p=0,c,u,v;if(a)for(r=0;r<k;r++)0===e&&(u=d[h++],e=32,p=0),e>=f?(c=u>>>p&g,e-=f,p+=f):(v=f-e,c=u>>>p&g,u=d[h++],e=32-v,c|=(u&(1<<v)-1)<<f-v,p=v),b[r]=a[c];else{a=Math.ceil((s-n)/l);for(r=0;r<k;r++)0===e&&(u=d[h++],e=32,p=0),e>=f?(c=u>>>p&g,e-=f,p+=f):(v=f-e,c=u>>>p&g,u=d[h++],e=
32-v,c|=(u&(1<<v)-1)<<f-v,p=v),b[r]=c<a?n+c*l:s}return b},unstuffLUT2:function(d,b,f,k,a,n){for(var l=(1<<b)-1,p=0,g=0,h=0,r=0,e=0,t=0,c,u=[],v=Math.ceil((n-k)/a),g=0;g<f;g++)0===r&&(c=d[p++],r=32,t=0),r>=b?(e=c>>>t&l,r-=b,t+=b):(h=b-r,e=c>>>t&l,c=d[p++],r=32-h,e|=(c&(1<<h)-1)<<b-h,t=h),u[g]=e<v?k+e*a:n;u.unshift(k);return u},originalUnstuff:function(d,b,f,k){var a=(1<<f)-1,n=0,l,p=0,g,h;l=4*d.length-Math.ceil(f*k/8);d[d.length-1]<<=8*l;for(l=0;l<k;l++)0===p&&(h=d[n++],p=32),p>=f?(g=h>>>p-f&a,p-=
f):(p=f-p,g=(h&a)<<p&a,h=d[n++],p=32-p,g+=h>>>p),b[l]=g;return b},originalUnstuff2:function(d,b,f,k){var a=(1<<f)-1,n=0,l,p=0,g=0,h,r,e;for(l=0;l<k;l++)0===p&&(r=d[n++],p=32,g=0),p>=f?(h=r>>>g&a,p-=f,g+=f):(e=f-p,h=r>>>g&a,r=d[n++],p=32-e,h|=(r&(1<<e)-1)<<f-e,g=e),b[l]=h;return b}},f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var b=65535,f=65535,k=d.length,a=Math.floor(k/2),n=0;a;){var l=359<=a?359:a,a=a-l;do b+=d[n++]<<8,f+=b+=d[n++];while(--l);b=(b&65535)+(b>>>16);f=(f&65535)+
(f>>>16)}k&1&&(f+=b+=d[n]<<8);return((f&65535)+(f>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(d,b){var f=b.ptr,k=new Uint8Array(d,f,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,k);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;f+=6;k=new DataView(d,f,52);a.fileVersion=k.getInt32(0,!0);f+=4;3<=a.fileVersion&&(a.checksum=k.getUint32(4,!0),f+=4);k=new DataView(d,f,48);a.height=k.getUint32(0,
!0);a.width=k.getUint32(4,!0);a.numValidPixel=k.getUint32(8,!0);a.microBlockSize=k.getInt32(12,!0);a.blobSize=k.getInt32(16,!0);a.imageType=k.getInt32(20,!0);a.maxZError=k.getFloat64(24,!0);a.zMin=k.getFloat64(32,!0);a.zMax=k.getFloat64(40,!0);f+=48;b.headerInfo=a;b.ptr=f;if(3<=a.fileVersion&&(f=this.computeChecksumFletcher32(new Uint8Array(d,f-48,a.blobSize-14)),f!==a.checksum))throw"Checksum failed.";return!0},readMask:function(d,b){var f=b.ptr,k=b.headerInfo,a=k.width*k.height,n=k.numValidPixel,
l=new DataView(d,f,4),k={};k.numBytes=l.getUint32(0,!0);f+=4;if((0===n||a===n)&&0!==k.numBytes)throw"invalid mask";if(0===n)n=new Uint8Array(Math.ceil(a/8)),k.bitset=n,l=new Uint8Array(a),b.pixels.resultMask=l,f+=k.numBytes;else if(0<k.numBytes){var n=new Uint8Array(Math.ceil(a/8)),l=new DataView(d,f,k.numBytes),p=l.getInt16(0,!0),g=2,h=0,r=0;do{if(0<p)for(;p--;)n[h++]=l.getUint8(g++);else{r=l.getUint8(g++);for(p=-p;p--;)n[h++]=r}p=l.getInt16(g,!0);g+=2}while(g<k.numBytes);if(-32768!==p||h<n.length)throw"Unexpected end of mask RLE encoding";
l=new Uint8Array(a);for(g=g=p=0;g<a;g++)g&7?(p=n[g>>3],p<<=g&7):p=n[g>>3],p&128&&(l[g]=1);b.pixels.resultMask=l;k.bitset=n;f+=k.numBytes}b.ptr=f;b.mask=k;return!0},readDataOneSweep:function(d,b,m){var k=b.ptr,a=b.headerInfo,n=a.width*a.height,a=a.numValidPixel*f.getDateTypeSize(a.imageType);if(m===Uint8Array)d=new Uint8Array(d,k,a);else{var l=new ArrayBuffer(a);(new Uint8Array(l)).set(new Uint8Array(d,k,a));d=new m(l)}if(d.length===n)b.pixels.resultPixels=d;else{b.pixels.resultPixels=new m(n);for(l=
l=m=0;l<n;l++)b.pixels.resultMask[l]&&(b.pixels.resultPixels[l]=d[m++])}b.ptr=k+a;return!0},readHuffman:function(d,b,m){var q=b.headerInfo,a=q.width*q.height,n=this.HUFFMAN_LUT_BITS_MAX,q=new DataView(d,b.ptr,16);b.ptr+=16;if(2>q.getInt32(0,!0))throw"unsupported Huffman version";var l=q.getInt32(4,!0),p=q.getInt32(8,!0),g=q.getInt32(12,!0);if(p>=g)return!1;var h=new Uint32Array(g-p);f.decodeBits(d,b,h);for(var r=[],e,t,q=p;q<g;q++)e=q-(q<l?0:l),r[e]={first:h[q-p],second:null};q=d.byteLength-b.ptr;
h=Math.ceil(q/4);h=new ArrayBuffer(4*h);(new Uint8Array(h)).set(new Uint8Array(d,b.ptr,q));d=new Uint32Array(h);var h=0,c,u=0;c=d[0];for(q=p;q<g;q++)e=q-(q<l?0:l),t=r[e].first,0<t&&(r[e].second=c<<h>>>32-t,32-h>=t?(h+=t,32===h&&(h=0,u++,c=d[u])):(h+=t-32,u++,c=d[u],r[e].second|=c>>>32-h));for(var v=0===b.headerInfo.imageType?128:0,y=b.headerInfo.height,x=b.headerInfo.width,w=0,B=0,A=new k,q=0;q<r.length;q++)void 0!==r[q]&&(w=Math.max(w,r[q].first));B=w>=n?n:w;30<=w&&console.log("WARning, large NUM LUT BITS IS "+
w);for(var n=[],D,q=p;q<g;q++)if(e=q-(q<l?0:l),t=r[e].first,0<t)if(c=[t,e],t<=B){e=r[e].second<<B-t;D=1<<B-t;for(p=0;p<D;p++)n[e|p]=c}else{e=r[e].second;D=A;for(p=t-1;0<=p;p--)(t=e>>>p&1)?(D.right||(D.right=new k),D=D.right):(D.left||(D.left=new k),D=D.left),0===p&&!D.val&&(D.val=c[1])}var l=b.pixels.resultMask,C,r=g=0;0<h&&(u++,h=0);c=d[u];m=new m(a);if(b.headerInfo.numValidPixel===x*y)for(q=p=0;q<y;q++)for(e=0;e<x;e++,p++){a=0;r=C=c<<h>>>32-B;32-h<B&&(r=C|=d[u+1]>>>64-h-B);if(n[r])a=n[r][1],h+=
n[r][0];else{C=c<<h>>>32-w;32-h<w&&(C|=d[u+1]>>>64-h-w);D=A;for(r=0;r<w;r++)if(D=(t=C>>>w-r-1&1)?D.right:D.left,!D.left&&!D.right){a=D.val;h=h+r+1;break}}32<=h&&(h-=32,u++,c=d[u]);a-=v;a=0<e?a+g:0<q?a+m[p-x]:a+g;a&=255;g=m[p]=a}else for(q=p=0;q<y;q++)for(e=0;e<x;e++,p++)if(l[p]){a=0;r=C=c<<h>>>32-B;32-h<B&&(r=C|=d[u+1]>>>64-h-B);if(n[r])a=n[r][1],h+=n[r][0];else{C=c<<h>>>32-w;32-h<w&&(C|=d[u+1]>>>64-h-w);D=A;for(r=0;r<w;r++)if(D=(t=C>>>w-r-1&1)?D.right:D.left,!D.left&&!D.right){a=D.val;h=h+r+1;break}}32<=
h&&(h-=32,u++,c=d[u]);a-=v;a=0<e&&l[p-1]?a+g:0<q&&l[p-x]?a+m[p-x]:a+g;a&=255;g=m[p]=a}b.pixels.resultPixels=m;b.ptr=b.ptr+4*(u+1)+(0<h?4:0)},decodeBits:function(d,b,f,k){var a=b.headerInfo.fileVersion,n=0,l=new DataView(d,b.ptr,5),s=l.getUint8(0);n++;var g=s>>6,h=0===g?4:3-g,r=0<(s&32)?!0:!1,g=s&31,s=0;if(1===h)s=l.getUint8(n),n++;else if(2===h)s=l.getUint16(n,!0),n+=2;else if(4===h)s=l.getUint32(n,!0),n+=4;else throw"Invalid valid pixel count type";k=k||0;var h=2*b.headerInfo.maxZError,e,t,c;if(r){b.counter.lut++;
c=l.getUint8(n);n++;r=Math.ceil((c-1)*g/8);e=Math.ceil(r/4);e=new ArrayBuffer(4*e);t=new Uint8Array(e);b.ptr+=n;t.set(new Uint8Array(d,b.ptr,r));n=new Uint32Array(e);b.ptr+=r;for(l=0;c-1>>>l;)l++;r=Math.ceil(s*l/8);e=Math.ceil(r/4);e=new ArrayBuffer(4*e);t=new Uint8Array(e);t.set(new Uint8Array(d,b.ptr,r));d=new Uint32Array(e);b.ptr+=r;b=3<=a?p.unstuffLUT2(n,g,c-1,k,h,b.headerInfo.zMax):p.unstuffLUT(n,g,c-1,k,h,b.headerInfo.zMax);3<=a?p.unstuff2(d,f,l,s,b):p.unstuff(d,f,l,s,b)}else b.counter.bitstuffer++,
l=g,b.ptr+=n,0<l&&(r=Math.ceil(s*l/8),e=Math.ceil(r/4),e=new ArrayBuffer(4*e),t=new Uint8Array(e),t.set(new Uint8Array(d,b.ptr,r)),d=new Uint32Array(e),b.ptr+=r,3<=a?p.unstuff2(d,f,l,s,!1,k,h,b.headerInfo.zMax):p.unstuff(d,f,l,s,!1,k,h,b.headerInfo.zMax))},readTiles:function(d,b,m){var k=b.headerInfo,a=k.width,n=k.height,l=k.microBlockSize,k=k.imageType,p=Math.ceil(a/l),g=Math.ceil(n/l);b.pixels.numBlocksY=g;b.pixels.numBlocksX=p;for(var h=b.pixels.ptr=0,r=0,e=0,t=0,c=0,u=0,v=0,y=0,x=h=0,w=0,B=0,
v=v=h=v=0,A,D=new m(l*l),n=n%l||l,C=a%l||l,e=0;e<g;e++){c=e!==g-1?l:n;for(t=0;t<p;t++){u=t!==p-1?l:C;w=e*a*l+t*l;B=a-u;v=d.byteLength-b.ptr;r=new DataView(d,b.ptr,Math.min(10,v));A={};v=0;y=r.getUint8(0);v++;h=y>>6&255;x=y>>2&15;if(x!==(t*l>>3&15))throw"integrity issue";y&=3;if(3<y)throw b.ptr+=v,"Invalid block encoding ("+y+")";if(2===y)b.counter.constant++,b.ptr+=v;else if(0===y){b.counter.uncompressed++;b.ptr+=v;v=c*u*f.getDateTypeSize(k);h=d.byteLength-b.ptr;v=v<h?v:h;h=new ArrayBuffer(v);r=new Uint8Array(h);
r.set(new Uint8Array(d,b.ptr,v));A=new m(h);v=0;if(b.pixels.resultMask)for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultMask[w]&&(b.pixels.resultPixels[w]=A[v++]),w++;w+=B}else for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultPixels[w++]=A[v++];w+=B}b.ptr+=v*f.getDateTypeSize(k)}else if(h=f.getDataTypeUsed(k,h),A=f.getOnePixel(A,v,h,r),v+=f.getDateTypeSize(h),3===y)if(b.ptr+=v,b.counter.constantoffset++,b.pixels.resultMask)for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultMask[w]&&(b.pixels.resultPixels[w]=
A),w++;w+=B}else for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultPixels[w++]=A;w+=B}else if(b.ptr+=v,f.decodeBits(d,b,D,A),v=0,b.pixels.resultMask)for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultMask[w]&&(b.pixels.resultPixels[w]=D[v++]),w++;w+=B}else for(h=0;h<c;h++){for(r=0;r<u;r++)b.pixels.resultPixels[w++]=D[v++];w+=B}}}},formatFileInfo:function(d){return{fileIdentifierString:d.headerInfo.fileIdentifierString,fileVersion:d.headerInfo.fileVersion,imageType:d.headerInfo.imageType,height:d.headerInfo.height,
width:d.headerInfo.width,numValidPixel:d.headerInfo.numValidPixel,microBlockSize:d.headerInfo.microBlockSize,blobSize:d.headerInfo.blobSize,maxZError:d.headerInfo.maxZError,pixelType:f.getPixelType(d.headerInfo.imageType),eofOffset:d.eofOffset,mask:d.mask?{numBytes:d.mask.numBytes}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,maxValue:d.headerInfo.zMax,minValue:d.headerInfo.zMin,noDataValue:d.noDataValue}}},constructConstantSurface:function(d){var b=d.headerInfo.zMax,
f=d.headerInfo.height*d.headerInfo.width,k=0;if(d.pixels.resultMask)for(k=0;k<f;k++)d.pixels.resultMask[k]&&(d.pixels.resultPixels[k]=b);else for(k=0;k<f;k++)d.pixels.resultPixels[k]=b},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;break;case 7:d=Float64Array;break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d=
"S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,b){if(null===b||void 0===b)return!1;var f;switch(d){case 0:f=-128<=b&&127>=b;break;case 1:f=0<=b&&255>=b;break;case 2:f=-32768<=b&&32767>=b;break;case 3:f=0<=b&&65536>=b;break;case 4:f=-2147483648<=b&&2147483647>=b;break;case 5:f=0<=b&&4294967296>=b;break;case 6:f=-3.4027999387901484E38<=
b&&3.4027999387901484E38>=b;break;case 7:f=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:f=!1}return f},getDateTypeSize:function(d){var b=0;switch(d){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=d}return b},getDataTypeUsed:function(d,b){var f=d;switch(d){case 2:case 4:f=d-b;break;case 3:case 5:f=d-2*b;break;case 6:f=0===b?d:1===b?2:1;break;case 7:f=0===b?d:d-2*b+1;break;default:f=d}return f},getOnePixel:function(d,b,f,k){d=0;switch(f){case 0:d=
k.getInt8(b);break;case 1:d=k.getUint8(b);break;case 2:d=k.getInt16(b,!0);break;case 3:d=k.getUint16(b,!0);break;case 4:d=k.getInt32(b,!0);break;case 5:d=k.getUInt32(b,!0);break;case 6:d=k.getFloat32(b,!0);break;case 7:d=k.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return d}},k=function(d,b,f){this.val=d;this.left=b;this.right=f};return{decode:function(d,b){b=b||{};var m=b.maskData||null===b.maskData,k=b.noDataValue,a=0,n={};n.ptr=b.inputOffset||0;n.pixels=
{};if(f.readHeaderInfo(d,n)){var a=n.headerInfo,l=f.getDataTypeArray(a.imageType);if(m)n.pixels.resultMask=b.maskData,n.ptr+=4;else if(!f.readMask(d,n))return;m=a.width*a.height;n.pixels.resultPixels=new l(m);n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==a.numValidPixel)if(a.zMax===a.zMin)f.constructConstantSurface(n);else{var p=new DataView(d,n.ptr,2),g=p.getUint8(0,!0);n.ptr++;g?f.readDataOneSweep(d,n,l):1<a.fileVersion&&1>=a.imageType&&1E-5>Math.abs(a.maxZError-
0.5)?(p=p.getUint8(1,!0),n.ptr++,p?f.readHuffman(d,n,l):f.readTiles(d,n,l)):f.readTiles(d,n,l)}n.eofOffset=n.ptr;b.inputOffset?(l=n.headerInfo.blobSize+b.inputOffset-n.ptr,1<=Math.abs(l)&&(n.eofOffset=b.inputOffset+n.headerInfo.blobSize)):(l=n.headerInfo.blobSize-n.ptr,1<=Math.abs(l)&&(n.eofOffset=n.headerInfo.blobSize));l={width:a.width,height:a.height,pixelData:n.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,maskData:n.pixels.resultMask};if(n.pixels.resultMask&&f.isValidPixelValue(a.imageType,
k)){p=n.pixels.resultMask;for(a=0;a<m;a++)p[a]||(l.pixelData[a]=k);l.noDataValue=k}n.noDataValue=k;b.returnFileInfo&&(l.fileInfo=f.formatFileInfo(n));return l}},getBandCount:function(d){for(var b=0,m=0,k={ptr:0,pixels:{}};m<d.byteLength-58;)f.readHeaderInfo(d,k),m+=k.headerInfo.blobSize,b++,k.ptr=m;return b}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(p,f,k,d,b,m){return p(null,
{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(b){f.mixin(this,b);this.isDataUV=b&&b.isDataUV?b.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(b,a){this.inputUnit=b;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},
_updateUnitConvFactor:function(){var b=m.indexOf(this.speedUnits,this.inputUnit),a=m.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=b&&0<=a){var d=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=d[b]/d[a]}},computeMagnitudeAndDirection:function(d){if(!b.isDefined(d))throw"Could not compute magnitude and direction. No pixel data is available.";var a=d.pixelBlock;if(!b.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var f=d.extent,l=(f.xmax-f.xmin)/a.width,m=(f.ymax-f.ymin)/a.height,g=f.xmin+l/2,f=f.ymax-m/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var h=180/Math.PI,k=[],e=0,p=0,c=0,u=!b.isDefined(a.mask),v,y,x,w,B,A,D,C;B=D=Infinity;A=C=-Infinity;for(e=0;e<a.height;e++)for(p=0;p<a.width;p++,c++)if(k.push([g+l*p,f-m*e]),u||a.mask[c])x=v=a.pixels[0][c]*this.unitConversionFactor,w=y=a.pixels[1][c],this.isDataUV&&(x=Math.sqrt(v*v+y*y),w=90-h*Math.atan2(y,v),a.pixels[0][c]=x*this.unitConversionFactor,
a.pixels[1][c]=w),x>A&&(A=x),x<B&&(B=x),w>C&&(C=w),w<D&&(D=w);a.statistics[0].maxValue=A;a.statistics[0].minValue=B;a.statistics[1].maxValue=C;a.statistics[1].minValue=D;d.locations=k;return d}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(p,f,k,d){var b;return f(null,{constructor:function(b){this.ctx=b.ctx;this._loadRasterFormatModule()},decode:function(b,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";
var a=new k,f,l=new Uint8Array(b),p=this._getFormat(b);if("error"===p)throw"invalid format";"jpeg"===p&&(f=this._getMask(l,d));var g="",h,r;for(h=0;h<l.length;h+=65535)r=l.subarray(h,h+65535>l.length-1?l.length-1:h+65535),g+=String.fromCharCode.apply(null,r);var l="data:image/"+p+";base64,"+window.btoa(g),e=new Image,t;e.src=l;var c=this;e.onload=function(){c.ctx.clearRect(0,0,d.width,d.height);c.ctx.drawImage(e,0,0);var b=c.ctx.getImageData(0,0,e.width,e.height);t=b.data;if(f)for(h=0;h<f.length;h++)t[4*
h+3]=f[h]?255:0;c.ctx.putImageData(b,0,0);a.resolve(null)};e.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(b){b=new Uint8Array(b,0,10);var d="error";255===b[0]&&216===b[1]?d="jpeg":137===b[0]&&(80===b[1]&&78===b[2]&&71===b[3])&&(d="png");return d},_getMask:function(d,f){var a;try{if(!b)throw"The zlib decoder module is not loaded.";var k=0,l=0,p=Math.round(d.length/2);1===p%2&&(p+=1);for(var g=d.length-2,k=p;k<g&&!(255===d[k]&&217===d[k+1]);k++);p=k+=2;if(p<d.length-
1){var h=(new b(d.subarray(p))).getBytes();a=new Uint8Array(f.width*f.height);for(k=p=0;k<h.length;k++)for(l=7;0<=l;l--)a[p++]=h[k]>>l&1}}catch(r){}return a},_loadRasterFormatModule:function(){10>d("ie")||p(["./Zlib"],function(d){b=d})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(p,f,k,d,b,m,q,a){p=p(q,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(a){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,d,f,g,h){try{var k=new a(b);this._successHandler([k],"onComplete",f,h)}catch(e){this._errorHandler(e,g,h)}},execute:function(a,d,k,g){var h=g.assembly;a=this._encode(f.mixin({},this._url.query,{f:"json"},a.toJson(h&&h[0])));var m=this._handler,e=this._errorHandler;return b({url:this._url.path,content:a,callbackParamName:"callback",
load:function(a,c){m(a,c,d,k,g.dfd)},error:function(a){e(a,k,g.dfd)}})},onComplete:function(){}});m._createWrappers(p);return p})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(p,f,k,d,b,m){return p(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=new m(d.catalogItems));d.location&&(this.location=b.fromJson(d.location));
this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.processedValues=d.processedValues;this.properties=d.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(p,f,k,d,b,m,q,a){return p(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,
renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(b){var f=b&&b.geometry||this.geometry;b={geometry:f,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?k.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?k.toJson(this.renderingRule.toJson()):null};f&&(b.geometryType=a.getJsonType(f));f=this.timeExtent;b.time=f?f.toJson().join(","):
null;q.isDefined(this.pixelSizeX)&&q.isDefined(this.pixelSizeY)?b.pixelSize=k.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?k.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(b.renderingRules=k.toJson(d.map(this.renderingRules,function(a){return a.toJson()})));return b}})})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(p,f,k){var d;return p(null,
{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:0.25,maxPercent:0.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(b){this.stretchType=b.stretchType||b.StretchType||this.stretchType;this.min=b.min||b.Min||this.min;this.max=b.max||b.Max||this.max;this.numberOfStandardDeviations=b.numberOfStandardDeviations||b.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=b.statistics||
b.Statistics||this.statistics;this.dra=b.dra||b.DRA||b.dRA||this.dra;this.minPercent=b.minPercent||b.MinPercent||this.minPercent;this.maxPercent=b.maxPercent||b.MaxPercent||this.maxPercent;this.useGamma=b.useGamma||b.UseGamma||this.useGamma;this.gamma=b.gamma||b.Gamma||this.gamma;this.computeGamma=b.computeGamma||b.ComputeGamma||this.computeGamma;this.raster=b.raster||b.Raster||this.raster;this.outputPixelType=b.outputPixelType||b.OutputPixelType||this.outputPixelType;this.raster=b.raster||b.Raster||
this.raster;d=this},filter:function(b){if(!(null===b||null===b.pixelBlock||null===b.pixelBlock.pixels)){var f=b.pixelBlock,k=f.pixels,a=f.width*f.height,n=k.length,l;(l=6===d.stretchType||3===d.stretchType&&d.dra)&&d._calculateStatisticsHistograms(b);if(d.dra)if(l)d._statistics=f.statistics,d._histograms=f.histograms;else{var p=f.statistics;d._statistics=[];for(l=0;l<n;l++)d._statistics[l]=[p[l].minValue,p[l].maxValue,0,0]}else d._statistics=d.statistics,d._histograms=d.histograms;d.computeGamma&&
(d.gamma=d._computeGammaValues(f.pixelType),d.useGamma=!0);d._createLUT(b);if(void 0===d.LUT||null===d.LUT)return d._filterNoLUT(b);var p=d.LUT,g=d.LUTOffset,h,r;for(l=0;l<n;l++){r=p[l];for(f=0;f<a;f++)h=k[l][f],k[l][f]=r[h-g]}b.pixelBlock.pixelType="U8";return b}},_calculateStatisticsHistograms:function(b){b=b.pixelBlock;var d=b.pixelType,k=b.pixels,a=b.mask,n=k.length,l,p,g,h,r=function(a){this.min=-0.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},
e=[],t,c,u,v,y,x;for(g=0;g<n;g++){t=new r;c=t.counts;v=k[g];if("U8"===d)if(a)for(h=0;h<b.width*b.height;h++)a[h]&&c[v[h]]++;else for(h=0;h<b.width*b.height;h++)c[v[h]]++;else{l=b.statistics[g].minValue;p=b.statistics[g].maxValue;t.min=l;t.max=p;p=(p-l)/256;u=new Uint32Array(257);if(a)for(h=0;h<b.width*b.height;h++)a[h]&&u[Math.floor((v[h]-l)/p)]++;else for(h=0;h<b.width*b.height;h++)u[Math.floor((v[h]-l)/p)]++;for(h=0;255>h;h++)c[h]=u[h];c[255]=u[255]+u[256]}e.push(t);v=[];l=b.statistics[g].minValue;
p=b.statistics[g].maxValue;for(h=x=y=u=0;h<t.size;h++)u+=c[h],y+=h*c[h];y/=u;for(h=0;h<t.size;h++)x+=c[h]*Math.pow(h-y,2);c=Math.sqrt(x/(u-1));h=(y+0.5)*(t.max-t.min)/t.size+t.min;t=c*(t.max-t.min)/t.size;v.push(l);v.push(p);v.push(h);v.push(t);b.statistics[g]=v}b.histograms=e},_getCutOffPoints:function(b){b=b.pixelBlock.pixels.length;var f=[],k=[],a,n,l,p,g,h;switch(d.stretchType){case 5:for(g=0;g<b;g++)f[g]=d._statistics[g][0],k[g]=d._statistics[g][1];break;case 3:for(g=0;g<b;g++)f[g]=d._statistics[g][2]-
d.numberOfStandardDeviations*d._statistics[g][3],k[g]=d._statistics[g][2]+d.numberOfStandardDeviations*d._statistics[g][3],f[g]<d._statistics[g][0]&&(f[g]=d._statistics[g][0]),k[g]>d._statistics[g][1]&&(k[g]=d._statistics[g][1]);break;case 6:for(g=0;g<b;g++){a=d._histograms[g];p=new Uint32Array(a.size);l=a.counts;for(h=n=0;h<a.size;h++)n+=l[h],p[h]=n;l=d.minPercent*n/100;for(h=1;h<a.size;h++)if(p[h]>l){f[g]=a.min+(a.max-a.min)/a.size*(h-0.5);break}l=(1-d.maxPercent/100)*n;for(h=a.size-2;0<=h;h--)if(p[h]<
l){k[g]=a.min+(a.max-a.min)/a.size*(h+0.5);break}}break;default:for(g=0;g<b;g++)f[g]=0,k[g]=255}return{minCutOff:f,maxCutOff:k}},_createLUT:function(b){var f=b.pixelBlock,k=f.pixelType;if("U8"===k||"U16"===k||"S8"===k||"S16"===k){if(d._LUTSignature&&(k=d._computeLutSignature(),k.length===d._LUTSignature.length&&!k.some(function(a,c){return a!==d._LUTSignature[c]})))return;var k=f.pixels.length,a=[],n=[],l=[],p,g,h,r=d.max,e=d.min,t=d.gamma,c=r-e,u=d._getCutOffPoints(b);b=u.minCutOff;var u=u.maxCutOff,
v=0,y=256,x;"S8"===f.pixelType?v=-127:"S16"===f.pixelType&&(v=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)y=65536;for(f=0;f<k;f++)a[f]=u[f]-b[f];if(d.useGamma&&null!==t&&t.length===k)for(f=0;f<k;f++)l[f]=1<t[f]?2<t[f]?6.5+Math.pow(t[f]-2,2.5):6.5+100*Math.pow(2-t[f],4):1;if(d.useGamma)for(var w,f=0;f<k;f++){x=[];for(p=0;p<y;p++)g=p+v,w=(g-b[f])/a[f],h=1,1<t[f]&&(h-=Math.pow(1/c,w*l[f])),g<u[f]&&g>b[f]?x[p]=Math.floor(h*c*Math.pow(w,1/t[f]))+e:g>u[f]?x[p]=r:g<b[f]&&(x[p]=e);n[f]=x}else for(f=
0;f<k;f++){x=[];for(p=0;p<y;p++)g=p+v,x[p]=g<b[f]?e:g>u[f]?r:Math.floor((g-b[f])/a[f]*c)+e;n[f]=x}d.LUT=n;d.LUTOffset=v;d._LUTSignature=d._computeLutSignature()}},_computeLutSignature:function(){var b=[],f,k;b.push(d.stretchType);b.push(d.min);b.push(d.max);b.push(d.numberOfStandardDeviations);if(d._statistics)for(f=0;f<d._statistics.length;f++)for(k=0;k<d._statistics[f].length;k++)b.push(d._statistics[f][k]);b.push(d.dra?1:0);b.push(d.minPercent);b.push(d.maxPercent);if(d.gamma)for(f=0;f<d._statistics.length;f++)b.push(d.gamma[f]);
b.push(d.useGamma?1:0);return b},_filterNoLUT:function(b){if(!(null===b||null===b.pixelBlock||null===b.pixelBlock.pixels)){var f=b.pixelBlock,k=f.pixels,a=f.mask,f=f.width*f.height,n=k.length,l=[],p=[],g,h,r,e,t,c=d.max,u=d.min,v=d.gamma,y=c-u;g=d._getCutOffPoints(b);var x=g.minCutOff,w=g.maxCutOff;for(g=0;g<n;g++)l[g]=w[g]-x[g];if(d.useGamma&&null!==v&&v.length===n)for(g=0;g<n;g++)p[g]=1<v[g]?2<v[g]?6.5+Math.pow(v[g]-2,2.5):6.5+100*Math.pow(2-v[g],4):1;if(d.useGamma)if(void 0!==a&&null!==a)for(h=
0;h<f;h++){if(a[h])for(g=0;g<n;g++)r=k[g][h],t=(r-x[g])/l[g],e=1,1<v[g]&&(e-=Math.pow(1/y,t*p[g])),r<w[g]&&r>x[g]?k[g][h]=Math.floor(e*y*Math.pow(t,1/v[g]))+u:r>w[g]?k[g][h]=c:r<x[g]&&(k[g][h]=u)}else for(h=0;h<f;h++)for(g=0;g<n;g++)r=k[g][h],t=(r-x[g])/l[g],e=1,1<v[g]&&(e-=Math.pow(1/y,t*p[g])),r<w[g]&&r>x[g]?k[g][h]=Math.floor(e*y*Math.pow(t,1/v[g]))+u:r>w[g]?k[g][h]=c:r<x[g]&&(k[g][h]=u);else if(void 0!==a&&null!==a)for(h=0;h<f;h++){if(a[h])for(g=0;g<n;g++)r=k[g][h],r<w[g]&&r>x[g]?k[g][h]=Math.floor((r-
x[g])/l[g]*y)+u:r>w[g]?k[g][h]=c:r<x[g]&&(k[g][h]=u)}else for(h=0;h<f;h++)for(g=0;g<n;g++)r=k[g][h],r<w[g]&&r>x[g]?k[g][h]=Math.floor((r-x[g])/l[g]*y)+u:r>w[g]?k[g][h]=c:r<x[g]&&(k[g][h]=u);b.pixelBlock.pixelType="U8";return b}},_computeGammaValues:function(b){var d=this._statistics.length,f,a=[],k;for(f=0;f<d;f++)k=this._statistics[f][2],"U8"!==b&&(k=255*(k-this._statistics[f][0])/(this._statistics[f][1]-this._statistics[f][0])),a.push(this._computeGammaValue(k));return a},_computeGammaValue:function(b){if(!(0===
b||255<b||0>b)){var d=0;0<b&&(150!=b&&255>b)&&(d=150>=b?45*Math.cos(0.01047*b):17*Math.sin(0.021*b));d=b+d;b=Math.log(b/255);d=Math.log(d/255);if(0!==d)return b/=d,isNaN(b)?void 0:Math.min(9.9,Math.max(0.01,b))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x){return p([h],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(a,c){c=c||{};if(!c.mode||c.mode===h.MODE_STREAM)this._isStream=!0,this.currentMode=this.mode=h.MODE_STREAM,this._mode=new r(this);this.purgeOptions=new x(this,c.purgeOptions||{});this.purgeInterval=c.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=
null;this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=b.hitch(this,this._attemptReconnect);this._purge=b.hitch(this,this._purge);this._processServiceJson=b.hitch(this,this._processServiceJson);if(b.isObject(a)&&a.layerDefinition)this._initFeatureLayer(a,c);else{var e=this;s({url:a,content:b.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){e._processServiceJson(a,c)},function(a){e._errorHandler(a)})}},_processServiceJson:function(a,
c){var b=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,s({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(e){e=e.fields||[];var d=k.map(a.fields,function(a){return a.name.toLowerCase()});k.forEach(e,function(c){-1===k.indexOf(d,c.name.toLowerCase())&&a.fields.push(c)});c.resourceInfo=a;b._initFeatureLayer(b._url,c)},
function(a){b.onError({error:a})})):(c.resourceInfo=a,this._initFeatureLayer(this._url,c))},_initLayer:function(a,c){this.inherited(arguments);if(a){var b;if(a.layerDefinition)this.purgeOptions=new x(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var e=this._getWebsocketConnectionInfo(a),d=e.urls;d&&d.length?(this._socketUrls=d,this.socketUrl=d[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=e.token,d.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=d.length)):(this.socketUrl=void 0,e="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(e+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(e)))}if(this._params.filter)try{this._filter=
b=this._makeFilter(this._params.filter)}catch(g){this.onError(Error("Error trying to create filter object: "+g+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){b=b||{};b.geometry=this._params.geometryDefinition;b.outFields=this._outFields;b.where=this._defnExpr;try{this._filter=b=this._makeFilter(b)}catch(f){this.onError(Error("Error trying to create filter object: "+f+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&(a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField)&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&(this.socketUrl&&!this._connected)&&this.connect()}},_setMap:function(a){var c=this.inherited(arguments),b=this._getRenderer();if(this.timeInfo&&(this._trackIdField||b&&(b.latestObservationRenderer||b.trackRenderer)))this._trackManager=new e(this),this._trackManager.initialize(a);this.socketUrl&&(!this._connected&&this._map)&&this.connect();return c},_unsetMap:function(a,c){k.forEach(this._connects,
f.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&this._mode._clearFeatureMap(),
this._trackManager&&this._trackManager.clearTracks()}catch(a){}this.inherited(arguments)},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},
getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var c=this,b={},e=this._filter,d,g,f=this.socketUrl,h;try{if(!this._connected){if(this._map){var l;if(this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive)return l=this.on("update-end",function(a){c._relatedQueried=!0;l.remove();l=null;a&&a.error?console.log("Not connecting. Error fetching related features"):c.connect()}),this._mode._fetchArchive(this._relatedUrl),!1;if(this._keepLatestUrl&&
!this._keepLatestQueried&&this._mode._fetchArchive)return l=this.on("update-end",function(a){c._keepLatestQueried=!0;l.remove();l=null;a&&a.error?console.log("Not connecting. Error fetching archived features"):c.connect()}),this._mode._fetchArchive(this._keepLatestUrl),!1}this._websocketToken&&(b.token=this._websocketToken);this._map&&(this._map.spatialReference&&this.spatialReference)&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(b.outSR=this._map.spatialReference.wkid);if(e)for(g in e)null!==
e[g]&&(d="geometry"===g?JSON.stringify(e[g]):e[g],b[g]=d);f+="?"+q.objectToQuery(b);return h=this._createConnection(f,a)}}catch(k){console.log("Error connecting to data stream: ",k),a&&a(k,!1),this.onConnectionError({error:k})}},disconnect:function(a){var c=this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",b=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connected=!1;this.socket&&
this.socket.close();this.onDisconnect({willReconnect:b,message:c});a&&a(null,!0)},setFilter:function(c){var b,e;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==c.outFields)return e=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:e}),!1;b=this._makeFilter(c)}catch(d){return e=Error(d),this.onFilterChange({filter:this.getFilter(),error:e}),!1}if(this.socket)c=
{filter:b},this.socket.send(JSON.stringify(c));else a.once(this,"connect",function(a){this.setFilter(b)});return!0},getFilter:function(){var a=this._filter,c={},b=["geometry","outFields","where"];a&&k.forEach(b,function(b){var e=a[b];e&&("geometry"===b?e=t.fromJson(e):"outFields"===b&&(e=e.split(",")),c[b]=e)});return c},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var c,b={},e=[];c=this._getField(a,
!0);if(!c)return e;a=c.name;k.forEach(this.graphics||[],function(c){c=(c.attributes||{})[a];void 0!==c&&!b[c]&&(b[c]=1,e.push(c))});e.sort(function(a,c){return a<c?-1:a>c?1:0});return e},getLatestObservations:function(){var a=[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var c=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(c!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&
this.purgeInterval){var c=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){!c.updating&&!c.suspended&&(c._mode._flushDrawBuffer(),c._togglePurgeT(!0))},6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},
_createConnection:function(a,c){var b=this,e=new WebSocket(a);e.onopen=function(){b.socket=e;b._connected=!0;b._reconnecting=!1;b._reconnectAttempts=0;b._bind();b.onConnect();c&&c(null,!0)};e.onclose=function(a){var c,e=!0,d=b._connected,g=null;if(b._connected||b._reconnecting){if(a.code)if(c="Connection failed: ",1001===a.code)c+=a.reason||"Service is going away.",e=!1;else if(4400===a.code)c+=a.reason||"Invalid url parameters. Check filter properties.",e=!1;else if(4404===a.code)c+="Service not found",
e=!1;else if(4401===a.code||4403===a.code)c+="Not authorized",e=!1;e&&(b._reconnectAttempts+=1,b._reconnectAttempts>b.maxReconnectAttempts&&(c="Maximum reconnect attempts exceeded",e=!1,d=!0));b._connected=!1;d&&(c&&(g=Error(c)),b.onDisconnect({error:g,willReconnect:e}));e?b._attemptReconnect():b.socket=null}else b.socket||(g=Error("Could not make connection to service"),b.onConnectionError({error:g})),b.socket=null,b._connected=!1};e.onerror=function(a){console.log("Socket error")};return e},_purge:function(){var a,
c=[],b;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-this.purgeOptions.displayCount;a++)b=this.graphics[a],c.push(b);0<c.length&&(this._mode._removeFeatures(c),this._trackManager&&this._trackManager.removeFeatures(c))},_bind:function(){var a=this;this.socket.onmessage=function(c){a._onMessage(JSON.parse(c.data))}},_onMessage:function(a){var c=this;this.onMessage(a);var b={create:function(a){c._create(a)},update:function(a){c._update(a)},
"delete":function(a){c._delete(a)}};if(a.type)b[a.type](a.feature);else a.hasOwnProperty("filter")?c._handleFilterMessage(a):this._create(a)},_create:function(a){function c(a){if(!b._featureHasOID(a,e)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[e]=b._nextId++}a=a.declaredClass?a:new g(a);b._mode.drawFeature(a)}var b=this,e=b.objectIdField;a.length?a.forEach(function(a){a&&c(a)}):a&&c(a)},_delete:function(a){var c=this,b=a[c.objectIdField]||a.attributes[c.objectIdField],e=
!1;this.graphics.forEach(function(a){a.attributes[c.objectIdField]==b&&(e=a)});e&&this.remove(e)},_update:function(a){var c=this,b=!1;this.graphics.forEach(function(e){e.attributes[c.objectIdField]==a.attributes[c.objectIdField]&&(b=e)});b&&(a.attributes&&b.setAttributes(a.attributes),a.geometry&&b.setGeometry(t.fromJson(a.geometry)))},_makeFilter:function(a){var c,b=null;a=a||{};if(void 0!==a.geometry)if(b=b||{},null===a.geometry)b.geometry=null;else{c="string"===typeof a.geometry?t.fromJson(JSON.parse(a.geometry)):
a.geometry.declaredClass?a.geometry:t.fromJson(a.geometry);if(!c||"point"===c.type)throw"Query object contains invalid geometry";"extent"!==c.type&&(c=c.getExtent());if(!c||0===c.getHeight()&&0===c.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";b.spatialRel="esriSpatialRelIntersects";b.geometryType="esriGeometryEnvelope";b.geometry=c.toJson()}void 0!==a.where&&(b=b||{},b.where=a.where);if(void 0!==a.outFields&&(b=b||{},a="string"===typeof a.outFields?"*"===a.outFields?
null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");b.outFields=a.fields?a.fields.join(","):null}return b},_makeOutFields:function(a){var c=this,b=[],e=[],d={fields:null};if(!a||0===a.length)return d;k.forEach(a,function(a){if("*"===a)return d;var g=c._getField(a,!0);g?b.push(g.name):e.push("Field named "+a+" not found in schema.")});a=c._getOutFields();k.forEach(a,
function(a){c._getField(a)&&-1===k.indexOf(b,a)&&b.push(a)});d.fields=b;d.errors=e;return d},_handleFilterMessage:function(a){a.error?(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var c={urls:[]},b,e=[],d=[],g,f,h;a.streamUrls&&k.forEach(a.streamUrls,function(a){"ws"===
a.transport&&(b=a.urls,c.token=a.token)});if(!b)return c;k.forEach(b,function(a){0===a.lastIndexOf("wss",0)?d.push(a):e.push(a)});a="https:"===location.protocol||0===this.url.lastIndexOf("https:",0)?d:0===e.length?d:e;if(1<a.length)for(g=0;g<a.length-1;g++)f=g+Math.floor(Math.random()*(a.length-g)),h=a[f],a[f]=a[g],a[g]=h;c.urls=a;return c},_attemptReconnect:function(){var a=this,c;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&
a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;c=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});
a.connect()},1E3*a._reconnectAttempts+c)},_getServiceConnectionMetadata:function(a){var c=this,e=c._url.path;a="function"===typeof a?a:null;s({url:e,content:b.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(b){b=c._getWebsocketConnectionInfo(b);c._websocketToken=b.token;a&&a()},function(a){c.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new d([5,112,176,0.8]),e=new d([255,255,255]),e=new u(u.STYLE_SOLID,e,1),g;if("esriGeometryPoint"===
a||"esriGeometryMultipoint"===a)g=new v(v.STYLE_CIRCLE,10,e,b);else if("esriGeometryPolyline"===a)g=new u(u.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===a||"esriGeometryEnvelope"===a)b=new d([5,112,176,0.2]),e=new d([5,112,176,0.8]),e=new u(u.STYLE_SOLID,e,1),g=new c(c.STYLE_SOLID,e,b);g&&this.setRenderer(new y(g))},_makeObjectIdField:function(){var a=1,c,b,e=[];if(!this.objectIdField){c=this.fields.length;for(b=0;b<c;b++)e.push(this.fields[b].name.toLowerCase());for(;-1!==k.indexOf(e,"objectid_"+
a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,c){return a.attributes&&(a.attributes[c]||0===a.attributes[c])},_randomIntFromInterval:function(a,c){return Math.floor(Math.random()*(c-a+1)+a)}})})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./TrackManager".split(" "),function(p,
f,k,d,b,m,q,a){return p([a],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(a){this.inherited(arguments)},initialize:function(a){this.inherited(arguments)},addFeatures:function(a,b){function d(a,c){var b,f,h,l;g[a]||(g[a]=[]);b=g[a];0<e&&(c.length>e&&c.splice(0,c.length-e),h=c.length+b.length,h>e&&(f=b.splice(0,h-e)));h=c.length;for(l=0;l<h;l+=1)b.push(c[l]);return{deletes:f,adds:c}}var g,f,m,e,p={},c={},q;if(b)return this.inherited(arguments),p;g=this.trackMap;f=this.layer;
m=f._trackIdField;e=f.maximumTrackPoints||0;k.forEach(a,function(a){var b=a.attributes[m];a.visible&&(c[b]||(c[b]=[]),c[b].push(a))});for(q in c)c.hasOwnProperty(q)&&(f=d(q,c[q]),p[q]=f);return p},removeFeatures:function(a){var b=[],d=this.layer.objectIdField,g=this.layer._trackIdField;a&&(k.forEach(a,function(a){var f,e,n,c;e=a.attributes[g];f=a.attributes[d];if(n=this.trackMap[e])for(a=0;a<n.length;a+=1)if(c=n[a],c.attributes[d]===f){this.trackMap[e].splice(a,1);-1===k.indexOf(e)&&b.push(e);break}},
this),0<a.length&&this.refreshTracks(b))},drawTracks:function(a){function b(a){var l=f[a],k=l&&1<l.length,n,t,w;if((w=d.trackLineMap[a])&&!k)g.remove(w),delete d.trackLineMap[a],w=null;if(!k)return!1;k=[];for(n=l.length-1;0<=n;n-=1)(t=l[n].geometry)&&k.push([t.x,t.y]);l={};l[e]=a;1<k.length&&(w?(a=w.geometry,a.removePath(0),a.addPath(k),w.setGeometry(a)):(w=new m(new q({paths:[k],spatialReference:p}),null,l),g.add(w),d.trackLineMap[a]=w))}var d=this,g=this.container,f,p,e,t;if(g)if(f=this.trackMap,
p=this.map.spatialReference,e=this.layer._trackIdField,a)k.forEach(a,function(a){b(a)});else for(t in f)f.hasOwnProperty(t)&&b(t)},refreshTracks:function(a){function b(a){var e,f;a=d[a]||[];e=a.length;for(f=0;f<e;f++)g._repaint(a[f],null,!0)}var d=this.trackMap,g=this.layer;g._getRenderer();var f;this.drawTracks(a);if(a)k.forEach(a,function(a){b(a)});else for(f in d)d.hasOwnProperty(f)&&b(f)},getLatestObservations:function(){var a,b,d=this.trackMap,g=[];for(a in d)d.hasOwnProperty(a)&&(b=d[a],g.push(b[b.length-
1]));return g},destroy:function(){this.inherited(arguments);this.trackLineMap=null}})})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(p,f,k,d,b){return p([k],{declaredClass:"esri.layers.PurgeOptions",constructor:function(b,d){this.parent=b;for(var a in d)this[a]=d[a]},_displayCountSetter:function(b){this.displayCount=b;this.parent.refresh()}})})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(p,f,k,d,b,m,q){return p([m,q],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=b}},exportMapImage:function(a,d){var l=b.defaults.map,l=f.mixin({size:l.width+","+l.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete l._ts;
this._exportMapImage(this._url.path+"/exportImage",l,d)}})})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r){return p([a,n],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,
b){this.symbolTileSize=b&&b.symbolTileSize?b.symbolTileSize:50;this._maxMag=this._minMag=null;this.setVectorRendererStyle(b&&b.rendererStyle?b.rendererStyle:l.STYLE_SINGLE_ARROW);var c=f.clone(this._params);delete c.imageServiceParameters;delete c.pixelFilter;delete c.rendererStyle;delete c.symbolTileSize;this._initialize(a,b);this.geometryType="esriGeometryPoint";this.symbolTileSizeUnits="Pixels";f.mixin(this._params,c)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=
a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onRendererChange:function(){},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},_refresh:function(a){if(10>b("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));
else if(!1===this.hasMultidimensions)this.onError(Error("Unable to refresh. This layer does not have multi-dimensional info."));else{this.setImageFormat("LERC",!0);a=this.fullExtent.xmin;var d=this.fullExtent.ymax,c=f.clone(this._map.extent),g=this._map.width*(1/this.symbolTileSize),g=g?Math.ceil(g):50,h=this._map.height*(1/this.symbolTileSize),h=h?Math.ceil(h):Math.ceil(g*((c.ymax-c.ymin)/(c.xmax-c.xmin))),l=(c.xmax-c.xmin)/g,k=(c.ymax-c.ymin)/h;c.xmin=a+Math.floor((c.xmin-a)/l)*l;c.xmax=a+Math.ceil((c.xmax-
a)/l)*l;c.ymin=d+Math.floor((c.ymin-d)/k)*k;c.ymax=d+Math.ceil((c.ymax-d)/k)*k;this._requestData(c,g,h)}},_drawPixelData:function(){this.clear();if(this.pixelData){var a=this.pixelData.pixelBlock,b=this.pixelData.extent,c=this.pixelData.locations,f=q.isDefined(a.mask)&&0<a.mask.length;if(a&&b&&c){if(this.useDefaultRenderer&&this.renderer&&(!q.isDefined(this._minMag)||!q.isDefined(this._maxMag))){var l=this._getServiceMinMaxStats();l?(this._minMag=l.min,this._maxMag=l.max):(this._minMag=a.statistics[0].minValue,
this._maxMag=a.statistics[0].maxValue);var l={type:"sizeInfo",minSize:r.px2pt(0.2*this.symbolTileSize),maxSize:r.px2pt(0.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},k=[];k.push(l);k.push({type:"colorInfo"});this.renderer.setVisualVariables(k)}for(var n=k=l=0,m,p=b.spatialReference?b.spatialReference._getInfo():null,l=0;l<a.height;l++)for(k=0;k<a.width;k++,n++)if(m=c[n],(!f||a.mask[n])&&m&&2===m.length){m=new s(m[0],m[1],b.spatialReference);p&&(m.x=g.prototype._normalizeX(m.x,
p).x);var A={Magnitude:a.pixels[0][n],Direction:a.pixels[1][n],Location:d.toJson(m.toJson())};m=new h(m,null,A);this.add(m)}}}},_getServiceMinMaxStats:function(){if(!q.isDefined(this.minValues)||!q.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],b=this.maxValues[0],c=this.minValues[1],d=this.maxValues[1];if(this.pixelFilter&&a&&b&&c&&d){var g=[];g.push([a,b]);g.push([c,d]);c=this._createPixelData(g);this.pixelFilter(c);c&&(c.pixelBlock&&
c.pixelBlock.pixels&&0<c.pixelBlock.pixels.length)&&(a=c.pixelBlock.pixels[0][0],b=c.pixelBlock.pixels[0][1])}return a&&b?{min:a,max:b}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:r.px2pt(0.2*this.symbolTileSize),maxSize:r.px2pt(0.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},b=[];b.push(a);a=new l({style:this.rendererStyle,visualVariables:b,flowRepresentation:this._vectorFlowRepresentation});this.setRenderer(a)},_getField:function(a,b){if(q.isDefined(a))return b&&
(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&(this.renderer&&q.isDefined(a.FlowDirection))&&(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}})})},
"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(p,f){return p(f,{constructor:function(f,d){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault esri/dijit/PopupTemplate esri/layers/FeatureLayer".split(" "),
function(p,f,k,d,b,m,q,a){return p(m,{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var b=new d;if(this.layerObject.empty)if(this.layerObject.url){var l=this._getLayerOptionsForCreateLayerObject();this.layerObject=new a(this.layerObject.url,f.mixin(l,this.originOperLayer.options||{})||{});this.layerObject.on("load",f.hitch(this,function(){!this.layerObject.empty&&(this.layerObject.name&&!f.getObject("_wabProperties.originalLayerName",
!1,this.layerObject))&&(f.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=this.title);this._bindEventAfterLayerObjectLoaded();b.resolve(this.layerObject)}));this.layerObject.on("error",f.hitch(this,function(){b.resolve(null)}))}else this.layerObject.featureCollectionData?(this.layerObject=new a(this.layerObject.featureCollectionData,this.originOperLayer.options||{}),b.resolve(this.layerObject)):b.resolve(null);else b.resolve(this.layerObject);
return b},getLayerType:function(){var a=new d;a.resolve("Table");return a},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return k.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new q(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var a=
b.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(a)},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():this.getFilterOfWebmap()},setFilter:function(){var a=arguments;return this.getLayerObject().then(f.hitch(this,function(){this.inherited(a)}))}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),
function(p,f,k,d,b,m,q,a,n){return p(n,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(a){10.2<=this.layerObject.version?this._legendRequestServer().then(d.hitch(this,
function(b){f.empty(a);k.forEach(b.layers,function(b){k.forEach(b.legend,function(b){if("\x3call other values\x3e"!==b.label){var d=f.create("div",{"class":"legend-div"},a),e=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},d),g=null,g=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:g},e);f.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},d)}},this)},this)}),d.hitch(this,function(){f.empty(a)})):f.empty(a)},_legendRequestServer:function(){var b=this.layerObject.url+"/legend",d={f:"json"};this.layerObject._params.bandIds&&(d.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(d.renderingRule=this.layerObject._params.renderingRule);return a({url:b,content:d,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var a=
new b,f={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},g=this.getLayerType(),h=this.getLayerObject();m({type:g,layerObject:h}).then(d.hitch(this,function(b){var e=b.type;b=b.layerObject;f.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(f.isSupportedLayer=!0);b.capabilities&&0<=b.capabilities.indexOf("Catalog")?f.isSupportQuery=!0:f.isSupportedLayer=!1;a.resolve(f)}),function(){a.resolve(f)});return a},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&
!this.layerObject.empty&&(a=q.after(this.layerObject,"setRenderingRule",d.hitch(this,this._onRendererChanged)),this._eventHandles.push(a))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(p,f,k,d,b){return p(b,{getSupportTableInfo:function(){var b=new k,p={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},a=this.getLayerType(),n=this.getLayerObject();
d({type:a,layerObject:n}).then(f.hitch(this,function(a){var d=a.type;a=a.layerObject;p.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(p.isSupportedLayer=!0);if((d=a.getLatestObservations())&&0<d.length)p.otherReasonCanNotSupport=!1;b.resolve(p)}),function(){b.resolve(p)});return b}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(p,
f,k,d,b,m,q,a,n){return m("dijit.layout._LayoutWidget",[f,k,d],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);q.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(b.on("resize",p.hitch(this,"resize")))}},resize:function(b,d){var g=this.domNode;b&&a.setMarginBox(g,b);var f=d||{};p.mixin(f,
b||{});if(!("h"in f)||!("w"in f))f=p.mixin(a.getMarginBox(g),f);var k=n.getComputedStyle(g),e=a.getMarginExtents(g,k),m=a.getBorderExtents(g,k),f=this._borderBox={w:f.w-(e.w+m.w),h:f.h-(e.h+m.h)},e=a.getPadExtents(g,k);this._contentBox={l:n.toPixelValue(g,k.paddingLeft),t:n.toPixelValue(g,k.paddingTop),w:f.w-e.w,h:f.h-e.h};this.layout()},layout:function(){},_setupChild:function(a){q.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,b){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){q.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t){s("dijit-legacy-requires")&&
t(0,function(){p(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return k("dijit.Menu",e,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return h.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(c){c=d.byId(c,this.ownerDocument);var e;if("iframe"==c.tagName.toLowerCase()){var f=c;e=this._iframeContentWindow(f);e=g.body(e.document)}else e=c==g.body(this.ownerDocument)?this.ownerDocument.documentElement:c;var h={node:c,
iframe:f};b.set(c,"_dijitMenu"+this.id,this._bindings.push(h));var k=n.hitch(this,function(c){var b=this.selector,e=b?function(a){return l.selector(b,a)}:function(a){return a},d=this;return[l(c,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<d._lastKeyDown+500||d._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),l(c,e("keydown"),function(c){if(93==c.keyCode||c.shiftKey&&c.keyCode==a.F10||d.leftClickToOpen&&c.keyCode==a.SPACE)c.stopPropagation(),
c.preventDefault(),d._scheduleOpen(this,f,null,c.target),d._lastKeyDown=(new Date).getTime()})]});h.connects=e?k(e):[];f&&(h.onloadHandler=n.hitch(this,function(){var a=this._iframeContentWindow(f),a=g.body(a.document);h.connects=k(a)}),f.addEventListener?f.addEventListener("load",h.onloadHandler,!1):f.attachEvent("onload",h.onloadHandler))},unBindDomNode:function(a){var e;try{e=d.byId(a,this.ownerDocument)}catch(g){return}a="_dijitMenu"+this.id;if(e&&b.has(e,a)){for(var f=b.get(e,a)-1,h=this._bindings[f],
l;l=h.connects.pop();)l.remove();(l=h.iframe)&&(l.removeEventListener?l.removeEventListener("load",h.onloadHandler,!1):l.detachEvent("onload",h.onloadHandler));b.remove(e,a);delete this._bindings[f]}},_scheduleOpen:function(a,b,e,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:e})},1))},_openMyself:function(a){function b(){p.refocus&&t&&t.focus();r.close(p)}var e=a.target,g=a.iframe,f=a.coords,h=!f;this.currentTarget=
a.delegatedTarget;if(f){if(g){a=m.position(g,!0);var e=this._iframeContentWindow(g),e=m.docScroll(e.document),l=q.getComputedStyle(g),k=q.toPixelValue,n=(s("ie")&&s("quirks")?0:k(g,l.paddingLeft))+(s("ie")&&s("quirks")?k(g,l.borderLeftWidth):0),g=(s("ie")&&s("quirks")?0:k(g,l.paddingTop))+(s("ie")&&s("quirks")?k(g,l.borderTopWidth):0);f.x+=a.x+n-e.x;f.y+=a.y+g-e.y}}else f=m.position(e,!0),f.x+=10,f.y+=10;var p=this,g=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var t=!a||
d.isDescendant(a,this.domNode)?g:a;r.open({popup:this,x:f.x,y:f.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();h||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);r.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(p,f,k){return p("dgrid.OnDemandGrid",[f,k],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(p,f,k,d,b,m,q){function a(a,b){b&&b.nodeType&&a.appendChild(b)}function n(a,b,d,f){if(this.formatter){f=this.formatter;var e=this.grid.formatterScope;d.innerHTML="string"===typeof f&&e?e[f](b,a):this.formatter(b,a)}else null!=b&&d.appendChild(document.createTextNode(b))}var l=8>d("ie")&&
!d("quirks");f=f("dgrid.Grid",m,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var d;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var f=a.columnId;if(f){b=f;d=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!d&&"undefined"!=typeof b){var e=this.row(a);if(f=e&&e.element)for(var f=f.getElementsByTagName("td"),
l=0;l<f.length;l++)if(f[l].columnId==b){d=f[l];break}}if(null!=a)return{row:e||this.row(a),column:b&&this.column(b),element:d}},createRowCells:function(a,g,f,k){var e=b("table.dgrid-row-table[role\x3dpresentation]"),n=9>d("ie")||d("quirks")?b(e,"tbody"):e,c,m,p,y,x,w,B,A,D,C;f=f||this.subRows;m=0;for(p=f.length;m<p;m++){w=f[m];c=b(n,"tr");w.className&&b(c,"."+w.className);y=0;for(x=w.length;y<x;y++){B=w[y];A=B.id;D=B.field?".field-"+q.escapeCssIdentifier(B.field,"-"):"";(C="function"===typeof B.className?
B.className(k):B.className)&&(D+="."+C);D=b(a+(".dgrid-cell.dgrid-cell-padding"+(A?".dgrid-column-"+q.escapeCssIdentifier(A,"-"):"")+D.replace(/ +/g,"."))+"[role\x3d"+("th"===a?"columnheader":"gridcell")+"]");D.columnId=A;l?(A=b(D,"!dgrid-cell-padding div.dgrid-cell-padding"),D.contents=A):A=D;if(C=B.colSpan)D.colSpan=C;if(C=B.rowSpan)D.rowSpan=C;g(A,B);c.appendChild(D)}}return e},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||1),"dgrid-cell"))},right:function(a,
b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},renderRow:function(d,g){var f=this.createRowCells("td",function(b,e){var f=d;e.get?f=e.get(d):"field"in e&&"_item"!=e.field&&(f=f[e.field]);e.renderCell?a(b,e.renderCell(d,f,b,g)):n.call(e,d,f,b,g)},g&&g.subRows,d);return b("div[role\x3drow]\x3e",f)},renderHeader:function(){var f=this,g=this.headerNode,h=g.childNodes.length;for(g.setAttribute("role","row");h--;)b(g.childNodes[h],"!");h=this.createRowCells("th",function(b,
e){var d=e.headerNode=b;l&&(b=b.parentNode);var c=e.field;c&&(b.field=c);if(e.renderHeaderCell)a(d,e.renderHeaderCell(d));else if("label"in e||e.field)d.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&(c&&"_item"!=c)&&(b.sortable=!0,b.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[h.id=this.id+"-header"]=this.columns;g.appendChild(h);this._sortListener&&this._sortListener.remove();this._sortListener=k(h,"click,keydown",
function(a){if("click"==a.type||32==a.keyCode||!d("opera")&&13==a.keyCode){var b=a.target,h,c,l;do if(b.sortable){l=[{attribute:h=b.field||b.columnId,descending:(c=f._sort[0])&&c.attribute==h&&!c.descending}];h={bubbles:!0,cancelable:!0,grid:f,parentType:a.type,sort:l};k.emit(a.target,"dgrid-sort",h)&&(f._sortNode=b,f.set("sort",l));break}while((b=b.parentNode)&&b!=g)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,f;this.inherited(arguments);if(!d("ie")||7<d("ie")&&!d("quirks"))if(b.style.width=
"",b&&a&&(f=a.offsetWidth)!=b.offsetWidth)b.style.width=f+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,b){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var b=this.columns,d;for(d in b){var f=b[d];if(f.field==a)return f.headerNode}},updateSortArrow:function(a,d){this._lastSortedArrow&&(b(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),b(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);d&&(this._sort=a);if(a[0]){var f=a[0].attribute,l=a[0].descending,f=this._sortNode||this._findSortArrowParent(f),e;delete this._sortNode;f&&(f=f.contents||f,e=this._lastSortedArrow=b("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),e.innerHTML="\x26nbsp;",f.insertBefore(e,f.firstChild),b(f,l?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,b){return this.addCssRule("#"+q.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+q.escapeCssIdentifier(a,
"-"),b)},_configColumns:function(a,b){var d=[],f=b instanceof Array;q.each(b,function(e,l){"string"==typeof e&&(b[l]=e={label:e});!f&&!e.field&&(e.field=l);l=e.id=e.id||(isNaN(l)?l:a+l);this._configColumn&&(this._configColumn(e,l,b,a),l=e.id);f&&(this.columns[l]=e);e.grid=this;"function"===typeof e.init&&e.init();d.push(e)},this);return f?b:d},_destroyColumns:function(){var a=this.subRows,b=a&&a.length,d,f,e,l;this.cleanup();for(d=0;d<b;d++){f=0;for(l=a[d].length;f<l;f++)e=a[d][f],"function"===typeof e.destroy&&
e.destroy()}},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},setColumns:function(a){p.deprecated("setColumns(...)",
'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){p.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=a;f.defaultRenderCell=n;return f})},"put-selector/put":function(){(function(p){var f,
k=/[-+,> ]/;p([],f=function(d,b){function m(b){function f(){c&&(t&&c!=t)&&(t==b&&(h||(h=k.test(x)&&d.createDocumentFragment()))?h:t).insertBefore(c,e||null)}for(var h,r,e,t,c,u=arguments,v=u[0],y=0;y<u.length;y++){var x=u[y];if("object"==typeof x){r=!1;if(x instanceof Array){c=d.createDocumentFragment();for(var w=0;w<x.length;w++)c.appendChild(m(x[w]));x=c}if(x.nodeType)c=x,f(),t=x,e=0;else for(w in x)c[w]=x[w]}else if(r)r=!1,c.appendChild(d.createTextNode(x));else{1>y&&(b=null);r=!0;if(v=x.replace(p,
function(h,k,p,r,q,v){k&&(f(),"-"==k||"+"==k?(t=(e=c||t).parentNode,c=null,"+"==k&&(e=e.nextSibling)):("\x3c"==k?t=c=(c||t).parentNode:(","==k?t=b:c&&(t=c),c=null),e=0),c&&(t=c));if((h=!p&&r)||!c&&(p||q))"$"==h?(h=u[++y],t.appendChild(d.createTextNode(h))):(h=h||m.defaultTag,(k=l&&u[y+1]&&u[y+1].name)&&(h="\x3c"+h+' name\x3d"'+k+'"\x3e'),c=n&&~(a=h.indexOf("|"))?d.createElementNS(n[h.slice(0,a)],h.slice(a+1)):d.createElement(h));if(p)if("$"==r&&(r=u[++y]),"#"==p)c.id=r;else if(k=(h=c.className)&&
(" "+h+" ").replace(" "+r+" "," "),"."==p)c.className=h?(k+r).substring(1):r;else if("!"==x){var w;l?m("div",c,"\x3c").innerHTML="":(w=c.parentNode)&&w.removeChild(c)}else k=k.substring(1,k.length-1),k!=h&&(c.className=k);q&&("$"==v&&(v=u[++y]),"style"==q?c.style.cssText=v:(p="!"==q.charAt(0)?(q=q.substring(1))&&"removeAttribute":"setAttribute",v=""===v?q:v,n&&~(a=q.indexOf("|"))?c[p+"NS"](n[q.slice(0,a)],q.slice(a+1),v):c[p](q,v)));return""}))throw new SyntaxError("Unexpected char "+v+" in "+x);
f();t=v=c||t}}b&&h&&b.appendChild(h);return v}k=b||k;var p=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,a,n=!1;d=d||document;var l="object"==typeof d.createElement;m.addNamespace=function(a,b){d.createElementNS?(n||(n={}))[a]=b:d.namespaces.add(a,b)};m.defaultTag="div";m.forDocument=f;return m})})(function(p,f,k){k=k||f;"function"===typeof define?define([],function(){return k()}):"undefined"==typeof window?require("./node-html")(module,k):put=
k()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(p,f,k,d,b,m,q,a,n){function l(a,c){n(document.body,a,".dgrid-scrollbar-measure");var b=a["offset"+c]-a["client"+c];a.className="";document.body.removeChild(a);return b}function s(a){var c=a?"."+a.replace(u,"."):"";this._class&&(c="!"+this._class.replace(u,"!")+
c);n(this.domNode,c);this._class=a}function g(){return this._class}function h(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function r(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}a("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var e,t;b.add("dom-scrollbar-width",function(a,c,b){return l(b,"Width")});b.add("dom-scrollbar-height",function(a,c,b){return l(b,"Height")});b.add("dom-rtl-scrollbar-left",
function(a,c,e){a=n("div");n(document.body,e,".dgrid-scrollbar-measure[dir\x3drtl]");n(e,a);c=!!b("ie")||!!b("trident")||a.offsetLeft>=b("dom-scrollbar-width");e.className="";document.body.removeChild(e);n(a,"!");e.removeAttribute("dir");return c});var c=0,u=/ +/g,v=7>b("ie")&&!b("quirks")?function(){var a,c,b;if(this._started&&(a=document.documentElement,c=a.clientWidth,a=a.clientHeight,b=this._prevWinDims||[],b[0]!==c||b[1]!==a))this.resize(),this._prevWinDims=[c,a]}:function(){this._started&&this.resize()};
return f("dgrid.List",b("touch")?q:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,c){var b=this;(this._Row=function(a,c,b){this.id=a;this.data=c;this.element=b}).prototype.remove=function(){b.removeRow(this.element)};c&&(this.srcNodeRef=c=c.nodeType?c:document.getElementById(c));this.create(a,c)},listType:"list",create:function(a,e){var d=
this.domNode=e||n("div"),g;a?(this.params=a,f.safeMixin(this,a),g=a["class"]||a.className||d.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=d.id=d.id||this.id||"dgrid_"+c++;null===this.useTouchScroll&&(this.useTouchScroll=!b("dom-scrollbar-width"));this.buildRendering();g&&s.call(this,g);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&
this.startup()},buildRendering:function(){var a=this.domNode,c=this.addUiClasses,e=this,f,g,h,l;l=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";n(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(c?".ui-widget":""));f=this.headerNode=n(a,"div.dgrid-header.dgrid-header-row"+(c?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(b("quirks")||8>b("ie"))&&n(a,"div.dgrid-spacer");g=this.bodyNode=n(a,"div.dgrid-scroller");
b("ff")&&(g.tabIndex=-1);this.headerScrollNode=n(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(c?".ui-widget-header":""));h=this.footerNode=n("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));n(a,h);l&&(a.className+=" dgrid-rtl"+(b("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));d(g,"scroll",function(c){e.showHeader&&(f.scrollLeft=c.scrollLeft||g.scrollLeft);c.stopPropagation();d.emit(a,"scroll",{scrollTarget:g})});this.configStructure();this.renderHeader();this.contentNode=
this.touchNode=n(this.bodyNode,"div.dgrid-content"+(c?".ui-widget-content":""));this._listeners.push(this._resizeHandle=d(window,"resize",m.throttleDelayed(v,this)))},postCreate:b("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,c=this.headerNode,d=this.footerNode,f=c.offsetHeight,
g=this.showFooter?d.offsetHeight:0,h=b("quirks")||7>b("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=g+"px";h&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-f-g,0)+"px",g&&(d.style.bottom="1px",setTimeout(function(){d.style.bottom=""},0)));e||(e=b("dom-scrollbar-width"),t=b("dom-scrollbar-height"),b("ie")&&(e++,t++),m.addCssRule(".dgrid-scrollbar-width","width: "+e+"px"),m.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17!=e&&
!h&&(m.addCssRule(".dgrid-header-row","right: "+e+"px"),m.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+e+"px")));h&&(c.style.width=a.clientWidth+"px",setTimeout(function(){c.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,c){var b=m.addCssRule(a,c);this.cleanAddedRules&&this._listeners.push(b);return b},on:function(a,c){var e=d(this.domNode,a,c);b("dom-addeventlistener")||this._listeners.push(e);return e},cleanup:function(){var a=this.observers,c;for(c in this._rowIdToObject)if(this._rowIdToObject[c]!=
this.columns){var b=document.getElementById(c);b&&this.removeRow(b,!0)}for(c=0;c<a.length;c++)(b=a[c])&&b.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();n(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";
this.scrollTo({x:0,y:0})},newRow:function(a,c,b,e,d){if(c){var f=this.insertRow(a,c,b,e,d);n(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){n(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var c=a.rowIndex;if(-1<c){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&n(a,"."+(1==c%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==c%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=
c++);while((a=a.nextSibling)&&a.rowIndex!=c)}},renderArray:function(a,c,b){function e(){var c=arguments;if(-1<r)for(var f=0;f<c.length;f++){var g=c[f],l=m[g?0:m.length-1];if(l=l&&d(l)){var k=l[g?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=l&&(g=g?"unshift":"push",a[g](k.data),m[g](k.element),b.count++)}}}function d(a){return!k.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){s=h.insertRow(a,t,null,l++,b);s.observerIndex=
r;return s}function g(a){u=a.slice(0);(p=c?c.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(t,c||null),(s=a[a.length-1])&&h.adjustRowIndices(s)):n[r]&&h.cleanEmptyObservers&&"undefined"!==typeof r&&(n[r].cancel(),n[r]=0,h._numObservers--);m=a;q&&(q.rows=m)}b=b||{};var h=this,l=b.start||0,n=this.observers,m,p,r;c||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var q=a.observe(function(f,g,l){var k,n,q;-1<g&&m[g]&&(k=m.splice(g,
1)[0],k.parentNode==p&&((n=k.nextSibling)&&g!=l&&n.rowIndex--,h.removeRow(k)),b.count--,h._processScroll&&h._processScroll());if(-1<l){if(m.length)if(0===l)q=(q=m[l])&&d(q);else{if(q=m[l-1])q=d(q),q=(q.connected||q).nextSibling}else q=h._getFirstRowSibling&&h._getFirstRowSibling(p);k&&(q&&k.id===q.id)&&(q=(q.connected||q).nextSibling);q&&!q.parentNode&&(q=document.getElementById(q.id));k=c&&c.parentNode||q&&q.parentNode||h.contentNode;if(k=h.newRow(f,k,q,b.start+l,b))if(k.observerIndex=r,m.splice(l,
0,k),!n||l<g)n=k.previousSibling,n=!n||n.rowIndex+1==k.rowIndex||0==k.rowIndex?k:n;b.count++}0===g?e(1,1):g===a.length-(-1===l?0:1)&&e(0,0);g!=l&&n&&h.adjustRowIndices(n);h._onNotification(m,f,g,l)},!0);r=n.push(q)-1}var t=document.createDocumentFragment(),s,u;if(a.map){if(m=a.map(f,console.error),m.then)return a.then(function(c){a=c;return m.then(function(a){g(a);e(1,1,0,0);return u})})}else{m=[];for(var v=0,M=a.length;v<M;v++)m[v]=f(a[v])}g(m);e(1,1,0,0);return u},_onNotification:function(a,c,b,
e){},renderHeader:function(){},_autoId:0,insertRow:function(a,c,b,e,d){var f=d.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===b&&(b=(b.connected||b).nextSibling),this.removeRow(g));g=this.renderRow(a,d);g.className=(g.className||"")+" dgrid-row "+(1==e%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;c.insertBefore(g,
b||null);h&&this.adjustRowIndices(h);g.rowIndex=e;return g},renderRow:function(a,c){return n("div",""+a)},removeRow:function(a,c){a=a.element||a;delete this._rowIdToObject[a.id];c||n(a,"!")},row:function(a){var c;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var b=a.id;if(c=this._rowIdToObject[b])return new this._Row(b.substring(this.id.length+5),c,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?c=this.store.getIdentity(a):
(c=a,a=this._rowIdToObject[this.id+"-row-"+c]),new this._Row(c,a,document.getElementById(this.id+"-row-"+c))},cell:function(a){return{row:this.row(a)}},_move:function(a,c,b,e){var d,f;f=d=a.element;c=c||1;do if(a=d[0>c?"previousSibling":"nextSibling"]){do if((d=a)&&-1<(d.className+" ").indexOf(b+" ")){f=d;c+=0>c?1:-1;break}while(a=(!e||!d.hidden)&&d[0>c?"lastChild":"firstChild"])}else if(d=d.parentNode,!d||d===this.bodyNode||d===this.headerNode)break;while(c);return f},up:function(a,c,b){a.element||
(a=this.row(a));return this.row(this._move(a,-(c||1),"dgrid-row",b))},down:function(a,c,b){a.element||(a=this.row(a));return this.row(this._move(a,c||1,"dgrid-row",b))},scrollTo:b("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):r.call(this,a)}:r,getScrollPosition:b("touch")?function(){return this.useTouchScroll?this.inherited(arguments):h.call(this)}:h,get:function(a){var c="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,
1)):this[a]},set:function(a,c){if("object"===typeof a)for(var b in a)this.set(b,a[b]);else b="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]=c;return this},_getClass:g,_setClass:s,_getClassName:g,_setClassName:s,_setSort:function(a,c){this._sort="string"!=typeof a?a:[{attribute:a,descending:c}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(c=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(b,
e){var d=b[a],f=e[a];void 0===d&&(d="");void 0===f&&(f="");return d==f?0:d>f==!c?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,c){p.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,c)},_getSort:function(){return this._sort},_setShowHeader:function(a){var c=this.headerNode;this.showHeader=a;n(c,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(c.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){p.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;n(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(p,f){p.add("dom-contains",function(a,b,d){return!!d.contains});var k=[],d,b,m,q=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,a={defaultDelay:15,throttle:function(b,d,f){var g=!1;f=f||a.defaultDelay;return function(){g||(g=!0,b.apply(d,arguments),
setTimeout(function(){g=!1},f))}},throttleDelayed:function(b,d,f){var g=!1;f=f||a.defaultDelay;return function(){if(!g){g=!0;var a=arguments;setTimeout(function(){g=!1;b.apply(d,a)},f)}}},debounce:function(b,d,f){var g;f=f||a.defaultDelay;return function(){g&&(clearTimeout(g),g=null);var a=arguments;g=setTimeout(function(){b.apply(d,a)},f)}},each:function(a,b,d){var f,h;if(a)if("number"===typeof a.length){f=0;for(h=a.length;f<h;f++)b.call(d,a[f],f,a)}else for(f in a)b.call(d,a[f],f,a)},contains:function(a,
b){return p("dom-contains")?a.contains(b):a.compareDocumentPosition(b)&8},addCssRule:function(a,l){d||(d=f(document.getElementsByTagName("head")[0],"style"),d=d.sheet||d.styleSheet,b=d.deleteRule?"deleteRule":"removeRule",m=d.cssRules?"cssRules":"rules");var p=k.length;k[p]=(d.cssRules||d.rules).length;d.addRule?d.addRule(a,l):d.insertRule(a+"{"+l+"}",k[p]);return{get:function(a){return d[m][k[p]].style[a]},set:function(a,b){"undefined"!==typeof k[p]&&(d[m][k[p]].style[a]=b)},remove:function(){var a=
k[p],f,l;if(void 0!==a){d[b](a);k[p]=void 0;f=p+1;for(l=k.length;f<l;f++)k[f]>a&&k[f]--}}}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(q,b||"\\$1"):a}};return a})},"xstyle/has-class":function(){define(["dojo/has"],function(p){var f={};return function(){for(var k,d=arguments,b=0;b<d.length;b++)if(k=d[b],!f[k]){f[k]=!0;var m=k.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),q=p(m[2]),a=-m[4];if((0<a?a<=q&&(-m[5]||a)>=q:!!q)==!m[1])document.documentElement.className+=" has-"+
k}}})},"xstyle/css":function(){define(["require"],function(p){function f(f,d,b){var m=document.documentElement;f=m.insertBefore(document.createElement(f),m.firstChild);f.id=d;d=(f.currentStyle||getComputedStyle(f,null)||{})[b];m.removeChild(f);return d}return{load:function(k,d,b,m){function q(a){var g=f("x-parse",null,"content"),h=a&&(a.sheet||a.styleSheet);g&&"none"!=g&&"normal"!=g?d([eval(g)],function(d){a?d.process(a,b):(d.processAll(),b(h))}):b(h)}var a=d.toUrl(k),n;a.match(/!$/)&&(n={wait:!1},
a=a.slice(0,-1));var l=d.cache&&d.cache["url:"+a];if(l)l.xCss&&(l=l.cssText),p(["./core/load-css"],function(a){q(a.insertCss(l))});else{if("none"==f("div",k.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return q();p(["./core/load-css"],function(b){b(a,q,n)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(p,f,k,d,b,m,q,a,n){return k("dgrid.OnDemandList",
[p,f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:a.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var b=this;q(this.bodyNode,"scroll",a[this.pagingMethod](function(a){b._processScroll(a)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,f){function g(a){n(y,
"!");if(a)throw h._refreshDeferred&&(h._refreshDeferred.reject(a),delete h._refreshDeferred),a;}var h=this,k=f&&f.container||this.contentNode,e={query:a,count:0,options:f},m,c=this.preload,p,q={node:n(k,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:e,options:f};q.node.style.height="0";e.node=m=n(k,"div.dgrid-preload");e.previous=q;m.rowIndex=this.minRowsPerPage;c?((e.next=c.next)&&m.offsetTop>=c.node.offsetTop?e.previous=c:(e.next=c,e.previous=c.previous),e.previous.next=e,e.next.previous=
e):this.preload=e;var y=n(m,"-div.dgrid-loading");n(y,"div.dgrid-below").innerHTML=this.loadingMessage;f=d.mixin(this.get("queryOptions"),f,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return p=a(f)});if("undefined"===typeof p)g();else return b.when(h.renderArray(p,m,f),function(a){return b.when("undefined"===typeof p.total?p.length:p.total,function(c){var b=a.length,d=m.parentNode,g=h.noDataNode;n(y,"!");"queryLevel"in f||(h._total=c);0===
c&&d&&(g&&(n(g,"!"),delete h.noDataNode),h.noDataNode=g=n("div.dgrid-no-data"),d.insertBefore(g,h._getFirstRowSibling(d)),g.innerHTML=h.noDataMessage);for(g=d=0;g<b;g++)d+=h._calcRowHeight(a[g]);b&&d&&(h.rowHeight=d/b);d=h.rowHeight*h.bufferRows;d>h.farOffRemoval&&(h.farOffRemoval=d);c-=b;e.count=c;m.rowIndex=b;c?m.style.height=Math.min(c*h.rowHeight,h.maxEmptySpace)+"px":(m.style.display="none",f.count++);h._previousScrollPosition&&(h.scrollTo(h._previousScrollPosition),delete h._previousScrollPosition);
h._processScroll();h._refreshDeferred&&(h._refreshDeferred.resolve(p),delete h._refreshDeferred);return a},g)},g),p},refresh:function(a){var d=this,f=a&&a.keepScrollPosition,h;"undefined"===typeof f&&(f=this.keepScrollPosition);f&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return f=this._refreshDeferred=new b,h=d.renderQuery(function(a){return d.store.query(d.query,a)}),"undefined"===typeof h&&f.reject(),f.then(function(a){d._refreshTimeout=setTimeout(function(){q.emit(d.domNode,
"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:a});d._refreshTimeout=null},0);delete d._refreshDeferred;return a},function(a){delete d._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function f(a,c,b,e){var d=
k.farOffRemoval,h=a.node;if(c>2*d){for(var l,m=h[b],p=0,q=0,t=[];l=m;){var s=k._calcRowHeight(l);if(p+s+d>c||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[b];p+=s;q+=l.count||1;k.removeRow(l,!0);t.push(l)}a.count+=q;e?(h.rowIndex-=q,g(a)):h.style.height=h.offsetHeight+p+"px";var u=n("div",t);setTimeout(function(){n(u,"!")},1)}}function g(a,c){a.node.style.height=Math.min(a.count*k.rowHeight,c?Infinity:k.maxEmptySpace)+"px"}function h(a,c){do a=c?a.next:a.previous;
while(a&&!a.node.offsetWidth);return a}var k=this,e=k.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var e=e.offsetHeight+a,m,c,p=k.preload,q=k.lastScrollTop,y=k.bufferRows*k.rowHeight,x=y-k.rowHeight,w,B,A,D=!0;for(k.lastScrollTop=a;p&&!p.node.offsetWidth;)p=p.previous;for(;p&&p!=m;){m=k.preload;k.preload=p;c=p.node;var C=c.offsetTop;if(e+1+x<C)p=h(p,D=!1);else if(a-1-x>C+c.offsetHeight)p=h(p,D=!0);else{var E=((c.rowIndex?a-y:e)-C)/k.rowHeight,C=(e-a+2*y)/k.rowHeight,F=Math.max(Math.min((a-
q)*k.rowHeight,k.maxRowsPerPage/2),k.maxRowsPerPage/-2),C=C+Math.min(Math.abs(F),10);0==c.rowIndex&&(E-=C);E=Math.max(E,0);10>E&&(0<E&&C+E<k.maxRowsPerPage)&&(C+=Math.max(0,E),E=0);C=Math.min(Math.max(C,k.minRowsPerPage),k.maxRowsPerPage,p.count);if(0==C)p=h(p,D);else{var C=Math.ceil(C),E=Math.min(Math.floor(E),p.count-C),G=d.mixin(k.get("queryOptions"),p.options);p.count-=C;var I=c,R,O=k.queryRowsOverlap;if(F=(0<c.rowIndex||c.offsetTop>a)&&p){var P=p.previous;P&&(f(P,a-(P.node.offsetTop+P.node.offsetHeight),
"nextSibling"),0<E&&P.node==c.previousSibling?(E=Math.min(p.count,E),p.previous.count+=E,g(p.previous,!0),c.rowIndex+=E,O=0):C+=E,p.count-=E);G.start=c.rowIndex-O;G.count=Math.min(C+O,k.maxRowsPerPage);c.rowIndex=G.start+G.count}else p.next&&(f(p.next,p.next.node.offsetTop-e,"previousSibling",!0),I=c.nextSibling,I==p.next.node?(p.next.count+=p.count-E,p.next.node.rowIndex=E+C,g(p.next),p.count=E,O=0):R=!0),G.start=p.count,G.count=Math.min(C+O,k.maxRowsPerPage);R&&(I&&I.offsetWidth)&&(R=I.offsetTop);
g(p);"level"in p.query&&(G.queryLevel=p.query.level);if("queryLevel"in G||!(G.start>k._total||0>G.count)){c=n(I,"-div.dgrid-loading[style\x3dheight:"+C*k.rowHeight+"px]");n(c,"div.dgrid-"+(F?"below":"above")).innerHTML=k.loadingMessage;c.count=C;var K=p.query(G);if(void 0===k._trackError(function(){return K})){n(c,"!");return}(function(a,c,e,d){A=b.when(k.renderArray(d,a,G),function(f){B=d;I=a.nextSibling;n(a,"!");if(e&&I&&I.offsetWidth){var h=k.getScrollPosition();k.scrollTo({x:h.x,y:h.y+I.offsetTop-
e,preserveMomentum:!0})}b.when(d.total||d.length,function(a){"queryLevel"in G||(k._total=a);c&&(c.count=a-c.node.rowIndex,0===c.count&&G.count++,g(c))});k._processScroll();return f},function(c){n(a,"!");throw c;})}).call(this,c,F,R,K);p=p.previous}}}}if(A&&(w=this._refreshDeferred))delete this._refreshDeferred,b.when(A,function(){w.resolve(B)})},removeRow:function(a,b){if(a){var d=a.previousSibling,f=a.nextSibling,d=d&&(null!=d.observerIndex?d.observerIndex:d.previousObserverIndex),k=f&&(null!=f.observerIndex?
f.observerIndex:f.nextObserverIndex),f=a.observerIndex;a.observerIndex=void 0;b&&(a.nextObserverIndex=k,a.previousObserverIndex=d);if(this.cleanEmptyObservers&&(-1<f&&f!==d&&f!==k)&&(d=this.observers,k=d[f])){if(!b)for(var e=k.rows,n=0;n<e.length;n++)if(e[n]!=a&&m.isDescendant(e[n],this.domNode))return this.inherited(arguments);k.cancel();this._numObservers--;d[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(p,f,k,d,b,m,q){function a(a){return a}function n(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;a.grid=this;b.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};m.before(this,"configStructure",
k.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&
(this._notifyHandle=m.after(a,"notify",k.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(a,b,d){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",b,d)},_setQuery:function(a,b){var d=b&&b.sort;this.query=void 0!==a?a:this.query;this.queryOptions=b||
this.queryOptions;this._started&&(d?this.set("sort",d):this.refresh())},setStore:function(a,b,d){p.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,b,d)},setQuery:function(a,b){p.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",a,b)},_getQueryOptions:function(){var a=k.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;
return"object"==typeof a&&null!=a?k.delegate(a,{}):a},_setSort:function(a,b){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,b){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);this.store||(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,b=this.inherited(arguments);this.store||
d.when(b,function(b){b.length&&a.noDataNode&&q(a.noDataNode,"!")});return b},insertRow:function(a,b,d,f,m){var e=this.store,n=this.dirty,e=e&&e.getIdentity(a),c;e in n&&!(e in this._updating)&&(c=n[e]);c&&(a=k.delegate(a,c));return this.inherited(arguments)},updateDirty:function(a,b,d){var f=this.dirty,k=f[a];k||(k=f[a]={});k[b]=d},setDirty:function(a,b,d){p.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,b,d)},save:function(){function a(c,e){return function(a){var l=
b._columnsWithSet,k=b._updating,m,n;if("function"===typeof a.set)a.set(e);else for(m in e)a[m]=e[m];for(m in l)n=l[m].set(a),void 0!==n&&(a[m]=n);k[c]=!0;return d.when(f.put(a),function(){delete h[c];delete k[c]})}}var b=this,f=this.store,h=this.dirty,k=new d,e=k.promise,m=function(a){var c;return b.getBeforePut||!(c=b.row(a).data)?function(){return f.get(a)}:function(){return c}},c;for(c in h)var n=a(c,h[c]),e=e.then(m(c)).then(n);k.resolve();return e},revert:function(){this.dirty={};this.refresh()},
_trackError:function(b){var f;"string"==typeof b&&(b=k.hitch(this,b));try{f=b()}catch(g){n.call(this,g)}return d.when(f,a,k.hitch(this,n))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(q(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,b){var d={element:a};!b&&(this.noDataMessage&&this.up(d).element===a&&this.down(d).element===a)&&(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},
"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(p,f,k,d,b,m,q,a,n){function l(a,b){for(var e=a.unselectable=b?"on":"",d=a.getElementsByTagName("*"),f=d.length;--f;)"INPUT"===d[f].tagName||"TEXTAREA"===d[f].tagName||(d[f].unselectable=e)}function s(a,e){var f=a.bodyNode,g=e?"text":21>b("ff")?"-moz-none":"none";h&&"msUserSelect"!==
h?f.style[h]=g:b("dom-selectstart")?!e&&!a._selectstartHandle?a._selectstartHandle=d(f,"selectstart",function(a){var c=a.target&&a.target.tagName;"INPUT"!==c&&"TEXTAREA"!==c&&a.preventDefault()}):e&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):(l(f,!e),!e&&!a._unselectableHandle?a._unselectableHandle=m.after(a,"renderRow",function(a){l(a,!0);return a}):e&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle))}b.add("dom-comparedocumentposition",
function(a,b,e){return!!e.compareDocumentPosition});b.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});b.add("css-user-select",function(a,b,e){a=e.style;b=["Khtml","O","ms","Moz","Webkit"];e=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(e--&&(d=b[e]+"UserSelect"));return!1});b.add("dom-selectstart","undefined"!==typeof document.onselectstart);var g=b("mac")?"metaKey":"ctrlKey",h=b("css-user-select"),r=(q=b("pointer"))&&
"MS"===q.slice(0,2),e=q?q+(r?"Down":"down"):"mousedown",t=q?q+(r?"Up":"up"):"mouseup";"WebkitUserSelect"===h&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(h=!1);return f("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:e+","+t+",dgrid-cellfocusin",selectionTouchEvents:b("touch")?a.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};
return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=
a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){p.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?s(this,a):s(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&!("dgrid-cellfocusin"===
a.type&&"mousedown"===a.parentType||a.type===t&&b!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===e&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){var e=a.keyCode?a.ctrlKey:a[g];this._lastSelected===b?this.select(b,null,!e||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=
b)},_multipleSelectionHandler:function(a,b){var e=this._lastSelected,d=a.keyCode?a.ctrlKey:a[g],f;a.shiftKey||(f=d?null:!0,e=null);this.select(b,e,f);e||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?!this.isSelected(b):!(a.keyCode?a.ctrlKey:a[g]))&&this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var c=this,e=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues=
{deselect:[],select:[]};b("touch")&&!b("pointer")&&this.selectionTouchEvents?(d(e,a.selector(f,this.selectionTouchEvents),function(a){c._handleSelect(a,this);c._ignoreMouseSelect=this}),d(e,d.selector(f,this.selectionEvents),function(a){c._ignoreMouseSelect!==this?c._handleSelect(a,this):a.type===t&&(c._ignoreMouseSelect=null)})):d(e,d.selector(f,this.selectionEvents),function(a){c._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){c._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",
function(a){a[g]&&(65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className))&&(a.preventDefault(),c[c.allSelected?"clearSelection":"selectAll"]())});this._setStore&&m.after(this,"_setStore",function(){c._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(c,e,d){c=e||c&&c[b.idProperty||"id"];if(null!=c&&(e=(c=b.row(c))&&b.selection[c.id]))b[d](c,null,e)}var b=this,e=this.store,d,f;this._removeDeselectSignals&&this._removeDeselectSignals();
e&&e.notify?(d=m.before(e,"notify",function(b,e){b||a(b,e,"deselect")}),f=m.after(e,"notify",function(b,e){a(b,e,"select")},!0),this._removeDeselectSignals=function(){d.remove();f.remove()}):(d=m.before(this,"removeRow",function(a,c){var b;c||(b=this.row(a))&&b.id in this.selection&&this.deselect(b)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],e=this._selectionTriggerEvent,f;f={bubbles:!0,
grid:this};e&&(f.parentType=e.type);f[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];d.emit(this.contentNode,"dgrid-"+a,f)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,e){var d,f,g;"undefined"===typeof e&&(e=!0);a.element||(a=this.row(a));if(!1===e||this.allowSelect(a))if(d=this.selection,f=!!d[a.id],null===e&&(e=!f),g=a.element,!e&&!this.allSelected?delete this.selection[a.id]:d[a.id]=
e,g&&(e?n(g,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):n(g,"!dgrid-selected!ui-state-active")),e!==f&&g&&this._selectionEventQueues[(e?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element){d=this._determineSelectionDirection(g,b);d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(g,b));for(;a.element!=b&&(a=this[d](a));)this._select(a,null,e)}}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:b("dom-comparedocumentposition")?function(a,b){var e=b.compareDocumentPosition(a);return e&1?!1:2===e?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,e){this._select(a,b,e);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var e in this.selection)a!==e&&this._select(e,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this,b=this.inherited(arguments);k.when(b,function(b){var e=a.selection,d,f,g;for(d=0;d<b.length;d++)f=a.row(b[d]),(g=f.id in e?e[f.id]:a.allSelected)&&a._select(f,null,g);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(p,f,k,d,b){function m(b){b=document.getElementsByTagName(b);for(var d=0;d<b.length;d++)a(b[d])}function q(){m("link");
m("style")}function a(b,d,f){function h(){p(["xstyle/core/load-imports"],function(c){c(b,function(){a(b,d,!0)})})}function k(a){for(var c=a.cssRules,b=0;b<c.length;b++){var e=c[b];if(e.selectorText&&"x-"==e.selectorText.substring(0,2)&&(m=!0,/^'/.test(e.style.content)))return n(eval(e.style.content),a,d),!0}}var e=b.sheet||b.styleSheet;if(e&&(!e.processed||f)){e.processed=!0;var m=e.needsParsing,c=e.rules||e.cssRules;if((e.href||e.imports&&e.imports.length)&&!f)return h();if(!m)for(var q=0;q<c.length;q++){var v=
c[q];if(v.href&&!f){if(!k(v.styleSheet))return h();return}}n(e.localSource||(e.ownerNode||e.owningElement).innerHTML,e,d)}}function n(a,b,d){b.addRule||(b.addRule=function(a,b,d){return this.insertRule(a+"{"+b+"}",0<=d?d:this.cssRules.length)});b.deleteRule||(b.deleteRule=b.removeRule);var h=1;(b.href||location.href).replace(/[^\/]+$/,"");k.css=a;f(k,a,b);0==--h&&d&&d(b);return k}d.ready(q);f.getStyleSheet=function(a,b){return a.styleSheet||a};return{process:a,processAll:q,parse:n,generate:b,update:d.update,
load:function(b,d,f,h){d(["xstyle/css"],function(k){k.load(b,d,function(b){b?a({sheet:b},f):(q(),f())},h)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function p(){this.push.apply(this,arguments)}function f(a){this.value=a}function k(){var a,b=this.args[0];if("string"==typeof b)a=b.split(/\s*,\s*/);else if(b){a=[];for(var d=0,e=0;e<b.length+1;e++){var f=b[e];if("string"==typeof f||void 0===f)if(f=f&&f.split(/\s*,\s*/),1<a.length||void 0===f){var c=b.slice(d,e);
0<d&&c.unshift(a.pop());d=e+1;a.push(c);f&&a.push.apply(a,f.slice(1))}}}else return[];return a}function d(g,h,r){function e(h,r){function x(a){D=!1;var b=c.lastIndex;a.then(function(){D=!0;e&&(c.lastIndex=b,w())});var e=!0}function w(){function g(a){a&&("string"==typeof a&&P)&&(a=P+a);H?H.push?"string"==typeof H[H.length-1]&&"string"==typeof a?H[H.length-1]+=a:a&&H.push(a):"string"==typeof H&&"string"==typeof a?H+=a:H=new p(H,a):H=a}for(D=!0;D;){var q=c.exec(h);if(!q)break;var w=q[5],P=q[1],K=q[2],
J=q[3],L=q[4],Q,M,H,N,L=L&&l(L),K=K&&l(K);G?(J?(M=K,Q=J.charAt(0),N="?"==J.charAt(1),-1<J.indexOf("\n")&&(L=J.slice(1))):L=K,H=L,G=!1):(L=J?K+J:K,g(L));"{"!=w&&(F+=q[0]);switch(w){case "'":case '"':var U="'"==w?b:m;U.lastIndex=c.lastIndex;(w=U.exec(h))||B("unterminated string");K=w[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,c){if(c)return String.fromCharCode(parseInt(c,16))});c.lastIndex=U.lastIndex;g(new f(K));F+=w[0];continue;case "\\":w=U.lastIndex++;g(h.charAt(w));continue;case "(":case "{":case "[":if("{"==
w){G=!0;":"==Q&&J&&(K+=J);F=l((F+K).replace(/\s+/g," "));g(J=A.newRule(F));"\x3d"==Q&&(E=!1,H.creating=!0);var z=null,aa=C;if(q[6]&&(L=r.cssRules||r.rules,J.cssRule=z=L[q[6].slice(1)]))F=z.selectorText;if(A.root&&E)for(L=r.cssRules||r.rules;z=L[C++];)if(z.selectorText==F||z.selectorText&&z.selectorText.replace(/::/g,":").replace(/'/g,'"')==F.replace(/::/g,":").replace(/'/g,'"')){J.cssRule=z;break}z||(J.ruleIndex=C=aa);J.styleSheet=r;H.creating?(J.selector="."+("\x3d"==Q?K.match(/[\w-]*$/g,"")[0]:
"")+"-x-"+n++,J.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(F)?J.setMediaSelector(F):J.selector=A.root?F:A.selector+" "+F;F=""}else K=L.match(/(.*?)([\w-]*)$/),g(J=A.newCall(K[2],H,A)),J.ref=A.getDefinition(K[2]),J.getArgs=k,(H.calls||(H.calls=[])).push(J);A.currentName=M;A.currentSequence=H;A.assignmentOperator=Q;var W;if("{"==w&&(W=J.selector.match(/[@:]\w+/)))W=W[0],(M=A.getDefinition(W))&&M.selector&&M.selector(J);s.push(A=J);A.operator=w;A.start=c.lastIndex;H=M=null;continue}if(H)if(K="string"==
typeof H?H:H[0],K.charAt&&"@"==K.charAt(0))if(q=K.match(/\w+/)[0],"import"==q)K=d.getStyleSheet((r.cssRules||r.imports)[C++],H,r),q=c.lastIndex,e(K.localSource,K),c.lastIndex=q;else{if("xstyle"==q){if("start"==K.slice(8,13))J=A?A.newRule(""):Y,J.root=A.root,s.push(A=J);else{var Y=A||Y;s.pop();A=s[s.length-1]}c=A?t:/(@[\w\s])/g}}else if("\x3d"===Q)try{var T=A.declareDefinition(M,H,N);T&&T.then&&x(T)}catch(ba){B(ba)}switch(w){case ":":"\x3d"==Q?(G=!0,Q=":"):g(":");break;case "}":if(M&&!A.root&&!A.isMediaBlock)try{A[":"==
Q?"setValue":"declareDefinition"](M,H,N)}catch(ca){B(ca)}case ")":case "]":a[A.operator]!=w&&B("Incorrect opening operator "+A.operator+" with closing operator "+w);M=null;M=h.slice(A.start,c.lastIndex-1);A.cssText=A.cssText?A.cssText+";"+M:M;if("}"==w){"}"==V&&(V=A.parent.selector)&&"@"==!V.charAt(0)&&B("A nested rule must end with a semicolon");if(A.root)B("Unmatched "+w);else{try{A.onRule(A.selector,A)}catch(da){B(da)}E=!0}F=""}if(")"==w||"]"==w)A.args=[H];if(")"==w&&!Q){try{T=s[s.length-2].onArguments(A)}catch(ea){B(ea)}T&&
T.then&&x(T)}s.pop();A=s[s.length-1];H=A.currentSequence;M=A.currentName;Q=A.assignmentOperator;if(A.root&&"}"==w){if(Q)try{A[":"==Q?"setValue":"declareDefinition"](M,H,N)}catch(fa){B(fa)}G=!0;Q=!1}break;case "":case void 0:return;case ";":if(A&&M){try{(T=A[":"==Q?"setValue":"declareDefinition"](M,H,N))&&T.then&&x(T)}catch($){B($)}M}H=null;G=!0;Q=E=!1;F=""}var V=w}}function B(a){var b=h.slice(0,c.lastIndex).split("\n"),d=b[b.length-1],b=(r.href||"in-page stylesheet")+":"+b.length+":"+d.length+" near:\n"+
d.slice(-40);if(e.onerror)e.onerror(a,b);console.error(a.message||a,b);a.stack&&console.error(a.stack)}h=h.replace(q,function(a){return a.replace(/[^\n]/g,"")});var A=g;c.lastIndex=0;var D,C=0,E=!0,F="",G=!0;w()}r=r||{addRule:function(){},cssRules:[]};var t,c=t=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,s=[g];g.parse=e;e(h,r)}var b=/((?:\\.|[^'])*)'/g,m=/((?:\\.|[^"])*)"/g,q=/\/\*[\w\W]*?\*\//g,
a={"{":"}","[":"]","(":")"},n=0,l="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},s=p.prototype=[];s.toString=function(){return this.join("")};s.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return d})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),
function(p,f,k,d,b,m,q){function a(b,e,d){function f(a){return{selectElement:function(e){d.newElement&&(e=e.parentNode);if(a&&a.selector)for(;!c(e,a);)if(e=e.parentNode,!e)throw Error("Rule not found");if(d.inherit)for(;!(b in e);)if(e=e.parentNode,!e)throw Error(b?b+" not found":"Property was never defined");return e},forElement:function(c){var e=c;c=this.selectElement(c);d.newElement&&(c["_"+b+"Node"]=e);c=d.get?d.get(c,b):c[b];return void 0===c&&a?g(b).valueOf().forRule(a):c},forRule:d.inherit&&
function(a){return f(a)}}}var h=new k(function(){return f(e)});h.define=function(c,e){return a(b||e,c,d)};h.keepCSSValue=!0;h.put=d.inherit?function(a,c){return g(b).put(a,c,b)}:function(a){return{forElement:function(f){if(e&&e.selector)for(;!c(f,e);)if(f=f.parentNode,!f)throw Error("Rule not found");d.set?d.set(f,b,a):f[b]=a;h.invalidate({elements:[f]})}}};return h}function n(a,c,b,e){return d.when(f.evaluate(a,b),function(c){c.forElement?p.addRenderer(a,function(a){e(c.forElement(a),a)}):e(c)})}
function l(a,c){return{apply:function(b,e,d){n(b,d,e[0],function(e,f){e.observe(function(e){e=e?a:c;value.toString().replace(RegExp(a+"\\([^)]+\\)","g"),e);f?f.style[d]=e:b.setStyle(d,e)})})}}}function s(a,c){var b=a.variables;if(b&&c in b)return b[c];if(b=a.bases)for(var e=0;e<b.length;e++){var d=s(b[e],c);if(void 0!==d)return d}}function g(a){var c=u[a];c||(c=u[a]=new k(function(){return{forRule:function(c){a:{do{var b=s(c,a);if(void 0!==b){c=b;break a}c=c.parent}while(c);c=void 0}return c}}}),
c.put=function(a,b,e){return{forRule:function(b){function d(a){f.push(a);for(var c in a.rules)d(a.rules[c])}(b.variables||(b.variables={}))[e]=a;for(var f=[];b;)d(b),b=b.parent;c.invalidate({rules:f})}}});return c}var h=b("div"),r=navigator.userAgent,e=-1<r.indexOf("WebKit")?"-webkit-":-1<r.indexOf("Firefox")?"-moz-":-1<r.indexOf("MSIE")?"-ms-":-1<r.indexOf("Opera")?"-o-":"",t;m=new m;var c=p.matchesRule;m.root=!0;var u={};m.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,
c){a[0].value&&(a=a[0].value);c||require([a]);return{then:function(c){return(new q.Promise(function(c){require([a],function(a){c(a)})})).then(c)}}}),item:a("item",null,{inherit:!0}),pageContent:new k,content:a("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:a(null,null,{}),elementClass:a(null,null,{get:function(a,c){return-1<(" "+a.className+" ").indexOf(" "+c+" ")},set:function(a,c,b){this.get(a,c)!=b&&(a.className=b?a.className+(" "+c):(" "+a.className+" ").replace(" "+
c+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!c(b,a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(t)},valueOf:function(){return t}},each:{put:function(a){return{forRule:function(c){c.each=a}}}},prefix:{put:function(a,c,b){return{forRule:function(c){if("string"==typeof h.style[e+b])return c._setStyleFromValue(e+b,a),!0}}}},"var":{define:function(a,c){return g(c)},
selfResolving:!0,apply:function(a,c){return g(d.convertCssNameToJs(c[0]))}},inline:l("inline","none"),block:l("block","none"),visible:l("visible","hidden"),"extends":{apply:function(a,c){for(;0<c.length;)return d.extend(a,c[0],console.error)}},set:{selfExecuting:!0,apply:function(a,c){return c[0].put(c[1].valueOf())}},get:{apply:function(a,c){return c[0]},put:function(a,c){f.evaluate(c,a)}},toggle:{selfExecuting:!0,apply:function(a,c){return c[0].put(!c[0].valueOf())}},on:{put:function(a,c,b){return{forRule:function(c){p.on(document,
b.charAt(2).toLowerCase()+b.slice(3),c,function(e){t=e;try{d.when(f.evaluate(c,a).valueOf(),function(a){a&&a.forRule&&(a=a.forRule(c));a&&a.forElement&&a.forElement(e.target);t=null},function(c){console.error("Error in "+b+" event handler, executing "+a,c)})}catch(g){console.error("Error in "+b+" event handler, executing "+a,g)}})}}}},title:{put:function(a){return{forRule:function(c){f.observe(f.evaluate(c,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function c(a){var e;
if(e=a.match(/^\s*not(.*)/))return!c(e[1]);if(e=a.match(/\((.*)\)/))return c(e[1]);if(e=a.match(/([^:]*):(.*)/))return a=d.convertCssNameToJs(e[1]),e=h.style[a]=e[2],h.style[a]==e;if(e=a.match(/\w+\[(.*)=(.*)\]/))return b(e[0])[e[1]]==e[2];if(e=a.match(/\w+/))return d.isTagSupported(e);throw Error("can't parse @supports string");}c(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};m.elementProperty=a;return m})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",
["put-selector/put","xstyle/core/utils"],function(p,f){function k(a,c,b,e){function f(a){if(!b)return e(a);var c=a.target;do if(w(c,b))return e(a);while((c=c.parentNode)&&1===c.nodeType)}g?a.addEventListener(c,f,!!h[c]):d(a,h[c]||c,f)}function d(a,c,b){c="on"+c;var e=a[c];a[c]=function(a){a=a||window.event;a.target=a.target||a.srcElement;e&&e(a);b(a)}}function b(a){/e/.test(l.readyState||"")?a():l.addEventListener("DOMContentLoaded",a)}function m(a){for(var c=l.querySelectorAll(a.selector),b=a.name,
e=0,d=c.length;e<d;e++){var f=c[e],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities={});var h=f.renderings;h||(h=f.renderings=[],v.push(f));h.push({name:b,rendered:g[b]==a.propertyValue,renderer:a});g[b]=a.propertyValue}}function q(){for(;v.length;){for(var a=v.shift(),c=a.renderings,b=a.elementalStyle;c.length;){var e=c.shift(),d=e.renderer,f=d.rendered;x=b[e.name]==d.propertyValue;if(!f&&x)try{d.render(a)}catch(g){console.error(g,g.stack),p(a,"div.error",g.toString())}f&&(!x&&
d.unrender)&&d.unrender(a)}a.renderings=void 0}}function a(a,b){for(var e=0,d=c.length;e<d;e++){var f=c[e];(!b||b==f.selector)&&w(a,f.rule)&&f.render(a)}}function n(a,b){var e={selector:a.selector,rule:a,render:b};c.push(e);y&&m(e);q();return{remove:function(){c.splice(c.indexOf(e),1)}}}var l=document,s=1,g=!!l.addEventListener,h={blur:"focusout",focus:"focusin"};k(l,"change",null,function(a){a=a.target;for(var c=0,b=u.length;c<b;c++){var e=u[c];if(-1<(" "+a.className+" ").indexOf(e.rule.selector.slice(1))){var d=
e.definition.valueOf();d&&d.forRule&&(d=d.forRule(e.rule));d&&d.forElement&&(d=d.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof d&&isFinite(f)&&(f=+f);(d=e.definition.put(f))&&d.forRule&&(d=d.forRule(e.rule));d&&d.forElement&&d.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&k(l,"keydown",null,function(a){if(13==a.keyCode){var c=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),c.dispatchEvent(a);else document.onchange({target:c})}});
var r=l.createElement("div"),e={"dom-qsa2.1":!!r.querySelectorAll},t=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector,c=[],u=[],v=[],y;b(function(){if(!y)if(y=!0,e["dom-qsa2.1"]){for(var b=0,d=c.length;b<d;b++)m(c[b]);q()}else for(var f=l.all,b=0,d=f.length;b<d;b++)a(f[b])});var x,w=t?function(a,c){return t.call(a,c.selector)}:function(a,c){c.ieId||c.setStyle(c.ieId="x-ie-"+s++,"true");return!!a.currentStyle[c.ieId]};return{ready:b,
on:k,matchesRule:w,addRenderer:n,addInputConnector:function(a,c){u.push({rule:a,definition:c})},update:a,clearRenderers:function(){c=[]},observeForElement:function(a,c,b){return f.when(a,function(a){function e(a){a.observe?a.observe(b):b(a)}a.forElement?n(c,function(c){e(a.forElement(c))}):e(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function p(b,d){for(var f=0,a=b.length;f<a;f++){var k=b[f];if(k&&"object"==typeof k&&d in k)return!0}}function f(b,d){return d.toUpperCase()}
var k="div"==document.createElement("div").tagName,d={};return{when:function(b,d,f){return b&&b.then?b.then(d,f)||b:d(b)},whenAll:function(b,d){return p(b,"then")?{then:function(f,a){function k(){l--;l||f(d(p))}for(var l=1,p=[],g=0;g<b.length;g++){var h=b[g];l++;h&&h.then?function(b){h.then(function(a){p[b]=a;k()},a)}(g):(p[g]=h,k())}k()},inputs:b}:d(b)},convertCssNameToJs:function(b){return b.replace(/-(\w)/g,f)},isTagSupported:function(b){if(b in d)return d[b];var f=document.createElement(b);k?
(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==b.toUpperCase();return d[b]=f},extend:function(b,d){var f=d.split(".");d=f[0];var a=b.getDefinition(d,"rules");f[0]="";b.selector+=b.extraSelector=f.join(".");if(a)return this.when(a,function(a){if(a.extend)a.extend(b,!0);else for(var d in a)b[d]=a[d]});b.tagName=d;if(!this.isTagSupported(d))throw Error("Extending undefined definition "+d);},someHasProperty:p}})},"xstyle/core/expression":function(){define("xstyle/core/expression",
["xstyle/core/utils","xstyle/core/Definition"],function(p,f){function k(a,b){var d=b[0];return d&&a?(d=n(d),k(a.property?a.property(d):a[d],b.slice(1))):a}function d(a,b,d){if(l(b,a)){var c={};c[a]=function(c){for(var f=[],g=0,h=b.length;g<h;g++){var k=b[g];k&&"function"==typeof k[a]&&(k=k[a](c));f[g]=k}return d(f)};return c}return d(b)}function b(a,b){return{apply:function(f,c,g){for(var h=0,k=c.length;h<k;h++){var l=c[h];l.dependencyOf&&l.dependencyOf(g)}h=function(){var b=[];if(a.selfExecuting)return a.apply(f,
c,g);for(var e=0,h=c.length;e<h;e++)b[e]=c[e].valueOf();if(a.selfWaiting)return a.apply(f,b,g);b.push(f);return p.whenAll(b,function(c){var b=c.pop();return d("forRule",c,function(c){return d("forElement",c,function(c){return a.apply(b,c,g)})})})};h.reverse=function(a){return b(a,c)};return h}}}function m(a){return g[a]||(g[a]=new Function("a","b","return "+a))}function q(a,e,d,c,f){function g(a){a.skipResolve=!0;a.precedence=e;a.infix=!1!==f}var k=function(a,b){var e=b[0],d=b[1];if(e&&e.put)d=c(a,
d&&d.valueOf()),d!==s&&e.put(d);else if(d&&d.put)d.put(f(a,e&&e.valueOf()));else throw new TypeError("Can not put");},l={apply:function(e,l,n){var p;d=m(d);c=c&&m(c);f=f&&m(f);h[a]=p=b(d,k);g(p);return p.apply(e,l,n)}};g(l);h[a]=l}function a(d,e){function g(a){for(;n<=a.precedence;){var c=q.pop(),b=h[q.pop()],e=new f;e.setCompute(b.apply(null,b.infix?[q.pop(),c]:[c],e));s=q.length?q[q.length-1]:void 0;q.push(e);n=s&&h[s]&&h[s].precedence}}var c,l;e=e.join?e.slice():[e];for(c=0;c<e.length;c++)if(l=
e[c],"string"==typeof l){var m=l.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);l=[c,1];m&&l.push.apply(l,m);e.splice.apply(e,l);c+=l.length-3}var n,q=[],s,m={};for(c=0;c<e.length;c++){l=e[c];if("("==l.operator){var B=q[q.length-1];void 0===B||h.hasOwnProperty(B)?l=a(d,l.getArgs()[0]):(q.pop(),l=function(c,e){function g(f){return p.when(c.valueOf(),function(g){var m=c.parent&&c.parent.valueOf();if(!g.selfResolving){if(!h){h=[];for(var n=0,p=e.length;n<p;n++)h[n]=a(d,e[n]);k=g.selfReacting?
g.apply(m,h,l):b(g).apply(m,h,l)}return k()}g=g.apply(m,e,l);return f?g:g.valueOf()})}var h,k,l=new f(g);l.setReverseCompute(function(){var a=arguments;return p.when(g(!0),function(c){return c.put.apply(c,a)})});return l}(B,l.getArgs()))}else if(h.hasOwnProperty(l))B=h[l],g(B),n=(s||B).precedence;else if(-1<l)l=+l;else if(l.isLiteralString)l=l.value;else{l=l.split(/\s*\/\s*/);var B=l[0],A=d.getDefinition(B);if("string"==typeof A||A instanceof Array)A=a(d,A);else if(void 0===A)throw Error('Could not find reference "'+
B+'"');m[B]=A;1<l.length&&(A=k(A,l.slice(1)));l=A}q.push(l)}g({precedence:100});if(1<q.length)throw Error("Could not reduce expression");l=q[0];l.inputs=m;return l}var n=p.convertCssNameToJs,l=p.someHasProperty,s={},g={},h={};q("+",6,"a+b","a-b","a-b");q("-",6,"a-b","a+b","b-a");q("*",5,"a*b","a/b","a/b");q("/",5,"a/b","a*b","b/a");q("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");q(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");q("!",4,"!a","!a",!1);q("%",5,"a%b");q("\x3e",
8,"a\x3eb");q("\x3e\x3d",8,"a\x3e\x3db");q("\x3c",8,"a\x3cb");q("\x3c\x3d",8,"a\x3c\x3db");q("\x3d\x3d",9,"a\x3d\x3d\x3db");q("\x26",8,"a\x26\x26b");q("|",8,"a||b");return{react:b,evaluate:a,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(p,f){function k(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse)}function d(a,d,k){if(d&&d.forElement)return{forElement:function(m){m=d.selectElement?
d.selectElement(m):m;var g=["_cache_"+a.id];if(g in m){var h=m[g+"observe"];h.addKey&&h.addKey(k);return m[g][k]}var p=m[g]=d.forElement(m),e=m[g+"observe"]=b(a,p,k,{elements:[m]});m.xcleanup=function(a){a&&f.unobserve(p,e)};return p[k]}}}function b(a,b,d,k){var g=a._properties,h;"object"==typeof b&&(h=function(a){for(var b=0;b<a.length;b++){var d=g[a[b].name];d&&d.invalidate&&d.invalidate(k)}},f.observe(b,h),h.addKey&&h.addKey(d));return h}var m={},q=1;k.prototype={id:"x-variable-"+q++,cache:m,valueOf:function(){if((this.dependents||
this._properties)&&this.cache!==m)return this.cache;var a=this,b=this.computeValue;if(b.then)return this.cache=b.then(function(b){a.computeValue=b;(b=a.cache=b())&&b.then&&b.then(function(b){a.cache=b});return b});(b=a.cache=b())&&b.then&&b.then(function(b){a.cache=b});return b},property:function(a){var f=this._properties||(this._properties={}),l=f[a];if(!l){var m=this,l=f[a]=new k(function(){return p.when(m.valueOf(),function(f){if(f&&f.forRule)return{forRule:function(h){h=f.selectRule?f.selectRule(h):
h;var e=["_cache_"+m.id],k;if((k=e in h?h[e]:h[e]=f.forRule(h))&&k.forElement)return d(m,k,a);var c=h[e+"observe"];c&&(c.addKey?c.addKey(a):h[e+"observe"]=b(m,k,a,{rules:[h]}));return k[a]}};if(f&&f.forElement)return d(m,f,a);var h=m.cacheObserve;h?h.addKey&&h.addKey(a):h=m.cacheObserve=b(m,f,a);return f[a]})});l.key=a;l.parent=this;l.put=function(b){return p.when(m.valueOf(),function(d){function f(e){if(e.forElement)return{forElement:function(d){e.forElement(d)[a]=b}};e[a]=b}if(d.forRule)return{forRule:function(a){return f(d.forRule(a))}};
f(d)})};l.id=this.id+"-"+a}return l},invalidate:function(a){var b=this.cacheObserve;b&&(f.unobserve(this.cache,b),this.cacheObserve=null);this.cache=m;var d,b=this._properties;for(d in b)b[d].invalidate(a);var k=this.dependents||0;d=0;for(b=k.length;d<b;d++)try{k[d].invalidate(a)}catch(g){console.error(g,"invalidating a definition")}},dependencyOf:function(a){(this.dependents||(this.dependents=[])).push(a)},notDependencyOf:function(a){for(var b=this.dependents||0,d=0;d<b.length;d++)b[d]===a&&b.splice(d--,
1)},setReverseCompute:function(a){this.put=function(){var b=a.apply(this,arguments);this.invalidate();return b}},setCompute:function(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse);this.invalidate()},setSource:function(a){this.computeValue=function(){return a};this.invalidate()},observe:function(a){this.computeValue&&a(this.valueOf());var b=this;return this.dependencyOf({invalidate:function(){a(b.valueOf())}})},newElement:function(){return p.when(this.valueOf(),function(a){return a&&
a.newElement&&a.newElement()})}};return k})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function p(a,b,d){q?-1===q.indexOf(a)&&q.push(a):(q=[a],setTimeout(function(){q.forEach(function(a){var b=[];a.properties.forEach(function(e){b.push({target:a.object,name:e})});a(b);a.object=null;a.properties=null});q=null},0));a.object=b;a=a.properties||(a.properties=[]);-1===a.indexOf(d)&&a.push(d)}function f(){return f}var k=Object.observe,d;if(d=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});d=!0;break a}catch(b){}d=void 0}var m={observe:k,defineProperty:d,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},k=m.observe?Object.observe:m.defineProperty?function(a,b){b.addKey=function(d){var c="key"+d;if(!this[c]){this[c]=!0;var f=a[d];if((c=Object.getOwnPropertyDescriptor(a,d))&&c.set){var g=c.set,h=c.get;Object.defineProperty(a,d,{get:function(){return f=h.call(this)},set:function(a){g.call(this,a);f!==a&&(f=a,b&&p(b,this,d))}})}else Object.defineProperty(a,
d,{get:function(){return f},set:function(a){f!==a&&(f=a,b&&p(b,this,d))}})}};b.remove=function(){b=null}}:function(b,e){s||(s=!0,setInterval(function(){for(var c=0,b=a.length;c<b;c++){var e=n[c],d=a[c],f=l[c],g=void 0,h=void 0;for(h in e)e.hasOwnProperty(h)&&e[h]!==d[h]&&(e[h]=d[h],(g||(g=[])).push({name:h}));for(h in d)d.hasOwnProperty(h)&&!e.hasOwnProperty(h)&&(e[h]=d[h],(g||(g=[])).push({name:h}));g&&f(g)}},20));var d={},c;for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);a.push(b);n.push(d);l.push(e)},
q;d=m.observe?Object.unobserve:function(b,e){e.remove&&e.remove();for(var d=0,c=a.length;d<c;d++)if(a[d]===b&&l[d]===e){a.splice(d,1);n.splice(d,1);l.splice(d,1);break}};var a=[],n=[],l=[],s=!1,g=1,h=function(){};h.prototype.toJSON=f;return{Promise:m.promise?Promise:function(){function a(b){function d(a){a&&a.then?a.then(d,c):(h=a,f())}function c(a){k=a;f()}function f(){g=!0;for(var a=0,c=l.length;a<c;a++)l[a]();l=0}var g,h,k,l=0;b(d,c);return{then:function(c,b){return new a(function(a,e){function d(){try{k&&
!b?e(k):a(k?b(k):c?c(h):h)}catch(f){e(f)}}g?d():(l||(l=[])).push(d)})}}}return a}(),WeakMap:m.WeakMap?WeakMap:function(a,b){var d="__"+(b||"")+g++;return m.defineProperty?{get:function(a){return a[d]},set:function(a,b){Object.defineProperty(a,d,{value:b,enumerable:!1})}}:{get:function(a){return(a=a[d])&&a.value},set:function(a,b){(a[d]||(a[d]=new h)).value=b}}},observe:k,unobserve:d,copy:function(a,b){for(var d in b)a[d]=b[d];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(p,f,k,d,b){function m(a,b,d){try{a[b]=d}catch(e){}}function q(){}function a(a,b,d,e){if(a.calls){var h;for(d=0;d<a.length;d++){var k=a[d];if(k instanceof n){a.hasOwnProperty(d)||(a[d]=k=g(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(b,k.getArgs(),b):p.evaluate(b,[k.caller,k]));void 0!==l&&((h||(h=[])).push(l),k.evaluated=!0)}}}if(h)return b=p.react(function(){for(var b=0,d=a.slice(),e=0;e<a.length;e++){var f=
a[e];f instanceof n&&f.evaluated&&(d[e-1]=a[e-1].slice(0,-f.caller.length),d[e]=arguments[b++])}return d.join("")}),b.skipResolve=!0,e=new f,e.setCompute(b.apply(e,h,e)),e;if(!e)return a.toString()}function n(a){this.caller=a;this.args=[]}function l(a,d,e,f){return b.when(d,function(b){var d=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var c=d.forRule(a,!0);c&&c.forElement?s(a,c,f):e&&e(c)}),b=b.forRule(a));if(b&&b.forElement)return s(a,b,f);e&&e(b)})}function s(a,
b,d){return require(["xstyle/core/elemental"],function(e){e.addRenderer(a,function(a){var c=b.forElement(a);d&&d(c,a)})})}var g=Object.create||function(a){function b(){}b.prototype=a;return new b},h=b.convertCssNameToJs,r={"{":"}","[":"]","(":")"},e=k("div").style;q.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,d=0;d<b.length;d++){var e=b[d];a.call(this,e||"unnamed",
b[e])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new q;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new n(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var d=this.styleSheet,e=d.cssRules||d.rules,f=-1<this.ruleIndex?this.ruleIndex:e.length;try{d.addRule(a,b||" ",f)}catch(g){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return e[f]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var d=this.installStyles[b];m(a.style,d[0],d[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?m(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(d){d.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,d,f){a=a&&h(a);if(!this.disabled){var g=this;if(d.length)if("\x3e"==d[0].toString().charAt(0))a||(this.generator=d,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,c){d=a.forSelector(d,g);c.addRenderer(g,d)}));else{var k=a in e||this.getDefinition(a);if(!f||!k){f=this.definitions||(this.definitions={});var l=d[0];if(l.indexOf&&-1<l.indexOf(","))for(var l=
d.join("").split(/\s*,\s*/),m=[],n=0;n<l.length;n++)m[n]=p.evaluate(this,l[n]);d[0]&&"{"==d[0].operator?m=d[0]:d[1]&&"{"==d[1].operator&&(m=d[1],b.extend(m,d[0]));m=m||p.evaluate(this,d);if(m.then)var q=m,m={then:function(a){return q.then(function(c){return a(r(c))})}};var r=function(b){b.define&&(b=b.define(g,a));return b};k&&console.warn('Overriding existing property "'+a+'"');return f[a]=r(m)}}else return f=this.definitions||(this.definitions={}),f[a]=d}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,b,d){var f=h(a);if(!this.disabled){var g=this.values||(this.values=[]);g.push(a);g[a]=b;if(a){do{g=(d||this).getDefinition(a);if(void 0!==g){if(this.cssRule&&(!g||!g.keepCSSValue)){var k=this.cssRule.style;f in k&&m(k,f,"")}l(this,g.put(b,this,f))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}f in e&&this._setStyleFromValue(f,b,!0)}},_setStyleFromValue:function(c,d,e){var f=d[0];if(f instanceof q){e=f.values;for(f=0;f<e.length;f++){var g=e[f];this._setStyleFromValue(c+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),e[g])}}else{if(d.calls){var h=this;if(d.expression=a(d,this,c,!0)){var k=d.expression&&d.expression.valueOf(),l=function(a,b){var d=k&&k.forRule?k.forRule(a,!0):k;if(d&&d.forElement){var e=b&&b.elements;if(e)for(var f=0;f<e.length;f++)for(var g=e[f].querySelectorAll(a.selector),h=0;h<g.length;h++){var l=g[h];m(l.style,c,d.forElement(l))}else s(a,d,function(a,b){m(b.style,c,a)})}else a.setStyle(c,d)},n=[h];b.when(k,function(a){if((k=a)&&k.forRule)(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){n.push(a);l(a)});l(h)});d.expression.dependencyOf({invalidate:function(a){b.when(d.expression.valueOf(),function(c){k=c;for(c=0;c<n.length;c++){var b=!0,d=n[c];if(a&&a.rules)for(var b=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){b=!0;break}b&&l(d,a)}})}})}}e||this.setStyle(c,d)}},put:function(a){var b=this;return{forRule:function(d){b.extend(d);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var e=a.toString().split(/,\s*/),f=0;f<e.length;f++){var g=
b.values[f];g&&d.setValue(g,e[f],b)}}}},extend:function(a,b){(this.derivatives||(this.derivatives=[])).push(a);var f=this.extraSelector;f&&(a.selector+=f);for(var k=this.cssRule.style,l=a.getCssRule().style,m=a.inheritedStyles||(a.inheritedStyles={}),f=0;f<k.length;f++){var n=h(k[f]);if(!l[n]||m[n])l[n]=k[n],m[n]=!0}if(f=this.values){var f=g(f),p=a.values;a.values=p?d.copy(f,p):f}if(b){if(f=this.definitions){var f=g(f),q=a.definitions;a.definitions=q?d.copy(f,q):f}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);n=this._subRuleListeners||0;for(f=0;f<n.length;f++)n[f](a);var r=a.getCssRule().style;this.eachProperty(function(b,d){var f=h(b);"object"==typeof d&&(d=g(d));f in e&&!r[f]&&a._setStyleFromValue(f,d)});if(p&&a.definitions){f=0;for(k=p.length;f<k;f++)n=p[f],l=h(n),a.definitions[l]!==(q&&q[l])&&a.setValue(n,p[l])}if(p=this.generator){if(p instanceof Array){p=p.slice(0);for(f=0;f<p.length;f++)q=p[f],"{"===q.operator&&(n=a.newRule(),n.selector=q.selector+a.selector.slice(1),n.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,q.extend(n,!0),p[f]=n)}a.declareDefinition(null,p)}},getDefinition:function(a,b){a=h(a);var d=this;do{var e=d.definitions&&d.definitions[a];void 0===e&&(b&&d[b])&&(e=d[b][a]);d=d.parent}while(void 0===e&&d);return e},newElement:function(){return k((this.tagName||"span")+(this.selector||""))},cssText:""};p.evaluateText=a;var t=n.prototype=new q;t.declareDefinition=t.setValue=function(a,b){this.args.push(b)};t.toString=function(){var a=this.operator;return a+
this.args+r[a]};q.updateStaleProperties=function(){};return q})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(p,f,k,d,b){function m(a,b){a=a.sort?a:[a];return function(d,g,h){var m=d,r;"content"in d||(d.content=void 0);if(void 0===h){var t=(d._contentNode||d).childNodes||0,s=t[0];if(s){var C=e.createDocumentFragment();do C.appendChild(s);while(s=t[0]);d.content=
C}if(d._contentNode){d._contentNode=void 0;try{d.innerHTML=""}catch(E){}}}for(var F=0,G=[d],I=[],t=0,s=a.length;t<s;t++){var R=O,O=a[t];try{if(O.eachProperty){if(O.args)if("("==O.operator){var P=a[t+1];q(O,P,m,function(a,c,d){l(a,c,d,b)})}else{var K=O.args[0];if("string"===typeof K){var J=K.split("\x3d");try{m.setAttribute(J[0],J[1])}catch(L){console.error(L)}}else{var Q=K[0].replace(/=$/,""),M=K[1];"("==M.operator?q(K[1],Q,m,function(a,c,d){n(a,c,d,b)}):m.setAttribute(Q,M.value)}}}else if("string"==
typeof O){"\x3d"==O.charAt(0)&&(O=O.slice(1));var H=m,P=a[t+1],J=[];O.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){J.push(arguments)});for(var N=0;N<J.length;N++)(function(a,c,e,l,n,p,q){function t(){var a=H._contentNode;a&&(a.innerHTML="",H=a)}c?(a=e?e.length:0,a>F?(t(),G[a]=H):H=G[a]||H,F=a):t();var s;if(l)s=(R&&R.args?"":"span")+l+n;else{l=n.match(/^[-\w]+/);if(!l)throw new SyntaxError("Unable to parse selector",n);l=l[0];var A;N===J.length-
1&&P&&P.selector?(P.bases||k.extend(P,l),A=P):A=b.getDefinition(l);A&&(A.then||A.newElement)?H=function(a,c,b,d){var e,g;k.when(A&&A.newElement&&A.newElement(),function(a){(e=a)?(b=b.slice(d.length))&&f(e,b):e=f(b);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var c;for(e=e._contentNode||e;c=a[0];)e.appendChild(c)}});if(e)return a.insertBefore(e,c||null);g=f("span");return a.insertBefore(g,c||null)}(H,h,n,l):s=n}s&&(H=f(h||H,(h?"-":"")+s));h=null;p&&H.setAttribute(p,""===q?p:q);g&&(H.item=g);
r=r||H;(N<J.length-1||H!=m&&H!=d)&&I.push(N==J.length-1&&P&&P.selector,H);m=H}).apply(this,J[N])}else m.appendChild(e.createTextNode(O.value))}catch(U){console.error(U,U.stack),m.innerHTML&&(m.innerHTML=""),m.appendChild(e.createTextNode(U))}}for(;O=I.pop();)p.update(O,I.pop());return r}}function q(a,b,e,g){var h,k;b&&b.eachProperty?(f(e,h=b.selector),k=b):(f(e,h=a.selector||(a.selector=".-xbind-"+t++)),k=a);var l=a.getArgs()[0],m=a.expressionResult,n=a.expressionDefinition;n||(n=a.expressionDefinition=
d.evaluate(a.parent,l),m=n.valueOf(),p.addInputConnector(k,n),function(b,d,e){a.expressionResult=m;e.dependencyOf&&e.dependencyOf({invalidate:function(a){a=a?p.matchesRule(a.elements[0],k)?a.elements:a.elements[0].querySelectorAll(d):document.querySelectorAll(d);for(var c=0,f=a.length;c<f;c++)g(a[c],b,e.valueOf())}})}(b,h,n));g(e,b,m)}function a(a,b,d,e){return k.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(d));e(a)})}function n(c,b,d,e){a(d,e,c,function(a){c.setAttribute(b,
a)})}function l(c,b,d,g){c._defaultBinding=!0;if(d&&d.then&&"INPUT"!==c.tagName)try{c.appendChild(e.createTextNode("Loading"))}catch(k){}a(d,g,c,function(a){if(c._defaultBinding)if(s(c),c.childNodes.length&&(c.innerHTML=""),a&&a.sort)if(a.isSequence)m(a,g)(c);else{var d=b&&b.definitions&&b.definitions.each,k=g.newRule(),d=d?m(d,k):function(a,c,b){return f(b||a,(b?"-":"")+(h[a.tagName]||"span"),""+c)},l=[],n;a.track&&(a=a.track(),n=a.tracking);a.forEach(function(a){l.push(d(c,a,null))});if(a.on)var p=
a.on("add,delete,update",function(a){var b=a.target,e=a.previousIndex;a=a.index;if(-1<e){var f=l[e];s(f,!0);f.parentNode.removeChild(f);l.splice(e,1)}-1<a&&l.splice(a,0,d(c,b,l[a]||null))});if(n=n||p)c.xcleanup=function(){n.remove()}}else a&&a.nodeType?c.appendChild(a):(a=void 0===a?"":a,c.tagName in r?"checkbox"===c.type?c.checked=a:c.value=a:c.appendChild(e.createTextNode(a)))})}function s(a,b){a.xcleanup&&a.xcleanup(b);for(var d=a.getElementsByTagName("*"),e=0,f=d.length;e<f;e++){var g=d[e];g.xcleanup&&
g.xcleanup(!0)}}function g(a,d){return m(d,b)(a)}var h={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},r={INPUT:1,TEXTAREA:1,SELECT:1},e=document,t=1;g.forSelector=m;return g})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(p,f,k){return p("dojo.store.Memory",null,{constructor:function(d){for(var b in d)this[b]=d[b];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:k,get:function(d){return this.data[this.index[d]]},
getIdentity:function(d){return d[this.idProperty]},put:function(d,b){var f=this.data,k=this.index,a=this.idProperty,a=d[a]=b&&"id"in b?b.id:a in d?d[a]:Math.random();if(a in k){if(b&&!1===b.overwrite)throw Error("Object already exists");f[k[a]]=d}else k[a]=f.push(d)-1;return a},add:function(d,b){(b=b||{}).overwrite=!1;return this.put(d,b)},remove:function(d){var b=this.index,f=this.data;if(d in b)return f.splice(b[d],1),this.setData(f),!0},query:function(d,b){return f(this.queryEngine(d,b)(this.data))},
setData:function(d){d.items?(this.idProperty=d.identifier||this.idProperty,d=this.data=d.items):this.data=d;this.index={};for(var b=0,f=d.length;b<f;b++)this.index[d[b][this.idProperty]]=b}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(p){return function(f,k){function d(b){b=p.filter(b,f);var d=k&&k.sort;d&&b.sort("function"==typeof d?d:function(a,b){for(var f,g=0;f=d[g];g++){var h=a[f.attribute],k=b[f.attribute],h=null!=h?h.valueOf():h,k=null!=k?k.valueOf():
k;if(h!=k)return!!f.descending==(null==h||h>k)?-1:1}return 0});if(k&&(k.start||k.count)){var a=b.length;b=b.slice(k.start||0,(k.start||0)+(k.count||Infinity));b.total=a}return b}switch(typeof f){default:throw Error("Can not query with a "+typeof f);case "object":case "undefined":var b=f;f=function(d){for(var f in b){var a=b[f];if(a&&a.test){if(!a.test(d[f],d))return!1}else if(a!=d[f])return!1}return!0};break;case "string":if(!this[f])throw Error("No filter function "+f+" was found in store");f=this[f];
case "function":}d.matches=f;return d}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g){k.isAsync||a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var h=f("dojo.dnd.Source",s,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],
generateText:!0,constructor:function(a,e){d.mixin(this,d.mixin({},e));var f=this.accept;if(f.length){this.accept={};for(var c=0;c<f.length;++c)this.accept[f[c]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&b.add(this.node,"dojoDndSource");this.targetState="";this.accept&&b.add(this.node,"dojoDndTarget");this.horizontal&&b.add(this.node,"dojoDndHorizontal");this.topics=[n.subscribe("/dnd/source/over",
d.hitch(this,"onDndSourceOver")),n.subscribe("/dnd/start",d.hitch(this,"onDndStart")),n.subscribe("/dnd/drop",d.hitch(this,"onDndDrop")),n.subscribe("/dnd/cancel",d.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var d=0;d<b.length;++d){for(var c=a.getItem(b[d].id).type,f=!1,g=0;g<c.length;++g)if(c[g]in this.accept){f=!0;break}if(!f)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==g.manager().target);
if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){h.superclass.destroy.call(this);p.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&"Disabled"==this.targetState)){h.superclass.onMouseMove.call(this,a);var b=g.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();
d.length&&b.startDrag(this,d,this.copyState(l.getCopyKeyState(a),!0))}if(this.isDragging){d=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=m.position(this.current,!0);d=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==m.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||d!=this.before)this._markTargetAnchor(d),b.canDrop(!this.current||b.source!=this||!(this.current.id in this.selection))}}},
onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!l.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,h.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,h.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=g.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||
!(this.current.id in this.selection))))},onDndStart:function(a,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&g.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,d,c){if(this==c)this.onDrop(a,b,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=
this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,d){if(this!=a)this.onDropExternal(a,b,d);else this.onDropInternal(b,d)},onDropExternal:function(a,b,d){var c=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,d){return c.call(this,a.getItem(b.id).data,d)}:d?function(c){var b=a.getItem(c.id);c=c.cloneNode(!0);c.id=l.getUniqueId();return{node:c,data:b.data,type:b.type}}:function(c){var b=a.getItem(c.id);a.delItem(c.id);return{node:c,
data:b.data,type:b.type}};this.selectNone();!d&&!this.creator&&a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=c},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=l.getUniqueId();return{node:a,
data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){h.superclass.onOverEvent.call(this);g.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){h.superclass.onOutEvent.call(this);
g.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!q.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(b.contains(a,"dojoDndHandle"))return!0;if(b.contains(a,"dojoDndItem")||b.contains(a,"dojoDndIgnore"))break}return!1}});return h})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(p,f,k,d,b,m,q,a,n,l,s,g){var h=f("dojo.dnd.Selector",g,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(n(this.node,l.press,d.hitch(this,"onMouseDown")),n(this.node,l.release,d.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var d=new a,e=s._empty,f;for(f in this.selection)f in e||d.push(b.byId(f));return d},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,d){this._addItemClass(b.byId(d),"Selected");this.selection[d]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=s._empty,d;for(d in this.selection)if(!(d in a)){var f=b.byId(d);this.delItem(d);m.destroy(f)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||k.global;var d=this.selection,c=s._empty,f;for(f in d)f in c||a.call(b,this.getItem(f),f,this)},sync:function(){h.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=s._empty,d;for(d in this.selection)d in b||this.getItem(d)||a.push(d);p.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,d,c){var f=this._normalizedCreator;this._normalizedCreator=function(c,b){var d=f.call(this,c,b);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};h.superclass.insertNodes.call(this,b,d,c);this._normalizedCreator=f;return this},destroy:function(){h.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!s.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,q.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){s.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,c;d<b.length&&!(c=b[d],c==this.anchor||c==this.current);++d);for(++d;d<b.length;++d){c=b[d];if(c==this.anchor||c==this.current)break;this._addItemClass(c,"Selected");this.selection[c.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?s.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):s.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=n(this.node,l.move,d.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=s._empty,d;for(d in this.selection)if(!(d in a)){var f=b.byId(d);f&&this._removeItemClass(f,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return h})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r){f=f("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=m.byId(a);
b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&m.byId(b.dropParent);this.map={};this.current=null;this.containerState="";q.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[s(this.node,h.over,d.hitch(this,"onMouseOver")),s(this.node,h.out,d.hitch(this,"onMouseOut")),s(this.node,"dragstart",d.hitch(this,"onSelectStart")),s(this.node,"selectstart",d.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},
setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||k.global;var c=this.map,d=r._empty,f;for(f in c)f in d||a.call(b,c[f],f,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return g((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=r.getUniqueId();var c=b.getAttribute("dndType"),
d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){p.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=r._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(c){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||
!r.isFormElement(a))a.stopPropagation(),a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,d=a.toLowerCase()+"State";q.replace(this.node,c+b,c+this[d]);this[d]=b},_addItemClass:function(a,b){q.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){q.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&q.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,b){var c=(this.creator||this.defaultCreator).call(this,a,b);d.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=r.getUniqueId());q.add(c.node,"dojoDndItem");return c}});r._createNode=function(b){return!b?r._createSpan:function(d){return a.create(b,{innerHTML:d})}};r._createTrTd=function(b){var d=a.create("tr");a.create("td",{innerHTML:b},d);return d};r._createSpan=function(b){return a.create("span",{innerHTML:b})};r._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};r._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?r._createTrTd:r._createNode(r._defaultCreatorNodes[a]);return function(a,e){var f=a&&d.isObject(a),g,h;f&&a.tagName&&a.nodeType&&a.getAttribute?(g=a.getAttribute("dndData")||a.innerHTML,f=(f=a.getAttribute("dndType"))?f.split(/\s*,\s*/):["text"],h=a):(g=f&&a.data?a.data:a,f=f&&a.type?a.type:["text"],h=("avatar"==e?r._createSpan:b)(String(g)));h.id||(h.id=r.getUniqueId());return{node:h,data:g,type:f}}};
return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r){var e=f("dojo.dnd.Manager",[m],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:q("touch")?0:16,OFFSET_Y:q("touch")?-64:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());l.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),l.publish("/dnd/source/over",null)):l.publish("/dnd/source/over",null)},startDrag:function(a,c,e){function f(a){a.preventDefault();a.stopPropagation()}h.autoScrollStart(d.doc);this.source=a;this.nodes=c;this.copy=Boolean(e);this.avatar=this.makeAvatar();
d.body().appendChild(this.avatar.node);l.publish("/dnd/start",a,c,this.copy);this.events=[n(d.doc,s.move,k.hitch(this,"onMouseMove")),n(d.doc,s.release,k.hitch(this,"onMouseUp")),n(d.doc,"keydown",k.hitch(this,"onKeyDown")),n(d.doc,"keyup",k.hitch(this,"onKeyUp")),n(d.doc,"dragstart",f),n(d.body(),"selectstart",f)];b.add(d.body(),"dojoDnd"+(e?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){b.remove(d.body(),
["dojoDndCopy","dojoDndMove"]);p.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new r(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var c=this.avatar;c&&(h.autoScrollNodes(a),c=c.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=a.pageY+this.OFFSET_Y+"px",c=Boolean(this.source.copyState(g.getCopyKeyState(a))),this.copy!=c&&this._setCopyStatus(c));
q("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var c=Boolean(this.source.copyState(g.getCopyKeyState(a)));l.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,a);l.publish("/dnd/drop",this.source,this.nodes,c,this.target,a)}else l.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(b){if(this.avatar)switch(b.keyCode){case a.CTRL:b=Boolean(this.source.copyState(!0));this.copy!=b&&this._setCopyStatus(b);break;case a.ESCAPE:l.publish("/dnd/cancel"),
this.stopDrag()}},onKeyUp:function(b){this.avatar&&b.keyCode==a.CTRL&&(b=Boolean(this.source.copyState(!1)),this.copy!=b&&this._setCopyStatus(b))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();b.replace(d.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});g._manager=null;e.manager=g.manager=function(){g._manager||(g._manager=new e);return g._manager};return e})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(p,f,k,d,b,m,q,a){return p("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=m.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),b=this.manager.source,f,g=m.create("tbody",null,a),h=m.create("tr",null,g),k=m.create("td",null,h),e=Math.min(5,this.manager.nodes.length),p=0;q("highcontrast")&&m.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},k);m.create("span",{innerHTML:b.generateText?
this._generateText():""},k);for(d.set(h,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});p<e;++p)b.creator?f=b._normalizedCreator(b.getItem(this.manager.nodes[p].id).data,"avatar").node:(f=this.manager.nodes[p].cloneNode(!0),"tr"==f.tagName.toLowerCase()&&(h=m.create("table"),m.create("tbody",null,h).appendChild(f),f=h)),f.id="",h=m.create("tr",null,g),k=m.create("td",null,h),k.appendChild(f),d.set(h,{"class":"dojoDndAvatarItem",style:{opacity:(9-p)/10}});this.node=a},destroy:function(){m.destroy(this.node);
this.node=!1},update:function(){b.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(q("highcontrast")){var d=k.byId("a11yIcon"),f="+";this.manager.canDropFlag&&!this.manager.copy?f="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?f="o":this.manager.canDropFlag||(f="x");d.innerHTML=f}a("tr.dojoDndAvatarHeader td span"+(q("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(p,f,k,d){return p("dijit.CheckedMenuItem",k,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:d,checked:!1,_setCheckedAttr:function(b){this.domNode.setAttribute("aria-checked",b?"true":"false");this._set("checked",b)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(b){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(b)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),function(p,f,k,d,b,m,q,a,n,l,s){var g=n("dijit.ColorPalette",[k,d,b],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,d,f){return new this._dyeClass(a,b,d,f)},buildRendering:function(){this.inherited(arguments);this._dyeClass=n(g._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],q.getLocalization("dojo","colors",
this.lang))}});g._Color=n("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":p.toUrl("./themes/a11y/colors7x10.png"),"3x4":p.toUrl("./themes/a11y/colors3x4.png")},constructor:function(b,d,e,f){this._title=f;this._row=d;this._col=e;this.setColor(a.named[b])},getValue:function(){return this.toHex()},fillCell:function(a,b){var d=s.substitute(m("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:b,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});l.place(d,a)}});return g})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(p){return p})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(p,f,k,d,b,m,q,a,n){d("dijit-legacy-requires")&&m(0,function(){p(["dijit/form/RadioButton"])});
return f("dijit.form.CheckBox",[q,a],{templateString:n,baseClass:"dijitCheckBox",_setValueAttr:function(a,b){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,b)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&b("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");
this.inherited(arguments)},_onBlur:function(){this.id&&b("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(p,f){return p("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(k){this._set("readOnly",k);f.set(this.focusNode,"readOnly",k)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==
f||""===f?"on":f},_setValueAttr:function(k){k=this._getSubmitValue(k);this._set("value",k);f.set(this.focusNode,"value",k)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(p,f,
k){return p("dijit.form.ComboBox",[f,k],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(p,f,k,d,b,m,q,a,n){return p("dijit.form.ComboBoxMixin",[a,m],{dropDownClass:q,hasDownArrow:!0,templateString:n,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},
_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||d.mixin(a,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,g){var h=new f(function(){k.abort&&k.abort()});h.total=new f;var k=this.fetch(d.mixin({query:a,
onBegin:function(a){h.total.resolve(a)},onComplete:function(a){h.resolve(a)},onError:function(a){h.reject(a)}},g));return b(h)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var b=this.declaredClass;d.mixin(this.store,{getValue:function(a,d){k.deprecated(b+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return a[d]},getLabel:function(a){k.deprecated(b+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){k.deprecated(b+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],d.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},
"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(p,f,k,d,b,m,q,a,n,l,s){f=f("dijit.form._AutoCompleterMixin",s,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(b){var d=0;if("number"==typeof b.selectionStart)d=b.selectionStart;else if(a("ie")){var f=
b.ownerDocument.selection.createRange().duplicate();b=b.createTextRange();f.move("character",0);b.move("character",0);try{b.setEndPoint("EndToEnd",f),d=String(b.text).replace(/\r/g,"").length}catch(e){}}return d},_setCaretPos:function(a,b){b=parseInt(b);l.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(!(b==d.ALT||b==d.CTRL||b==d.META||
b==d.SHIFT)){var f=this.dropDown,e=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(e=f.getHighlightedOption()),b){case d.PAGE_DOWN:case d.DOWN_ARROW:case d.PAGE_UP:case d.UP_ARROW:this._opened&&this._announceOption(e);a.stopPropagation();a.preventDefault();break;case d.ENTER:if(e){if(e==f.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(e==f.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();
break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case d.TAB:b=this.get("displayedValue");if(f&&(b==f._messages.previousMessage||b==f._messages.nextMessage))break;e&&this._selectOption(e);case d.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var b=this.focusNode;l.selectInputText(b,b.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?
(d=this.autoComplete?this._getCaretPos(b):b.value.length,d+1>b.value.length&&(b.value=a,l.selectInputText(b,d))):(b.value=a,l.selectInputText(b))},_openResultList:function(a,d,f){var e=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==f.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=b.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,f,b.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in
f?(f.direction?this.dropDown.highlightFirstOption():f.direction||this.dropDown.highlightLastOption(),e&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(d[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},
isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;b&&(a==b._messages.previousMessage||a==b._messages.nextMessage)?this._setValueAttr(this._lastValueReported,!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),
this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,d){var e="";a&&(d||(d=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):d);this.set("value",e,b,d,a)},_announceOption:function(a){if(a){var b;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var d=this.dropDown.items[a.getAttribute("item")];
b=(this.store._oldAPI?this.store.getValue(d,this.searchAttr):d[this.searchAttr]).toString();this.set("item",d,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",k.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},
_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var d=this.id+"_popup";this.dropDown=new (b.isString(this.dropDownClass)?b.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:b.hitch(this,this._selectOption),id:d,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);
if(!this.store&&this.srcNodeRef&&(this.store=new n({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=m('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);p.after(this,"onSearch",b.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=
this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var d=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),e=this.queryExpr.indexOf("${0}");b=q.escapeString(b);return this._escapeHtml(a.replace(RegExp((0==e?"^":"")+"("+b+")"+(e==this.queryExpr.length-4?"$":""),d),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,
'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,d,e){this._set("item",e||null);null==a&&(a="");this.inherited(arguments)}});
a("dojo-bidi")&&f.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(p,f,k,d,b,m){function q(a){return{id:a.value,value:a.value,name:k.trim(a.innerText||a.textContent||"")}}return p("dijit.form.DataList",b,{constructor:function(a,b){this.domNode=f.byId(b);k.mixin(this,a);this.id&&
m.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:d("option",this.domNode).map(q)}])},destroy:function(){m.remove(this.id)},fetchSelectedItem:function(){var a=d("\x3e option[selected]",this.domNode)[0]||d("\x3e option",this.domNode)[0];return a&&q(a)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(p,f,k,d,b,m,q){return p("dijit.form._SearchMixin",null,{pageSize:Infinity,
store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,b,d,f){return d?".*":f?".":b?b:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&
(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;var b=!1;this._prev_key_backspace=!1;switch(a){case f.DELETE:case f.BACKSPACE:b=this._maskValidSubsetError=this._prev_key_backspace=!0;break;default:b="string"==typeof a||229==a}if(b)if(this.store)this.searchTimer=
this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var d=this,f=k.clone(this.query),p={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},g=b.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),h,q=function(){var a=d._fetchHandle=d.store.query(f,p);!d.disabled&&!(d.readOnly||h!==d._lastQuery)&&m(a,function(b){d._fetchHandle=
null;!d.disabled&&(!d.readOnly&&h===d._lastQuery)&&m(a.total,function(a){b.total=a;var e=d.pageSize;if(isNaN(e)||e>b.total)e=b.total;b.nextPage=function(a){p.direction=a=!1!==a;p.count=e;a?(p.start+=b.length,p.start>=b.total&&(p.count=0)):(p.start-=e,0>p.start&&(p.count=Math.max(e+p.start,0),p.start=0));0>=p.count?(b.length=0,d.onSearch(b,f,p)):q()};d.onSearch(b,f,p)})},function(a){d._fetchHandle=null;d._cancelingQuery||console.error(d.declaredClass+" "+a.toString())})};k.mixin(p,this.fetchProperties);
this.store._oldAPI?h=g:(h=this._patternToRegExp(g),h.toString=function(){return g});this._lastQuery=f[this.searchAttr]=h;this._queryDeferHandle=this.defer(q,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=q.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(p,f,k,d,b,m,q,a){return p("dijit.form._ComboBoxMenu",[b,m,a,q],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){f.add(a,"dijitMenuItemHover")},onUnhover:function(a){f.remove(a,
"dijitMenuItemHover")},onSelect:function(a){f.add(a,"dijitMenuItemSelected")},onDeselect:function(a){f.remove(a,"dijitMenuItemSelected")},_page:function(a){var b=0,d=this.domNode.scrollTop,f=k.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<f;){var h=this.getHighlightedOption();if(a){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;b+=(h-d)*(a?-1:1);d=h}},handleKey:function(a){switch(a.keyCode){case d.DOWN_ARROW:return this.selectNextNode(),!1;case d.PAGE_DOWN:return this._page(!1),!1;case d.UP_ARROW:return this.selectPreviousNode(),!1;case d.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(p,f,k,d,b){var m=f("dijit.form._ComboBoxMenuMixin"+
(d("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=b.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(b){this._set("value",b);this.onChange(b)},onClick:function(b){if(b==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(b==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(b)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(b,a){var d=this._createMenuItem(),f=a(b);f.html?d.innerHTML=f.label:d.appendChild(d.ownerDocument.createTextNode(f.label));""==d.innerHTML&&(d.innerHTML="\x26#160;");return d},createOptions:function(b,a,d){this.items=b;this.previousButton.style.display=0==a.start?"none":"";k.set(this.previousButton,"id",this.id+
"_prev");p.forEach(b,function(a,b){var f=this._createOption(a,d);f.setAttribute("item",b);k.set(f,"id",this.id+b);this.nextButton.parentNode.insertBefore(f,this.nextButton)},this);var f=!1;b.total&&!b.total.then&&-1!=b.total?a.start+a.count<b.total?f=!0:a.start+a.count>b.total&&a.count==b.length&&(f=!0):a.count==b.length&&(f=!0);this.nextButton.style.display=f?"":"none";k.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var b=this.containerNode;2<b.childNodes.length;)b.removeChild(b.childNodes[b.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});d("dojo-bidi")&&(m=f("dijit.form._ComboBoxMenuMixin",
m,{_createOption:function(){var b=this.inherited(arguments);this.applyTextDir(b);return b}}));return m})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(p,f,k,d){return p("dijit.form._ListMouseMixin",d,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(b,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(b,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(b,d){this._isDragging=!1;var f=this.selected,a=this._hoveredNode;f&&d==f?this.defer(function(){this._onClick(b,
f)}):a&&this.defer(function(){this._onClick(b,a)})},_onMouseOut:function(b,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(b,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(p,f,k){return p("dijit.form._ListBase",null,{selected:null,_listConnect:function(d,b){var k=this;return k.own(f(k.containerNode,f.selector(function(b,a,d){return b.parentNode==d},d),function(d){k[b](d,this)}))},selectFirstNode:function(){for(var d=this.containerNode.firstChild;d&&"none"==d.style.display;)d=d.nextSibling;this._setSelectedAttr(d,!0)},selectLastNode:function(){for(var d=this.containerNode.lastChild;d&&"none"==d.style.display;)d=d.previousSibling;this._setSelectedAttr(d,
!0)},selectNextNode:function(){var d=this.selected;if(d){for(d=d.nextSibling;d&&"none"==d.style.display;)d=d.nextSibling;d?this._setSelectedAttr(d,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var d=this.selected;if(d){for(d=d.previousSibling;d&&"none"==d.style.display;)d=d.previousSibling;d?this._setSelectedAttr(d,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(d,b){if(this.selected!=d){var f=this.selected;if(f)this.onDeselect(f);
d&&(b&&k.scrollIntoView(d),this.onSelect(d));this._set("selected",d)}else if(d)this.onSelect(d)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d"custom"\x3e${nls.customImage}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cdiv class\x3d"crop-section" data-dojo-attach-point\x3d"cropSection"\x3e\r\n\t\t\x3cdiv class\x3d"viewer-box hide-status" data-dojo-attach-point\x3d"viewerBox"\x3e\r\n\t\t\t\x3cdiv class\x3d"viewer-content" data-dojo-attach-point\x3d"viewerContent"\x3e\r\n\t\t\t\t\x3cimg class\x3d"viewer-image hide-status" data-dojo-attach-point\x3d"viewerImage" src\x3d""\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" data-dojo-attach-event\x3d"mousedown:_onViewerMouseDown,mouseup:_onViewerMouseUp"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"controller hide-status" data-dojo-attach-point\x3d"zoomController"\x3e\r\n\t\t\x3cdiv class\x3d"zoom-out" data-dojo-attach-point\x3d"zoomOutBtn" data-dojo-attach-event\x3d"click:_onZoomOutClick"\x3e-\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"slider" data-dojo-attach-point\x3d"sliderNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"button" data-dojo-attach-point\x3d"sliderButton" data-dojo-attach-event\x3d"mousedown:_onSliderMouseDown,mouseup:_onSliderMouseUp"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"horizontal"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"zoom-in" data-dojo-attach-point\x3d"zoomInBtn" data-dojo-attach-event\x3d"click:_onZoomInClick"\x3e+\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/EditorColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0"\r\n         role\x3d"presentation"\x3e\r\n    \x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(p){p(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(p,f,k,d,b,m,q,a,n,l,s,g,h,r,e,t,c,u,v,y,x,w,B,A,D,C){function E(a){F=a}r={};var F;u.defaults.io.timeout=
18E4;"function"!==typeof h.getAll&&(h.getAll=function(a){var b=[];(a=h(a))&&b.push(a);return b});window.jimuNls=C;x.setProtocolErrorHandler(function(){return!0});u=B.getAncestorWindow();var G=!1;try{G=0===u.location.href.indexOf("https://")}catch(I){console.log(I),G="https:"===window.location.protocol}v.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);G&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!B.isHostedService(a.url)&&
(a.url=a.url.replace("FeatureServer","MapServer"));/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());!window.isBuilder&&(F&&!F.mode&&F.appProxies&&0<F.appProxies.length)&&n.some(F.appProxies,function(b){if(0<=a.url.indexOf(b.sourceUrl))return a.url=a.url.replace(b.sourceUrl,b.proxyUrl),!0});return a});l(window,"mousedown",function(a){if(s.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===
a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=a.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[360,1280]},jimuConfig);window.wabVersion="2.3";window.productVersion="Online 4.4";window.isBuilder?(g.subscribe("app/appConfigLoaded",E),g.subscribe("app/appConfigChanged",
E)):(g.subscribe("appConfigLoaded",E),g.subscribe("appConfigChanged",E));r.initApp=function(){var a,c;console.log("jimu.js init...");a=window.location.search;a=""===a?{}:t.queryToObject(a.substr(1));if(a.mobileBreakPoint)try{c=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=c}catch(e){console.error("mobileBreakPoint URL parameter must be a number.",e)}k.getInstance(d.getInstance());b.getInstance();m.getInstance();q.setStyle(jimuConfig.loadingId,"display","none");q.setStyle(jimuConfig.mainPageId,
"display","block");c=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=p.getInstance(a);c.startup();a.loadConfig();A(["dynamic-modules/preload"])};return r});
