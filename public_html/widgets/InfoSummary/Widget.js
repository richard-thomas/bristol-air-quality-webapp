// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(T,G,u,q,a,k,v,L){function U(a,m){this.start=a;this.end=m}function h(a,m,e){this.start=a;this.end=m;this.units=e}function b(a,m){this.start=a;this.end=m;this.temp=new q}function B(a){this.values=a;this.length=a.length}function D(a,m){this.values=a;this.def=m?m:{}}function Q(a,m){this.stack=a;this.original=m}function s(a,
m,e,r){if(a.values)return new B(a.values);var w,W;W=a.start?G.normalizeColor(a.start):w=m?e?m[e]:m:r;a.end?a=G.normalizeColor(a.end):(w||(w=m?e?m[e]:m:r),a=w);return new b(W,a)}var O=G.fx={};U.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};h.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};b.prototype.getValue=function(a){return q.blendColors(this.start,this.end,a,this.temp)};B.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*
this.length),this.length-1)]};D.prototype.getValue=function(a){var m=T.clone(this.def),e;for(e in this.values)m[e]=this.values[e].getValue(a);return m};Q.prototype.getValue=function(b){var m=[];a.forEach(this.stack,function(e){if(e instanceof u.Matrix2D)m.push(e);else if("original"==e.name&&this.original)m.push(this.original);else if("matrix"==e.name){if(e.start instanceof u.Matrix2D&&e.end instanceof u.Matrix2D){var r=new u.Matrix2D,w;for(w in e.start)r[w]=(e.end[w]-e.start[w])*b+e.start[w];m.push(r)}}else e.name in
u&&(r=u[e.name],"function"!=typeof r?m.push(r):(w=a.map(e.start,function(a,m){return(e.end[m]-a)*b+a}),r=r.apply(u,w),r instanceof u.Matrix2D&&m.push(r)))},this);return m};var E=new q(0,0,0,0);O.animateStroke=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),e=a.shape,r;v.connect(b,"beforeBegin",b,function(){r=e.getStroke();var b=a.color,m={},k;b&&(m.color=s(b,r,"color",E));if((b=a.style)&&b.values)m.style=new B(b.values);if(b=a.width){var h=b;h.values?k=new B(h.values):(b=
h.start?h.start:k=r?r.width:1,h.end?k=h.end:"number"!=typeof k&&(k=r?r.width:1),k=new U(b,k));m.width=k}if((b=a.cap)&&b.values)m.cap=new B(b.values);if(b=a.join)b.values?m.join=new B(b.values):(k=b.start?b.start:r&&r.join||0,b=b.end?b.end:r&&r.join||0,"number"==typeof k&&"number"==typeof b&&(m.join=new U(k,b)));this.curve=new D(m,r)});v.connect(b,"onAnimate",e,"setStroke");return b};O.animateFill=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),e=a.shape,h;v.connect(b,"beforeBegin",
b,function(){h=e.getFill();var b=a.color;b&&(this.curve=s(b,h,"",E))});v.connect(b,"onAnimate",e,"setFill");return b};O.animateFont=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),e=a.shape,r;v.connect(b,"beforeBegin",b,function(){r=e.getFont();var b=a.style,m={},k,q;b&&b.values&&(m.style=new B(b.values));if((b=a.variant)&&b.values)m.variant=new B(b.values);if((b=a.weight)&&b.values)m.weight=new B(b.values);if((b=a.family)&&b.values)m.family=new B(b.values);if((b=a.size)&&
b.units)k=parseFloat(b.start?b.start:e.font&&e.font.size||"0"),q=parseFloat(b.end?b.end:e.font&&e.font.size||"0"),m.size=new h(k,q,b.units);this.curve=new D(m,r)});v.connect(b,"onAnimate",e,"setFont");return b};O.animateTransform=function(b){b.easing||(b.easing=k._defaultEasing);var m=new k.Animation(b),e=b.shape,h;v.connect(m,"beforeBegin",m,function(){h=e.getTransform();this.curve=new Q(b.transform,h)});v.connect(m,"onAnimate",e,"setTransform");if("svg"===G.renderer&&(9<=L("ie")||L("ff")))var q=
[v.connect(m,"onBegin",m,function(){for(var a=e.getParent();a&&a.getParent;)a=a.getParent();a&&(e.__svgContainer=a.rawNode.parentNode,e.__svgRoot=a.rawNode,e.__svgRoot&&e.__svgRoot.getAttribute&&(e.__svgWidth=parseInt(e.__svgRoot.getAttribute("width"),10),isNaN(e.__svgWidth)&&delete e.__svgWidth))}),v.connect(m,"onAnimate",m,function(){try{if(e.__svgContainer){var a=e.__svgContainer.style.visibility;e.__svgContainer.style.visibility="visible";e.__svgContainer.style.visibility=a;var b=e.__svgWidth;
if(!isNaN(b))try{e.__svgRoot.setAttribute("width",b-5E-6),e.__svgRoot.setAttribute("width",b)}catch(m){}}}catch(k){}}),v.connect(m,"onEnd",m,function(){a.forEach(q,v.disconnect);if(e.__svgContainer){var b=e.__svgContainer;if(null==b.getAttribute("__gotVis")){b.setAttribute("__gotVis",!0);var m=e.__svgContainer.style.visibility,k=e.__svgRoot,h=e.__svgWidth;b.style.visibility="visible";setTimeout(function(){try{b.style.visibility=m;b.removeAttribute("__gotVis");b=null;try{isNaN(h)||(k.setAttribute("width",
h-5E-6),k.setAttribute("width",h))}catch(a){}}catch(e){}},100)}}delete e.__svgContainer;delete e.__svgRoot;delete e.__svgWidth})];return m};return O})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(T,G,u,q,a,k,v,L,U,h,b,B,D,Q,s,O,E,$,m,e,r,w,W,z,X,R,S,Z){return T("ClusterLayer",[Q,B],{constructor:function(n){this.clusterGraphics=null;this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=[];this.hidePanel=n.hidePanel;this._parent=n._parent;if(this._parentLayer=n.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=n.name;this._map=n.map;this.color=a.fromString(n.color||"#ff0000");
this._styleColor=n._styleColor;this.symbolData=n.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=n.lyrInfo.itemId;this.refresh=n.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=n.node;this.countEnabled=n.countEnabled;this.legendNode=n.legendNode;this.id=n.id;this.infoTemplate=n.infoTemplate;this.url=n.lyrInfo.url;this._testRenderer=n.lyrInfo.renderer;(this.originOperLayer=n.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);
this.lyrInfo=n.lyrInfo;this.lyrType=n.lyrType;this.filter=n.filter;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(q.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(n){var a=new z;a.geometry=this._map.extent;n.queryCount?n.queryCount(a,q.hitch(this,function(a){if(0<a)this.hidePanel||(this.nodeCount=a),this._initFeatures(this._parentLayer);else if(!this.hidePanel){this.nodeCount=
0;var V=new Z(n.url);b(V,"load",q.hitch(this,function(){this.countFeatures(V)}))}})):this._initFeatures(this._parentLayer)},_initFeatures:function(n){this._features=[];var a=!0,b=new z;-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||null===this.url?(this._getSourceFeatures(n.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(b.where=this.filter?this.filter:"1\x3d1",b.outFields=this._fieldNames,b.returnGeometry=!0,n.queryFeatures?n.queryFeatures(b).then(q.hitch(this,
function(n){n.features&&(this._getSourceFeatures(n.features),this.clusterFeatures())})):a="error");"error"!==a&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",q.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",q.hitch(this,this.handleClick))))},_getSourceFeatures:function(n){this._features=[];for(var a=0;a<n.length;a++){var b=n[a];b.geometry&&this._features.push(b)}},_getInfoTemplate:function(n){n=n.parentLayerInfo?n.parentLayerInfo:
n;if(n.controlPopupInfo&&(n=n.controlPopupInfo.infoTemplates)){if(this.url){var a=this.url.split("/").pop();a&&(n.indexOf?-1<n.indexOf(a)&&(this.infoTemplate=n[a].infoTemplate):n.hasOwnProperty(a)&&(this.infoTemplate=n[a].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var n=this.infoTemplate.info.fieldInfos;if(n)for(var a=0;a<n.length;a++)n[a].visible&&this._fieldNames.push(n[a].fieldName)}if(this.symbolData.featureDisplayOptions&&
0<this.symbolData.featureDisplayOptions.fields.length)for(n=0;n<this.symbolData.featureDisplayOptions.fields.length;n++)a=this.symbolData.featureDisplayOptions.fields[n],-1===this._fieldNames.indexOf(a.name)&&this._fieldNames.push(a.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(a){this.lyrInfo=a},clearSingles:function(a){G.forEach(a||this._singles,function(a){this.remove(a)},this);this._singles.length=0},_getSingleGraphic:function(a){a=new s(new E(a.geometry.x,a.geometry.y,
this._map.spatialReference),null,a.attributes);a.setSymbol(this._singleSym);return a},_addSingles:function(a){G.forEach(a,function(a){a=this._getSingleGraphic(a);this._singles.push(a);this._showSingles&&this.add(a)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(a){if(!this.hidePanel){var b=new z;b.returnGeometry=!1;b.geometry=this._map.extent;b.where=this.filter?this.filter:"1\x3d1";(new X(a)).executeForIds(b).then(q.hitch(this,function(a){var n;this.node?(L.contains(this.node,
"searching")&&L.remove(this.node,"searching"),this.node.innerHTML=a?D.localizeNumber(a.length):0,n=this.node.parentNode):this.legendNode&&(n=this.legendNode.previousSibling);this.updateExpand(n,a?!1:!0)}))}},updateExpand:function(a,b){if(!this.hidePanel&&"undefined"!==typeof a){var e;-1<a.id.indexOf("rec_")&&(e=a.id.replace("rec_",""),e=U.byId("exp_"+e));b?(a&&(k.addClass(a,"recDefault"),k.addClass(a,"inActive")),e&&k.addClass(e,"expandInActive")):(a&&(k.removeClass(a,"recDefault"),k.removeClass(a,
"inActive")),e&&k.removeClass(e,"expandInActive"))}},loadData:function(a){if(0<a.length){this.initalCount(a);var b=new z;b.where="1\x3d1";this.filter&&(b.where=this.filter);b.returnGeometry=!1;this.queryPending=!0;(new X(a)).executeForIds(b).then(q.hitch(this,function(b){if(b){this.queryIDs=b;b=[];var e,m;e=0;for(m=this.queryIDs.length;e<m;e+=1E3){var V=this.queryIDs.slice(e,e+1E3),k=new z;k.outFields=this._fieldNames;k.objectIds=V;k.returnGeometry=!0;k.outSpatialReference=this._map.spatialReference;
V=new X(a);b.push(V.execute(k))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new v(b)).then(q.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var f=this._map.spatialReference,x=[],d=0;d<a.length;d++)if(a[d][1].features)for(var l=0;l<a[d][1].features.length;l++){var c=a[d][1].features[l];if("undefined"!==typeof c.geometry&&null!==c.geometry&&c.geometry){var g=new E(c.geometry.x,c.geometry.y,f),
g=new s(g);g.setAttributes(c.attributes);this.infoTemplate&&g.setInfoTemplate(this.infoTemplate);x.push(g)}}a=!0;1E4>x&&(a=JSON.stringify(this._features)!==JSON.stringify(x));a&&(this._features=x,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},handleClick:function(a){var b=[];if(a.graphic&&(b=a.graphic,b.attributes)){var e=b.attributes;e.Data&&1<e.Data.length?(this.clearSingles(this._singles),b=e.Data,a.stopPropagation(),this._addSingles(b)):e.Data&&1===e.Data.length?
(e.Data[0].symbol=b.symbol,this._map.infoWindow.setFeatures([e.Data[0]])):this._map.infoWindow.setFeatures([b])}this.infoTemplate&&this._map.infoWindow.show(a.mapPoint);u.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();else if(a.delta){var b=a.delta;a=Math.abs(b.x);b=Math.abs(b.y);(50<a||50<b)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;"undefined"===typeof this.updateFeatures&&(this.updateFeatures=a);var b=!0;1E4>
a.length&&(b=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(b){this._features=[];this._parentLayer.clear();var b=this._parentLayer.spatialReference,e;this._parentLayer.renderer?e=this._parentLayer.renderer:this._testRenderer&&(e=this._testRenderer);for(var m=0;m<a.length;m++){var k=a[m];if(k.geometry){var h=new s(this.getGraphicOptions(k,b,e));h.setAttributes(k.attributes);this.infoTemplate&&h.setInfoTemplate(this.infoTemplate);h.setSymbol(e.getSymbol(h));this._parentLayer.add(h);this._features.push(h)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=
a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,b,e){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new E(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:e.symbol}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},flashSingle:function(b){if("undefined"===
typeof b.symbol){var k=new e(e.STYLE_NULL,new a(0,0,0,0),0),h=this.color.toRgb();b.setSymbol(new m(m.STYLE_CIRCLE,9,k,new a([h[0],h[1],h[2],0.5])))}this.flashGraphics([b])},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b]);setTimeout(q.hitch(this,this._clearFeatures),1100)},_flashFeature:function(b){var k;if(b.geometry){var Y=a.fromHex(this._styleColor),r=q.clone(Y);r.a=0.4;"undefined"!==typeof b.symbol&&(k=new m(m.STYLE_CIRCLE,b.symbol.size,new e(e.STYLE_SOLID,Y,1),r))}if("undefined"!==
typeof k&&(b=new s(b.geometry,k),this._map.graphics.add(b),k=b.getDojoShape()))h.animateStroke({shape:k,duration:700,color:{start:k.strokeStyle.color,end:k.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,b)},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(a){a.getLayer().remove(a)},setColor:function(a){this.color=a},setStyleColor:function(a){this._styleColor=a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&
(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var a=this._features,b=0;if("undefined"!==typeof a){if(0<a.length&&this.visible){var e=this.clusterSize;this.clusterGraphics=
[];for(var m=this._map.spatialReference,k=this._map.extent,h=new E(k.xmin,k.ymax,m),q=Math.ceil(this._map.height/e),t=Math.ceil(this._map.width/e),f=k.getWidth()/this._map.width*e,e=k.getHeight()/this._map.height*e,k=0;k<q;k++)for(var x=0;x<t;x++){var d=h.x+f*x,l=h.y-e*k,l=new O(d,l-e,d+f,l,m),d=[],c;for(c in a){var g=a[c];l.contains(g.geometry)&&(b+=1,d.push(g))}0<d.length&&(l=this.getClusterCenter(d),this.clusterGraphics.push({center:l,graphics:d}))}for(var ea in this.clusterGraphics){a=this.clusterGraphics[ea];
m=a.graphics.length;h=a.graphics;f=D.localizeNumber(m);t=q=19*f.length;q+=5;c=new w;c.family="Arial";c.size="16px";f=new r(f,c,this.countColor);f.setOffset(0,-4);var p;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?p=this.symbolData.symbol.size:this.symbolData.symbol.width&&(p=this.symbolData.symbol.width,c=this.symbolData.symbol.height,p=p>=c?p:c):this.icon.width?(q=this.icon.width>=q?this.icon.width+5:q,q=this.icon.height>=q?this.icon.height+5:q,t=this.icon.width>=t?this.icon.width+
1:t,t=this.icon.height>=t?this.icon.height+1:t):this.icon.size&&(p=this.icon.size);p&&(q=p>=q?p+5:q,t=p>=t?p+1:t);t>=q&&(q+=0===t-q?4:t-q+5);this._setSymbols(q+15,q);h={Count:m,Data:h};1<m?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new s(a.center,this.csym,h)),this.displayFeatureCount?this.add(new s(a.center,f,h)):this.add(new s(a.center,this.csym3,h))):(this.add(new s(a.center,this.csym,h)),this.displayFeatureCount?this.add(new s(a.center,f,h)):this.add(new s(a.center,
this.psym,h))):(this.add(new s(a.center,this.csym,h)),this.displayFeatureCount?this.add(new s(a.center,f,h)):this.add(new s(a.center,this.psym,h))):(a=a.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new s(a,null,h.Data[0].attributes,this.infoTemplate),a.setSymbol(this.renderer.getSymbol(a))):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new s(a,null,h.Data[0].attributes,this.infoTemplate),
a.setSymbol(R.fromJson(this.renderer.symbol))):a="EsriSymbol"===this.symbolData.symbolType?new s(a,R.fromJson(this.symbolData.symbol),h,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new s(a,this.psym,h,this.infoTemplate):this.renderer.symbol?new s(a,this.renderer.symbol,h,this.infoTemplate):new s(a,this.psym,h,this.infoTemplate),"undefined"!==typeof a&&this.add(a)))}}this._updateNode(b)}},_getSym:function(a){var b;this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?
b=this.renderer.getSymbol(a):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?b=this.renderer.symbol:"EsriSymbol"===this.symbolData.symbolType?b=this.symbolData.symbol:this.symbolData.symbol&&(b=this.symbolData.symbol);return b},_updateNode:function(a){if(!this.hidePanel){var b;this.node?(this.node.innerHTML=a?D.localizeNumber(a):0,b=this.node.parentNode):this.legendNode&&(b=this.legendNode.previousSibling);this.updateExpand(b,a&&this.visible?!1:!0)}},_updatePanelTime:function(a){if(!this.hidePanel){this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e";var b="";""!==this.config.mainPanelText&&(b=this.config.mainPanelText+" ");this.pageTitle.innerHTML=b+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}},_setSymbols:function(b,k){var h=this.color.toRgb(),r,u,v;if("undefined"!==typeof this.symbolData){var s;"custom"===this.backgroundClusterSymbol?s=h:(r=R.fromJson(this.backgroundClusterSymbol),0===r.outline.color.a||0===r.outline.width?
(u=e.STYLE_NULL,v=0):(u=e.STYLE_SOLID,v=r.outline.width));r?(h=e(u,r.outline.color,v),s=r.color.toRgb(),this.csym=new m(m.STYLE_CIRCLE,b,h,new a([s[0],s[1],s[2],0.75]))):this.csym=new m(m.STYLE_CIRCLE,b,null,new a([s[0],s[1],s[2],0.75]));(h=this.symbolData.s)&&-1<h.indexOf("${appPath}")?(h=window.location.pathname.replace("index.html",""),h=this.symbolData.s.replace("${appPath}",window.location.origin+h)):h=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(h&&"CustomIcon"===this.symbolData.iconType){var t,
f;this.symbolData.symbol&&this.symbolData.symbol.height&&(t=this.symbolData.symbol.height);this.symbolData.symbol&&this.symbolData.symbol.width&&(f=this.symbolData.symbol.width);t&&f?f=t=f>t?f:t:(t=this.symbolData.icon.height?this.symbolData.icon.height:k,f=this.symbolData.icon.width?this.symbolData.icon.width:k);this.psym=new $(h,t,f)}else h&&"LayerIcon"===this.symbolData.iconType?this.psym=R.fromJson(this.symbolData.symbol):(t=e(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),
this.psym=new m(this.icon.style,this.icon.size,t,this.icon.color));this.csym2=q.clone(this.psym);this.csym3=q.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else t=new e(e.STYLE_NULL,new a(0,0,0,0),0),this.csym=new m(m.STYLE_CIRCLE,b,t,new a([h[0],h[1],h[2],0.5])),this.psym=new $(this.icon.url,b-10,b-10),this.psym2=new $(this.icon.url,k-7,k-7),t=new e(e.STYLE_NULL,new a(0,0,0,0),0),this.csym2=new m(m.STYLE_CIRCLE,
k,t,new a([h[0],h[1],h[2],0.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer.toJson?this._parentLayer.renderer:S.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=S.fromJson(this._testRenderer):this.symbolData.renderer&&
(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:S.fromJson(this.symbolData.renderer)):this.renderer=new W(R.fromJson(this.symbolData.symbol));var b=this.color.toRgb(),h=new e(e.STYLE_NULL,new a(0,0,0,0),0);this._singleSym=new m(m.STYLE_CIRCLE,9,h,new a([b[0],b[1],b[2],0.5]))}},getLayer:function(){return this},getClusterCenter:function(a){var b=0,e=0,h=a.length;G.forEach(a,function(a){b+=a.geometry.x;e+=a.geometry.y},this);return new E(b/h,e/h,a[0].geometry.spatialReference)},
destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.loadData(this.url)}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .page-dart {position: relative; width: 360px; margin-left: 0; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent-dart {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: #4c4c4c;}.jimu-widget-InfoSummary .featureItem-dart{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px; color: whitesmoke;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px; color: whitesmoke;}.jimu-widget-InfoSummary .featureItem-dart:hover{background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItem-dart{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table; color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5); color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart{background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart{background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover{background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart{background-color: black;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 20px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 20px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .featureItem:hover{background-color: lightgray;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 210px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .pageClose {position: absolute; left: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 210px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px;}.jimu-widget-InfoSummary .inActive {opacity:0.6; filter:alpha(opacity\x3d60);}.jimu-widget-InfoSummary .lightThemeColor {color: #000000;}.jimu-widget-InfoSummary .darkThemeColor {color: whitesmoke;}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 35px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 55px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 55px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageLabel {padding-top: 10px; color: whitesmoke; font-size: 17px; text-align: center;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: left;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: right;}.jimu-widget-InfoSummary .expandArrow {width: 100%; height: 20px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent {} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 25px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; top: 25px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity:0.3; filter:alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto; overflow-y: auto;}}",
"*now":function(T){T(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(T,
G,u,q,a,k,v,L,U,h,b,B,D,Q,s,O,E,$,m,e,r,w,W,z,X,R,S,Z,n,V,Y,aa,ba,ca,da,t){return U([T,m],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],postCreate:function(){this.inherited(arguments);this.setupOrientationChange();this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=this.config.layerInfos;
this.layerList={};this._initWidget()},setupOrientationChange:function(){window.hasOwnProperty("matchMedia")&&window.matchMedia("(orientation: portrait)").addListener(h.hitch(this,this._orientationChange))},_orientationChange:function(){470>=window.innerWidth?q.byId("map").style.bottom=window.innerHeight/2+"px":this._resetMapDiv()},inPanelOverrides:function(f){(this.isDartTheme="DartTheme"===f)?a.contains(this.pageContent,"pageContent")&&(a.remove(this.pageContent,"pageContent"),a.add(this.pageContent,
"pageContent-dart")):a.contains(this.pageContent,"pageContent-dart")&&(a.remove(this.pageContent,"pageContent-dart"),a.add(this.pageContent,"pageContent"))},startup:function(){this.inherited(arguments);this.hidePanel||(this.mapExtentChangedHandler=this.map.on("extent-change",h.hitch(this,this._mapExtentChange)),this._mapExtentChange())},onOpen:function(){this.widgetChange=!1;this.hidePanel||this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);
var f=[],a;for(a in this.layerList){var d=this.layerList[a],b=d.li,c=d.layerObject;if(b&&b.orgRenderer){if(c.setRenderer)c.setRenderer(b.newRenderer);else if(c.setLayerDrawingOptions){var g=[],e=new t;e.renderer=b.newRenderer;g[b.subLayerId]=e;c.setLayerDrawingOptions(g)}else console.log("Error setting the new renderer...will use the default rendering of the layer");c.refresh()}var p;c&&c.layerInfos?p=c:b&&"undefined"!==typeof b.parentLayerID&&(p=this.map.getLayer(b.parentLayerID));if(p&&p.visibleLayers){c=
!1;g=0;b:for(;g<f.length;g++)if(f[g].id===p.id){c=!0;break b}(0===f.length||!c)&&f.push({id:p.id,layers:p.visibleLayers});c=0;c;b:for(;c<f.length;c++)if(f[c].id===p.id)break b;g=f[c].layers;if(p.layerInfos){if(0<p.layerInfos.length&&b&&"undefined"!==typeof b.subLayerId){var e=-1<g.indexOf(b.subLayerId),k=d.parentLayerVisible,m=d.layerObject.parentLayerVisible;"ClusterLayer"===d.type&&(e||k||m)?(d.parentLayerVisible=!0,d.layerObject.parentLayerVisible=!0,d.visible=!0,e&&g.splice(g.indexOf(b.subLayerId),
1)):e||k?(d.parentLayerVisible=!0,d.visible=!0,-1===g.indexOf(b.subLayerId)&&g.push(b.subLayerId)):(d.parentLayerVisible=!1,d.visible=!1,e&&g.splice(g.indexOf(b.subLayerId),1),"ClusterLayer"===d.type&&(d.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(d.id)&&(b=this.map.getLayer(d.id),b.setVisibility(!1))))}f[c].layers=g}this.updatePanelVisibility(d,a,d)}else c&&("ClusterLayer"===d.type&&c._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(d.id)&&(b=this.map.getLayer(d.id),
"undefined"===typeof d.layerObject.parentLayerVisible&&(d.parentLayerVisible=c._parentLayer.visible,d.layerObject.parentLayerVisible=c._parentLayer.visible),b.setVisibility(d.layerObject.parentLayerVisible)),c._parentLayer.setVisibility&&c._parentLayer.setVisibility(!1)),this.updatePanelVisibility(c,a,d))}for(a=0;a<f.length;a++)(d=this.map.getLayer(f[a].id))&&d.setVisibleLayers(f[a].layers);!this.hidePanel&&"undefined"===typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler=this.map.on("extent-change",
h.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow.highlight=!0},updatePanelVisibility:function(f,x,d){if(!this.hidePanel&&"undefined"!==typeof f.visible){var b=q.byId("recLabel_"+x);f.visible?(a.contains("recIcon_"+x,"active")||a.add("recIcon_"+x,"active"),this.config.countEnabled&&a.contains("recNum_"+x,"recNumInActive")&&(a.remove("recNum_"+x,"recNumInActive"),a.add("recNum_"+x,"recNum")),b&&b.firstChild&&a.remove(b.firstChild,
"inActive"),a.contains("exp_"+x,"expandInActive")&&a.remove("exp_"+x,"expandInActive"),a.contains("rec_"+x,"recDefault")&&a.remove("rec_"+x,"recDefault")):(a.contains("recIcon_"+x,"active")&&a.remove("recIcon_"+x,"active"),this.config.countEnabled&&a.contains("recNum_"+x,"recNum")&&(a.remove("recNum_"+x,"recNum"),a.add("recNum_"+x,"recNumInActive")),b&&b.firstChild&&a.add(b.firstChild,"inActive"),a.contains("exp_"+x,"expandInActive")||a.add("exp_"+x,"expandInActive"),d.toggleLegend.remove(),a.contains("rec_"+
x,"rec")&&a.add("rec_"+x,"recDefault"))}},enableRefresh:function(){var f=null,a=!1,d;for(d in this.layerList){f=this.layerList[d];if("ClusterLayer"!==f.type)!a&&f.li&&f.li.itemId&&(this.getItem(f.li.itemId),a=!0),f=f.layerObject;else for(var b=0;b<this.opLayers.length;b++){var c=this.opLayers[b];if(c.layerObject){f=c.layerObject;break}}f&&(f.refreshInterval=this.config.refreshInterval)}f=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=
f,this.refreshInterval=setInterval(h.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==f&&(this.refreshIntervalValue=f,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(h.hitch(this,this.refreshLayers),this.refreshIntervalValue))},getItem:function(f){var a=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+f;aa({url:a,content:{f:"json",
requestTime:Date.now()}}).then(h.hitch(this,function(d){if(d){d=d.modified;var b=!0;this.lastModifiedTime&&(b=this.lastModifiedTime<d);-1<this.currentQueryList.indexOf(f)&&this.currentQueryList.splice(this.currentQueryList.indexOf(f),1);b&&(this.lastModifiedTime=d,this._updatePanelTime(d),aa({url:a+"/data",content:{f:"json",requestTime:Date.now()}}).then(h.hitch(this,this._updateItem,f)))}}))},_updatePanelTime:function(f){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=
u.fieldFormatter.getFormattedDate(new Date(f),{dateFormat:"shortDateShortTime"}))},refreshLayers:function(){for(var f in this.layerList){var a=this.layerList[f],d;a.li&&a.li.itemId?d=a.li.itemId:a.layerObject.itemId&&(d=a.layerObject.itemId);d&&-1===this.currentQueryList.indexOf(d)&&(this.currentQueryList.push(d),this.getItem(d))}},_updateItem:function(f,a){for(var d=0;d<a.layers.length;d++)this._updateLayerItem(a.layers[d],this.lastModifiedTime);this.currentQueryList.splice(this.currentQueryList.indexOf(f),
1)},_updateLayerItem:function(f){var a,d,b;for(b in this.layerList)if(this.layerList[b].pl&&this.layerList[b].pl.layerDefinition){if(this.layerList[b].pl.layerDefinition.name===f.layerDefinition.name){a=this.layerList[b];d=a.pl;break}}else this.layerList[b].layerObject._parentLayer&&this.layerList[b].layerObject._parentLayer.name===f.layerDefinition.name&&(this.layerList[b].layerObject.refreshFeatures(f),this.layerList[b].layerObject&&this._loadList(this.layerList[b],!0));if(f&&d){f=f.featureSet.features;
b=d.featureSet.features;var c=!0;1E4>f.length&&(c=JSON.stringify(b)!==JSON.stringify(f));if(c){d.layerObject.clear();b=a.layerObject.spatialReference;for(c=0;c<f.length;c++){var g=f[c];if(g.geometry){var h=this.getGraphicOptions(g,b,a.layerObject.renderer),p=new e(h);p.setSymbol(h.symbol);p.setAttributes(g.attributes);this._infoTemplate&&p.setInfoTemplate(this._infoTemplate);d.layerObject.add(p)}else console.log("Null geometry skipped")}a.layerObject.refresh();d.layerObject.refresh();d.featureSet.features=
f;this.countFeatures(a);a.layerObject&&this._loadList(a,!0)}}},getGraphicOptions:function(f,a,d){return"undefined"!==typeof f.geometry.rings?{geometry:{rings:f.geometry.rings,spatialReference:{wkid:a.wkid}}}:"undefined"!==typeof f.geometry.paths?{geometry:{paths:f.geometry.paths,spatialReference:{wkid:a.wkid}}}:{geometry:new r(f.geometry.x,f.geometry.y,f.geometry.spatialReference),symbol:d.symbol}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?this.config.hidePanel:
!1;this.map.itemId&&G.getInstance(this.map,this.map.itemInfo).then(h.hitch(this,function(f){2.1<=parseFloat(this.appConfig.wabVersion)?this.supportsFilter=!0:this.supportsFilter=!1;this.opLayers=f._operLayers;this.opLayerInfos=f._layerInfos;this._createPanelUI(this.configLayerInfos,f);this.supportsFilter&&this._addFilterChanged(f)}))},_addFilterChanged:function(f){f.on("filterChanged",h.hitch(this,function(f){Q.forEach(f,h.hitch(this,function(f){var a=f.id,c=f.id+this.UNIQUE_APPEND_VAL_CL;this.layerList.hasOwnProperty(a)?
this.layerList[a].filter=f.getFilter():this.layerList.hasOwnProperty(c)&&(this.layerList[c].filter=f.getFilter())}))}))},_updatePanelHeader:function(){this.pageLabel.innerHTML=u.stripHTML(this.label);L.set(this.pageLabel,"display","block");var f;f=this.map.width;this.config.displayPanelIcon&&750<f?(this.pageHeader&&(b.removeClass(this.pageHeader,"pageHeaderNoIcon"),b.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?b.addClass(this.pageHeader,
"pageHeaderRefresh"):b.addClass(this.pageHeader,"pageHeaderRefreshNoText"):b.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(b.removeClass(this.pageBody,"pageBodyNoIcon"),b.removeClass(this.pageBody,"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?b.addClass(this.pageBody,"pageBodyRefresh"):b.addClass(this.pageBody,"pageBodyRefreshNoText"):b.addClass(this.pageBody,"pageBody")),this.pageTitle&&(b.addClass(this.pageTitle,"pageTitleWidth"),this.config.refreshEnabled?
(b.removeClass(this.pageTitle,"pageTitle"),b.addClass(this.pageTitle,"pageTitleRefresh")):(b.removeClass(this.pageTitle,"pageTitleRefresh"),b.addClass(this.pageTitle,"pageTitle"))),f=this.config.mainPanelText,"undefined"===typeof f&&(f=""),this.pageTitle.innerHTML=f,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):!this.config.displayPanelIcon&&!this.config.refreshEnabled?(this.pageHeader&&(b.removeClass(this.pageHeader,"pageHeader"),b.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),
b.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(b.removeClass(this.pageBody,"pageBody"),b.removeClass(this.pageBody,"pageBodyNoIconRefresh"),b.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(b.removeClass(this.pageHeader,"pageHeader"),b.removeClass(this.pageHeader,"pageHeaderNoIcon"),b.addClass(this.pageHeader,
"pageHeaderNoIconRefresh")),this.pageBody&&(b.removeClass(this.pageBody,"pageBody"),b.removeClass(this.pageBody,"pageBodyNoIcon"),b.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&b.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&(750>=f&&this.config.refreshEnabled)&&(this.pageHeader&&(b.removeClass(this.pageHeader,"pageHeaderNoIcon"),b.removeClass(this.pageHeader,
"pageHeaderNoIconRefresh"),b.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?b.addClass(this.pageHeader,"pageHeaderRefresh"):b.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&(b.removeClass(this.pageBody,"pageBodyNoIcon"),b.removeClass(this.pageBody,"pageBodyNoIconRefresh"),b.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?b.addClass(this.pageBody,"pageBodyRefresh"):b.addClass(this.pageBody,"pageBodyRefreshNoText")),this.pageTitle&&
b.addClass(this.pageTitle,"pageTitleWidth"),f=this.config.mainPanelText,"undefined"===typeof f&&(f=""),this.pageTitle.innerHTML=f)},_createPanelUI:function(f,a){this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var d=0;d<f.length;d++){var b=f[d];"ThemeCluster"===b.symbolData.clusterType&&this.updateThemeClusterSymbol(b,d);var c=a.getLayerInfoById(b.id);this._createLayerListItem(b,c)}if(!this.hidePanel){k.create("div",
{"class":"expandArrow"},this.pageMain);for(var g in this.layerList)d=this.layerList[g],"ClusterLayer"!==d.type&&this.updateEnd.push(this.own(v(d.layerObject,"update-end",h.hitch(this,this.onUpdateEnd))))}this.addMapLayers()},updateThemeClusterSymbol:function(f,a){var d=f.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var b=B.fromHex(this._styleColor),c=a+1,g=
0<c?30*c:30,e=0===c%2,p=b.g,h=b.b,b=b.r-g;e&&(255<b?b-=255:0>b&&(b+=255));h-=g;0===c%3&&e&&(255<h?h-=255:0>h&&(h+=255));g=p-g;0===c%5&&e&&(255<g?g-=255:0>g&&(g+=255));d.clusterType="CustomCluster";d.clusterSymbol={color:[b,g,h,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},_createLayerListItem:function(f,a){for(var b=["ArcGISFeatureLayer","KML","ArcGISStreamLayer","CSV","GeoRSS"],l=0;l<this.opLayers.length;l++){var c=this.opLayers[l];
if(c.id===f.id||c.id===f.parentLayerID)if("ArcGISMapServiceLayer"===c.layerType){if(c=this._getSubLayerByURL(f.id),"undefined"!==typeof c){this.updateLayerList(c,f,"Feature Layer",a);break}}else if(-1<b.indexOf(c.layerType)||"undefined"===typeof c.layerType)if(c.layerObject&&c.id===f.id){this.updateLayerList(c,f,"Feature Layer",a);break}else if(c.featureCollection)for(var g=0;g<c.featureCollection.layers.length;g++){var e=c.featureCollection.layers[g];if(e.id===f.id||c.id===f.id){this.updateLayerList(e,
f,"Feature Collection",a);break}}else if(c.layerObject&&c.id===f.parentLayerID){var h,k;"GeoRSS"===c.type?(k="GeoRSS",h=c.layerObject.getFeatureLayers()):"KML"===c.type&&(k="KML",h=c.layerObject.getLayers());if(h)for(c=0;c<h.length;c++)if(g=h[c],g.id===f.id){this.updateLayerList(g,f,k,a);break}}}},removeOldClusterLayers:function(f){var a=[],b;for(b in this.layerList)if("ClusterLayer"===this.layerList[b].type){var l=0;b:for(;l<f.length;l++){var c=f[l];if(c.id+this.UNIQUE_APPEND_VAL_CL===b){c.symbolData&&
!c.symbolData.clusteringEnabled&&a.push(b);break b}}}if(0<a.length)for(var g in a)this.layerList.hasOwnProperty(a[g])&&(this.layerList[a[g]].layerObject.destroy(),delete this.layerList[a[g]])},addMapLayers:function(){for(var f=Object.keys(this.layerList).reverse(),a=0;a<f.length;a++){var b=f[a],l=this.layerList[b];l.type&&"ClusterLayer"===l.type&&-1===this.map.graphicsLayerIds.indexOf(b)&&this.map.addLayer(l.layerObject)}},_getSubLayerByURL:function(f){for(var a=null,b=0;b<this.opLayerInfos.length;b++){var l=
this.opLayerInfos[b];if(0<l.newSubLayers.length&&(a=this._recurseOpLayers(l.newSubLayers,f)))break}return a},_recurseOpLayers:function(f,a){for(var b=0;b<f.length;b++){var l=f[b];if(0<l.newSubLayers.length)this._recurseOpLayers(l.newSubLayers,a);else if(l.id===a)return l}},updateLayerList:function(f,a,b,l){var c=null,g=null,e=null,p=null,p=a.layerObject?a.layerObject:f,k=this._getInfoTemplate(p&&p.originOperLayer?p.originOperLayer:f);"ArcGISFeatureLayer"===f.layerType?a.symbolData.clusteringEnabled?
(c=this._getClusterLayer(a,f,l,b),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id,li:a,filter:this.supportsFilter&&l?l.getFilter():"1\x3d1",infoTemplate:k},this.hidePanel||this.own(v(c,"update-end",h.hitch(this,function(){this._loadList(this.layerList[c.id],!0)}))),this.numClusterLayers+=1):(f.parentLayerInfo&&f.parentLayerInfo.layerObject&&(g=f.parentLayerInfo.layerObject,e=a.id),c=f.layerObject,p=e?e:a.id,this.layerList[p]={type:g?b:c.type,layerObject:g?g:c,visible:!0,
pl:f,li:a,filter:this.supportsFilter&&l?l.getFilter():"1\x3d1",infoTemplate:k},this.updateRenderer(p)):"ArcGISStreamLayer"===f.layerType?(c=f.layerObject,this.layerList[c.id]={type:"StreamLayer",layerObject:c,visible:!0,id:c.id,filter:this.supportsFilter&&l?l.getFilter():"1\x3d1",infoTemplate:k}):a.symbolData.clusteringEnabled?(c=this._getClusterLayer(a,f,l,b),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id,li:a,filter:this.supportsFilter&&l?l.getFilter():"1\x3d1",infoTemplate:k},
this.hidePanel||this.own(v(c,"update-end",h.hitch(this,function(){this._loadList(this.layerList[c.id],!0)}))),this.numClusterLayers+=1):(f.parentLayerInfo&&f.parentLayerInfo.layerObject&&(g=f.parentLayerInfo.layerObject,e=g.visibleLayers?f.id:g.id),c=f.layerObject,p=e?e:f.id,this.layerList[p]={type:g?b:c?c.type:b,layerObject:g?g:c?c:f,visible:!0,pl:f,li:a,filter:this.supportsFilter&&l?l.getFilter():"1\x3d1",infoTemplate:k},this.updateRenderer(p));this.hidePanel||this._addPanelItem(g?g:c?c:f,a)},updateRenderer:function(f){f=
this.layerList[f];if("LayerSymbol"!==f.li.symbolData.symbolType){"undefined"===typeof f.li.orgRenderer&&(f.li.orgRenderer=f.layerObject.renderer?f.layerObject.renderer:f.li.renderer);var a=new ba(Y.fromJson(f.li.symbolData.symbol));f.li.newRenderer=a;if(f.layerObject.setRenderer)f.layerObject.setRenderer(a);else if(f.layerObject.setLayerDrawingOptions){var b=[],l=new t;l.renderer=a;b[f.li.subLayerId]=l;f.layerObject.setLayerDrawingOptions(b)}else console.log("Error setting the new renderer...will use the default rendering of the layer");
f.layerObject.refresh()}},_onRecNodeMouseover:function(f){a.add(f,this.isDartTheme?"layer-row-mouseover-dart":"layer-row-mouseover")},_onRecNodeMouseout:function(f){a.remove(f,this.isDartTheme?"layer-row-mouseover-dart":"layer-row-mouseover")},_addPanelItem:function(f,a){var d=f.visibleLayers?a.id:f.id,l=this.layerList[d].type,c;c=this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:["rec","expand","expandDown","solidBorder"];var g=k.create("div",{"class":c[0]+" "+c[3],
id:"rec_"+d},this.pageMain);this.own(v(g,"mouseover",h.hitch(this,this._onRecNodeMouseover,g)));this.own(v(g,"mouseout",h.hitch(this,this._onRecNodeMouseout,g)));k.create("div",{"class":c[1]+" "+c[2],id:"exp_"+d},g);c=k.create("div",{"class":"recIcon active",id:"recIcon_"+d},g);if(a.panelImageData&&-1<a.panelImageData.toString().indexOf("\x3cimg")){var e=document.createElement("div");e.innerHTML=a.panelImageData;e=new W(e.children[0].src,26,26);a.panelImageData=this._createImageDataDiv(e,44,44,void 0,
!0).innerHTML}c.innerHTML=a.panelImageData;L.set(c.firstChild,"border-radius","41px");var e=this.isDartTheme?" darkThemeColor":" lightThemeColor",p;this.config.countEnabled?(p=k.create("div",{"class":"recLabel"+e,id:"recLabel_"+d,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},g),b.setStyle(p,"top","20px"),p=k.create("div",{"class":"recNum"+e,id:"recNum_"+d,innerHTML:""},g)):k.create("div",{"class":"recLabelNoCount"+e,id:"recLabel_"+d,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},g);"ClusterLayer"===l?
(f.node=p,this._addLegend(d,this.layerList[d]),f._updateNode(f.nodeCount)):("StreamLayer"===l?(this.layerList[d].node=p,this.countFeatures(this.layerList[d])):this.layerList[d].node=p,this._addLegend(d,this.layerList[d]));v(c,"click",h.hitch(this,this._toggleLayer,this.layerList[d]));this.layerList[d].toggleLegend=v(g,"click",h.hitch(this,this._toggleLegend,this.layerList[d]));this.layerList[d].pl&&(this.layerList[d].pl.featureSet||this.countFeatures(this.layerList[d]))},_addLegend:function(f,a){a.legendNode=
k.create("div",{"class":"legendLayer legendOff",id:"legend_"+f},this.pageMain);"ClusterLayer"===a.type&&(a.layerObject.legendNode=a.legendNode)},_loadList:function(a,b){if(!this.hidePanel){var d=[],l=[],c=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;b&&this._addSearching(c);var g=[],e;a.layerObject&&a.layerObject.infoTemplate?e=a.layerObject.infoTemplate:a.li.infoTemplate&&(e=a.li.infoTemplate);if(e&&e.info){var p=e.info.fieldInfos;if("undefined"!==typeof p)for(var k=0;k<p.length;k++)p[k].visible&&
g.push(p[k].fieldName)}if(a.li.symbolData&&(p=a.li.symbolData.featureDisplayOptions)){if(p.fields)for(k=0;k<p.fields.length;k++)-1===g.indexOf(p.fields[k].name)&&g.push(p.fields[k].name);p.groupField&&-1===g.indexOf(p.groupField.name)&&g.push(p.groupField.name)}if(0===g.length||"undefined"===typeof e)g=["*"];"*"!==g[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===g.indexOf(a.layerObject.objectIdField)&&g.push(a.layerObject.objectIdField);if("ClusterLayer"===a.type){var m=[];if(a.layerObject.clusterGraphics){c=
a.layerObject.clusterGraphics;for(e=0;e<c.length;e++)if(p=c[e],p.graphics&&0<p.graphics.length)for(k=0;k<p.graphics.length;k++)m.push(p.graphics[k]);setTimeout(h.hitch(this,function(){this._updateList(m,a.legendNode,a.layerObject.node,g,b,a)}),100)}else this._removeSearching(c,!0)}c=["StreamLayer","GeoRSS","KML","Feature Layer"];if("ClusterLayer"!==a.type){if(a.pl&&a.pl.featureSet){this.getFeatures(a,g,b);return}if(-1<c.indexOf(a.type)||"CSV"===a.pl.type){this.getFeatures(a,g,b);return}}if(a.li&&
(a.li.url&&"ClusterLayer"!==a.type&&"undefined"===typeof a.queryFeatures)&&(e=a.li.url,-1<e.indexOf("MapServer")||-1<e.indexOf("FeatureServer")))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),c=new S,c.where=a.filter?a.filter:"1\x3d1",c.geometry=this.map.extent,c.returnGeometry=!0,c.outFields=g,e=new Z(e),d.push(e.execute(c)),l.push({node:a.node,legendNode:a.legendNode,fields:g,updateCount:b,li:a.li});0<d.length&&(this.promises=D(d).then(h.hitch(this,function(a){this.promises=
void 0;if(a)for(var f=0;f<a.length;f++)if(a[f]){var b=l[f];this._updateList(a[f].features,b.legendNode,b.node,b.fields,b.updateCount,b.li)}})))}},_addSearching:function(f){var b=this.isDartTheme?"expandDown-dart":"expandDown",d=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+f,b)&&(a.remove("exp_"+f,b),a.add("exp_"+f,"expandSearching"));a.contains("exp_"+f,d)&&(a.remove("exp_"+f,d),a.add("exp_"+f,"expandSearching"))},_removeSearching:function(f,b){var d=this.isDartTheme?"expandDown-dart":
"expandDown",l=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+f,"expandSearching")&&(a.remove("exp_"+f,"expandSearching"),a.add("exp_"+f,b?l:d))},_getClusterLayer:function(a,b,d,l){var c=b.layerObject?b.layerObject:b,g=a.infoTemplate,e=c&&c.originOperLayer?c.originOperLayer:b.parentLayerInfo;b=null;b=a.id+this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(b)||-1<this.map._layers.indexOf(b)?(b=this.map.getLayer(b),c=l=!1,JSON.stringify(b.symbolData)!==JSON.stringify(a.symbolData)&&
(b.symbolData=a.symbolData,b.countColor=a.symbolData._highLightColor,c=!0),d=k.toDom(a.panelImageData),JSON.stringify(b.icon)!==JSON.stringify(d.src)&&(b.icon=d.src,c=!0),k.destroy(d.id),b.displayFeatureCount=a.symbolData.displayFeatureCount,b.refresh!==a.refresh&&(b.refresh=a.refresh,l=!0),c&&b._setupSymbols(),b.countEnabled=this.config.countEnabled,b.hidePanel=this.hidePanel,l?b.refreshFeatures(b.url):c&&b.clusterFeatures()):b=new da({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:b,map:this.map,node:q.byId("recNum_"+
b),legendNode:q.byId("legend_"+b),infoTemplate:"undefined"!==typeof c.infoTemplate?c.infoTemplate:g,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:c,lyrInfo:a,lyrType:l,_styleColor:this._styleColor,originOperLayer:e,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:this.supportsFilter&&d?d.getFilter():"1\x3d1"});return b},_createImageDataDiv:function(a,b,d,e,c){var g;if(a){g=b;var h=d;if(a.height&&a.width){var p;if(a.height>a.width)p=
a.width/a.height,h=b*p;else if(a.width===a.height||a.width>a.height)h=b,p=a.width/a.height,g=0<p?d*p:d}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(c?h-0.25*h:h),a.setHeight(c?g-0.25*g:g)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);g=k.create("div",{"class":"imageDataGFX"},e);e=E.createSurface(g,b,d);a=Y.getShapeDescriptors(a);e.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:b/2,dy:d/2})}return g},_updateUI:function(a){this.styleName=
a},_toggleLayer:function(b,e){e.stopPropagation();var d=this.isDartTheme?" darkThemeColor":" lightThemeColor";this.map.infoWindow.hide();var l=b.id?b.id:b.layerObject.id,c=this.layerList[l];c||(c=this.layerList[l]);c||(b.pl&&(l=b.pl.id),c=this.layerList[l]);if(c){var g=!0;c.layerObject.hasOwnProperty("visibleAtMapScale")&&(g=c.layerObject.visibleAtMapScale);var k=!1;c.li&&c.li.hasOwnProperty("subLayerId")&&(k="undefined"!==typeof c.li.subLayerId);var p=q.byId("recLabel_"+l);if(a.contains("recIcon_"+
l,"active"))a.remove("recIcon_"+l,"active"),k&&"ClusterLayer"!==c.type?(k=c.layerObject.visibleLayers,g=k.indexOf(c.li.subLayerId),-1<g&&k.splice(g,1),c.layerObject.setVisibleLayers(k),c.layerObject.setVisibility(!0)):c&&(c.layerObject.setVisibility(!1),"undefined"!==typeof c.pl&&(c.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(l)&&(k=this.map.getLayer(l),k.setVisibility(!1)))),this.layerList[l].visible=!1,this.layerList[l].parentLayerVisible=!1,"ClusterLayer"===this.layerList[l].type&&(this.layerList[l].layerObject.parentLayerVisible=
!1),this._clearList(this.layerList[l]),this.config.countEnabled&&a.contains("recNum_"+l,"recNum")&&(a.remove("recNum_"+l,"recNum"),a.add("recNum_"+l,"recNumInActive"+d)),p&&p.firstChild&&a.add(p.firstChild,"inActive"),a.contains("exp_"+l,"expandInActive")||a.add("exp_"+l,"expandInActive"),c.legendOpen&&a.contains("legend_"+l,"legendOn")&&(this.layerList[l].legendOpen=!1,a.remove("legend_"+l,"legendOn"),a.add("legend_"+l,"legendOff"),d=this.isDartTheme?"expandDown-dart":"expandDown",p=this.isDartTheme?
"expandUp-dart":"expandUp",a.contains("exp_"+l,p)&&(a.remove("exp_"+l,p),a.add("exp_"+l,d))),c.toggleLegend&&c.toggleLegend.remove(),a.contains("rec_"+l,"rec")&&a.add("rec_"+l,"recDefault");else{a.add("recIcon_"+l,"active");k&&"ClusterLayer"!==c.type?(k=c.layerObject.visibleLayers,k.push(c.li.subLayerId),c.layerObject.setVisibleLayers(k),c.layerObject.setVisibility(!0)):c&&(c.layerObject.setVisibility(!0),"ClusterLayer"===c.type&&(c.layerObject.handleMapExtentChange({levelChange:!0}),c.layerObject.flashFeatures()),
this.layerList[l].visible=!0,this.layerList[l].parentLayerVisible=!0,"undefined"!==typeof c.pl&&(c.pl.visibility=!0,-1<this.map.graphicsLayerIds.indexOf(l)&&(k=this.map.getLayer(l),k.setVisibility(!0))));this.layerList[l].visible=!0;this.layerList[l].parentLayerVisible=!0;"ClusterLayer"===c.type&&(this.layerList[l].layerObject.parentLayerVisible=!0);this._loadList(c,!0);this.config.countEnabled&&a.contains("recNum_"+l,"recNumInActive")&&(a.remove("recNum_"+l,"recNumInActive"),a.add("recNum_"+l,"recNum"+
d));p&&p.firstChild&&a.remove(p.firstChild,"inActive");a.contains("exp_"+l,"expandInActive")&&g&&a.remove("exp_"+l,"expandInActive");c.toggleLegend&&c.toggleLegend.remove();if(d=q.byId("rec_"+l))c.toggleLegend=v(d,"click",h.hitch(this,this._toggleLegend,c));a.contains("rec_"+l,"recDefault")&&a.remove("rec_"+l,"recDefault")}}return!1},_toggleLegend:function(b,e){if("thumb2"!==e.currentTarget.className&&"recIcon"!==e.currentTarget.className){var d=b.layerObject.id in this.layerList?b.layerObject.id:
b.li.id;if(a.contains("legend_"+d,"legendOff"))this._addSearching(d),this.layerList[d].legendOpen=!0,"undefined"===typeof this.layerList[d].li.layerListExtentChanged&&(this.layerList[d].li.layerListExtentChanged=!0),this.layerList[d].li.layerListExtentChanged?setTimeout(h.hitch(this,function(){this._loadList(b,!1)}),500):this._removeSearching(d,!0),a.remove("legend_"+d,"legendOff"),a.add("legend_"+d,"legendOn");else if(a.contains("legend_"+d,"legendOn")){this.layerList[d].legendOpen=!1;var l=this.isDartTheme?
"expandDown-dart":"expandDown",c=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+d,c)&&(a.remove("exp_"+d,c),a.add("exp_"+d,l));a.remove("legend_"+d,"legendOn");a.add("legend_"+d,"legendOff")}}e.stopPropagation()},_toggleGroup:function(f,e){var d=e.currentTarget.id.slice(0,-2),l=this.isDartTheme?"featureItem-dart":"featureItem",c=!0;e.target.parentNode&&(""!==e.target.parentNode.id&&a.contains(e.target.parentNode.id,l)&&(c=!1),""!==e.target.id&&a.contains(e.target.id,l)&&(c=!1));var l=
this.isDartTheme?"groupItemImage-dart":"groupItemImage",g=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp",k=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";if(c){var c=f.layerObject.id in this.layerList?f.layerObject.id:f.li.id,h=document.getElementById(e.currentTarget.id),m=h.childNodes[0].childNodes.length-1;a.contains(d,"groupOff")?(this.layerList[c].openGroups&&0<this.layerList[c].openGroups.length?-1===this.layerList[c].openGroups.indexOf(d)&&this.layerList[c].openGroups.push(d):
this.layerList[c].openGroups=[d],a.remove(d,"groupOff"),a.add(d,"groupOn"),this.layerList[c].groupOpen=!0,-1<h.childNodes[0].childNodes[m].childNodes[0].className.indexOf(l)&&(b.removeClass(h.childNodes[0].childNodes[m].childNodes[0],k),b.addClass(h.childNodes[0].childNodes[m].childNodes[0],g))):a.contains(d,"groupOn")&&(a.remove(d,"groupOn"),a.add(d,"groupOff"),this.layerList[c].openGroups&&0<this.layerList[c].openGroups.length?(d=this.layerList[c].openGroups.indexOf(d),-1<d&&this.layerList[c].openGroups.splice(d,
1),0===this.layerList[c].openGroups.length&&(this.layerList[c].groupOpen=!1)):this.layerList[c].groupOpen=!1,-1<h.childNodes[0].childNodes[m].childNodes[0].className.indexOf(l)&&(b.removeClass(h.childNodes[0].childNodes[m].childNodes[0],g),b.addClass(e.currentTarget.childNodes[0].childNodes[m].childNodes[0],k)))}},onAppConfigChanged:function(a,b,d){switch(b){case "themeChange":this.inPanelOverrides(d);break;case "layoutChange":this.destroy();break;case "styleChange":this.hidePanel||this._updateUI(d);
this._updateStyleColor(d);break;case "widgetChange":this.widgetChange=!0;d&&(d.config&&d.config.layerInfos)&&this.removeOldClusterLayers(d.config.layerInfos);break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(h.hitch(this,function(){this.getPanel();var b;switch(this.appConfig.theme.name){default:b=this.pageHeader}b=window.getComputedStyle(b,null).getPropertyValue("background-color");this._styleColor=R.fromRgb(b).toHex();for(var d in this.layerList)b=this.layerList[d],
"ClusterLayer"===b.type&&b.layerObject.setStyleColor(this._styleColor);this._updateUI(a)}),50)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var b=this.layerList[a];if("ClusterLayer"===b.type){var d=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(d=!this.continuousRefreshEnabled);d&&(b.layerObject._clear(),this.map.removeLayer(b.layerObject))}}this.layerList={}}},setPosition:function(a,e){var d;this.hidePanel?(this.inherited(arguments),this.position=d={right:"0px",
bottom:"0px",top:"0px",height:"0px","z-index":"auto"},d=u.getPositionStyle(this.position),d.position="absolute",d.width="",e=this.map.id,b.place(this.domNode,e),b.setStyle(this.domNode,d)):"BoxTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"0px",top:"0px",height:"auto","z-index":"auto"},d=u.getPositionStyle(this.position),d.position="absolute",e=this.map.id,b.place(this.domNode,e),d.width="",b.setStyle(this.domNode,d),L.set(this.pageContent,"bottom",
"60px")):("DartTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"80px",top:"0px",height:"auto","z-index":"auto"},d=u.getPositionStyle(this.position),d.position="absolute",d.width="",e=this.map.id,b.place(this.domNode,e)):"LaunchpadTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"130px",top:"70px",height:"auto","z-index":"auto"},d=u.getPositionStyle(this.position),d.position="absolute",d.width="",e=this.map.id,
b.place(this.domNode,e)):470>=window.innerWidth?(this.position=d={right:"0px",bottom:"0px",height:"none","z-index":"auto",relativeTo:"browser"},d=u.getPositionStyle(this.position),d.position="absolute",d.width="",b.place(this.domNode,window.jimuConfig.layoutId),q.byId("map").style.bottom=window.innerHeight/2+"px"):(this.position=d={right:"0px",bottom:"0px",height:"none","z-index":"auto"},d=u.getPositionStyle(this.position),d.position="absolute",d.width="",b.place(this.domNode,this.map.id)),b.setStyle(this.domNode,
d))},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);for(var a in this.layerList){var b=this.layerList[a];b.li&&b.li.orgRenderer&&(b.layerObject.setRenderer?b.layerObject.setRenderer(b.li.orgRenderer):b.layerObject.setLayerDrawingOptions?b.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),b.layerObject.refresh())}a=!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);
a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);!this.hidePanel&&"undefined"!==typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0);this._resetMapDiv()},_resetMapDiv:function(){q.byId("map").style.bottom="0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},onUpdateEnd:function(a){a=this.layerList.hasOwnProperty(a.target.id)?a.target.id:
a.target.id+"_CL";if((a=this.layerList[a])&&a.visible)a.updateList?this._loadList(a,a.updateList):(this.config.countEnabled&&this.countFeatures(a),this._loadList(a,!0))},_mapExtentChange:function(){var f=this.config.countEnabled,e=[],d=[],l;for(l in this.layerList){var c=this.layerList[l],g=!0;c.layerObject.hasOwnProperty("visibleAtMapScale")&&(g=c.layerObject.visibleAtMapScale);if(!c.legendOpen||c.groupEnabled&&!c.groupOpen)if(this._clearList(c),c.li&&(c.li.layerListExtentChanged=!0),c.visible&&
g){if(c.li&&c.li.url&&"ClusterLayer"!==c.type&&"undefined"===typeof c.layerObject.queryCount){var h=c.li.url;if(-1<h.indexOf("MapServer")||-1<h.indexOf("FeatureServer"))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),g=new S,g.where=c.filter?c.filter:"1\x3d1",g.geometry=this.map.extent,g.returnGeometry=!1,h=new Z(h),e.push(h.executeForIds(g)),f?d.push(c.node):d.push(c.legendNode)}"ClusterLayer"===c.type&&(c.layerObject.initalLoad&&this.config.countEnabled)&&c.layerObject._updateNode(c.layerObject.node.innerHTML);
g=["StreamLayer","GeoRSS","KML"];"ClusterLayer"!==c.type&&("undefined"===typeof c.layerObject?console.log("layer object not known"):c.pl&&c.pl.featureSet?this.countFeatures(c):-1<g.indexOf(c.type)||"CSV"===c.pl.type?this.countFeatures(c):c.layerObject._autoSnapshot&&this.countFeatures(c))}else g||this._updateList([],c.legendNode,c.node,[],!0,c);else c.visible&&g?(c.updateList=!0,this._loadList(c,c.updateList)):this._updateList([],c.legendNode,c.node,[],!0,c)}0<e.length&&(this.promises=D(e).then(function(c){this.promises=
void 0;if(c)for(var e=0;e<c.length;e++){var g;c[e]?(a.contains(d[e].id,"searching")&&a.remove(d[e].id,"searching"),g=c[e].length):g=0;var l;f?(d[e].innerHTML=u.localizeNumber(g),l=d[e].parentNode):l=d[e].previousSibling;var h;-1<l.id.indexOf("rec_")&&(h=l.id.replace("rec_",""),h=q.byId("exp_"+h));0===g?(l&&(b.addClass(l,"recDefault"),b.addClass(l,"inActive")),h&&b.addClass(h,"expandInActive")):(l&&(b.removeClass(l,"recDefault"),b.removeClass(l,"inActive")),h&&b.removeClass(h,"expandInActive"))}}))},
getFeatures:function(a,b,d){var e=a.layerObject,c=a.legendNode,g=a.node,k=!0;e.hasOwnProperty("visibleAtMapScale")&&(k=e.visibleAtMapScale);var m=[],n=new S;n.geometry=this.map.extent;n.outFields=b;n.returnGeometry=!0;if(a.visible&&k)if(e.queryFeatures)m.push(e.queryFeatures(n));else{if(e=a.li.url,-1<e.indexOf("MapServer")||-1<e.indexOf("FeatureServer"))e=new Z(e),n.where=a.filter?a.filter:"1\x3d1",m.push(e.execute(n)),m.push(e.executeForIds(n))}else this._updateList([],a.legendNode,a.node,[],!0,
a);0<m.length&&(this.featurePromises&&(this.featurePromises.cancel("redundant",!1),this.featurePromises=void 0),D(m).then(h.hitch(this,function(e){var l;g&&(l=this.config.countEnabled?g.parentNode:g.previousSibling);e&&e[0]?e[0].features?setTimeout(h.hitch(this,function(){this._updateList(e[0].features,c,g,b,d,a);this.config.countEnabled&&1<e.length&&1E3<e[1].length&&(g.innerHTML=u.localizeNumber(e[1].length))}),100):0<e[0].length&&k?this._updateList(e[0],a.legendNode,a.node,[],!0,a,!0):this._updateList([],
a.legendNode,a.node,[],!0,a):(this.config.countEnabled&&(g.innerHTML=u.localizeNumber(0)),this.updateExpand(l,!0));this._removeSearching(a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,a.legendOpen)})))},_getInfoTemplate:function(a){var b;b=a.parentLayerInfo?a.parentLayerInfo:a;if(b.controlPopupInfo&&(a=b.controlPopupInfo.infoTemplates)&&b.layerObject&&b.layerObject.url)if(b=b.layerObject.url,b=b.split("/").pop())if(a.indexOf){if(-1<a.indexOf(b))return a[b].infoTemplate}else if(a.hasOwnProperty(b))return a[b].infoTemplate},
_clearList:function(a){a.legendNode&&(a.legendNode.innerHTML="")},_updateList:function(b,e,d,l,c,g,m){"ClusterLayer"===g.type&&g.layerObject.node&&a.contains(g.layerObject.node.id,"searching")&&a.remove(g.layerObject.node.id,"searching");var p;if("undefined"!==typeof g.li.subLayerId){var n=g.layerObject.infoTemplates;n&&n.hasOwnProperty(g.li.subLayerId)&&(p=n[g.li.subLayerId].infoTemplate)}n=g.li.symbolData.featureDisplayOptions;e.innerHTML="";c&&(d&&this.config.countEnabled)&&(d.innerHTML=u.localizeNumber(b.length));
this.updateExpand(this.config.countEnabled?d.parentNode:e.previousSibling,0===b.length);if(!m){if(0<b.length){var q;"ClusterLayer"===g.type?q=g.layerObject.renderer:b[0]._graphicsLayer?q=b[0]._graphicsLayer.renderer:g.li.renderer&&(q=ca.fromJson(g.li.renderer));c=[];m=[];d=[];var r=0;for(;r<b.length;r++){var s=b[r];"undefined"===typeof s.infoTemplate&&p&&(s.infoTemplate=p);var t;q&&q.getSymbol?t=q.getSymbol(s):s.symbol&&(t=Y.fromJson(s.symbol));var w,B;s._layer&&s._layer.objectIdField?(w=s.attributes[s._layer.objectIdField],
B=s._layer.objectIdField):g.li&&g.li.oidFieldName?(w=s.attributes[g.li.oidFieldName.name],B=g.li.oidFieldName.name):g.layerObject&&g.layerObject.objectIdField?(w=s.attributes[g.layerObject.objectIdField],B=g.layerObject.objectIdField):w=e.id+r;var P,A=!1;"*"===l[0]?P=s.attributes:(P=l,A=!0);A=this.getDisplayString(s,g,P,n,B,A);P=A.displayString;var J=A.aliasNames,H,F,K;if(n.groupEnabled){var C,z,D=void 0;if("undefined"===typeof n.groupByField||n.groupByField)A=n.groupField,C=s.attributes[A.name],
K="byField",D=C;else if(A=n.groupByRendererOptions.fields[0],C=s.attributes[A.name],H=n.groupByRendererOptions.values,K="byRenderer",null!==C&&""!==C){F=0;b:for(;F<H.length;F++){var I=H[F],y=I.value,y=(y=y.split("\x26\x26"))&&1<y.length?C+y[0]+"\x26\x26 "+C+y[1]:isNaN(C)?"'"+C+"'"+I.value:C+I.value;if(eval(y)){z=I;break b}}"undefined"!==typeof z&&null!==z&&(D=z.label.replace(/ /g,""))}H="group_"+g.li.id+"_"+A.name+"_"+D;var I=!0,G;if(0<c.length){F=0;b:for(;F<c.length;F++)if(y=c[F],H===y.id&&("byField"===
K&&C===y.value||"byRenderer"===K)){I=!1;G=y.node;F=y.parent;break b}}if(I){F=k.create("div",{"class":this.isDartTheme?"groupItem-dart":"groupItem",id:H+"_c"});var I=k.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:H+"_t"},F),y="",M="byRenderer"===K?"":A.name+": ";"undefined"!==typeof J&&J.hasOwnProperty(A.name)&&""!==J[A.name]&&(M="byField"===K?J[A.name]+": ":"");"byField"===K?"undefined"!==typeof A.label&&""!==A.label&&(M=y=A.label+": "):"undefined"!==typeof z?"undefined"!==
typeof z.label&&""!==z.label&&(M=y=M+z.label):M=y=M+C;": "===y&&(M=y="");J=C;this._checkDateField(g,A.name)&&(J=this.formatDateValue(C,A.name,g));var N=this._checkDomainField(g,A.name);N&&(J=this.formatDomainValue(C,N));"byRenderer"===K&&t&&this._createImageDataDiv(h.clone(t),30,30,I,E);k.create("div",{"class":"byField"===K?"groupField":"groupFieldImage",innerHTML:"byField"===K?y+J:y,title:"byField"===K?M+J:M},I);J=!1;g.openGroups&&0<g.openGroups.length&&(J=-1<g.openGroups.indexOf(H));E=k.create("div",
{"class":"groupCountLabel"+(this.isDartTheme?" darkThemeColor":" lightThemeColor")},I);I=k.create("div",{"class":"expandImageContainer"},I);y=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp";M=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";N=this.isDartTheme?"groupItemImage-dart":"groupItemImage";N+=J?" "+y:" "+M;k.create("div",{"class":N},I);N=this.isDartTheme?"groupItem-dart":"groupItem";N=g.groupOpen&&J?N+" groupOn":N+" groupOff";H=k.create("div",{"class":N,id:H},F);
c.push({id:"group_"+g.li.id+"_"+A.name+"_"+D,node:H,parent:F,value:C});m.push({value:C,node:F,countNode:E,count:1});v(F,"click",h.hitch(this,this._toggleGroup,g))}else m.filter(function(a){if(a.node.id===G.id+"_c")return a})[0].count+=1,H=G}w=k.create("div",{"class":this.isDartTheme?"featureItem-dart":"featureItem",id:"feature_"+g.li.id+"_"+w});var E=!1;g.li&&g.li.symbolData&&(E="CustomSymbol"===g.li.symbolData.symbolType);t&&!(n.groupEnabled&&"byRenderer"===K)&&this._createImageDataDiv(h.clone(t),
30,30,w,E);v(w,"click",h.hitch(this,this._panToFeature,s));-1<P.indexOf(" - ")&&(P=P.slice(0,-3));k.create("div",{style:"padding: 7px 5px 5px "+(n.groupEnabled&&"byRenderer"===K?"15px":"35px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:P,title:P},w);d.push({node:w,updateNode:H?H:e})}if(0<m.length){b=m.sort(function(a,b){return"undefined"===typeof a.value?b.value:"undefined"===typeof b.value?a.value:isNaN(a.value)?a.value.localeCompare(b.value):parseFloat(a.value)-parseFloat(b.value)});
var L=this.config.countEnabled;Q.forEach(b,function(a){L&&(a.countNode.innerHTML=u.localizeNumber(a.count));e.appendChild(a.node)})}0<d.length&&Q.forEach(d,function(a){k.place(a.node,a.updateNode)})}g.li.layerListExtentChanged=!1;this._removeSearching(g.layerObject.id in this.layerList?g.layerObject.id:g.li.id,g.legendOpen)}},updateDomainValues:function(a,b,d,e){var c,g,h,k;for(k in d)h=b?d[k]:k,c=this._checkDomainField(e,h),g=a.attributes[h],c&&(a.attributes[h]=this.formatDomainValue(g,c));return a},
updateExpand:function(a,e){if("undefined"!==typeof a){var d;-1<a.id.indexOf("rec_")&&(d=a.id.replace("rec_",""),d=q.byId("exp_"+d));e?(a&&(b.addClass(a,"recDefault"),b.addClass(a,"inActive")),d&&b.addClass(d,"expandInActive")):(a&&(b.removeClass(a,"recDefault"),b.removeClass(a,"inActive")),d&&b.removeClass(d,"expandInActive"))}},getDisplayString:function(a,b,d,e,c,g){var h,k,m,n="",q,s,r,t,u={},v;for(v in d)if(r=g?d[v]:v,k=this._checkDateField(b,r),m=this._checkDomainField(b,r),t=this._checkAliasName(b,
r),h=!0,e.fields&&0<e.fields.length&&(h=this._checkDisplayField(e.fields,r)),q=""!==h.label?": ":" ",s=a.attributes[r],k&&(s=this.formatDateValue(s,r,b)),m&&(s=this.formatDomainValue(s,m)),h&&(u[r]=t),t&&(r=t),h&&e.fields&&0<e.fields.length)n+=h.label+q+s+" - ";else if(h)if(c&&r!==c){n+=r+q+s;break}else if("undefined"===typeof c){n+=r+q+s;break}return{displayString:n,aliasNames:u}},formatDomainValue:function(a,b){if(b&&b.codedValues)for(var d=b.codedValues,e=0;e<d.length;e++){var c=d[e];if(c.code===
a)return c.name}},formatDateValue:function(a,b,d){if(a){var e,c;d.layerObject&&d.layerObject.infoTemplate?c=d.layerObject.infoTemplate:d.li&&d.li.infoTemplate&&(c=d.li.infoTemplate);if(c&&(d=c._fieldsMap))for(var g in d)if(d[g].fieldName===b){e=d[g].format;break}"undefined"===typeof e&&(e={dateFormat:"shortDate"});return u.fieldFormatter.getFormattedDate(new Date(a),e)}return""},_checkAliasName:function(a,b){var d=a.li.fields;if(d){for(var e=0;e<d.length;e++){var c=d[e];if(c.name===b)return"undefined"!==
typeof c.alias?c.alias:!1}return!1}},_checkDomainField:function(a,b){var d=a.li.fields;if(d){for(var e=0;e<d.length;e++){var c=d[e];if(c.name===b)return"undefined"!==typeof c.domain?c.domain:!1}return!1}},_checkDateField:function(a,b){var d=a.li.fields;if(d){for(var e=0;e<d.length;e++){var c=d[e];if(c.name===b){if("esriFieldTypeDate"===c.type)return!0;break}}return!1}},_checkDisplayField:function(a,b){var d=!0;if(a)for(var e=0;e<a.length;e++){if(a[e].name===b)return a[e];d=!1}return d},flashGraphics:function(a){for(var b=
0;b<a.length;b++)this._flashFeature(a[b])},_flashFeature:function(a){var b;if(a.geometry){var d=R.fromHex(this._styleColor),k=h.clone(d);k.a=0.4;switch(a.geometry.type){case "point":b=new w(w.STYLE_CIRCLE,15,new z(z.STYLE_SOLID,d,1),k);break;case "polyline":b=new z(z.STYLE_SOLID,d,3);break;case "polygon":b=new X(X.STYLE_DIAGONAL_CROSS,new z(z.STYLE_SOLID,d,2),k)}}a=new e(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())O.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,
end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type)var d=b.paths[Math.ceil(b.paths.length/2)-1],d=d[Math.ceil((d.length-1)/2)],b=new r(d[0],d[1],b.spatialReference);"point"!==b.type&&(b=b.getExtent().getCenter());this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),this.map.infoWindow.select(0),
this.map.infoWindow.show(b)}},countFeatures:function(a){var b=a.layerObject,d=this.config.countEnabled?a.node:a.legendNode;a=new S;a.geometry=this.map.extent;b.queryCount&&b.visible&&b.queryCount(a,h.hitch(this,function(a){if(d){var b;this.config.countEnabled?(d.innerHTML=u.localizeNumber(a),b=d.parentNode):b=d.previousSibling;this.updateExpand(b,0===a)}}))}})});