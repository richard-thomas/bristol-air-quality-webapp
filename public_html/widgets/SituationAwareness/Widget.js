// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(r,l,n,q,h,d,c,k,g,u,f){return r(u,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},
constructor:function(b){this._geocodeHandler=l.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=l.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=l.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(b){this.outSpatialReference=b},_geocodeHandler:function(b,t,c,e,k){try{var a=b.candidates,m;t=[];var g,d=a.length,u=b.spatialReference,h;for(g=0;g<d;g++){m=a[g];if(h=m.location)h.spatialReference=
u;t[g]=new f(m)}this._successHandler([t],"onAddressToLocationsComplete",c,k)}catch(w){this._errorHandler(w,e,k)}},_geocodeAddressesHandler:function(b,t,c,e,k){try{var a=b.locations;t=[];var m,g=a.length,d=b.spatialReference,u;for(m=0;m<g;m++){if(u=a[m].location)u.spatialReference=d;t[m]=new f(a[m])}this._successHandler([t],"onAddressesToLocationsComplete",c,k)}catch(h){this._errorHandler(h,e,k)}},addressToLocations:function(b,f,c,e,d){var a,m,v,u,A,x,w;b.address&&(e=c,c=f,f=b.outFields,d=b.searchExtent,
w=b.countryCode,a=b.magicKey,m=b.distance,x=b.categories,b.location&&this.normalization&&(v=b.location.normalize()),u=b.maxLocations,A=b.forStorage,b=b.address);d&&(d=d.shiftCentralMeridian());var n=this.outSpatialReference;b=this._encode(l.mixin({},this._url.query,b,{f:"json",outSR:n&&h.toJson(n.toJson()),outFields:f&&f.join(",")||null,searchExtent:d&&h.toJson(d.toJson()),category:x&&x.join(",")||null,countryCode:w||null,magicKey:a||null,distance:m||null,location:v||null,maxLocations:u||null,forStorage:A||
null}));var R=this._geocodeHandler,z=this._errorHandler,r=new q(g._dfdCanceller);r._pendingDfd=k({url:this._url.path+"/findAddressCandidates",content:b,callbackParamName:"callback",load:function(a,b){R(a,b,c,e,r)},error:function(a){z(a,e,r)}});return r},suggestLocations:function(b){var f;f=new q(g._dfdCanceller);b.hasOwnProperty("location")&&this.normalization&&(b.location=b.location.normalize());b.searchExtent&&(b.searchExtent=b.searchExtent.shiftCentralMeridian());b=this._encode(l.mixin({},this._url.query,
{f:"json",text:b.text,maxSuggestions:b.maxSuggestions,searchExtent:b.searchExtent&&h.toJson(b.searchExtent.toJson()),category:b.categories&&b.categories.join(",")||null,countryCode:b.countryCode||null,location:b.location||null,distance:b.distance||null},{f:"json"}));b=k({url:this._url.path+"/suggest",content:b,callbackParamName:"callback"});f._pendingDfd=b;b.then(l.hitch(this,function(b){b=b.suggestions||[];this.onSuggestLocationsComplete(b);f.resolve(b)}),l.hitch(this,function(b){this._errorHandler(b);
f.reject(b)}));return f},addressesToLocations:function(b,f,c){var e=this.outSpatialReference,d=[],a=b.categories,m=b.countryCode;n.forEach(b.addresses,function(a,b){d.push({attributes:a})});b=this._encode(l.mixin({},this._url.query,{category:a&&a.join(",")||null,sourceCountry:m||null},{addresses:h.toJson({records:d})},{f:"json",outSR:e&&h.toJson(e.toJson())}));var v=this._geocodeAddressesHandler,u=this._errorHandler,A=new q(g._dfdCanceller);A._pendingDfd=k({url:this._url.path+"/geocodeAddresses",
content:b,callbackParamName:"callback",load:function(a,b){v(a,b,f,c,A)},error:function(a){u(a,c,A)}});return A},_reverseGeocodeHandler:function(b,c,k,e,g){try{var a=new f({address:b.address,location:b.location,score:100});this._successHandler([a],"onLocationToAddressComplete",k,g)}catch(m){this._errorHandler(m,e,g)}},locationToAddress:function(b,f,c,e){b&&this.normalization&&(b=b.normalize());var d=this.outSpatialReference;b=this._encode(l.mixin({},this._url.query,{outSR:d&&h.toJson(d.toJson()),location:b&&
h.toJson(b.toJson()),distance:f,f:"json"}));var a=this._reverseGeocodeHandler,m=this._errorHandler,v=new q(g._dfdCanceller);v._pendingDfd=k({url:this._url.path+"/reverseGeocode",content:b,callbackParamName:"callback",load:function(b,f){a(b,f,c,e,v)},error:function(a){m(a,e,v)}});return v},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}})})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(r,l,n,q,h){return r(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(d){l.mixin(this,d);this.location=new h(this.location)}})})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(r,l,n,q,h,d,c,k){return r(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,
outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var g={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},d=this.distances,f=this.outSpatialReference,b=this.bufferSpatialReference,t=n.map(this.geometries,function(b){b="extent"===b.type?c.fromExtent(b):b;return b.toJson()},this),s=this.geometries;if(s&&0<s.length){var e="extent"===s[0].type?"esriGeometryPolygon":k.getJsonType(s[0]);g.geometries=q.toJson({geometryType:e,
geometries:t});g.inSR=s[0].spatialReference.wkid?s[0].spatialReference.wkid:q.toJson(s[0].spatialReference.toJson())}d&&(g.distances=d.join(","));f&&(g.outSR=f.wkid?f.wkid:q.toJson(f.toJson()));b&&(g.bufferSR=b.wkid?b.wkid:q.toJson(b.toJson()));return g}})})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R,z,N,I,M,C,p,y,G,J,O,K,H,E,F,P,T){var L=r([w,m,v],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:T,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},constructor:function(a,b){l.mixin(this,e.widgets.attributeInspector);a=a||{};!a.featureLayer&&!a.layerInfos&&console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(a);this._layerInfos=a.layerInfos||[{featureLayer:a.featureLayer,options:a.options||[]}];this._layerInfos=
n.filter(this._layerInfos,function(a){return!a.disableAttributeUpdate});this._hideNavButtons=a.hideNavButtons||!1},postCreate:function(){if(n.every(this._layerInfos,function(a){return a.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var a=this._layerInfos.length;n.forEach(this._layerInfos,function(b){b=b.featureLayer;if(b.loaded)a--;else var p=q.connect(b,"onLoad",this,function(b){q.disconnect(p);p=null;a--;a||(this._initLayerInfos(),this._createAttachmentEditor(),
this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();n.forEach(this._aiConnects,q.disconnect);delete this._aiConnects;this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},
next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(a,b){b&&(this._createOnlyFirstTime=!0);this._updateSelection([a],b);this._updateUI()},onLayerSelectionChange:function(a,b,p){this._createOnlyFirstTime=!1;this._featureIdx=p===s.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){this._selection&&!(0>=this._selection.length)&&(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=
this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(a,b,p,e){},onLayerError:function(a,b,p,e){},onLayerEditsError:function(a,b,p,e){},onLayerEditsComplete:function(a,b,p,e){e=e||[];if(e.length){var f=this._selection,c=a.featureLayer.objectIdField;n.forEach(e,l.hitch(this,function(a){n.some(f,l.hitch(this,function(b,p){if(b.attributes[c]!==a.objectId)return!1;this._selection.splice(p,1);return!0}))}))}b=b||[];b.length&&(this._selection=R.findFeatures(b,a.featureLayer),this._featureIdx=
0);e=this._numFeatures=this._selection?this._selection.length:0;if(b.length){if(b=e?this._selection[this._featureIdx]:null)e=b.getLayer().getEditCapabilities(),(!e.canCreate||e.canUpdate)&&this._showFeature(b);this._updateUI()}p=p||[];if(p.length){var k=this._rollbackInfo;n.forEach(p,function(b){var e=R.findFeatures(p,a.featureLayer)[0];if(!b.success&&e.attributes[a.featureLayer.objectIdField]===b.objectId&&k){b=k.graphic.attributes[k.field.name];var f=n.filter(this._currentLInfo.fieldInfos,function(a){return a.fieldName===
k.field.name},this)[0].dijit;e.attributes[k.field.name]=b;this._setValue(f,b)}},this)}this._rollbackInfo=null},onFieldValueChange:function(a,b){var p=a.field,e=a.dijit,f=this._currentFeature,c=this._currentLInfo,k=p.name;if(""!==e.displayedValue&&"undefined"===typeof b&&!e.isValid())this._setValue(e,f.attributes[p.name]);else if(""!==e.displayedValue&&e.displayedValue!==b&&e.isValid&&!e.isValid())this._setValue(e,f.attributes[p.name]);else{b="undefined"===typeof b?null:b;if("esriFieldTypeDate"===
p.type){if(e instanceof Array){var y=e[0].getValue(),e=e[1].getValue();b=y&&e?new Date(y.getFullYear(),y.getMonth(),y.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()):y||e||null}else b=e.getValue();b=b&&b.getTime?b.getTime():b&&b.toGregorian?b.toGregorian().getTime():b}if(this._currentFeature.attributes[p.name]!==b){if(k===c.typeIdField){var m=this._findFirst(c.types,"id",b);n.forEach(c.fieldInfos,function(a){if((p=a.field)&&p.name!==c.typeIdField)a=a.dijit,this._setFieldDomain(a,
m,p)&&a&&(this._setValue(a,f.attributes[p.name]+""),!1===a.isValid()&&this._setValue(a,null))},this)}this.onAttributeChange(f,k,b)}}},onDeleteBtn:function(a){this._deleteFeature()},onNextFeature:function(a){this._onNextFeature(1)},onPreviousFeature:function(a){this._onNextFeature(-1)},onFirstFeature:function(a){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(a){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var a=this._layerInfos;this._editorTrackingInfos=
{};n.forEach(a,this._initLayerInfo,this)},_initLayerInfo:function(a){var b=a.featureLayer,p,e;this._userIds={};e=b.id;b.credential&&(this._userIds[e]=b.credential.userId);a.userId&&(this._userIds[e]=a.userId);this._connect(b,"onSelectionComplete",l.hitch(this,"onLayerSelectionChange",a));this._connect(b,"onSelectionClear",l.hitch(this,"onLayerSelectionClear",a));this._connect(b,"onEditsComplete",l.hitch(this,"onLayerEditsComplete",a));this._connect(b,"error",l.hitch(this,"onLayerError",a));this._connect(b,
"onUpdateEnd",l.hitch(this,"onLayerUpdateEnd",a));a.showAttachments=b.hasAttachments?f.isDefined(a.showAttachments)?a.showAttachments:!0:!1;a.hideFields=a.hideFields||[];a.htmlFields=a.htmlFields||[];a.isEditable=b.isEditable()?f.isDefined(a.isEditable)?a.isEditable:!0:!1;a.typeIdField=b.typeIdField;a.layerId=b.id;a.types=b.types;b.globalIdField&&(p=this._findFirst(a.fieldInfos,"fieldName",b.globalIdField),!p&&!a.showGlobalID&&a.hideFields.push(b.globalIdField));e=this._findFirst(a.fieldInfos,"fieldName",
b.objectIdField);!e&&!a.showObjectID&&a.hideFields.push(b.objectIdField);var c=this._getFields(a.featureLayer);if(c){var k=a.fieldInfos||[],k=n.map(k,function(a){return l.mixin({},a)});k.length?a.fieldInfos=n.filter(n.map(k,l.hitch(this,function(b){var p=b.stringFieldOption||(this._isInFields(b.fieldName,a.htmlFields)?L.STRING_FIELD_OPTION_RICHTEXT:L.STRING_FIELD_OPTION_TEXTBOX);return l.mixin(b,{field:this._findFirst(c,"name",b.fieldName),stringFieldOption:p})})),"return item.field;"):(c=n.filter(c,
l.hitch(this,function(b){return!this._isInFields(b.name,a.hideFields)})),a.fieldInfos=n.map(c,l.hitch(this,function(b){var p=this._isInFields(b.name,a.htmlFields)?L.STRING_FIELD_OPTION_RICHTEXT:L.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:b.name,field:b,stringFieldOption:p}})));a.showGlobalID&&!p&&k.push(this._findFirst(c,"name",b.globalIdField));a.showObjectID&&!e&&k.push(this._findFirst(c,"name",b.objectIdField));p=[];b.editFieldsInfo&&(b.editFieldsInfo.creatorField&&p.push(b.editFieldsInfo.creatorField),
b.editFieldsInfo.creationDateField&&p.push(b.editFieldsInfo.creationDateField),b.editFieldsInfo.editorField&&p.push(b.editFieldsInfo.editorField),b.editFieldsInfo.editDateField&&p.push(b.editFieldsInfo.editDateField));this._editorTrackingInfos[b.id]=p}},_createAttachmentEditor:function(){this._attachmentEditor=null;var a=n.filter(this._layerInfos,function(a){return a.showAttachments});a&&a.length&&(this._attachmentEditor=new Q({"class":"atiAttachmentEditor"},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(a){var b=this._currentLInfo?this._currentLInfo.featureLayer:null,p=a.featureLayer;if(b&&(b.id===p.id&&!b.ownershipBasedAccessControlForFeatures)&&(b=p.getEditCapabilities(),!b.canCreate||b.canUpdate))return;this._currentLInfo=a;this._createTable()},_updateSelection:function(a,b){this._selection=a||[];n.forEach(this._layerInfos,this._getSelection,this);var p=this._selection.length;this._numFeatures=this._selection.length;this._showFeature(p?this._selection[this._featureIdx]:
null,b)},_getSelection:function(a){a=a.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(a)},_updateUI:function(){var a=this._numFeatures,b=this._currentLInfo;this.layerName.innerHTML=!b||0===a?this.NLS_noFeaturesSelected:b.featureLayer?b.featureLayer.name:"";k.set(this.attributeTable,"display",a?"":"none");k.set(this.editButtons,"display",a?"":"none");k.set(this.navButtons,"display",!this._hideNavButtons&&1<a?"":"none");this.navMessage.innerHTML=f.substitute({idx:this._featureIdx+
1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&k.set(this._attachmentEditor.domNode,"display",b&&b.showAttachments&&a?"":"none");k.set(this.deleteBtn.domNode,"display",!(b&&!1===b.showDeleteButton)&&this._canDelete?"":"none");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(a){this._featureIdx+=a;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&
(this._featureIdx=0);a=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(a);this._updateUI();this.onNext(a)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(a,p){if(a){this._currentFeature=a;var e=p?p:a.getLayer(),c=e.getEditCapabilities({feature:a,userId:this._userIds[e.id]});this._canUpdate=c.canUpdate;this._canDelete=c.canDelete;if(c=this._getLInfoFromFeatureLayer(e)){this._setCurrentLInfo(c);var k=a.attributes,y=this._findFirst(c.types,
"id",k[c.typeIdField]),m=null;n.forEach(c.fieldInfos,function(a){m=a.field;var b=[];a.dijit&&1<a.dijit.length?n.forEach(a.dijit,function(a){b.push(a)}):b.push(a.dijit);n.forEach(b,l.hitch(this,function(a){if(a){var b=this._setFieldDomain(a,y,m),p=k[m.name],p=p&&b&&b.codedValues&&b.codedValues.length?b.codedValues[p]?b.codedValues[p].name:p:p;f.isDefined(p)||(p="");"dijit.form.DateTextBox"===a.declaredClass||"dijit.form.TimeTextBox"===a.declaredClass?p=""===p?null:new Date(p):"dijit.form.FilteringSelect"===
a.declaredClass&&(a._lastValueReported=null,p=k[m.name]+"");try{this._setValue(a,p),"dijit.form.FilteringSelect"===a.declaredClass&&!1===a.isValid()&&this._setValue(a,null)}catch(e){a.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&c.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,e);(e=e.getEditSummary(a))?(this.editorTrackingInfoDiv.innerHTML=e,b.show(this.editorTrackingInfoDiv)):b.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(a,
b,p){if(!a)return null;var e=p.domain;b&&b.domains&&b.domains[p.name]&&!1===b.domains[p.name]instanceof t&&(e=b.domains[p.name]);if(!e)return null;e.codedValues&&0<e.codedValues.length?(a.set("store",this._toStore(n.map(e.codedValues,function(a){return{id:a.code+="",name:a.name}}))),this._setValue(a,e.codedValues[0].code)):(a.constraints={min:f.isDefined(e.minValue)?e.minValue:Number.MIN_VALUE,max:f.isDefined(e.maxValue)?e.maxValue:Number.MAX_VALUE},this._setValue(a,a.constraints.min));return e},
_setValue:function(a,b){a.set&&(a._onChangeActive=!1,a.set("value",b,!0),a._onChangeActive=!0)},_getFields:function(a){var b=a._getOutFields();if(!b)return null;a=a.fields;return"*"==b?a:n.filter(n.map(b,l.hitch(this,"_findFirst",a,"name")),f.isDefined)},_isInFields:function(a,b){return!a||!b&&!b.length?!1:n.some(b,function(b){return b.toLowerCase()===a.toLowerCase()})},_findFirst:function(a,b,p){return(a=n.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===p}))&&a.length?a[0]:null},_getLInfoFromFeatureLayer:function(a){return this._findFirst(this._layerInfos,
"layerId",a?a.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=g.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var a=g.create("tbody",null,this._attributes),b=this._currentLInfo,p=this._findFirst(b.types,"id",this._currentFeature.attributes[b.typeIdField]);n.forEach(b.fieldInfos,l.hitch(this,"_createField",p,a),this);this._createOnlyFirstTime=!1},_createField:function(a,b,p){var e=this._currentLInfo,c=p.field,
f=!1,k=null,y;if(!this._isInFields(c.name,e.hideFields)&&!this._isInFields(c.name,this._editorTrackingInfos[e.featureLayer.id])){b=g.create("tr",null,b);g.create("td",{innerHTML:p.label||c.alias||c.name,"class":"atiLabel"},b).setAttribute("data-fieldname",c.name);b=g.create("td",null,b);if(p.customField)g.place(p.customField.domNode||p.customField,g.create("div",null,b),"first"),y=p.customField;else if(!1===e.isEditable||!1===c.editable||!1===p.isEditable||"esriFieldTypeOID"===c.type||"esriFieldTypeGlobalID"===
c.type||!this._canUpdate&&!this._createOnlyFirstTime)f=!0;!y&&e.typeIdField&&c.name.toLowerCase()==e.typeIdField.toLowerCase()?y=this._createTypeField(c,p,b):y||(y=this._createDomainField(c,p,a,b));if(!y)switch(c.type){case "esriFieldTypeString":y=this._createStringField(c,p,b);break;case "esriFieldTypeDate":y=this._createDateField(c,p,b);p.format&&p.format.time&&(k=this._createTimeField(c,p,b));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":y=this._createIntField(c,p,b);break;
case "esriFieldTypeSingle":case "esriFieldTypeDouble":y=this._createFltField(c,p,b);break;default:y=this._createStringField(c,p,b)}p.tooltip&&p.tooltip.length&&this._toolTips.push(new K({connectId:[y.id],label:p.tooltip}));y.onChange=l.hitch(this,"onFieldValueChange",p);y.set("disabled",f);k?(p.dijit=[y,k],k.onChange=l.hitch(this,"onFieldValueChange",p),k.set("disabled",f)):p.dijit=y}},_createTypeField:function(a,b,p){return(b=a.domain)&&"range"===b.type&&b.minValue===b.maxValue?new I({"class":"atiField"},
g.create("div",null,p)):new C({"class":"atiField",name:a.alias||a.name,required:!a.nullable||!1,store:this._toStore(n.map(this._currentLInfo.types,function(a){return{id:a.id,name:a.name}})),searchAttr:"name"},g.create("div",null,p))},_createDomainField:function(a,b,e,c){b=a.domain;e&&e.domains&&e.domains[a.name]&&!1===e.domains[a.name]instanceof t&&(b=e.domains[a.name]);return!b?null:b.codedValues?new C({"class":"atiField",name:a.alias||a.name,searchAttr:"name",required:!a.nullable||!1},g.create("div",
null,c)):new p({"class":"atiField"},g.create("div",null,c))},_createStringField:function(a,b,p){var e={"class":"atiField",trim:!0,maxLength:a.length};return b.stringFieldOption===L.STRING_FIELD_OPTION_TEXTAREA?(e["class"]+=" atiTextAreaField",new G(e,g.create("div",null,p))):b.stringFieldOption===L.STRING_FIELD_OPTION_RICHTEXT?(e["class"]+=" atiRichTextField",e.height="100%",e.width="100%",e.plugins=b.richTextPlugins||"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),
a=new B(e,g.create("div",null,p)),a.startup(),a):!a.nullable||!b.field||!b.field.nullable?new J({required:!0},g.create("div",null,p)):new I(e,g.create("div",null,p))},_createTimeField:function(a,b,p){a={"class":"atiField",trim:!0,constraints:{formatLength:"medium"}};this._datePackage&&(a.datePackage=this._datePackage);return new O(a,g.create("div",null,p))},_createDateField:function(a,b,p){a={"class":"atiField",trim:!0};this._datePackage&&(a.datePackage=this._datePackage);return new N(a,g.create("div",
null,p))},_createIntField:function(a,b,p){return new M({"class":"atiField",constraints:"esriFieldTypeSmallInteger"===a.type?{min:-32768,max:32767,places:0}:{places:0},invalidMessage:this.NLS_validationInt,trim:!0},g.create("div",null,p))},_createFltField:function(a,b,p){var e=/\de[-+]?\d/i,c=/[0-9]\d{0,2}(\.\d{3})*(,\d+)?$/i;return new J({validator:function(a,b){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return""===a||null===a?!0:e.test(a)?!0:c.test(a)?("min"in b?0<=this.compare(a,b.min):
1)&&("max"in b?0>=this.compare(a,b.max):1)?!0:!1:!1},"class":"atiField",trim:!0,constraints:{places:"0,40",min:-Infinity,max:Infinity,exponent:!0},invalidMessage:this.NLS_validationFlt},g.create("div",null,p))},_toStore:function(a){return new H({data:{identifier:"id",label:"name",items:a}})},_connect:function(a,b,p){this._aiConnects.push(q.connect(a,b,p))},_getDatePackage:function(a){return null===a.datePackage?null:a.datePackage?a.datePackage:"ar"===d.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){n.forEach(this._layerInfos,
function(a){n.forEach(a.fieldInfos,function(a){var b=a.dijit;if(b){b._onChangeHandle=null;if(a.customField)return;b instanceof Array?n.forEach(b,l.hitch(this,function(a){a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy();a._onChangeHandle=null})):b.destroyRecursive?b.destroyRecursive():b.destroy&&b.destroy()}a.dijit=null},this)},this);n.forEach(this._toolTips,function(a){a.destroy()});this._toolTips=[];this._attributes&&g.destroy(this._attributes)}});l.mixin(L,{STRING_FIELD_OPTION_RICHTEXT:"richtext",
STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});return L})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R){function z(a){return new B({command:a.name})}function N(a){return new B({buttonClass:v,command:a.name})}n=n("dijit.Editor",Q,{plugins:null,extraPlugins:null,constructor:function(){f.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",A]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(b("ie")||b("trident")||b("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new q;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);f.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=h.getLocalization("dijit._editor",
"commands",this.lang);b("webkit")&&g.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new D({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));l.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);c.add(this.iframe.parentNode,"dijitEditorIFrameContainer");c.add(this.iframe,"dijitEditorIFrame");d.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){l.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(a,b){var e=f.isString(a)?{name:a}:f.isFunction(a)?{ctor:a}:a;if(!e.setEditor){var p={args:e,plugin:null,editor:this};e.name&&(B.registry[e.name]?p.plugin=B.registry[e.name](e):s.publish(R._scopeName+".Editor.getPlugin",p));if(!p.plugin)try{var c=
e.ctor||f.getObject(e.name)||r(e.name);c&&(p.plugin=new c(e))}catch(k){throw Error(this.id+": cannot find plugin ["+e.name+"]");}if(!p.plugin)throw Error(this.id+": cannot find plugin ["+e.name+"]");a=p.plugin}1<arguments.length?this._plugins[b]=a:this._plugins.push(a);a.setEditor(this);f.isFunction(a.setToolbar)&&a.setToolbar(this.toolbar)},resize:function(a){a&&m.prototype.resize.apply(this,arguments)},layout:function(){var a=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+k.getPadBorderExtents(this.iframe.parentNode).h+
k.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=a+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(a){var b,e=this.document.body,p=e.clientWidth,c=e.clientHeight,f=e.clientLeft,k=e.offsetWidth,m=e.offsetHeight,t=e.offsetLeft;/^rtl$/i.test(e.dir||"")?p<k&&(a.x>p&&a.x<k)&&(b=!0):a.x<f&&a.x>t&&(b=!0);b||c<m&&(a.y>c&&a.y<m)&&(b=!0);b||(delete this._cursorToStart,delete this._savedSelection,"BODY"==a.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0);"BODY"!=a.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(a){this._inEditing||(this._inEditing=!0,this._beginEditing(a));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(a){if(this.customUndo&&
("undo"==a||"redo"==a))return this[a]();this.customUndo&&(this.endEditing(),this._beginEditing());var b=this.inherited(arguments);this.customUndo&&this._endEditing();return b},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(a){var e;try{if(e=this.document.execCommand(a,!1,null),b("webkit")&&!e)throw{};}catch(c){e=t.substitute,alert(e(this.commands.systemShortcut,
[this.commands[a],e(this.commands[b("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[a]])])),e=!1}return e},queryCommandEnabled:function(a){return this.customUndo&&("undo"==a||"redo"==a)?"undo"==a?1<this._steps.length:0<this._undoedSteps.length:this.inherited(arguments)},_moveToBookmark:function(a){var e=a.mark,c=a.mark;a=a.isCollapsed;var p,k,m;if(c)if(9>b("ie")||9===b("ie")&&b("quirks"))if(f.isArray(c))e=[],l.forEach(c,function(a){e.push(w.getNode(a,this.editNode))},this),this.selection.moveToBookmark({mark:e,
isCollapsed:a});else{if(c.startContainer&&c.endContainer&&(m=w.getSelection(this.window))&&m.removeAllRanges)m.removeAllRanges(),a=w.create(this.window),p=w.getNode(c.startContainer,this.editNode),k=w.getNode(c.endContainer,this.editNode),p&&k&&(a.setStart(p,c.startOffset),a.setEnd(k,c.endOffset),m.addRange(a))}else if((m=w.getSelection(this.window))&&m.removeAllRanges)m.removeAllRanges(),a=w.create(this.window),p=w.getNode(c.startContainer,this.editNode),k=w.getNode(c.endContainer,this.editNode),
p&&k&&(a.setStart(p,c.startOffset),a.setEnd(k,c.endOffset),m.addRange(a))},_changeToStep:function(a,b){this.setValue(b.text);var e=b.bookmark;e&&this._moveToBookmark(e)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._steps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0);delete this._undoRedoActive}return a},
redo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._undoedSteps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0);delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var a=this.selection.getBookmark(),
e=[];if(a&&a.mark){var c=a.mark;if(9>b("ie")||9===b("ie")&&b("quirks")){var p=w.getSelection(this.window);if(f.isArray(c))l.forEach(a.mark,function(a){e.push(w.getIndex(a,this.editNode).o)},this),a.mark=e;else if(p){var k;p.rangeCount&&(k=p.getRangeAt(0));a.mark=k?k.cloneRange():this.selection.getBookmark()}}try{a.mark&&a.mark.startContainer&&(e=w.getIndex(a.mark.startContainer,this.editNode).o,a.mark={startContainer:e,startOffset:a.mark.startOffset,endContainer:a.mark.endContainer===a.mark.startContainer?
e:w.getIndex(a.mark.endContainer,this.editNode).o,endOffset:a.mark.endOffset})}catch(m){a.mark=null}}return a},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:x.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var a=x.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:a,bookmark:this._getBookmark()})},onKeyDown:function(a){!b("ie")&&(!this.iframe&&a.keyCode==u.TAB&&!this.tabIndent)&&this._saveSelection();if(this.customUndo){var e=
a.keyCode;if(a.ctrlKey&&!a.shiftKey&&!a.altKey){if(90==e||122==e){a.stopPropagation();a.preventDefault();this.undo();return}if(89==e||121==e){a.stopPropagation();a.preventDefault();this.redo();return}}this.inherited(arguments);switch(e){case u.ENTER:case u.BACKSPACE:case u.DELETE:this.beginEditing();break;case 88:case 86:if(a.ctrlKey&&!a.altKey&&!a.metaKey){this.endEditing();88==a.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!a.ctrlKey&&!a.altKey&&
!a.metaKey&&(a.keyCode<u.F1||a.keyCode>u.F15)){this.beginEditing();break}case u.ALT:this.endEditing();break;case u.UP_ARROW:case u.DOWN_ARROW:case u.LEFT_ARROW:case u.RIGHT_ARROW:case u.HOME:case u.END:case u.PAGE_UP:case u.PAGE_DOWN:this.endEditing(!0);case u.CTRL:case u.SHIFT:case u.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(a){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="\x26#160;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(a){this.setValueDeferred.then(f.hitch(this,function(){!this.disabled&&a||!this._buttonEnabledPlugins&&a?
l.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!a&&l.forEach(this._plugins,function(a){a.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&g.set(this.document.body,"color",g.get(this.iframe,"color"))}catch(a){}}});f.mixin(B.registry,{undo:z,redo:z,cut:z,copy:z,paste:z,insertOrderedList:z,insertUnorderedList:z,indent:z,outdent:z,justifyCenter:z,justifyFull:z,justifyLeft:z,justifyRight:z,
"delete":z,selectAll:z,removeFormat:z,unlink:z,insertHorizontalRule:z,bold:N,italic:N,underline:N,strikethrough:N,subscript:N,superscript:N,"|":function(){return new B({setEditor:function(b){this.editor=b;this.button=new a({ownerDocument:b.ownerDocument})}})}});return n})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(r,l,n,q,h,d,c,k){n("dijit-legacy-requires")&&h(0,function(){r(["dijit/ToolbarSeparator"])});
return l("dijit.Toolbar",[d,k,c],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],function(r,l,n,q){return r("dijit.ToolbarSeparator",[n,q],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',
buildRendering:function(){this.inherited(arguments);l.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(r,l,n,q,h){l=l("dijit._editor._Plugin",q,{constructor:function(d){this.params=d||{};n.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:h,
disabled:!1,getLabel:function(d){return this.editor.commands[d]},_initButton:function(){if(this.command.length){var d=this.getLabel(this.command),c=this.editor,k=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(d=n.mixin({label:d,ownerDocument:c.ownerDocument,dir:c.dir,lang:c.lang,showLabel:!1,iconClass:k,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete d.name,this.button=new this.buttonClass(d))}this.get("disabled")&&
this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(d,c,k){this.own(r.connect(d,c,this,k))},updateState:function(){var d=this.editor,c=this.command,k,g;if(d&&d.isLoaded&&c.length){var u=this.get("disabled");if(this.button)try{g=!u&&d.queryCommandEnabled(c),this.enabled!==g&&(this.enabled=g,this.button.set("disabled",!g)),g&&"boolean"==typeof this.button.checked&&(k=d.queryCommandState(c),
this.checked!==k&&(this.checked=k,this.button.set("checked",d.queryCommandState(c))))}catch(f){console.log(f)}}},setEditor:function(d){this.editor=d;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",n.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",n.hitch(this,"updateState")))},setToolbar:function(d){this.button&&
d.addChild(this.button)},set:function(d,c){if("object"===typeof d){for(var k in d)this.set(k,d[k]);return this}k=this._getAttrNames(d);if(this[k.s])var g=this[k.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(d,c);return g||this},get:function(d){var c=this._getAttrNames(d);return this[c.g]?this[c.g]():this[d]},_setDisabledAttr:function(d){this._set("disabled",d);this.updateState()},_getAttrNames:function(d){var c=this._attrPairNames;if(c[d])return c[d];var k=d.charAt(0).toUpperCase()+
d.substr(1);return c[d]={s:"_set"+k+"Attr",g:"_get"+k+"Attr"}},_set:function(d,c){this[d]=c}});l.registry={};return l})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(r,l,n,q,h,d,c,k,g,u,f){return r("dijit._editor.plugins.EnterKeyHandling",g,{blockNodeForEnter:"BR",constructor:function(b){b&&("blockNodeForEnter"in b&&(b.blockNodeForEnter=
b.blockNodeForEnter.toUpperCase()),q.mixin(this,b))},setEditor:function(b){if(this.editor!==b)if(this.editor=b,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,b.onLoadDeferred.then(q.hitch(this,function(c){this.own(h(b.document,"keydown",q.hitch(this,function(b){if(b.keyCode==n.ENTER){var c=q.mixin({},b);c.shiftKey=!0;this.handleEnterKey(c)||(b.stopPropagation(),b.preventDefault())}})));9<=d("ie")&&10>=d("ie")&&this.own(h(b.document,"paste",q.hitch(this,function(b){setTimeout(q.hitch(this,
function(){var b=this.editor.document.selection.createRange();b.move("character",-1);b.select();b.move("character",1);b.select()}),0)})));return c}));else if(this.blockNodeForEnter){var c=q.hitch(this,"handleEnterKey");b.addKeyHandler(13,0,0,c);b.addKeyHandler(13,0,1,c);this.own(this.editor.on("KeyPressed",q.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var b=this.editor.selection.getAncestorElement("LI");if(b){d("mozilla")&&
"LI"==b.parentNode.parentNode.nodeName&&(b=b.parentNode.parentNode);var c=b.firstChild;if(c&&1==c.nodeType&&("UL"==c.nodeName||"OL"==c.nodeName))b.insertBefore(c.ownerDocument.createTextNode("\u00a0"),c),c=f.create(this.editor.window),c.setStart(b.firstChild,0),b=f.getSelection(this.editor.window,!0),b.removeAllRanges(),b.addRange(c)}else u.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(b=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(b.innerHTML=
this.bogusHtmlContent,9>=d("ie")&&(b=this.editor.document.selection.createRange(),b.move("character",-1),b.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(b){var c,g,e,h,a=this.editor.document,
m,v,B;if(b.shiftKey){b=this.editor.selection.getParentElement();if(h=f.getAncestor(b,this.blockNodes)){if("LI"==h.tagName)return!0;b=f.getSelection(this.editor.window);c=b.getRangeAt(0);c.collapsed||(c.deleteContents(),b=f.getSelection(this.editor.window),c=b.getRangeAt(0));if(f.atBeginningOfContainer(h,c.startContainer,c.startOffset))m=a.createElement("br"),c=f.create(this.editor.window),h.insertBefore(m,h.firstChild),c.setStartAfter(m),b.removeAllRanges(),b.addRange(c);else if(f.atEndOfContainer(h,
c.startContainer,c.startOffset))c=f.create(this.editor.window),m=a.createElement("br"),h.appendChild(m),h.appendChild(a.createTextNode("\u00a0")),c.setStart(h.lastChild,0),b.removeAllRanges(),b.addRange(c);else return(v=c.startContainer)&&3==v.nodeType?(B=v.nodeValue,g=a.createTextNode(B.substring(0,c.startOffset)),e=a.createTextNode(B.substring(c.startOffset)),h=a.createElement("br"),""==e.nodeValue&&d("webkit")&&(e=a.createTextNode("\u00a0")),l.place(g,v,"after"),l.place(h,g,"after"),l.place(e,
h,"after"),l.destroy(v),c=f.create(this.editor.window),c.setStart(e,0),b.removeAllRanges(),b.addRange(c),!1):!0}else if(b=f.getSelection(this.editor.window),b.rangeCount){if((c=b.getRangeAt(0))&&c.startContainer)c.collapsed||(c.deleteContents(),b=f.getSelection(this.editor.window),c=b.getRangeAt(0)),(v=c.startContainer)&&3==v.nodeType?(h=c.startOffset,v.length<h&&(e=this._adjustNodeAndOffset(v,h),v=e.node,h=e.offset),B=v.nodeValue,g=a.createTextNode(B.substring(0,h)),e=a.createTextNode(B.substring(h)),
h=a.createElement("br"),e.length||(e=a.createTextNode("\u00a0")),g.length?l.place(g,v,"after"):g=v,l.place(h,g,"after"),l.place(e,h,"after"),l.destroy(v)):(0<=c.startOffset&&(m=v.childNodes[c.startOffset]),h=a.createElement("br"),e=a.createTextNode("\u00a0"),m?(l.place(h,m,"before"),l.place(e,h,"after")):(v.appendChild(h),v.appendChild(e))),c=f.create(this.editor.window),c.setStart(e,0),c.setEnd(e,e.length),b.removeAllRanges(),b.addRange(c),this.editor.selection.collapse(!0)}else u.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var A=!0;b=f.getSelection(this.editor.window);c=b.getRangeAt(0);c.collapsed||(c.deleteContents(),b=f.getSelection(this.editor.window),c=b.getRangeAt(0));m=f.getBlockAncestor(c.endContainer,null,this.editor.editNode);var x=m.blockNode;if(this._checkListLater=x&&("LI"==x.nodeName||"LI"==x.parentNode.nodeName))return d("mozilla")&&(this._pressedEnterInBlock=x),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(x.innerHTML)&&
(x.innerHTML="",d("webkit")&&(c=f.create(this.editor.window),c.setStart(x,0),b.removeAllRanges(),b.addRange(c)),this._checkListLater=!1),!0;if(!m.blockNode||m.blockNode===this.editor.editNode){try{u.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(w){}m={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(m.blockNode){if(m.blockNode!=this.editor.editNode&&!(m.blockNode.textContent||m.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(m.blockNode),!1}else m.blockNode=this.editor.editNode;b=f.getSelection(this.editor.window);c=b.getRangeAt(0)}x=a.createElement(this.blockNodeForEnter);x.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(m.blockNode);e=c.endOffset;A=c.endContainer;A.length<e&&(e=this._adjustNodeAndOffset(A,e),A=e.node,e=e.offset);if(f.atEndOfContainer(m.blockNode,A,e))m.blockNode===m.blockContainer?m.blockNode.appendChild(x):l.place(x,m.blockNode,"after"),A=!1,c=f.create(this.editor.window),
c.setStart(x,0),b.removeAllRanges(),b.addRange(c),this.editor.height&&k.scrollIntoView(x);else if(f.atBeginningOfContainer(m.blockNode,c.startContainer,c.startOffset))l.place(x,m.blockNode,m.blockNode===m.blockContainer?"first":"before"),x.nextSibling&&this.editor.height&&(c=f.create(this.editor.window),c.setStart(x.nextSibling,0),b.removeAllRanges(),b.addRange(c),k.scrollIntoView(x.nextSibling)),A=!1;else{m.blockNode===m.blockContainer?m.blockNode.appendChild(x):l.place(x,m.blockNode,"after");A=
!1;m.blockNode.style&&(x.style&&m.blockNode.style.cssText)&&(x.style.cssText=m.blockNode.style.cssText);if((v=c.startContainer)&&3==v.nodeType){e=c.endOffset;v.length<e&&(e=this._adjustNodeAndOffset(v,e),v=e.node,e=e.offset);B=v.nodeValue;g=a.createTextNode(B.substring(0,e));e=a.createTextNode(B.substring(e,B.length));l.place(g,v,"before");l.place(e,v,"after");l.destroy(v);for(g=g.parentNode;g!==m.blockNode;){B=a.createElement(g.tagName);g.style&&(B.style&&g.style.cssText)&&(B.style.cssText=g.style.cssText);
"FONT"===g.tagName&&(g.color&&(B.color=g.color),g.face&&(B.face=g.face),g.size&&(B.size=g.size));for(c=e;c;)v=c.nextSibling,B.appendChild(c),c=v;l.place(B,g,"after");e=B;g=g.parentNode}c=e;if(1==c.nodeType||3==c.nodeType&&c.nodeValue)x.innerHTML="";for(g=c;c;)v=c.nextSibling,x.appendChild(c),c=v}c=f.create(this.editor.window);a=g;if("BR"!==this.blockNodeForEnter){for(;a;)h=a,a=v=a.firstChild;h&&h.parentNode?(x=h.parentNode,c.setStart(x,0),b.removeAllRanges(),b.addRange(c),this.editor.height&&k.scrollIntoView(x),
d("mozilla")&&(this._pressedEnterInBlock=m.blockNode)):A=!0}else c.setStart(x,0),b.removeAllRanges(),b.addRange(c),this.editor.height&&k.scrollIntoView(x),d("mozilla")&&(this._pressedEnterInBlock=m.blockNode)}return A},_adjustNodeAndOffset:function(b,c){for(;b.length<c&&b.nextSibling&&3==b.nextSibling.nodeType;)c-=b.length,b=b.nextSibling;return{node:b,offset:c}},removeTrailingBr:function(b){if(b=/P|DIV|LI/i.test(b.tagName)?b:this.editor.selection.getParentOfType(b,["P","DIV","LI"]))b.lastChild&&
(1<b.childNodes.length&&3==b.lastChild.nodeType&&/^[\s\xAD]*$/.test(b.lastChild.nodeValue)||"BR"==b.lastChild.tagName)&&l.destroy(b.lastChild),b.childNodes.length||(b.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R,z,N,I,M){var C=n("dijit._editor.RichText",[w,Q],{constructor:function(a){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};a&&t.isString(a.value)&&(this.value=a.value);this.onLoadDeferred=new q},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[t.trim,t.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);a("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));a("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(a("ie")||a("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[t.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[t.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);v.publish(M._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var b=t.hitch(this,function(a,b){return function(){return!this.execCommand(a,b)}}),c={b:b("bold"),i:b("italic"),u:b("underline"),a:b("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:b("formatblock",
"h1"),2:b("formatblock","h2"),3:b("formatblock","h3"),4:b("formatblock","h4"),"\\":b("insertunorderedlist")};a("ie")||(c.Z=b("redo"));for(var e in c)this.addKeyHandler(e,!0,!1,c[e])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(C._editorCommandsLocalized)this._local2NativeFormatNames=C._local2NativeFormatNames,this._native2LocalFormatNames=C._native2LocalFormatNames;else{C._editorCommandsLocalized=!0;C._local2NativeFormatNames={};
C._native2LocalFormatNames={};this._local2NativeFormatNames=C._local2NativeFormatNames;this._native2LocalFormatNames=C._native2LocalFormatNames;for(var a="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),b="",c,e=0;c=a[e++];)b="l"!==c.charAt(1)?b+("\x3c"+c+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+c+"\x3e\x3cbr/\x3e"):b+("\x3c"+c+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+c+"\x3e\x3cbr/\x3e");var f=k.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:0.01},innerHTML:b});this.ownerDocumentBody.appendChild(f);
a=t.hitch(this,function(){for(var a=f.firstChild;a;)try{this.selection.selectElement(a.firstChild);var b=a.tagName.toLowerCase();this._local2NativeFormatNames[b]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[b]]=b;a=a.nextSibling.nextSibling}catch(c){}k.destroy(f)});this.defer(a)}},open:function(b){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new q;this.isClosed||this.close();v.publish(M._scopeName+"._editor.RichText::open",
this);1===arguments.length&&b.nodeName&&(this.domNode=b);var e=this.domNode,f;if(t.isString(this.value))f=this.value,e.innerHTML="";else if(e.nodeName&&"textarea"==e.nodeName.toLowerCase()){var g=this.textarea=e;this.name=g.name;f=g.value;e=this.domNode=this.ownerDocument.createElement("div");e.setAttribute("widgetId",this.id);g.removeAttribute("widgetId");e.cssText=g.cssText;e.className+=" "+g.className;k.place(e,g,"before");var m=t.hitch(this,function(){u.set(g,{display:"block",position:"absolute",
top:"-1000px"});if(a("ie")){var b=g.style;this.__overflow=b.overflow;b.overflow="hidden"}});a("ie")?this.defer(m,10):m();if(g.form){var w=g.value;this.reset=function(){this.getValue()!==w&&this.replaceValue(w)};s(g.form,"submit",t.hitch(this,function(){d.set(g,"disabled",this.disabled);g.value=this.getValue()}))}}else f=N.getChildrenHtml(e),e.innerHTML="";this.value=f;e.nodeName&&"LI"===e.nodeName&&(e.innerHTML=" \x3cbr\x3e");this.header=e.ownerDocument.createElement("div");e.appendChild(this.header);
this.editingArea=e.ownerDocument.createElement("div");e.appendChild(this.editingArea);this.footer=e.ownerDocument.createElement("div");e.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!l.useXDomain||l.allowXdRichTextSave)){if((f=h.byId(M._scopeName+"._editor.RichText.value"))&&""!==f.value)for(var m=f.value.split(this._SEPARATOR),D=0,A;A=m[D++];)if(A=A.split(this._NAME_CONTENT_SEP),A[0]===this.name){this.value=A[1];m=m.splice(D,1);f.value=m.join(this._SEPARATOR);
break}C._globalSaveHandler||(C._globalSaveHandler={},B.addOnUnload(function(){for(var a in C._globalSaveHandler){var b=C._globalSaveHandler[a];t.isFunction(b)&&b()}}));C._globalSaveHandler[this.id]=t.hitch(this,"_saveContent")}this.isClosed=!1;f=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");f.id=this.id+"_iframe";f.style.border="none";f.style.width="100%";this._layoutMode?f.style.height="100%":7<=a("ie")?(this.height&&(f.style.height=this.height),this.minHeight&&(f.style.minHeight=
this.minHeight)):f.style.height=this.height?this.height:this.minHeight;f.frameBorder=0;f._loadFunc=t.hitch(this,function(b){this.window=b;this.document=b.document;this.selection=new R.SelectionManager(b);a("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});m=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");m=11>a("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+m+"');document.close()":"javascript: '"+
m+"'";this.editingArea.appendChild(f);f.src=m;"LI"===e.nodeName&&(e.lastChild.style.marginTop="-1.2em");c.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var b=u.getComputedStyle(this.domNode),c;if(this["aria-label"])c=this["aria-label"];else{var k=e('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||h.byId(this["aria-labelledby"],this.ownerDocument);k&&(c=k.textContent||k.innerHTML||"")}var k="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(c?" aria-label\x3d'"+m.escape(c)+"'":"")+"\x3e\x3c/div\x3e",g=[b.fontWeight,b.fontSize,b.fontFamily].join(" "),d=b.lineHeight,d=0<=d.indexOf("px")?parseFloat(d)/parseFloat(b.fontSize):0<=d.indexOf("em")?parseFloat(d):"normal",v="",s=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(a){a=a.replace(/^;/ig,"")+";";var b=a.split(":")[0];if(b){var b=t.trim(b),b=b.toLowerCase(),c,e="";for(c=0;c<b.length;c++){var p=b.charAt(c);switch(p){case "-":c++,p=b.charAt(c).toUpperCase();default:e+=
p}}u.set(s.domNode,e,"")}v+=a+";"});this.iframe.setAttribute("title",c);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||f.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",c?"\x3ctitle\x3e"+m.escape(c)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",g,";\n",this.height||a("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",d,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",a("ie")||a("trident")||a("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",c?" aria-label\x3d'"+m.escape(c)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+v+"'\x3e",k,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var b="",c=0,e,f=x.get(this.ownerDocument);e=a[c++];)e=(new A(f.location,e)).toString(),this.editingAreaStyleSheets.push(e),b+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+e+'"/\x3e';return b},addStyleSheet:function(a){var b=a.toString(),c=x.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new A(c.location,b)).toString();-1<r.indexOf(this.editingAreaStyleSheets,b)||(this.editingAreaStyleSheets.push(b),
this.onLoadDeferred.then(t.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(b);else{var a=this.document.getElementsByTagName("head")[0],c=this.document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=b;a.appendChild(c)}})))},removeStyleSheet:function(a){var b=a.toString(),c=x.get(this.ownerDocument);if("."===b.charAt(0)||"/"!==b.charAt(0)&&!a.host)b=(new A(c.location,b)).toString();a=r.indexOf(this.editingAreaStyleSheets,b);-1!==a&&(delete this.editingAreaStyleSheets[a],
e('link[href\x3d"'+b+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(b){b=!!b;this._set("disabled",b);if(this.isLoaded){var c=a("ie")&&(this.isLoaded||!this.focusOnLoad);c&&(this.editNode.unselectable="on");this.editNode.contentEditable=!b;this.editNode.tabIndex=b?"-1":this.tabIndex;c&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(a("mozilla")&&!b&&this._mozSettingProps){b=this._mozSettingProps;for(var e in b)if(b.hasOwnProperty(e))try{this.document.execCommand(e,
!1,b[e])}catch(f){}}this._disabledOK=!0}},onLoad:function(b){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=I.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var c=this;this.beforeIframeNode=k.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=k.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){c.editNode.focus()};this.focusNode=
this.editNode;var e=this.events.concat(this.captureEvents),f=this.iframe?this.document:this.editNode;this.own.apply(this,r.map(e,function(a){var b=a.toLowerCase().replace(/^on/,"");return s(f,b,t.hitch(this,a))},this));this.own(s(f,"mouseup",t.hitch(this,"onClick")));a("ie")&&(this.own(s(this.document,"mousedown",t.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);a("webkit")&&(this._webkitListener=this.own(s(this.document,"mouseup",t.hitch(this,"onDisplayChanged")))[0],this.own(s(this.document,
"mousedown",t.hitch(this,function(a){(a=a.target)&&(a===this.document.body||a===this.document)&&this.defer("placeCursorAtEnd")}))));if(a("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(g){}this.isLoaded=!0;this.set("disabled",this.disabled);e=t.hitch(this,function(){this.setValue(b);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&D(t.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(e):e()},onKeyDown:function(c){if(c.keyCode===b.SHIFT||c.keyCode===b.ALT||c.keyCode===b.META||c.keyCode===b.CTRL)return!0;if(c.keyCode===b.TAB&&this.isTabIndent&&(c.stopPropagation(),c.preventDefault(),this.queryCommandEnabled(c.shiftKey?"outdent":"indent")))this.execCommand(c.shiftKey?"outdent":"indent");if(c.keyCode==b.TAB&&!this.isTabIndent&&!c.ctrlKey&&!c.altKey)return c.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>a("ie")&&(c.keyCode===b.BACKSPACE&&"Control"===this.document.selection.type)&&(c.stopPropagation(),c.preventDefault(),this.execCommand("delete"));a("ff")&&(c.keyCode===b.PAGE_UP||c.keyCode===b.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&c.preventDefault();var e=this._keyHandlers[c.keyCode],f=arguments;e&&!c.altKey&&r.some(e,function(a){if(!(a.shift^c.shiftKey)&&!(a.ctrl^(c.ctrlKey||c.metaKey)))return a.handler.apply(this,f)||c.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){f.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(a){this.document?d.set(this.document.body,"spellcheck",!a):this.onLoadDeferred.then(t.hitch(this,function(){d.set(this.document.body,"spellcheck",!a)}));this._set("disableSpellCheck",a)},addKeyHandler:function(a,b,c,e){"string"==
typeof a&&(a=a.toUpperCase().charCodeAt(0));t.isArray(this._keyHandlers[a])||(this._keyHandlers[a]=[]);this._keyHandlers[a].push({shift:c||!1,ctrl:b||!1,handler:e})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){!this.focused&&!this.disabled&&this.focus()},_onBlur:function(b){(a("ie")||a("trident"))&&this.defer(function(){I.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var c=this.getValue(!0);if(c!==this.value)this.onChange(c);
this._set("value",c)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!a("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>a("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(b,c){var e=b.toLowerCase();"formatblock"===e?a("safari")&&void 0===c&&(e="heading"):"hilitecolor"===e&&!a("mozilla")&&(e="backcolor");return e},_qcaCache:{},queryCommandAvailable:function(a){var b=this._qcaCache[a];return void 0!==
b?b:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(b){switch(b.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return a("ie")||a("trident")||a("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!a("webkit");default:return!1}},execCommand:function(b,c){var e;this.focused&&this.focus();b=this._normalizeCommand(b,c);if(void 0!==c){if("heading"===b)throw Error("unimplemented");if("formatblock"===
b&&(a("ie")||a("trident")))c="\x3c"+c+"\x3e"}var f="_"+b+"Impl";if(this[f])e=this[f](c);else if((c=1<arguments.length?c:null)||"createlink"!==b)e=this.document.execCommand(b,!1,c);this.onDisplayChanged();return e},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var b="_"+a+"EnabledImpl";return this[b]?this[b](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(b){return!1}},queryCommandValue:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);if(a("ie")&&"formatblock"===b)b=this._native2LocalFormatNames[this.document.queryCommandValue(b)];else if(a("mozilla")&&"hilitecolor"===b){var c;try{c=this.document.queryCommandValue("styleWithCSS")}catch(e){c=!1}this.document.execCommand("styleWithCSS",!1,!0);b=this.document.queryCommandValue(b);this.document.execCommand("styleWithCSS",
!1,c)}else b=this.document.queryCommandValue(b);return b},_sCall:function(a,b){return this.selection[a].apply(this.selection,b)},placeCursorAtStart:function(){this.focus();var b=!1;if(a("mozilla"))for(var c=this.editNode.firstChild;c;){if(3===c.nodeType){if(0<c.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(c);break}}else if(1===c.nodeType){var b=!0,e=c.tagName?c.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(e)?this.selection.selectElement(c):
this.selection.selectElementChildren(c);break}c=c.nextSibling}else b=!0,this.selection.selectElementChildren(this.editNode);b&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var b=!1;if(a("mozilla"))for(var c=this.editNode.lastChild;c;){if(3===c.nodeType){if(0<c.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(c);break}}else if(1===c.nodeType){b=!0;this.selection.selectElement(c.lastChild||c);break}c=c.previousSibling}else b=!0,this.selection.selectElementChildren(this.editNode);
b&&this.selection.collapse(!1)},getValue:function(a){return this.textarea&&(this.isClosed||!this.isLoaded)?this.textarea.value:this.isLoaded?this._postFilterContent(null,a):this.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(a){if(this.isLoaded){if(this.textarea&&(this.isClosed||!this.isLoaded))this.textarea.value=a;else{a=this._preFilterContent(a);var b=this.isClosed?this.domNode:this.editNode;b.innerHTML=a;this._preDomFilterContent(b)}this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(t.hitch(this,function(){this.setValue(a)}))},replaceValue:function(b){this.isClosed?this.setValue(b):this.window&&this.window.getSelection&&!a("mozilla")?this.setValue(b):this.window&&this.window.getSelection?(b=this._preFilterContent(b),this.execCommand("selectall"),this.execCommand("inserthtml",b),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(b);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var b=
a;r.forEach(this.contentPreFilters,function(a){a&&(b=a(b))});return b},_preDomFilterContent:function(a){a=a||this.editNode;r.forEach(this.contentDomPreFilters,function(b){b&&t.isFunction(b)&&b(a)},this)},_postFilterContent:function(a,b){var c;t.isString(a)?c=a:(a=a||this.editNode,this.contentDomPostFilters.length&&(b&&(a=t.clone(a)),r.forEach(this.contentDomPostFilters,function(b){a=b(a)})),c=N.getChildrenHtml(a));t.trim(c.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(c="");r.forEach(this.contentPostFilters,
function(a){c=a(c)});return c},_saveContent:function(){var a=h.byId(M._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,b){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");b||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){f.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return N.getNodeHtml(a)},getNodeChildrenHtml:function(a){f.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return N.getChildrenHtml(a)},close:function(b){if(!this.isClosed){arguments.length||(b=!0);b&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);a("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var e=this.textarea.style;e.position="";e.left=e.top="";a("ie")&&(e.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;k.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;c.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);C._globalSaveHandler&&delete C._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ \>])/gi,"\x3c$1b$2").replace(/<(\/)?em([ \>])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(b){if(!b)return!1;
if(a("ie")||a("trident")||a("edge"))return this.focused&&!this.disabled;var c=9>a("ie")?this.document.selection.createRange():this.document;try{return c.queryCommandEnabled(b)}catch(e){return!1}},_createlinkEnabledImpl:function(){var b=!0;return b=a("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var b=!0;return b=a("mozilla")||a("webkit")||a("ie")||a("trident")||a("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var b=!0;return b=a("mozilla")||a("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var b=!0;a("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("cut");return b},_copyEnabledImpl:function(){var b=!0;a("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("copy");
return b},_pasteEnabledImpl:function(){var b=!0;return a("webkit")?!0:b=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(b){return a("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,b)},_unlinkImpl:function(b){return this.queryCommandEnabled("unlink")&&(a("mozilla")||a("webkit"))?(b=this.selection.getAncestorElement("a"),this.selection.selectElement(b),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,b)},_hilitecolorImpl:function(b){var c;this._handleTextColorOrProperties("hilitecolor",b)||(a("mozilla")?(this.document.execCommand("styleWithCSS",!1,!0),console.log("Executing color command."),c=this.document.execCommand("hilitecolor",!1,b),this.document.execCommand("styleWithCSS",!1,!1)):c=this.document.execCommand("hilitecolor",!1,b));return c},_backcolorImpl:function(b){a("ie")&&(b=b?b:null);var c=this._handleTextColorOrProperties("backcolor",b);c||(c=this.document.execCommand("backcolor",
!1,b));return c},_forecolorImpl:function(b){a("ie")&&(b=b?b:null);var c=!1;(c=this._handleTextColorOrProperties("forecolor",b))||(c=this.document.execCommand("forecolor",!1,b));return c},_inserthtmlImpl:function(b){b=this._preFilterContent(b);var c=!0;if(9>a("ie")){var e=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var f=e.item(0);e.length;)e.remove(e.item(0));f.outerHTML=b}else e.pasteHTML(b);e.select()}else if(8>a("trident")){var g=z.getSelection(this.window);
if(g&&g.rangeCount&&g.getRangeAt){e=g.getRangeAt(0);e.deleteContents();var m=k.create("div");m.innerHTML=b;for(var d,f=this.document.createDocumentFragment();b=m.firstChild;)d=f.appendChild(b);e.insertNode(f);d&&(e=e.cloneRange(),e.setStartAfter(d),e.collapse(!1),g.removeAllRanges(),g.addRange(e))}}else a("mozilla")&&!b.length?this.selection.remove():c=this.document.execCommand("inserthtml",!1,b);return c},_boldImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),c=this._adaptIEFormatAreaAndExec("bold");
c||(c=this.document.execCommand("bold",!1,b));return c},_italicImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),c=this._adaptIEFormatAreaAndExec("italic");c||(c=this.document.execCommand("italic",!1,b));return c},_underlineImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),c=this._adaptIEFormatAreaAndExec("underline");c||(c=this.document.execCommand("underline",!1,b));return c},_strikethroughImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),
c=this._adaptIEFormatAreaAndExec("strikethrough");c||(c=this.document.execCommand("strikethrough",!1,b));return c},_superscriptImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),c=this._adaptIEFormatAreaAndExec("superscript");c||(c=this.document.execCommand("superscript",!1,b));return c},_subscriptImpl:function(b){var c=!1;if(a("ie")||a("trident"))this._adaptIESelection(),c=this._adaptIEFormatAreaAndExec("subscript");c||(c=this.document.execCommand("subscript",!1,b));return c},
_fontnameImpl:function(b){var c;if(a("ie")||a("trident"))c=this._handleTextColorOrProperties("fontname",b);c||(c=this.document.execCommand("fontname",!1,b));return c},_fontsizeImpl:function(b){var c;if(a("ie")||a("trident"))c=this._handleTextColorOrProperties("fontsize",b);c||(c=this.document.execCommand("fontsize",!1,b));return c},_insertorderedlistImpl:function(b){var c=!1;if(a("ie")||a("trident")||a("edge"))c=this._adaptIEList("insertorderedlist",b);c||(c=this.document.execCommand("insertorderedlist",
!1,b));return c},_insertunorderedlistImpl:function(b){var c=!1;if(a("ie")||a("trident")||a("edge"))c=this._adaptIEList("insertunorderedlist",b);c||(c=this.document.execCommand("insertunorderedlist",!1,b));return c},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var b=0;if(a&&a.childNodes){var c;for(c=0;c<a.childNodes.length;c++)var e=g.position(a.childNodes[c]),
b=b+e.h}return b},_isNodeEmpty:function(a,b){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],b):!0:3===a.nodeType?""===a.nodeValue.substring(b):!1},_removeStartingRangeFromRange:function(a,b){if(a.nextSibling)b.setStart(a.nextSibling,0);else{for(var c=a.parentNode;c&&null==c.nextSibling;)c=c.parentNode;c&&b.setStart(c.nextSibling,0)}return b},_adaptIESelection:function(){var a=z.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var b=a.getRangeAt(0),c=
b.startContainer,e=b.startOffset;3===c.nodeType&&e>=c.length&&c.nextSibling;)e-=c.length,c=c.nextSibling;for(var f=null;this._isNodeEmpty(c,e)&&c!==f;)f=c,b=this._removeStartingRangeFromRange(c,b),c=b.startContainer,e=0;a.removeAllRanges();a.addRange(b)}},_adaptIEFormatAreaAndExec:function(a){var b=z.getSelection(this.window),c=this.document,e,f,g,m,d,v,h;if(a&&b&&b.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);g=b.getRangeAt(0);m=g.startContainer;3===m.nodeType&&(f=g.endOffset,
m.length<f&&(f=this._adjustNodeAndOffset(e,f),m=f.node));for(;m&&m!==this.editNode;){e=m.tagName?m.tagName.toLowerCase():"";if(-1<r.indexOf(a,e)){h=m;break}m=m.parentNode}if(h&&(e=g.startContainer,a=c.createElement(h.tagName),k.place(a,h,"after"),e&&3===e.nodeType)){f=g.endOffset;e.length<f&&(f=this._adjustNodeAndOffset(e,f),e=f.node,f=f.offset);m=e.nodeValue;g=c.createTextNode(m.substring(0,f));var t=m.substring(f,m.length);t&&(d=c.createTextNode(t));k.place(g,e,"before");d&&(v=c.createElement("span"),
v.className="ieFormatBreakerSpan",k.place(v,e,"after"),k.place(d,v,"after"),d=v);k.destroy(e);g=g.parentNode;for(e=[];g!==h;){m=g.tagName;f={tagName:m};e.push(f);m=c.createElement(m);g.style&&(m.style&&g.style.cssText)&&(m.style.cssText=g.style.cssText,f.cssText=g.style.cssText);"FONT"===g.tagName&&(g.color&&(m.color=g.color,f.color=g.color),g.face&&(m.face=g.face,f.face=g.face),g.size&&(m.size=g.size,f.size=g.size));g.className&&(m.className=g.className,f.className=g.className);if(d)for(;d;)f=d.nextSibling,
m.appendChild(d),d=f;m.tagName==g.tagName?(v=c.createElement("span"),v.className="ieFormatBreakerSpan",k.place(v,g,"after"),k.place(m,v,"after")):k.place(m,g,"after");d=m;g=g.parentNode}if(d){if(1===d.nodeType||3===d.nodeType&&d.nodeValue)a.innerHTML="";for(;d;)f=d.nextSibling,a.appendChild(d),d=f}if(e.length){f=e.pop();d=c.createElement(f.tagName);f.cssText&&d.style&&(d.style.cssText=f.cssText);f.className&&(d.className=f.className);"FONT"===f.tagName&&(f.color&&(d.color=f.color),f.face&&(d.face=
f.face),f.size&&(d.size=f.size));for(k.place(d,a,"before");e.length;)f=e.pop(),h=c.createElement(f.tagName),f.cssText&&h.style&&(h.style.cssText=f.cssText),f.className&&(h.className=f.className),"FONT"===f.tagName&&(f.color&&(h.color=f.color),f.face&&(h.face=f.face),f.size&&(h.size=f.size)),d.appendChild(h),d=h;h=c.createTextNode(".");v.appendChild(h);d.appendChild(h)}else v=c.createElement("span"),v.className="ieFormatBreakerSpan",h=c.createTextNode("."),v.appendChild(h),k.place(v,a,"before");d=
z.create(this.window);d.setStart(h,0);d.setEnd(h,h.length);b.removeAllRanges();b.addRange(d);this.selection.collapse(!1);h.parentNode.innerHTML="";a.firstChild||k.destroy(a);return!0}return!1}g=b.getRangeAt(0);if((e=g.startContainer)&&3===e.nodeType)return f=g.startOffset,e.length<f&&(f=this._adjustNodeAndOffset(e,f),e=f.node,f=f.offset),m=e.nodeValue,g=c.createTextNode(m.substring(0,f)),t=m.substring(f),""!==t&&(d=c.createTextNode(m.substring(f))),v=c.createElement("span"),h=c.createTextNode("."),
v.appendChild(h),g.length?k.place(g,e,"after"):g=e,k.place(v,g,"after"),d&&k.place(d,v,"after"),k.destroy(e),d=z.create(this.window),d.setStart(h,0),d.setEnd(h,h.length),b.removeAllRanges(),b.addRange(d),c.execCommand(a),k.place(v.firstChild,v,"before"),k.destroy(v),d.setStart(h,0),d.setEnd(h,h.length),b.removeAllRanges(),b.addRange(d),this.selection.collapse(!1),h.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var b=z.getSelection(this.window);if(b.isCollapsed&&b.rangeCount&&
!this.queryCommandValue(a)){var c=b.getRangeAt(0),e=c.startContainer;if(e&&3==e.nodeType&&!c.startOffset)return c="ul","insertorderedlist"===a&&(c="ol"),a=this.document.createElement(c),c=k.create("li",null,a),k.place(a,e,"before"),c.appendChild(e),k.create("br",null,a,"after"),a=z.create(this.window),a.setStart(e,0),a.setEnd(e,e.length),b.removeAllRanges(),b.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(b,c){var e=z.getSelection(this.window),f=this.document,
g,m,d,v,h;c=c||null;if(b&&(e&&e.isCollapsed)&&e.rangeCount&&(m=e.getRangeAt(0),(g=m.startContainer)&&3===g.nodeType)){h=m.startOffset;g.length<h&&(m=this._adjustNodeAndOffset(g,h),g=m.node,h=m.offset);d=g.nodeValue;m=f.createTextNode(d.substring(0,h));""!==d.substring(h)&&(v=f.createTextNode(d.substring(h)));d=f.createElement("span");h=f.createTextNode(".");d.appendChild(h);f=f.createElement("span");d.appendChild(f);m.length?k.place(m,g,"after"):m=g;k.place(d,m,"after");v&&k.place(v,d,"after");k.destroy(g);
g=z.create(this.window);g.setStart(h,0);g.setEnd(h,h.length);e.removeAllRanges();e.addRange(g);if(a("webkit")){e="color";if("hilitecolor"===b||"backcolor"===b)e="backgroundColor";u.set(d,e,c);this.selection.remove();k.destroy(f);d.innerHTML="\x26#160;";this.selection.selectElement(d);this.focus()}else this.execCommand(b,c),k.place(d.firstChild,d,"before"),k.destroy(d),g.setStart(h,0),g.setEnd(h,h.length),e.removeAllRanges(),e.addRange(g),this.selection.collapse(!1),h.parentNode.removeChild(h);return!0}return!1},
_adjustNodeAndOffset:function(a,b){for(;a.length<b&&a.nextSibling&&3===a.nextSibling.nodeType;)b-=a.length,a=a.nextSibling;return{node:a,offset:b}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return e(".ieFormatBreakerSpan",a).forEach(function(a){for(;a.firstChild;)k.place(a.firstChild,a,"before");
k.destroy(a)}),a},_stripTrailingEmptyNodes:function(a){for(;a.lastChild&&(/^(p|div|br)$/i.test(a.lastChild.nodeName)&&0==a.lastChild.children.length&&/^[\s\xA0]*$/.test(a.lastChild.textContent||a.lastChild.innerText||"")||3===a.lastChild.nodeType&&/^[\s\xA0]*$/.test(a.lastChild.nodeValue));)k.destroy(a.lastChild);return a},_setTextDirAttr:function(a){this._set("textDir",a);this.onLoadDeferred.then(t.hitch(this,function(){this.editNode.dir=a}))}});return C})},"dijit/_editor/range":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/lang"],function(r,l,n){var q={getIndex:function(c,k){for(var g=[],d=[],f=c,b,h;c!=k;){var s=0;for(b=c.parentNode;h=b.childNodes[s++];)if(h===c){--s;break}g.unshift(s);d.unshift(s-b.childNodes.length);c=b}if(0<g.length&&3==f.nodeType){for(h=f.previousSibling;h&&3==h.nodeType;)g[g.length-1]--,h=h.previousSibling;for(h=f.nextSibling;h&&3==h.nodeType;)d[d.length-1]++,h=h.nextSibling}return{o:g,r:d}},getNode:function(c,k){if(!n.isArray(c)||0==c.length)return k;var g=k;
r.every(c,function(c){if(0<=c&&c<g.childNodes.length)g=g.childNodes[c];else return g=null,!1;return!0});return g},getCommonAncestor:function(c,k,g){g=g||c.ownerDocument.body;var d=function(b){for(var c=[];b;)if(c.unshift(b),b!==g)b=b.parentNode;else break;return c};c=d(c);k=d(k);for(var d=Math.min(c.length,k.length),f=c[0],b=1;b<d;b++)if(c[b]===k[b])f=c[b];else break;return f},getAncestor:function(c,k,g){for(g=g||c.ownerDocument.body;c&&c!==g;){var d=c.nodeName.toUpperCase();if(k.test(d))return c;
c=c.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(c,k,g){g=g||c.ownerDocument.body;k=k||q.BlockTagNames;for(var d=null,f;c&&c!==g;){var b=c.nodeName.toUpperCase();!d&&k.test(b)&&(d=c);!f&&/^(?:BODY|TD|TH|CAPTION)$/.test(b)&&(f=c);c=c.parentNode}return{blockNode:d,blockContainer:f||c.ownerDocument.body}},atBeginningOfContainer:function(c,k,g){var d=!1,f=0==g;!f&&3==k.nodeType&&/^[\s\xA0]+$/.test(k.nodeValue.substr(0,g))&&
(f=!0);if(f)for(d=!0;k&&k!==c;){if(k.previousSibling){d=!1;break}k=k.parentNode}return d},atEndOfContainer:function(c,k,g){var d=!1,f=g==(k.length||k.childNodes.length);!f&&3==k.nodeType&&/^[\s\xA0]+$/.test(k.nodeValue.substr(g))&&(f=!0);if(f)for(d=!0;k&&k!==c;){if(k.nextSibling){d=!1;break}k=k.parentNode}return d},adjacentNoneTextNode:function(c,d){for(var g=c,h=0-c.length||0,f=d?"nextSibling":"previousSibling";g&&3==g.nodeType;)h+=g.length,g=g[f];return[g,h]},create:function(c){c=c||window;return c.getSelection?
c.document.createRange():new d},getSelection:function(c,d){if(c.getSelection)return c.getSelection();var g=new h.selection(c);d||g._getCurrentSelection();return g}};if(!window.getSelection)var h=q.ie={cachedSelection:{},selection:function(c){this._ranges=[];this.addRange=function(c,g){this._ranges.push(c);g||c._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(c){return this._ranges[c]};this._getCurrentSelection=
function(){this.removeAllRanges();var k;k=c.document.selection.createRange();k="CONTROL"==c.document.selection.type.toUpperCase()?new d(h.decomposeControlRange(k)):new d(h.decomposeTextRange(k));k?(this.addRange(k,!0),this.isCollapsed=k.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(c){var d=c.item(0),g=c.item(c.length-1);c=d.parentNode;var h=g.parentNode,d=q.getIndex(d,c).o[0],g=q.getIndex(g,h).o[0]+1;return[c,d,h,g]},getEndPoint:function(c,d){var g=c.duplicate();g.collapse(!d);
var h="EndTo"+(d?"End":"Start"),f=g.parentElement(),b,t,s;0<f.childNodes.length?r.every(f.childNodes,function(e,a){var m;if(3!=e.nodeType)if(g.moveToElementText(e),0<g.compareEndPoints(h,c))if(s&&3==s.nodeType)b=s,m=!0;else return b=f,t=a,!1;else{if(a==f.childNodes.length-1)return b=f,t=f.childNodes.length,!1}else a==f.childNodes.length-1&&(b=e,m=!0);if(m&&b){b=(m=q.adjacentNoneTextNode(b)[0])?m.nextSibling:f.firstChild;var d=q.adjacentNoneTextNode(b);m=d[0];d=d[1];m?(g.moveToElementText(m),g.collapse(!1)):
g.moveToElementText(f);g.setEndPoint(h,c);t=g.text.length-d;return!1}s=e;return!0}):(b=f,t=0);if(!d&&1==b.nodeType&&t==b.childNodes.length){var e=b.nextSibling;e&&3==e.nodeType&&(b=e,t=0)}return[b,t]},setEndPoint:function(c,d,g){c=c.duplicate();var h;if(3!=d.nodeType)if(0<g){if(h=d.childNodes[g-1])if(3==h.nodeType)d=h,g=h.length;else if(h.nextSibling&&3==h.nextSibling.nodeType)d=h.nextSibling,g=0;else{c.moveToElementText(h.nextSibling?h:d);var f=h.parentNode;h=f.insertBefore(h.ownerDocument.createTextNode(" "),
h.nextSibling);c.collapse(!1);f.removeChild(h)}}else c.moveToElementText(d),c.collapse(!0);3==d.nodeType&&(h=q.adjacentNoneTextNode(d),f=h[0],h=h[1],f?(c.moveToElementText(f),c.collapse(!1),"inherit"!=f.contentEditable&&h++):(c.moveToElementText(d.parentNode),c.collapse(!0),c.move("character",1),c.move("character",-1)),g+=h,0<g&&c.move("character",g)!=g&&console.error("Error when moving!"));return c},decomposeTextRange:function(c){var d=h.getEndPoint(c),g=d[0],u=d[1],f=d[0],d=d[1];c.htmlText.length&&
(c.htmlText==c.text?d=u+c.text.length:(d=h.getEndPoint(c,!0),f=d[0],d=d[1]));return[g,u,f,d]},setRange:function(c,d,g,u,f,b){d=h.setEndPoint(c,d,g);c.setEndPoint("StartToStart",d);if(!b)var t=h.setEndPoint(c,u,f);c.setEndPoint("EndToEnd",t||d);return c}},d=q.W3CRange=l(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=
null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?q.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(c,d){d=parseInt(d);this.startContainer===c&&this.startOffset==d||(delete this._cachedBookmark,this.startContainer=c,this.startOffset=d,this.endContainer?this._updateInternal():
this.setEnd(c,d))},setEnd:function(c,d){d=parseInt(d);this.endContainer===c&&this.endOffset==d||(delete this._cachedBookmark,this.endContainer=c,this.endOffset=d,this.startContainer?this._updateInternal():this.setStart(c,d))},setStartAfter:function(c,d){this._setPoint("setStart",c,d,1)},setStartBefore:function(c,d){this._setPoint("setStart",c,d,0)},setEndAfter:function(c,d){this._setPoint("setEnd",c,d,1)},setEndBefore:function(c,d){this._setPoint("setEnd",c,d,0)},_setPoint:function(c,d,g,h){g=q.getIndex(d,
d.parentNode).o;this[c](d.parentNode,g.pop()+h)},_getIERange:function(){var c=(this._body||this.endContainer.ownerDocument.body).createTextRange();h.setRange(c,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return c},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var c=this.startContainer,d=this._getIERange();3===c.nodeType&&!this.startOffset&&this.setStartBefore(c);
d.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var c=new d([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);c._body=this._body;return c},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});n.setObject("dijit.range",q);return q})},"dijit/_editor/html":function(){define(["dojo/_base/array",
"dojo/_base/lang","dojo/sniff"],function(r,l,n){var q={};l.setObject("dijit._editor.html",q);var h=q.escapeXml=function(d,c){d=d.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");c||(d=d.replace(/'/gm,"\x26#39;"));return d};q.getNodeHtml=function(d){var c=[];q.getNodeHtmlHelper(d,c);return c.join("")};q.getNodeHtmlHelper=function(d,c){switch(d.nodeType){case 1:var k=d.nodeName.toLowerCase();if(!k||"/"==k.charAt(0))return"";c.push("\x3c",k);var g=
[],u={},f;if(n("dom-attributes-explicit")||n("dom-attributes-specified-flag"))for(var b=0;f=d.attributes[b++];){var t=f.name;if("_dj"!==t.substr(0,3)&&(!n("dom-attributes-specified-flag")||f.specified)&&!(t in u)){f=f.value;if("src"==t||"href"==t)d.getAttribute("_djrealurl")&&(f=d.getAttribute("_djrealurl"));8===n("ie")&&"style"===t&&(f=f.replace("HEIGHT:","height:").replace("WIDTH:","width:"));g.push([t,f]);u[t]=f}}else{var s=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML,u=s.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi),
s=s.substr(0,s.indexOf("\x3e"));r.forEach(u,function(b){if(b){var c=b.indexOf("\x3d");if(0<c&&(b=b.substring(0,c),"_dj"!=b.substr(0,3)))if(("src"==b||"href"==b)&&d.getAttribute("_djrealurl"))g.push([b,d.getAttribute("_djrealurl")]);else{var a;switch(b){case "style":a=d.style.cssText.toLowerCase();break;case "class":a=d.className;break;case "width":if("img"===k){(c=/width=(\S+)/i.exec(s))&&(a=c[1]);break}case "height":if("img"===k){(c=/height=(\S+)/i.exec(s))&&(a=c[1]);break}default:a=d.getAttribute(b)}null!=
a&&g.push([b,a.toString()])}}},this)}g.sort(function(b,c){return b[0]<c[0]?-1:b[0]==c[0]?0:1});for(u=0;f=g[u++];)c.push(" ",f[0],'\x3d"',"string"===typeof f[1]?h(f[1],!0):f[1],'"');switch(k){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":c.push(" /\x3e");break;case "script":c.push("\x3e",d.innerHTML,"\x3c/",k,"\x3e");break;default:c.push("\x3e"),d.hasChildNodes()&&q.getChildrenHtmlHelper(d,c),c.push("\x3c/",k,"\x3e")}break;case 4:case 3:c.push(h(d.nodeValue,
!0));break;case 8:c.push("\x3c!--",h(d.nodeValue,!0),"--\x3e");break;default:c.push("\x3c!-- Element not recognized - Type: ",d.nodeType," Name: ",d.nodeName,"--\x3e")}};q.getChildrenHtml=function(d){var c=[];q.getChildrenHtmlHelper(d,c);return c.join("")};q.getChildrenHtmlHelper=function(d,c){if(d)for(var h=d.childNodes||d,g=!n("ie")||h!==d,u,f=0;u=h[f++];)(!g||u.parentNode==d)&&q.getNodeHtmlHelper(u,c)};return q})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b){var t=l("dijit._editor.plugins.LinkDialog",u,{buttonClass:f,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=h.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(b){r("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),h.hitch(this,function(c,a,f){var k=this;this.tag="insertImage"==this.command?"img":"a";c=h.delegate(c.getLocalization("dijit","common",this.lang),c.getLocalization("dijit._editor",
"LinkDialog",this.lang));var s=this.dropDown=this.button.dropDown=new a({title:c[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:h.hitch(this,"setValue"),onOpen:function(){k._onOpenDialog();a.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(h.hitch(k,"_onCloseDialog"),0)}});c.urlRegExp=this.urlRegExp;c.id=f.getUniqueId(this.editor.id);this._uniqueId=c.id;this._setContent(s.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
g.substitute(this.linkDialogTemplate,c));s.startup();this._urlInput=f.byId(this._uniqueId+"_urlInput");this._textInput=f.byId(this._uniqueId+"_textInput");this._setButton=f.byId(this._uniqueId+"_setButton");this.own(f.byId(this._uniqueId+"_cancelButton").on("click",h.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",h.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",h.hitch(this,"_checkAndFixInput")));this._urlRegExp=RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=h.hitch(this,function(){var a=this._urlInput.get("value");return this._urlRegExp.test(a)||this._emailRegExp.test(a)});this.own(d(s.domNode,"keydown",h.hitch(this,h.hitch(this,function(a){a&&(a.keyCode==q.ENTER&&!a.shiftKey&&!a.metaKey&&!a.ctrlKey&&!a.altKey)&&!this._setButton.get("disabled")&&(s.onExecute(),s.execute(s.get("value")))}))));b()}))},_checkAndFixInput:function(){var b=this,c=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var a=c,f=!1,d=!1;a&&1<a.length&&(a=h.trim(a),0!==a.indexOf("mailto:")&&(0<a.indexOf("/")?-1===a.indexOf("://")&&"/"!==a.charAt(0)&&a.indexOf("./")&&0!==a.indexOf("../")&&b._hostRxp.test(a)&&(f=!0):b._userAtRxp.test(a)&&(d=!0)));f&&b._urlInput.set("value","http://"+a);d&&b._urlInput.set("value","mailto:"+a);b._setButton.set("disabled",!b._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(h.hitch(this,
function(){this.own(d(this.editor.editNode,"dblclick",h.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(b){this.dropDown.set({parserScope:"dojo",content:b})},_checkValues:function(b){b&&b.urlInput&&(b.urlInput=b.urlInput.replace(/"/g,"\x26quot;"));return b},setValue:function(e){this._onCloseDialog();if(9>c("ie")){var f=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===f.nodeType&&(f=f.parentNode);
f&&(f.nodeName&&f.nodeName.toLowerCase()!==this.tag)&&(f=this.editor.selection.getSelectedElement(this.tag));f&&(f.nodeName&&f.nodeName.toLowerCase()===this.tag)&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(f),this.editor.execCommand("unlink"))}e=this._checkValues(e);this.editor.execCommand("inserthtml",g.substitute(this.htmlTemplate,e));k("a",this.editor.document).forEach(function(a){!a.innerHTML&&!n.has(a,"name")&&a.parentNode.removeChild(a)},this)},_onCloseDialog:function(){this.editor.focused&&
this.editor.focus()},_getCurrentValues:function(b){var c,a,f;b&&b.tagName.toLowerCase()===this.tag?(c=b.getAttribute("_djrealurl")||b.getAttribute("href"),f=b.getAttribute("target")||"_self",a=b.textContent||b.innerText,this.editor.selection.selectElement(b,!0)):a=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:a||"",targetSelect:f||""}},_onOpenDialog:function(){var e,f;if(c("ie")){if(f=b.getSelection(this.editor.window),f.rangeCount){var a=f.getRangeAt(0);e=a.endContainer;
3===e.nodeType&&(e=e.parentNode);e&&(e.nodeName&&e.nodeName.toLowerCase()!==this.tag)&&(e=this.editor.selection.getSelectedElement(this.tag));if(!e||e.nodeName&&e.nodeName.toLowerCase()!==this.tag)if((f=this.editor.selection.getAncestorElement(this.tag))&&f.nodeName&&f.nodeName.toLowerCase()==this.tag)e=f,this.editor.selection.selectElement(e);else if(a.startContainer===a.endContainer&&(f=a.startContainer.firstChild)&&f.nodeName&&f.nodeName.toLowerCase()==this.tag)e=f,this.editor.selection.selectElement(e)}}else e=
this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(e))},_onDblClick:function(b){if(b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&n.get(b,"href"))){var c=this.editor;this.editor.selection.selectElement(b);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var a=this.button;setTimeout(function(){a.set("disabled",
!1);a.loadAndOpenDropDown().then(function(){a.dropDown.focus&&a.dropDown.focus()})},10)}}}),s=l("dijit._editor.plugins.ImgLinkDialog",[t],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(b){var c,a;b&&b.tagName.toLowerCase()===this.tag?(c=b.getAttribute("_djrealurl")||b.getAttribute("src"),a=b.getAttribute("alt"),this.editor.selection.selectElement(b,!0)):a=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:a||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(h.hitch(this,
function(){this.own(d(this.editor.editNode,"mousedown",h.hitch(this,"_selectTag")))}))},_selectTag:function(b){b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(b))},_checkValues:function(b){b&&b.urlInput&&(b.urlInput=b.urlInput.replace(/"/g,"\x26quot;"));b&&b.textInput&&(b.textInput=b.textInput.replace(/"/g,"\x26quot;"));return b},_onDblClick:function(b){if(b&&b.target&&(b=b.target,(b.tagName?b.tagName.toLowerCase():"")===this.tag&&n.get(b,
"src"))){var c=this.editor;this.editor.selection.selectElement(b);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var a=this.button;setTimeout(function(){a.set("disabled",!1);a.loadAndOpenDropDown().then(function(){a.dropDown.focus&&a.dropDown.focus()})},10)}}});u.registry.createLink=function(){return new t({command:"createLink"})};u.registry.insertImage=function(){return new s({command:"insertImage"})};t.ImgLinkDialog=s;return t})},
"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(r,l,n,q,h,d){var c=n("dijit._editor.plugins.TextColor",h,{buttonClass:d,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var c=this;this.button.loadDropDown=function(d){function h(f){c.button.dropDown=new f({dir:c.editor.dir,ownerDocument:c.editor.ownerDocument,
value:c.value,onChange:function(b){c.editor.execCommand(c.command,b)},onExecute:function(){c.editor.execCommand(c.command,this.get("value"))}});d()}"string"==typeof c.colorPicker?r([c.colorPicker],h):h(c.colorPicker)}},updateState:function(){var c=this.editor,d=this.command;if(c&&c.isLoaded&&d.length){if(this.button){var h=this.get("disabled");this.button.set("disabled",h);if(h)return;var f;try{f=c.queryCommandValue(d)||""}catch(b){f=""}}""==f&&(f="#000000");"transparent"==f&&(f="#ffffff");"string"==
typeof f?-1<f.indexOf("rgb")&&(f=l.fromRgb(f).toHex()):(f=((f&255)<<16|f&65280|(f&16711680)>>>16).toString(16),f="#000000".slice(0,7-f.length)+f);this.value=f;(c=this.button.dropDown)&&(c.get&&f!==c.get("value"))&&c.set("value",f,!1)}}});h.registry.foreColor=function(d){return new c(d)};h.registry.hiliteColor=function(d){return new c(d)};return c})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a){return r([u,f],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:D,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"(\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e)",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},
constructor:function(b,c){l.mixin(this,a.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=n.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=n.connect(this._uploadField,"onfocus",l.hitch(this,function(a){e.hide(this._attachmentError)}))},destroy:function(){q.forEach(this._aeConnects,n.disconnect);n.disconnect(this._uploadField_connect);n.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(a,b){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";q.forEach(this.domNode.children,function(a,b){e.show(a)});e.hide(this._attachmentError);if(a&&(this._featureLayer=a.getLayer()||b))if("esri.layers.FeatureLayer"!==this._featureLayer.declaredClass||!this._featureLayer.getEditCapabilities){if(!b||!b.getEditCapabilities())e.hide(this._uploadForm),q.forEach(this.domNode.children,function(a,b){e.hide(a)})}else this._currentLayerId=
this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:a}).canUpdate,this._oid=a.attributes[this._featureLayer.objectIdField],this._getAttachments(a)},_getAttachments:function(a){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
l.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){e.hide(this._attachmentError);!this._featureLayer||!this._featureLayer.addAttachment?this._tempUpload=this._uploadForm:(e.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,l.hitch(this,"_onAddAttachmentComplete"),l.hitch(this,"_onAddAttachmentError")))},_chainAttachment:function(a,b){this._tempUpload&&(e.show(this._attachmentProgress),b.addAttachment(a,this._tempUpload,l.hitch(this,
"_onAddAttachmentComplete"),l.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(a,b){e.show(this._attachmentProgress);this._featureLayer.deleteAttachments(a,[b],l.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(a){var b=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&
!this._layerEditingCap[this._currentLayerId].canUpdate?(b=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(b=this._listHtml+this._endHtml);var c=this._attachmentList;a=q.map(a,l.hitch(this,function(a){return s.substitute({href:a.url,name:a.name,oid:a.objectId,attid:a.id},b)}));c.innerHTML=a.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(a){e.hide(this._attachmentProgress.domNode);
var b=this._attachmentList,c=this._uploadField,f=c.value,d=f.lastIndexOf("\\");-1<d&&(f=f.substring(d+1,f.length));var f=f.replace(/\ /g,"_"),d=k.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()}),g=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(g=this._listHtml+this._endHtml);a=s.substitute({href:this._featureLayer._url.path+"/"+a.objectId+
"/attachments/"+a.attachmentId+(d?"?"+d:""),name:f,oid:a.objectId,attid:a.attachmentId},g);b.innerHTML=b.innerHTML==this.NLS_none?a:b.innerHTML+a;this._updateConnects();c.value=""},_onAddAttachmentError:function(a){e.hide(this._attachmentProgress.domNode);if(a&&s.isDefined(a.code)){var b=this._attachmentError;g.set(b,"innerHTML",(400===a.code?this.NLS_fileNotSupported:a.message||a.details&&a.details.length&&a.details[0])||this.NLS_error);e.show(b)}},_onDeleteAttachmentComplete:function(a){e.hide(this._attachmentProgress.domNode);
var b=this._attachmentList;if(q.every(a,function(a){return a.success})&&(h.query("#node_"+a[0].objectId+"_"+a[0].attachmentId).orphan(),!b.children||!b.children.length))b.innerHTML=this.NLS_none},_updateConnects:function(){q.forEach(this._aeConnects,n.disconnect);h.query(".deleteAttachment").forEach(function(a){this._aeConnects.push(n.connect(a,"onclick",l.hitch(this,"_deleteAttachment",this._oid,a.id)))},this)}})})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(r,l,n,q,h,d,c,k){return l("dijit.ProgressBar",[d,c],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:k,_indeterminateHighContrastImagePath:r.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(c){var d="rtl"==c.toLowerCase();n.toggle(this.domNode,"dijitProgressBarRtl",d);n.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&d);this.inherited(arguments)},update:function(c){q.mixin(this,c||{});c=this.internalProgress;var d=this.domNode,f=1;this.indeterminate?d.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(f=Math.min(parseFloat(this.progress)/100,1),this.progress=f*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),f=this.maximum?this.progress/this.maximum:0),d.setAttribute("aria-valuenow",this.progress));d.setAttribute("aria-labelledby",this.labelNode.id);d.setAttribute("aria-valuemin",0);d.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(f);n.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);n.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());c.style.width=100*f+"%";this.onChange()},_setValueAttr:function(c){this._set("value",
c);Infinity==c?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:c})},_setLabelAttr:function(c){this._set("label",c);this.update()},_setIndeterminateAttr:function(c){this._set("indeterminate",c);this.update()},report:function(c){return this.label?this.label:this.indeterminate?"\x26#160;":h.format(c,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(r,l,n,q){r={};return r={findFeatures:function(h,d,c){var k=d.objectIdField;d=l.filter(d.graphics,function(c){return l.some(h,function(d){return c.attributes[k]===d.objectId})});if(c)c(d);else return d},getSelection:function(h){var d=[];l.forEach(h,function(c){c=c.getSelectedFeatures();l.forEach(c,function(c){d.push(c)})});return d}}})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(r,l,n){return r("dijit.form.DateTextBox",n,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:l,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a){var m=q("dijit.Calendar",[t,s,e],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",
incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){k.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new m._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:u.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);
this.own(f(this.domNode,"keydown",u.hitch(this,"_onKeyDown")),f(this.dateRowsNode,"mouseover",u.hitch(this,"_onDayMouseOver")),f(this.dateRowsNode,"mouseout",u.hitch(this,"_onDayMouseOut")),f(this.dateRowsNode,"mousedown",u.hitch(this,"_onDayMouseDown")),f(this.dateRowsNode,"mouseup",u.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,
a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){if((a=d.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!d.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode))d.add(a,"dijitCalendarHoveredDate"),this._currentNode=a},_onDayMouseOut:function(a){this._currentNode&&!(a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode)&&(a="dijitCalendarHoveredDate",d.contains(this._currentNode,"dijitCalendarActiveDate")&&
(a+=" dijitCalendarActiveDate"),d.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){if((a=a.target.parentNode)&&a.dijitDateValue&&!d.contains(a,"dijitCalendarDisabledDate"))d.add(a,"dijitCalendarActiveDate"),this._currentNode=a},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&d.remove(a,"dijitCalendarActiveDate")},handleKey:function(a){var b=-1,c,e=this.currentFocus;switch(a.keyCode){case g.RIGHT_ARROW:b=1;case g.LEFT_ARROW:c="day";this.isLeftToRight()||
(b*=-1);break;case g.DOWN_ARROW:b=1;case g.UP_ARROW:c="week";break;case g.PAGE_DOWN:b=1;case g.PAGE_UP:c=a.ctrlKey||a.altKey?"year":"month";break;case g.END:e=this.dateModule.add(e,"month",1),c="day";case g.HOME:e=new this.dateClassObj(e);e.setDate(1);break;default:return!0}c&&(e=this.dateModule.add(e,c,b));this._setCurrentFocusAttr(e);return!1},_onKeyDown:function(a){this.handleKey(a)||(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},
getClassForDate:function(){}});m._MonthDropDownButton=q("dijit.Calendar._MonthDropDownButton",a,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new m._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",c);this.containerNode.innerHTML=(6==b("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+
"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[a.getMonth()]+"\x3c/div\x3e"}});m._MonthDropDown=q("dijit.Calendar._MonthDropDown",[s,D,e],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML="";r.forEach(a,function(a,b){c.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState=
"dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(h.get(a.target,"month"))},onChange:function(){}});return m})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e){var D=l("dijit.CalendarLite",
[t,s],{templateString:e,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',
value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,
b){"string"==typeof a&&(a=d.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){a&&(a=new this.dateClassObj(a),a.setHours(1,0,0,0));return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},
_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),c=this.dateModule.getDaysInMonth(a),e=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),f=new this.dateClassObj,d=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);d>b&&(d-=7);if(!this.summary){var g=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",g[a.getMonth()])}this._date2cell={};r.forEach(this.dateCells,
function(g,h){var k=h+d,s=new this.dateClassObj(a),t="dijitCalendar",w=0;k<b?(k=e-b+k+1,w=-1,t+="Previous"):k>=b+c?(k=k-b-c+1,w=1,t+="Next"):(k=k-b+1,t+="Current");w&&(s=this.dateModule.add(s,"month",w));s.setDate(k);this.dateModule.compare(s,f,"date")||(t="dijitCalendarCurrentDate "+t);this.isDisabledDate(s,this.lang)?(t="dijitCalendarDisabledDate "+t,g.setAttribute("aria-disabled","true")):(t="dijitCalendarEnabledDate "+t,g.removeAttribute("aria-disabled"),g.setAttribute("aria-selected","false"));
(w=this.getClassForDate(s,this.lang))&&(t=w+" "+t);g.className=t+"Month dijitCalendarDateTemplate";t=s.valueOf();this._date2cell[t]=g;g.dijitDateValue=t;this._setText(this.dateLabels[h],s.getDateLocalized?s.getDateLocalized(this.lang):s.getDate())},this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;r.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+
"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?g.getObject(a.datePackage,!1):q;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?g.getObject(a.datePackage+".locale",!1):h},_createMonthWidget:function(){return D._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},
buildRendering:function(){var a=this.dowTemplateString,e=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),f=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);this.dayCellsHtml=b.substitute([a,a,a,a,a,a,a].join(""),{d:""},function(){return e[f++%7]});a=b.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);c.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);
this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=g.hitch(this,function(a,b,c){this[a].dojoClick=!0;return u(this[a],"click",g.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,
b){var c=this.currentFocus,e=this._getNodeByDate(c);a=this._patchDate(a);this._set("currentFocus",a);if(!this._date2cell||0!=this.dateModule.difference(c,a,"month"))this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]);c=this._getNodeByDate(a);c.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&c.focus();e&&e!=c&&(f("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();
a.preventDefault();for(a=a.target;a&&!a.dijitDateValue;a=a.parentNode);a&&!k.contains(a,"dijitCalendarDisabledDate")&&this.set("value",a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,c){k.toggle(c,"dijitCalendarSelectedDate",a);c.setAttribute("aria-selected",a?"true":"false")}r.forEach(this._selectedCells||[],g.partial(b,!1));this._selectedCells=r.filter(r.map(a,this._getNodeByDate,
this),function(a){return a});r.forEach(this._selectedCells,g.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});D._MonthWidget=l("dijit.CalendarLite._MonthWidget",t,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),c=6==f("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+r.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=c+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+
b[a.getMonth()]+"\x3c/div\x3e"}});return D})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(r,l,n,q,h,d,c,k){new Date("X");return q("dijit.form._DateTimeTextBox",[d,c],{templateString:k,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:l.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},compare:function(c,d){var f=this._isInvalidDate(c),b=this._isInvalidDate(d);if(f||b)return f&&b?0:!f?1:-1;var f=this.format(c,this._unboundedConstraints),b=this.format(d,this._unboundedConstraints),h=this.parse(f,this._unboundedConstraints),k=this.parse(b,this._unboundedConstraints);return f==b?0:r.compare(h,k,this._selector)},autoWidth:!0,format:function(c,d){return!c?"":this.dateLocaleModule.format(c,d)},parse:function(c,d){return this.dateLocaleModule.parse(c,d)||(this._isEmpty(c)?
null:void 0)},serialize:function(c,d){c.toGregorian&&(c=c.toGregorian());return n.toISOString(c,d)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(c){c=c||{};this.dateModule=c.datePackage?h.getObject(c.datePackage,!1):r;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=c.datePackage?h.getObject(c.datePackage+".locale",!1):l;this._set("pattern",
this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(c){c.selector=this._selector;c.fullYear=!0;var d=n.fromISOString;"string"==typeof c.min&&(c.min=d(c.min),this.dateClassObj instanceof Date||(c.min=new this.dateClassObj(c.min)));
"string"==typeof c.max&&(c.max=d(c.max),this.dateClassObj instanceof Date||(c.max=new this.dateClassObj(c.max)));this.inherited(arguments);this._unboundedConstraints=h.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(c){return!c||isNaN(c)||"object"!=typeof c||c.toString()==this._invalidDate},_setValueAttr:function(c,d,f){void 0!==c&&("string"==typeof c&&(c=n.fromISOString(c)),this._isInvalidDate(c)&&(c=null),c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c)));
this.inherited(arguments,[c,d,f]);this.value instanceof Date&&(this.filterString="");!1!==d&&this.dropDown&&this.dropDown.set("value",c,!1)},_set:function(c,d){if("value"==c){d instanceof Date&&!(this.dateClassObj instanceof Date)&&(d=new this.dateClassObj(d));var f=this._get("value");if(f instanceof this.dateClassObj&&0==this.compare(d,f))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(c){this._isInvalidDate(c)&&(c=new this.dateClassObj);this._set("dropDownDefaultValue",c)},
openDropDown:function(c){this.dropDown&&this.dropDown.destroy();var d=h.isString(this.popupClass)?h.getObject(this.popupClass,!1):this.popupClass,f=this,b=this.get("value");this.dropDown=new d({onChange:function(b){f.set("value",b,!0)},id:this.id+"_popup",dir:f.dir,lang:f.lang,value:b,textDir:f.textDir,currentFocus:!this._isInvalidDate(b)?b:this.dropDownDefaultValue,constraints:f.constraints,filterString:f.filterString,datePackage:f.datePackage,isDisabledDate:function(b){return!f.rangeCheck(b,f.constraints)}});
this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(c,d){this._setValueAttr(this.parse(c,this.constraints),d,c)}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(r,l,n,q,h){return r("dijit.form.FilteringSelect",[q,h],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||
!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(d,c,h,g){c&&c[this.searchAttr]!==this._lastQuery||!c&&d.length&&this.store.getIdentity(d[0])!=this._lastQuery||(d.length?this.set("item",d[0],g):this.set("value","",g||void 0===g&&!this.focused,this.textbox.value,null))},_openResultList:function(d,c,h){c[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},
_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(d,c,h,g){this._onChangeActive||(c=null);if(void 0===g){if(null===d||""===d)if(d="",!l.isString(h)){this._setDisplayedValueAttr(h||"",c);return}var u=this;this._lastQuery=d;n(this.store.get(d),function(f){u._callbackSetLabel(f?[f]:[],void 0,void 0,c)})}else this.valueNode.value=d,this.inherited(arguments,[d,c,h,g])},_setItemAttr:function(d,c,h){this.inherited(arguments);this._lastDisplayedValue=
this.textbox.value},_getDisplayQueryString:function(d){return d.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(d,c){null==d&&(d="");if(!this._created){if(!("displayedValue"in this.params))return;c=!1}if(this.store){this.closeDropDown();var h=l.clone(this.query),g=this._getDisplayQueryString(d),u;this.store._oldAPI?u=g:(u=this._patternToRegExp(g),u.toString=function(){return g});this._lastQuery=h[this.searchAttr]=u;this._lastDisplayedValue=this.textbox.value=d;this._set("displayedValue",
d);var f=this,b={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};l.mixin(b,this.fetchProperties);this._fetchHandle=this.store.query(h,b);n(this._fetchHandle,function(d){f._fetchHandle=null;f._callbackSetLabel(d||[],h,b,c)},function(b){f._fetchHandle=null;f._cancelingQuery||console.error("dijit.form.FilteringSelect: "+b.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff",
"./TextBox"],function(r,l,n,q){return r("dijit.form.SimpleTextarea",q,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);n("ie")&&this.cols&&l.add(this.textbox,"dijitTextAreaCols")},
filter:function(h){h&&(h=h.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(h){if(this.maxLength){var d=parseInt(this.maxLength),c=this.textbox.value.replace(/\r/g,""),d=c.length-d;if(0<d){var k=this.textbox;if(k.selectionStart){var g=k.selectionStart,l=0;n("opera")&&(l=(this.textbox.value.substring(0,g).match(/\r/g)||[]).length);this.textbox.value=c.substring(0,g-d-l)+c.substring(g-l);k.setSelectionRange(g-d,g-d)}else this.ownerDocument.selection&&(k.focus(),c=this.ownerDocument.selection.createRange(),
c.moveStart("character",-d),c.text="",c.select())}}this.inherited(arguments)}})})},"dijit/form/TimeTextBox":function(){define(["dojo/_base/declare","dojo/keys","dojo/_base/lang","../_TimePicker","./_DateTimeTextBox"],function(r,l,n,q,h){return r("dijit.form.TimeTextBox",h,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:q,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(d){this.inherited(arguments);this.dropDown.on("input",n.hitch(this,function(){this.set("value",
this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var d=this.get("displayedValue");this.filterString=d&&!this.parse(d,this.constraints)?d.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D){return h("dijit._TimePicker",[e,D],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:q.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(a){k.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,b,c,e){a=this.ownerDocument.createDocumentFragment();for(b=0;b<this._maxIncrement;b++)(c=this._createOption(b))&&a.appendChild(c);return a},_showText:function(){var a=q.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);
this._visibleIncrementDate=a(this.visibleIncrement);var b=3600*this._clickableIncrementDate.getHours()+60*this._clickableIncrementDate.getMinutes()+this._clickableIncrementDate.getSeconds(),c=3600*this._visibleIncrementDate.getHours()+60*this._visibleIncrementDate.getMinutes()+this._visibleIncrementDate.getSeconds();(this.value||this.currentFocus).getTime();this._refDate=a(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=c/b;a=a(this.pickerMax);
a.setFullYear(1970,0,1);a=0.0010*(a.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((a+1)/b);b=this._getFilteredNodes();!b.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(b)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){for(var b in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})b in a&&
(this[b]=a[b]);a.locale||(a.locale=this.lang)},_createOption:function(a){var b=new Date(this._refDate),e=this._clickableIncrementDate;b.setHours(b.getHours()+e.getHours()*a,b.getMinutes()+e.getMinutes()*a,b.getSeconds()+e.getSeconds()*a);"time"==this.constraints.selector&&b.setFullYear(1970,0,1);var f=n.format(b,this.constraints);if(this.filterString&&0!==f.toLowerCase().indexOf(this.filterString))return null;e=this.ownerDocument.createElement("div");e.className=this.baseClass+"Item";e.date=b;e.idx=
a;c.create("div",{"class":this.baseClass+"ItemInner",innerHTML:f},e);f=1>a%this._visibleIncrement&&-1<a%this._visibleIncrement;a=!f&&!(a%this._clickableIncrement);f?e.className+=" "+this.baseClass+"Marker":a&&(e.className+=" "+this.baseClass+"Tick");this.isDisabledDate(b)&&(e.className+=" "+this.baseClass+"ItemDisabled");this.value&&!l.compare(this.value,b,this.constraints.selector)&&(e.selected=!0,e.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=e,f?e.className+=" "+this.baseClass+
"MarkerSelected":a&&(e.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(e,!0));return e},onOpen:function(){this.inherited(arguments);this.set("selected",this._selectedDiv)},_onOptionSelected:function(a,b){var c=a.target.date||a.target.parentNode.date;c&&!this.isDisabledDate(c)&&(this._set("value",c),this.emit("input"),b&&(this._highlighted_option=null,this.set("value",c),this.onChange(c)))},onChange:function(){},_highlightOption:function(a,b){if(a){if(b)this._highlighted_option&&
this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else{if(this._highlighted_option!==a)return;this._highlighted_option=null}d.toggle(a,this.baseClass+"ItemHover",b);d.contains(a,this.baseClass+"Marker")?d.toggle(a,this.baseClass+"MarkerHover",b):d.toggle(a,this.baseClass+"TickHover",b)}},handleKey:function(a){if(a.keyCode==g.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==
g.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==g.ENTER||a.keyCode===g.TAB){if(!this._keyboardSelected&&a.keyCode===g.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return a.keyCode===g.TAB}},onHover:function(a){this._highlightOption(a,!0)},onUnhover:function(a){this._highlightOption(a,!1)},onSelect:function(a){this._highlightOption(a,
!0)},onDeselect:function(a){this._highlightOption(a,!1)},onClick:function(a){this._onOptionSelected({target:a},!0)}})})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(r,l,n,q){var h=l.getObject("date.islamic",!0,r);h.getDaysInMonth=function(d){return d.getDaysInIslamicMonth(d.getMonth(),d.getFullYear())};h.compare=function(d,c,h){d instanceof q&&(d=d.toGregorian());c instanceof q&&(c=c.toGregorian());return n.compare.apply(null,arguments)};
h.add=function(d,c,h){var g=new q(d);switch(c){case "day":g.setDate(d.getDate()+h);break;case "weekday":var l=d.getDay();if(5>l+h&&0<l+h)g.setDate(d.getDate()+h);else{var f=c=0;5==l?(l=4,f=0<h?-1:1):6==l&&(l=4,f=0<h?-2:2);var l=0<h?5-l-1:-l,b=h-l,t=parseInt(b/5);0!=b%5&&(c=0<h?2:-2);g.setDate(d.getDate()+(c+7*t+b%5+l)+f)}break;case "year":g.setFullYear(d.getFullYear()+h);break;case "week":g.setDate(d.getDate()+7*h);break;case "month":d=d.getMonth();g.setMonth(d+h);break;case "hour":g.setHours(d.getHours()+
h);break;case "minute":g._addMinutes(h);break;case "second":g._addSeconds(h);break;case "millisecond":g._addMilliseconds(h)}return g};h.difference=function(d,c,k){c=c||new q;k=k||"day";var g=c.getFullYear()-d.getFullYear(),l=1;switch(k){case "weekday":g=Math.round(h.difference(d,c,"day"));l=parseInt(h.difference(d,c,"week"));k=g%7;if(0==k)g=5*l;else{var f=0,b=d.getDay();c=c.getDay();l=parseInt(g/7);k=g%7;d=new q(d);d.setDate(d.getDate()+7*l);d=d.getDay();if(0<g)switch(!0){case 5==b:f=-1;break;case 6==
b:f=0;break;case 5==c:f=-1;break;case 6==c:f=-2;break;case 5<d+k:f=-2}else if(0>g)switch(!0){case 5==b:f=0;break;case 6==b:f=1;break;case 5==c:f=2;break;case 6==c:f=1;break;case 0>d+k:f=2}g=g+f-2*l}l=g;break;case "year":l=g;break;case "month":k=c.toGregorian()>d.toGregorian()?c:d;f=c.toGregorian()>d.toGregorian()?d:c;l=k.getMonth();b=f.getMonth();if(0==g)l=k.getMonth()-f.getMonth();else{l=12-b+l;g=f.getFullYear()+1;k=k.getFullYear();for(g;g<k;g++)l+=12}c.toGregorian()<d.toGregorian()&&(l=-l);break;
case "week":l=parseInt(h.difference(d,c,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;case "second":l/=1E3;case "millisecond":l*=c.toGregorian().getTime()-d.toGregorian().getTime()}return Math.round(l)};return h})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(r,l,n){var q=l("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,
constructor:function(){var h=arguments.length;h?1==h?(h=arguments[0],"number"==typeof h&&(h=new Date(h)),h instanceof Date?this.fromGregorian(h):""==h?this._date=new Date(""):(this._year=h._year,this._month=h._month,this._date=h._date,this._hours=h._hours,this._minutes=h._minutes,this._seconds=h._seconds,this._milliseconds=h._milliseconds)):3<=h&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=
arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},setDate:function(h){h=parseInt(h);if(!(0<h&&h<=this.getDaysInIslamicMonth(this._month,
this._year))){var d;if(0<h)for(d=this.getDaysInIslamicMonth(this._month,this._year);h>d;h-=d,d=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(d=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=h;d=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),h+=d}this._date=
h;return this},setFullYear:function(h){this._year=+h},setMonth:function(h){this._year+=Math.floor(h/12);this._month=0<h?Math.floor(h%12):Math.floor((h%12+12)%12)},setHours:function(){var h=arguments.length,d=0;1<=h&&(d=parseInt(arguments[0]));2<=h&&(this._minutes=parseInt(arguments[1]));3<=h&&(this._seconds=parseInt(arguments[2]));4==h&&(this._milliseconds=parseInt(arguments[3]));for(;24<=d;)this._date++,h=this.getDaysInIslamicMonth(this._month,this._year),this._date>h&&(this._month++,12<=this._month&&
(this._year++,this._month-=12),this._date-=h),d-=24;this._hours=d},_addMinutes:function(h){h+=this._minutes;this.setMinutes(h);this.setHours(this._hours+parseInt(h/60));return this},_addSeconds:function(h){h+=this._seconds;this.setSeconds(h);this._addMinutes(parseInt(h/60));return this},_addMilliseconds:function(h){h+=this._milliseconds;this.setMilliseconds(h);this._addSeconds(parseInt(h/1E3));return this},setMinutes:function(h){this._minutes=h%60;return this},setSeconds:function(h){this._seconds=
h%60;return this},setMilliseconds:function(h){this._milliseconds=h%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var h=new Date;h.setHours(this._hours);h.setMinutes(this._minutes);h.setSeconds(this._seconds);h.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+h.toTimeString()},toGregorian:function(){var h=this._year,h=this._date+Math.ceil(29.5*this._month)+354*(h-1)+Math.floor((3+11*h)/30)+this._ISLAMIC_EPOCH-1,h=Math.floor(h-
0.5)+0.5,d=h-this._GREGORIAN_EPOCH,c=Math.floor(d/146097),k=this._mod(d,146097),d=Math.floor(k/36524),g=this._mod(k,36524),k=Math.floor(g/1461),g=this._mod(g,1461),g=Math.floor(g/365),c=400*c+100*d+4*k+g;4==d||4==g||c++;d=h-(this._GREGORIAN_EPOCH+365*(c-1)+Math.floor((c-1)/4)-Math.floor((c-1)/100)+Math.floor((c-1)/400));k=this._GREGORIAN_EPOCH-1+365*(c-1)+Math.floor((c-1)/4)-Math.floor((c-1)/100)+Math.floor((c-1)/400)+Math.floor(739/12+(n.isLeapYear(new Date(c,3,1))?-1:-2)+1);k=h<k?0:n.isLeapYear(new Date(c,
3,1))?1:2;d=Math.floor((12*(d+k)+373)/367);k=this._GREGORIAN_EPOCH-1+365*(c-1)+Math.floor((c-1)/4)-Math.floor((c-1)/100)+Math.floor((c-1)/400)+Math.floor((367*d-362)/12+(2>=d?0:n.isLeapYear(new Date(c,d-1,1))?-1:-2)+1);return new Date(c,d-1,h-k+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(h){h=new Date(h);var d=h.getFullYear(),c=h.getMonth(),k=h.getDate(),d=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)+-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor((367*
(c+1)-362)/12+(2>=c+1?0:n.isLeapYear(h)?-1:-2)+k),d=Math.floor(d)+0.5,d=d-this._ISLAMIC_EPOCH,c=Math.floor((30*d+10646)/10631),k=Math.ceil((d-29-this._yearStart(c))/29.5),k=Math.min(k,11);this._date=Math.ceil(d-this._monthStart(c,k))+1;this._month=k;this._year=c;this._hours=h.getHours();this._minutes=h.getMinutes();this._seconds=h.getSeconds();this._milliseconds=h.getMilliseconds();this._day=h.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},_yearStart:function(h){return 354*
(h-1)+Math.floor((3+11*h)/30)},_monthStart:function(h,d){return Math.ceil(29.5*d)+354*(h-1)+Math.floor((3+11*h)/30)},_civilLeapYear:function(h){return 11>(14+11*h)%30},getDaysInIslamicMonth:function(h,d){var c=0,c=29+(h+1)%2;11==h&&this._civilLeapYear(d)&&c++;return c},_mod:function(h,d){return h-d*Math.floor(h/d)}});q.getDaysInIslamicMonth=function(h){return(new q).getDaysInIslamicMonth(h.getMonth(),h.getFullYear())};return q})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(r,l,n,q,h,d,c,k,g){function u(b,f,a,d,h){return h.replace(/([a-z])\1*/ig,function(a){var d,g,m=a.charAt(0);a=a.length;var k=["abbr","wide","narrow"];switch(m){case "G":d=f.eraAbbr[0];break;case "y":d=String(b.getFullYear());break;case "M":d=b.getMonth();3>a?(d+=1,g=!0):(m=["months-format",k[a-3]].join("-"),d=f[m][d]);break;case "d":d=b.getDate(!0);g=!0;break;case "E":d=b.getDay();3>a?(d+=1,g=!0):(m=["days-format",k[a-3]].join("-"),d=f[m][d]);break;case "a":d=12>b.getHours()?"am":"pm";d=f["dayPeriods-format-wide-"+
d];break;case "h":case "H":case "K":case "k":g=b.getHours();switch(m){case "h":d=g%12||12;break;case "H":d=g;break;case "K":d=g%12;break;case "k":d=g||24}g=!0;break;case "m":d=b.getMinutes();g=!0;break;case "s":d=b.getSeconds();g=!0;break;case "S":d=Math.round(b.getMilliseconds()*Math.pow(10,a-3));g=!0;break;case "z":if(d=q.getTimezoneName(b.toGregorian()))break;a=4;case "Z":d=b.toGregorian().getTimezoneOffset();d=[0>=d?"+":"-",c.pad(Math.floor(Math.abs(d)/60),2),c.pad(Math.abs(d)%60,2)];4==a&&(d.splice(0,
0,"GMT"),d.splice(3,0,":"));d=d.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+h);}g&&(d=c.pad(d,a));return d})}function f(b,c,a,d){var f=function(a){return a};c=c||f;a=a||f;d=d||f;var h=b.match(/(''|[^'])+/g),g="'"==b.charAt(0);n.forEach(h,function(b,e){b?(h[e]=(g?a:c)(b),g=!g):h[e]=""});return d(h.join(""))}function b(b,c,a,f){f=d.escapeString(f);h.normalizeLocale(a.locale);return f.replace(/([a-z])\1*/ig,function(d){var f;f=d.charAt(0);var h=
d.length,g="";a.strict?1<h&&(g="0{"+(h-1)+"}"):g="0?";switch(f){case "y":f="\\d+";break;case "M":f=2<h?"\\S+ ?\\S+":g+"[1-9]|1[0-2]";break;case "d":f="[12]\\d|"+g+"[1-9]|3[01]";break;case "E":f="\\S+";break;case "h":f=g+"[1-9]|1[0-2]";break;case "k":f=g+"\\d|1[01]";break;case "H":f=g+"\\d|1\\d|2[0-3]";break;case "K":f=g+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":f=g+"\\d|[0-5]\\d";break;case "S":f="\\d{"+h+"}";break;case "a":h=a.am||c["dayPeriods-format-wide-am"];g=a.pm||c["dayPeriods-format-wide-pm"];
a.strict?f=h+"|"+g:(f=h+"|"+g,h!=h.toLowerCase()&&(f+="|"+h.toLowerCase()),g!=g.toLowerCase()&&(f+="|"+g.toLowerCase()));break;default:f=".*"}b&&b.push(d);return"("+f+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var t=l.getObject("date.islamic.locale",!0,r);t.format=function(b,c){c=c||{};var a=h.normalizeLocale(c.locale),d=c.formatLength||"short",g=t._getIslamicBundle(a),k=[],a=l.hitch(this,u,b,g,a,c.fullYear);if("year"==c.selector)return b.getFullYear();if("time"!=c.selector){var s=c.datePattern||g["dateFormat-"+
d];s&&k.push(f(s,a))}"date"!=c.selector&&(d=c.timePattern||g["timeFormat-"+d])&&k.push(f(d,a));return k.join(" ")};t.regexp=function(b){return t._parseInfo(b).regexp};t._parseInfo=function(c){c=c||{};var d=h.normalizeLocale(c.locale),d=t._getIslamicBundle(d),a=c.formatLength||"short",g=c.datePattern||d["dateFormat-"+a],a=c.timePattern||d["timeFormat-"+a],k=[];return{regexp:f("date"==c.selector?g:"time"==c.selector?a:"undefined"==typeof a?g:g+" "+a,l.hitch(this,b,k,d,c)),tokens:k,bundle:d}};t.parse=
function(b,c){b=b.replace(/[\u200E\u200F\u202A\u202E]/g,"");c||(c={});var a=t._parseInfo(c),f=a.tokens,d=a.bundle,a=a.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,""),a=RegExp("^"+a+"$").exec(b);h.normalizeLocale(c.locale);if(!a)return null;var g=[1389,0,1,0,0,0,0],s="",l=["abbr","wide","narrow"];n.every(a,function(a,b){if(!b)return!0;var e=f[b-1],h=e.length;switch(e.charAt(0)){case "y":g[0]=Number(a);break;case "M":if(2<h){if(e=d["months-format-"+l[h-3]].concat(),c.strict||(a=a.replace(".","").toLowerCase(),
e=n.map(e,function(a){return a?a.replace(".","").toLowerCase():a})),a=n.indexOf(e,a),-1==a)return!1}else a--;g[1]=Number(a);break;case "D":g[1]=0;case "d":g[2]=Number(a);break;case "a":e=c.am||d["dayPeriods-format-wide-am"];h=c.pm||d["dayPeriods-format-wide-pm"];if(!c.strict){var k=/\./g;a=a.replace(k,"").toLowerCase();e=e.replace(k,"").toLowerCase();h=h.replace(k,"").toLowerCase()}if(c.strict&&a!=e&&a!=h)return!1;s=a==h?"p":a==e?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":g[3]=
Number(a);break;case "m":g[4]=Number(a);break;case "s":g[5]=Number(a);break;case "S":g[6]=Number(a)}return!0});a=+g[3];"p"===s&&12>a?g[3]=a+12:"a"===s&&12==a&&(g[3]=0);return new k(g[0],g[1],g[2],g[3],g[4],g[5],g[6])};var s=[];t.addCustomFormats=function(b,c){s.push({pkg:b,name:c})};t._getIslamicBundle=function(b){var c={};n.forEach(s,function(a){a=h.getLocalization(a.pkg,a.name,b);c=l.mixin(c,a)},this);return c};t.addCustomFormats("dojo.cldr","islamic");t.getNames=function(b,c,a,f,d){var g;f=t._getIslamicBundle(f);
b=[b,a,c];"standAlone"==a&&(a=b.join("-"),g=f[a],1==g[0]&&(g=void 0));b[1]="format";return(g||f[b.join("-")]).concat()};t.weekDays=t.getNames("days","wide","format");t.months=t.getNames("months","wide","format");return t})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R,z,N,I,M,C,p,y){return r("SummaryInfo",[l],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.baseLabel=""!==a.label?a.label:a.layerTitle?
a.layerTitle:a.layers},queryTabCount:function(a,b,c,f){this.incidentCount=a.length;var e=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(e=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var g;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryFields=this._getFields(this.summaryLayer),g=new z(this.summaryLayer.url),
g.infoTemplate=this.tab.tabLayers[0].infoTemplate,e=[g],this.tab.tabLayers=e,this._performQuery(a,b,c,f,e)):this.loading||(g=new z(this.tab.tabLayers[0].url),this.loading=!0,s(g,"load",d.hitch(this,function(){this.summaryLayer=g;this.summaryFields=this._getFields(this.summaryLayer);for(var d=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,k=0;k<h.length;k++){var m=h[k];if("undefined"!==typeof m.layerObject)if(m.layerObject.infoTemplates){if(m=
m.layerObject.infoTemplates[d]){g.infoTemplate=m.infoTemplate;break}}else if(m.layerObject.infoTemplate){g.infoTemplate=m.layerObject.infoTemplate;break}}e=[g];this.tab.tabLayers=e;this.loading=!1;this._performQuery(a,b,c,f,e)})))}this.mapServiceLayer||this._performQuery(a,b,c,f,e)},_performQuery:function(a,b,c,f,e){var g=[],h,k;0<b.length?k=y.getGeoms(b):0<a.length&&(k=y.getGeoms(a));this.summaryGeoms=k;if(0<k.length)for(a=0;a<k.length;a++)g=k[a],b=y.createDefArray(e,g),h=0===a?g=b:g=h.concat(b);
(new q(g)).then(d.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var g=a[e][1];isNaN(g)?g&&g.features?b+=g.features.length:g&&"undefined"!==typeof g.length&&(b+=g.length):b+=g}this.updateTabCount(b,c,f);this.queryOnLoad&&d.hitch(this,this._queryFeatures(this.summaryGeoms))}))},updateTabCount:function(a,b,c){this.featureCount=a;y.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,f,e,k,m){this.incidentCount=a.length;this.allFields="undefined"!==
typeof k&&"undefined"!==typeof m?k?!0:m:!1;var t="undefined"!==typeof e,l;this.tabNum=f;t?l=new h:(this.container.innerHTML="",g.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var w=this.summaryGeoms,p;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],p=new z(this.summaryLayer.url),p.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=p,this.summaryFields=this._getFields(this.tab.tabLayers[0]),
t?this._queryFeatures(w,t).then(function(a){l.resolve(a)}):(this._initGraphicsLayer(c),d.hitch(this,this._queryFeatures(w)))):(p=new z(this.tab.tabLayers[0].url),s(p,"load",d.hitch(this,function(){this.summaryLayer=p;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,f=0;f<b.length;f++){var e=b[f];if("undefined"!==typeof e.layerObject&&e.layerObject.infoTemplates&&(e=e.layerObject.infoTemplates[a])){p.infoTemplate=
e.infoTemplate;break}}this.tab.tabLayers[1]=p;this.summaryFields=this._getFields(this.tab.tabLayers[1]);t?this._queryFeatures(w,t).then(function(a){l.resolve(a)}):(this._initGraphicsLayer(c),d.hitch(this,this._queryFeatures(w)))})));if(t)return l}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?
this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(a,b){var c;b&&(c=new h);for(var f=[],e=new p,g=0;g<a.length;g++)e.geometry=a[g],f.push(this.summaryLayer.queryIds(e));(new q(f)).then(d.hitch(this,function(a){for(var f,e,d=0;d<a.length;d++)a[d][0]&&(f=a[d][1],e=f=0===d?f:e.concat(f));f?(this.summaryIds=f,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():b||this._processResults()):
b||this._processResults()}),d.hitch(this,function(a){console.error(a);new v({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new h);var f=this.summaryLayer.maxRecordCount||1E3,e=this.summaryIds.slice(0,f);this.summaryIds.splice(0,f);var k=new p,m=!1;n.some(this.summaryFields,d.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return m=!0}));a&&(m=!0);k.returnGeometry=m;var s=[];n.forEach(this.summaryFields,function(a){s.push(a.field)});
this.symbolField&&s.push(this.symbolField);k.outFields=!0===this.config.csvAllFields||"true"===this.config.csvAllFields?["*"]:s;k.objectIds=e;for(c.push(this.summaryLayer.queryFeatures(k));0<this.summaryIds.length;)e=this.summaryIds.slice(0,f),this.summaryIds.splice(0,f),k.objectIds=e,c.push(this.summaryLayer.queryFeatures(k));(new q(c)).then(d.hitch(this,function(c){for(var f=0;f<c.length;f++)if(c[f][0]){var e=c[f][1];e.features&&(this.summaryFeatures=this.summaryFeatures.concat(e.features))}a?this._processResults(a).then(d.hitch(this,
function(a){this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing");b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing")}),d.hitch(this,function(a){console.error(a);new v({message:a})}));if(a)return b},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],c=b.field,f=b.total;switch(b.type){case "count":f=
this.summaryFeatures.length;break;case "area":f=y.getArea(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "length":f=y.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits);break;case "sum":f=y.getSum(this.summaryFeatures,c);break;case "avg":f=y.getSum(this.summaryFeatures,c)/this.summaryFeatures.length;break;case "min":f=y.getMin(this.summaryFeatures,c);break;case "max":f=y.getMax(this.summaryFeatures,
c)}b.total=f}},_processResults:function(a){this._prepResults();var b,c=this.summaryFields,f=0,e;if(a)b=new h;else{this.container.innerHTML="";g.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}e=u.create("div",{style:"width:"+220*(c.length+1)+"px;"},this.container);g.add(e,"SAT_tabPanelContent");var k=u.create("div",{},e);g.add(k,"SATcolExport");g.add(k,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");
k=u.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},k);g.add(k,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);s(k,"click",d.hitch(this,this._exportToCSV,c))}for(var k=[],l=0;l<c.length;l++){var w=c[l],p=m.stripHTML(w.alias?w.alias:"")+"\x3cbr/\x3e",f=w.alias===this.parent.nls.area||w.alias===this.parent.nls.length?w.total:Math.round(w.total);isNaN(f)&&(f=0);w=t.format(f);if(a)k.push({num:w,info:p,total:f});else{f=u.create("div",{"class":"SATcol"},
e);g.add(f,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var n=u.create("div",{style:"max-height: 60px;"},f);u.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:p},n);u.create("div",{"class":" colSummary",innerHTML:w},f)}}c=[];e=null!==this.graphicsLayer;!a&&e&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(l=0;l<this.summaryFeatures.length;l++)p=this.summaryFeatures[l],this.lyrSymbol?p.symbol=this.lyrSymbol:
e&&this.graphicsLayer.renderer?(w=this.graphicsLayer.renderer.getSymbol(p),p.symbol=w):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(p.symbol=this.summaryLayer.renderer.getSymbol(p)),!a&&e?(this.graphicsLayer.add(p),this.tab.tabLayers[1].add(p)):c.push(p);!a&&e&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(a)return b.resolve({graphics:c,analysisResults:k,
context:this}),b},_exportToCSV:function(a,b,c,f){a=y.exportToCSV(this.summaryFeatures,b,c,f,{type:"summary",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){var b=y.getSkipFields(a),c=[];if("undefined"!==typeof this.tab.advStat){var f=
this.tab.advStat.stats,e;for(e in f)0<f[e].length&&n.forEach(f[e],function(a){c.push({field:a.expression,alias:a.label+"",type:e,total:0})})}else{if(a.infoTemplate)f=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var g=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,f=null,k=0;k<h.length;k++){var m=h[k];if(m.layerObject.infoTemplates&&(m=m.layerObject.infoTemplates[g])){f=m.infoTemplate.info.fieldInfos;
break}}else f=a.fields;f||(f=a.fields);for(g=0;g<f.length;g++)if(h=f[g],"undefined"!==typeof a.fields){var k=a.fields[g].type,s;if(h.name!==a.objectIdField&&("esriFieldTypeDouble"===k||"esriFieldTypeInteger"===k||"esriFieldTypeSmallInteger"===k))"undefined"!==typeof h.visible?h.visible&&(s={field:h.fieldName,alias:h.label,type:"sum",total:0}):s={field:h.name,alias:h.alias,type:"sum",total:0},s&&-1===b.indexOf(s.field)&&c.push(s),s=null}}this.calcFields=d.clone(c);if(this.allFields){f=0;for(;f<a.fields.length;f++){s=
a.fields[f];g=!0;h=0;b:for(;h<c.length;h++)if(s.name===c[h].field){g=!1;break b}-1===b.indexOf(s.name)&&g&&c.push({field:s.name,alias:s.alias,type:s.type})}}return c}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style esri/tasks/query esri/geometry/geometryEngine ./CSVUtils jimu/utils".split(" "),function(r,l,n,q,h,d,c,k,g){function u(c){return function(b,d){return b.attributes[c]<d.attributes[c]?-1:
b.attributes[c]>d.attributes[c]?1:0}}return{getFields:function(c,b,d,g){var e=this.getSkipFields(c),h=[];if(!d&&b.advStat&&b.advStat.stats&&b.advStat.stats.outFields&&0<b.advStat.stats.outFields.length)r.forEach(b.advStat.stats.outFields,function(a){h.push(a.expression)});else{if(c.infoTemplate)b=c.infoTemplate.info.fieldInfos;else if(0<g.map.itemInfo.itemData.operationalLayers.length){g=g.map.itemInfo.itemData.operationalLayers;b=null;var a=0;a:for(;a<g.length;a++){var k=g[a];if("ArcGISMapServiceLayer"===
k.layerType&&"undefined"!==typeof k.layers)for(var l=0;l<k.layers.length;l++){var n=k.layers[l];if(n.id===c.layerId&&n.popupInfo){b=n.popupInfo.fieldInfos;break a}}}b||(b=c.fields)}else b=c.fields;if(b)for(g=0;g<b.length;g++)a=b[g],!d&&"undefined"!==typeof a.visible?a.visible&&-1===e.indexOf(a.fieldName)&&h.push(a.fieldName):(a=a.name?a.name:a.fieldName,-1===e.indexOf(a)&&h.push(a))}c=this.getSpecialFields(c);return{dateFields:c.dateFields,specialFields:c.specialFields,fields:3<h.length&&!d?h.slice(0,
3):h,allFields:h}},getField:function(c,b){for(var d=0;d<c.length;d++){var g=c[d];if(g.name===b||g.alias===b)return g}},getFieldValue:function(c,b,d,h,e){var k=b;d[c]&&(d=d[c],"esriFieldTypeDate"===d.type?("undefined"!==h[c]?(c=h[c],e=void 0!==typeof c?{dateFormat:c}:{dateFormat:e}):e={dateFormat:e},k=g.fieldFormatter.getFormattedDate(new Date(b),e)):r.some(d.domain.codedValues,function(a){if(a.code===b)return k=a.name,!0}));return k},getSkipFields:function(c){var b=[];if(c.fields)for(var d=0;d<c.fields.length;d++){var g=
c.fields[d];g&&g.type&&g.name&&"esriFieldTypeGeometry"===g.type&&b.push(g.name)}c.globalIdField&&""!==c.globalIdField&&b.push(c.globalIdField);c.objectIdField&&""!==c.objectIdField&&b.push(c.objectIdField);return b},getSpecialFields:function(c){var b={},d=[];c.fields&&r.forEach(c.fields,l.hitch(this,function(g){if("esriFieldTypeDate"===g.type||g.domain){if("esriFieldTypeDate"===g.type&&c.infoTemplate)for(var e in c.infoTemplate._fieldsMap)"undefined"!==typeof c.infoTemplate._fieldsMap[e].fieldName&&
(c.infoTemplate._fieldsMap[e].fieldName===g.name&&"undefined"!==typeof c.infoTemplate._fieldsMap[e].format.dateFormat)&&(d[g.name]=c.infoTemplate._fieldsMap[e].format.dateFormat);b[g.name]=g}}));return{specialFields:b,dateFields:d}},getSummaryFields:function(){},getDisplayFields:function(c){var b;"undefined"!==typeof c.advStat&&"undefined"!==typeof c.advStat.stats&&"undefined"!==typeof c.advStat.stats.outFields?b=c.advStat.stats.outFields:(b=[],0<c.tabLayers.length&&r.forEach(c.tabLayers,l.hitch(this,
function(c){"undefined"!==typeof c.popupInfo?r.forEach(c.popupInfo.fieldInfos,l.hitch(this,function(c){if(c.visible){var e={value:0};e.expression=c.fieldName;e.label=c.label;b.push(e)}})):c.infoTemplate?r.forEach(c.infoTemplate.info.fieldInfos,l.hitch(this,function(c){if(c.visible){var e={value:0};e.expression=c.fieldName;e.label=c.label;b.push(e)}})):r.forEach((c.layerObject?c.layerObject:c).fields,l.hitch(this,function(c){var e={value:0};e.expression=c.name;e.label=c.alias;b.push(e)}))})));return b},
exportToCSV:function(c,b,d,g,e){if(0===c.length)return!1;var h=e.baseLabel,a=[],m=[];"proximity"===e.type&&c.sort(this.compareDistance);var n;"undefined"===typeof b.altKey?n=b:(n=!1,d=e.csvAllFields);r.forEach(c,function(b){("proximity"===e.type||"closest"===e.type)&&delete b.attributes.DISTANCE;a.push(b.attributes)});if("summary"===e.type||"grouped"===e.type)if(!0===e.csvAllFields||"true"===e.csvAllFields)for(var q in a[0])m.push(q);else for(c=0;c<e.summaryFields.length;c++)m.push(e.summaryFields[c].field);
else for(var u in a[0])m.push(u);c=e.layer;q=c.fields;if(c&&c.loaded&&q||n){u=this.getSkipFields(c);var x={};if(e.opLayers&&e.opLayers._layerInfos){var w=e.opLayers.getLayerInfoById(c.id);w&&(x.popupInfo=w.getPopupInfo())}var w=[],Q=0;for(;Q<m.length;Q++){var R=m[Q];if(-1===u.indexOf(R)){var z=!1,N,I=0;b:for(;I<q.length;I++)if(N=q[I],N.name===R){z=!0;break b}z?w.push(N):w.push({name:R,alias:R,show:!0,type:"esriFieldTypeString"})}}x.datas=a;x.fromClient=!1;x.withGeometry=!1;x.outFields=w;x.formatDate=
!0;x.formatCodedValue=!0;x.formatNumber=!1;var M=[],C=[];if(!b&&d&&"undefined"!==typeof g)switch(e.type){case "proximity":M.push(e.nlsCount);C.push(g);break;case "closest":var p=0;r.forEach(g,l.hitch(this,function(a){0===p&&(r.forEach(a,function(a){M.push(a.label)}),p+=1);var b=[];r.forEach(a,function(a){b.push(a.value)});C.push(b)}));break;case "summary":r.forEach(g,l.hitch(this,function(a){var b=a.info.replace("\x3cbr/\x3e",""),c=!1,d=0;a:for(;d<e.calcFields.length;d++)if(b===e.calcFields[d].alias){c=
!0;break a}c&&(M.push(b),C.push(a.total))}));break;case "grouped":r.forEach(g,function(a){M.push(a.info.replace("\x3cbr/\x3e",""));C.push(a.total)})}if(n)return{summaryLayer:c,details:w};k.exportCSVFromFeatureLayer(h,c,x);return{summaryLayer:c,details:{appendColumns:M,appendDatas:C,name:h,type:e.nlsValue}}}k.exportCSV(h,a,m)},isURL:function(c){return/(https?:\/\/|ftp:)/g.test(c)},isEmail:function(c){return/\S+@\S+\.\S+/.test(c)},queryTabCount:function(){},performQuery:function(){},getGeoms:function(d){for(var b=
[],g=[],h=0;h<d.length;h++){var e=d[h].geometry?d[h].geometry:d[h];if("polygon"===e.type&&-1===b.indexOf(h)){for(var k=0;k<d.length;k++)if(k!==h&&-1===b.indexOf(k)){var a=d[k].geometry?d[k].geometry:d[k];"polygon"===a.type?c.intersects(e,a)&&(b.push(k),e=c.union(e,a)):b.push(k)}g.push(e)}}return g},createDefArray:function(c,b){for(var g=[],h=0;h<c.length;h++){var e=c[h],k=new d;k.returnGeometry=!1;k.geometry=b;"undefined"!==typeof e.queryCount?g.push(e.queryCount(k)):"undefined"!==typeof e.queryIds?
g.push(e.queryIds(k)):"undefined"!==typeof e.queryFeatures&&g.push(e.queryFeatures(k))}return g},updateTabCount:function(c,b,d,k,e){var l="undefined"!==typeof e&&0<e?!0:!1;e=q.position(b).w;"undefined"!==typeof c&&0===c?(n.remove(b,"noFeatures"),n.remove(b,"noFeaturesActive"),n.add(b,l?"noFeaturesActive":"noFeatures")):(l&&n.contains(b,"noFeatures")&&n.remove(b,"noFeatures"),l&&n.contains(b,"noFeaturesActive")&&n.remove(b,"noFeaturesActive"));d&&(c="undefined"!==typeof c?k+" ("+g.localizeNumber(c).toString()+
")":k,b.innerHTML=c);d=q.position(b).w;c=0;var a;d>e?(a=!0,c=d-e):e>d&&(a=!1,c=e-d);e=q.position(b.parentNode).w;if(0<e){a=a?e+c:e-c;h.set(b.parentNode,"width",a+"px");b=b.parentNode.parentNode;e=b.parentNode;var m;if(e&&e.children&&0<e.children.length)for(c=0;c<e.children.length;c++)if(d=e.children[c],-1<d.className.indexOf("SA_panelRight")){m=d;break}m&&b&&(a>q.position(e).w?(h.set(b,"right","58px"),h.set(m,"display","block")):(h.set(b,"right","24px"),h.set(m,"display","none")))}},getSum:function(c,
b){var d=0;r.forEach(c,function(c){d+=c.attributes[b]});return d},getMin:function(c,b){c.sort(u(b));return c[0].attributes[b]},getMax:function(c,b){c.sort(u(b));c.reverse();return c[0].attributes[b]},getArea:function(d,b,g,h){var e=0;g=l.clone(g);g.miles=109413;g.kilometers=109414;g.feet=109405;g.meters=109404;g.yards=109442;g.nauticalMiles=109409;var k=g[h];r.forEach(d,function(a){for(var d=0;d<b.length;d++){var f=c.intersect(a.geometry,b[d]);null!==f&&(e+=c.geodesicArea(f,k))}});return e},getLength:function(d,
b,g,h){var e=0,k=g[h];r.forEach(d,function(a){for(var d=0;d<b.length;d++){var f=c.intersect(a.geometry,b[d]);null!==f&&(e+=c.geodesicLength(f,k))}});return e},getDistance:function(d,b,g){var h=0,h=c.distance(d,b,9001);switch(g){case "miles":h*=6.21371E-4;break;case "kilometers":h*=0.0010;break;case "feet":h*=3.28084;break;case "yards":h*=1.09361;break;case "nauticalMiles":h*=5.39957E-4}return h},compareDistance:function(c,b){return c.attributes.DISTANCE<b.attributes.DISTANCE?-1:c.attributes.DISTANCE>
b.attributes.DISTANCE?1:0}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(r,l,n,q,h,d,c,k,g,u){function f(b){var c=l.clone(b.attributes);if((b=b.geometry)&&"point"===b.type)"x"in c?c._x=b.x:c.x=b.x,"y"in c?c._y=b.y:c.y=b.y;return c}r.exportCSV=function(b,c,d,e,f){return r._createCSVStr(c,d,e,f).then(function(a){return r._download(b+
".csv",a)})};r.exportCalculatedResultsCSV=function(b,c){var d="",e=0;n.forEach(c,function(f){d+=f.name+" ("+f.type+")\r\n";r._createCSVStr([],[],f.appendColumns,f.appendDatas).then(function(a){d+=a;e++;if(e===c.length)return r._download(b+".csv",d);d+="\r\n\r\n"})})};r.exportCSVFromFeatureLayer=function(b,c,d){d=d||{};return r._getExportData(c,{datas:d.datas,fromClient:d.fromClient,withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression}).then(function(e){return r._formattedData(c,
e,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,popupInfo:d.popupInfo,appendColumns:d.appendColumns,appendDatas:d.appendDatas}).then(function(c){return r.exportCSV(b,c.datas,c.columns,c.appendColumns,c.appendDatas)})})};r.exportCSVByAttributes=function(b,c,d,e){e=l.mixin({},e);e.datas=d;return r.exportCSVFromFeatureLayer(b,c,e)};r.exportCSVByGraphics=function(b,c,d,e){d=n.map(d,function(b){return b.attributes});return r.exportCSVByAttributes(b,c,d,e)};r._createCSVStr=
function(b,c,f,e){var g=new d,a="",h=0,k=0,l="",q="";try{if(c&&0<c.length){n.forEach(c,function(b){a=a+l+b;l=","});for(var a=a+"\r\n",h=b.length,k=c.length,r=0;r<h;r++){for(var l="",w=0;w<k;w++)q=b[r][c[w]],!q&&"number"!==typeof q&&(q=""),q&&/[",\r\n]/g.test(q)&&(q='"'+q.replace(/(")/g,'""')+'"'),a=a+l+q,l=",";a+="\r\n"}}"undefined"!==typeof f&&"undefined"!==typeof e&&(0<f.length&&0<e.length)&&(l="",n.forEach(f,function(b){a=a+l+b;l=","}),l="",a+="\r\n",n.forEach(e,function(b){Array.isArray(b)?(n.forEach(b,
function(b){a=a+l+b;l=","}),l="",a+="\r\n"):(a=a+l+b,l=",")}));g.resolve(a)}catch(Q){console.error(Q),g.resolve("")}return g};r._isIE11=function(){return 11===c.has("ie")};r._isEdge=function(){return c.has("edge")};r._getDownloadUrl=function(b){return window.Blob&&window.URL&&window.URL.createObjectURL?(b=new Blob(["\ufeff"+b],{type:"text/csv"}),URL.createObjectURL(b)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(b)};r._download=function(b,c){var f=new d;try{if(h("ie")&&10>h("ie")){var e=
window.top.open("about:blank","_blank");e.document.write("sep\x3d,\r\n"+c);e.document.close();e.document.execCommand("SaveAs",!0,b);e.close()}else if(10===h("ie")||r._isIE11()||r._isEdge()){var g=new Blob(["\ufeff"+c],{type:"text/csv"});navigator.msSaveBlob(g,b)}else{var a=q.create("a",{href:r._getDownloadUrl(c),target:"_blank",download:b},document.body);if(h("safari")){var k=document.createEvent("MouseEvents");k.initEvent("click",!0,!0);a.dispatchEvent(k)}else a.click();q.destroy(a)}f.resolve()}catch(l){f.reject(l)}return f};
r._getExportData=function(b,c){var g=new d,e=null,h=c.datas,a=c.withGeometry,e=c.outFields;if(!e||!e.length)e=b.fields;e=l.clone(e);if(a&&!(h&&0<h.length)){var k="",k=-1!==e.indexOf("x")?"_x":"x";e.push({name:k,alias:k,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});k=-1!==e.indexOf("y")?"_y":"y";e.push({name:k,alias:k,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?g.resolve({data:h||[],outFields:e}):c.fromClient?(h=n.map(b.graphics,
function(b){return a?f(b):l.clone(b)}),g.resolve({data:h||[],outFields:e})):r._getExportDataFromServer(b,e,c).then(function(a){g.resolve({data:a||[],outFields:e})});return g};r._getExportDataFromServer=function(b,c,h){var e=new d;if("esri.layers.FeatureLayer"!==b.declaredClass)return e.resolve([]),e;var k=new g(b.url),a=new u;a.where=h.filterExpression||b.getDefinitionExpression&&b.getDefinitionExpression()||"1\x3d1";0<c.length?(b=n.map(c,function(a){return a.name}),a.outFields=b):a.outFields=["*"];
a.returnGeometry=h.withGeometry;k.execute(a,function(a){a=n.map(a.features,function(a){return f(a)});e.resolve(a)},function(a){console.error(a);e.resolve([])});return e};r._formattedData=function(b,c,f){var e=new d,g=[],a=c.data;c=c.outFields;for(var h=0,k=a.length;h<k;h++){for(var l={},q=0;q<c.length;q++){var u=c[q];l[u.alias||u.name]=r._getExportValue(a[h][u.name],u,b.objectIdField,b.typeIdField,a[h][b.typeIdField],b.types,f)}g.push(l)}b=n.map(c,function(a){return a.alias||a.name});e.resolve({datas:g,
columns:b,appendColumns:f.appendColumns,appendDatas:f.appendDatas});return e};r._getExportValue=function(b,d,f,e,g,a,h){function l(a){if(q&&k.isDefined(q.fieldInfos))for(var b=0,c=q.fieldInfos.length;b<c;b++){var d=q.fieldInfos[b];if(d.fieldName===a)return d.format}return null}var q=h.popupInfo,r=!!d.domain&&h.formatCodedValue;h="esriFieldTypeDate"===d.type&&h.formatDate;var u=f&&d.name===f;e=e&&d.name===e;return h?c.fieldFormatter.getFormattedDate(b,l(d.name)):e?c.fieldFormatter.getTypeName(b,a):
r?c.fieldFormatter.getCodedValue(d.domain,b):!r&&!h&&!u&&!e?(r=null,f&&a&&0<a.length&&(f=(f=n.filter(a,function(a){return a.id===g}))&&f[0])&&(f.domains&&f.domains[d.name]&&f.domains[d.name].codedValues)&&(r=c.fieldFormatter.getCodedValue(f.domains[d.name],b)),null!==r?r:b):b}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/utils jimu/dijit/Message esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R,z,N,I,M,C,p,y){return r("GroupedCountInfo",[l],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.config=c.config;this.graphicsLayer=null;this.specialFields=
{};this.dateFields={};this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,e){this.displayCount=e;this.incidentCount=a.length;var f=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(f=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var g;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],
this.summaryFields=this._getFields(this.summaryLayer),g=new z(this.summaryLayer.url),g.infoTemplate=this.tab.tabLayers[0].infoTemplate,f=[g],this.tab.tabLayers=f,this._performQuery(a,b,c,e,f)):this.loading||(g=new z(this.tab.tabLayers[0].url),this.loading=!0,s(g,"load",d.hitch(this,function(){this.summaryLayer=g;this.summaryFields=this._getFields(this.summaryLayer);for(var d=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,k=0;k<h.length;k++){var m=
h[k];if("undefined"!==typeof m.layerObject&&m.layerObject.infoTemplates&&(m=m.layerObject.infoTemplates[d])){g.infoTemplate=m.infoTemplate;break}}f=[g];this.tab.tabLayers=f;this.loading=!1;this._performQuery(a,b,c,e,f)})))}this.mapServiceLayer||this._performQuery(a,b,c,e,f)},_performQuery:function(a,b,c,e,f){var g=[],h,k;0<b.length?k=y.getGeoms(b):0<a.length&&(k=y.getGeoms(a));this.summaryGeoms=k;if(0<k.length)for(a=0;a<k.length;a++)g=k[a],b=y.createDefArray(f,g),h=0===a?g=b:g=h.concat(b);(new q(g)).then(d.hitch(this,
function(a){for(var b=0,f=0;f<a.length;f++){var g=a[f][1];isNaN(g)?g&&g.features?b+=g.features.length:g&&"undefined"!==typeof g.length&&(b+=g.length):b+=g}this.updateTabCount(b,c,e);this.queryOnLoad&&d.hitch(this,this._queryFeatures(this.summaryGeoms))}))},updateTabCount:function(a,b,c){this.displayCount=c;this.featureCount=a;y.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,e,f,k,m){this.incidentCount=a.length;this.allFields="undefined"!==
typeof k&&"undefined"!==typeof m?k?!0:m:!1;var l="undefined"!==typeof f,w;this.tabNum=e;l?w=new h:(this.container.innerHTML="",g.add(this.container,"loading"));this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var p=[];if(0<b.length)p=b;else for(b=0;b<a.length;b++)e=a[b].geometry?a[b].geometry:a[b],"polygon"===e.type&&p.push(e);var n;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],n=new z(this.summaryLayer.url),
n.infoTemplate=this.tab.tabLayers[0].infoTemplate,this.tab.tabLayers[1]=n,this.summaryFields=this._getFields(this.tab.tabLayers[0]),l?this._queryFeatures(p,l).then(function(a){w.resolve(a)}):(this._initGraphicsLayer(c),d.hitch(this,this._queryFeatures(p,l)))):(n=new z(this.tab.tabLayers[0].url),s(n,"load",d.hitch(this,function(){this.summaryLayer=n;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var a=this.tab.tabLayers[0].url.split("MapServer/")[1],b=this.parent.map.itemInfo.itemData.operationalLayers,
e=0;e<b.length;e++){var f=b[e];if("undefined"!==typeof f.layerObject&&f.layerObject.infoTemplates&&(f=f.layerObject.infoTemplates[a])){n.infoTemplate=f.infoTemplate;break}}this.tab.tabLayers[1]=n;this.summaryFields=this._getFields(this.tab.tabLayers[1]);l?this._queryFeatures(p,l).then(function(a){w.resolve(a)}):(this._initGraphicsLayer(c),d.hitch(this,this._queryFeatures(p)))})));if(l)return w}},_initGraphicsLayer:function(a){null!==a&&(this.graphicsLayer=a,this.graphicsLayer.clear(),this.summaryLayer&&
(this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol),null===this.specialFields&&y.getSpecialFields(this.summaryLayer)))},_queryFeatures:function(a,b){var c;b&&(c=new h);for(var e=[],f=new p,g=0;g<a.length;g++)f.geometry=a[g],e.push(this.summaryLayer.queryIds(f));(new q(e)).then(d.hitch(this,
function(a){for(var d,e,f=0;f<a.length;f++)a[f][0]&&(d=a[f][1],e=d=0===f?d:e.concat(d));d?(this.summaryIds=d,0<this.summaryIds.length?b?this._queryFeaturesByIds(b).then(function(a){c.resolve(a)}):this._queryFeaturesByIds():b||this._processResults()):b||this._processResults()}),d.hitch(this,function(a){console.error(a);new v({message:a})}));if(b)return c},_queryFeaturesByIds:function(a){var b,c=[];a&&(b=new h);var e=this.summaryLayer.maxRecordCount||1E3,f=this.summaryIds.slice(0,e);this.summaryIds.splice(0,
e);var k=new p,m=!1;n.some(this.summaryFields,d.hitch(this,function(a){if("area"===a.type||"length"===a.type||this.graphicsLayer)return m=!0}));a&&(m=!0);k.returnGeometry=m;var l=[];n.forEach(this.summaryFields,function(a){l.push(a.field)});this.symbolField&&l.push(this.symbolField);if(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)k.outFields=["*"];else{if(0<this.popupFields.length)for(var w=0;w<this.popupFields.length;w++){var s=this.popupFields[w];-1===l.indexOf(s)&&l.push(s)}k.outFields=
l}k.objectIds=f;for(c.push(this.summaryLayer.queryFeatures(k));0<this.summaryIds.length;)f=this.summaryIds.slice(0,e),this.summaryIds.splice(0,e),k.objectIds=f,c.push(this.summaryLayer.queryFeatures(k));(new q(c)).then(d.hitch(this,function(c){for(var e=0;e<c.length;e++)if(c[e][0]){var f=c[e][1];f.features&&(this.summaryFeatures=this.summaryFeatures.concat(f.features))}a?this._processResults(a).then(d.hitch(this,function(a){this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing");
b.resolve(a)})):(this._processResults(),this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&g.replace(this.SA_SAT_download,"download","processing")}),d.hitch(this,function(a){console.error(a);new v({message:a})}));if(a)return b},_prepGroupedResults:function(){for(var a=0;a<this.summaryFeatures.length;a++){var b=this.summaryFeatures[a];if("undefined"!==typeof this.summaryFields&&0<this.summaryFields.length){var c=y.getFieldValue(this.summaryFields[0].field,
b.attributes[this.summaryFields[0].field],this.specialFields,this.dateFields,"longMonthDayYear"),c="undefined"!==typeof c&&null!==c?m.stripHTML(c.toString()):"";c in this.groupedResults?this.groupedResults[c].features.push(b):this.groupedResults[c]={features:[b]}}}},_prepResults:function(){for(var a in this.groupedResults){var b=this.summaryFields[0];b.total=this.groupedResults[a].features.length;this.groupedResults[a].total=b.total;this.groupedResults[a].type=b.type;this.groupedResults[a].label=
b.alias}},_processResults:function(a){this._prepGroupedResults();this._prepResults();var b=this.groupedResults,c=0,e,f;if(a)f=new h;else{this.container.innerHTML="";g.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var k=Object.keys(this.groupedResults).length+1;e=u.create("div",{style:"width:"+220*k+"px;"},this.container);g.add(e,"SAT_tabPanelContent");k=u.create("div",{},e);g.add(k,"SATcolExport");g.add(k,
this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");k=u.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV},k);g.add(k,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);s(k,"click",d.hitch(this,this._exportToCSV,b))}var l=Object.keys(b).sort(),k=[];this.displayCount&&k.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,c:void 0});for(var w in l){var c=l[w],p=b[c],n=m.stripHTML(c.toString()),c=c===this.parent.nls.area||
c===this.parent.nls.length?p.total:Math.round(p.total);isNaN(c)&&(c=0);var c=t.format(c),q="pre"===p.type?p.label.trim():n,n="pre"===p.type?n:p.label.trim(),p=""!==p.label?"colGroupedSummary":"colSummary";if(a)k.push({total:c,a:q,info:""===n?q:n,c:p});else{var z=u.create("div",{"class":"SATcol"},e);g.add(z,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var r=u.create("div",{style:"max-height: 45px;"},z);u.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",
innerHTML:q},r);u.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:n},r);u.create("div",{"class":p,innerHTML:c},z)}}b=[];w=null!==this.graphicsLayer;!a&&w&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(e=0;e<this.summaryFeatures.length;e++)l=this.summaryFeatures[e],this.lyrSymbol?l.symbol=this.lyrSymbol:this.graphicsLayer?this.graphicsLayer.renderer&&(c=this.graphicsLayer.renderer.getSymbol(l),l.symbol=c):this.summaryLayer.renderer&&
this.summaryLayer.renderer.getSymbol&&(l.symbol=this.summaryLayer.renderer.getSymbol(l)),!a&&w?(this.graphicsLayer.add(l),this.tab.tabLayers[1].add(l)):b.push(l);!a&&w&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(a)return f.resolve({graphics:b,analysisResults:k,context:this}),f},_exportToCSV:function(a,b,c,d){a=y.exportToCSV(this.summaryFeatures,b,c,d,{type:"grouped",
baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){var b=y.getSkipFields(a),c,d=[];if("undefined"!==typeof this.tab.advStat){var e=this.tab.advStat.stats,f;for(f in e)0<e[f].length&&n.forEach(e[f],function(a){var b={field:a.expression,alias:a.label+
"",type:f,total:0};c=a.expression;d.push(b)})}e=y.getSpecialFields(a);this.dateFields=e.dateFields;this.specialFields=e.specialFields;if(this.allFields)for(e=0;e<a.fields.length;e++){var g=a.fields[e];-1===b.indexOf(g.name)&&c!==g.name&&d.push({field:g.name,alias:g.alias,type:g.type})}return d}})})},"widgets/SituationAwareness/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),function(r,l,
n,q,h,d){return r("WeatherInfo",null,{constructor:function(c,d,g){this.tab=c;this.container=d;this.parent=g;this.weatherURL=c.url;this.weatherDict={119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain","light_rain.png",
"light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle","light_rain.png","light_rain.png"],263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet","sleet.png",
"sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain","sleet.png","sleet.png"],311:["Light freezing rain","sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow","snow4.png",
"snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],371:["Moderate or heavy snow showers","snow5.png","snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],356:["Moderate or heavy rain shower",
"shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png","snow3_night.png"],329:["Patchy moderate snow","snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby","tstorm1.png",
"tstorm1_night.png"],179:["Patchy snow nearby","snow1.png","snow1_night.png"],176:["Patchy rain nearby","shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},queryTabCount:function(c,d,g){this.updateTabCount(this.parent.incidents.length,g,!1)},updateTabCount:function(c,d){c=this.parent.incidents.length;"undefined"!==typeof c&&0===c?n.contains(d,"noFeatures")||n.add(d,"noFeatures"):
n.contains(d,"noFeatures")&&n.remove(d,"noFeatures")},updateForIncident:function(c){c=c[0];this.container.innerHTML="";n.add(this.container,"loading");var k=c=c.geometry;"point"!==c.type&&(k=c.getExtent().getCenter());c=h.webMercatorToGeographic(k);c=c.y+","+c.x;k="";"Weather"!==this.tab.label?(k=this.weatherURL,this.container.innerHTML="\x3cimg style\x3d'height:100%;' src\x3d'"+this.weatherURL+"' /\x3e"):(k=this.weatherURL+"\x26q\x3d"+c,d({url:k,callbackParamName:"callback"},{useProxy:!1}).then(l.hitch(this,
function(c){return this._resultsHandler(c)}),l.hitch(this,function(c){c=this._errorHandler(c);console.log(c)})))},_resultsHandler:function(c){c=c.data;console.log(c);var d=c.current_condition;c=c.weather;var g=1;this.container.innerHTML="";n.remove(this.container,"loading");var h=q.create("div",{style:"width:"+165*(c.length+3)+"px;"},this.container);n.add(h,"SAT_tabPanelContent");var f,b;if(0<d.length){d=d[0];f=d.localObsDateTime.split(" ");b=f[2];f=f[1].split(":");f=parseInt(f[0],10);if("AM"===b){if(6>
f||12===f)g=2}else 6<f&&12>f&&(g=2);b=d.temp_F;f=d.weatherCode;f=this.weatherDict[parseInt(f,10)];f=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+f[g]+"' /\x3e\x3cbr/\x3e"+b+"\x26deg;";b=q.create("div",{innerHTML:f},h);n.add(b,"SATcolSmall");n.add(b,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");f=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+d.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+
d.windspeedMiles+" MPH";d=q.create("div",{innerHTML:f},h);n.add(d,"SATcolSmall");n.add(d,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}for(b=0;b<c.length;b++){var d=c[b],l=this._getDay(d.date),s=d.tempMaxF,e=d.tempMinF;f=d.weatherCode;f=this.weatherDict[parseInt(f,10)];f=l+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+f[g]+"' /\x3e\x3cbr/\x3e"+s+"\x26deg; | "+e+"\x26deg;";d=q.create("div",{innerHTML:f},h);n.add(d,"SATcolSmall");n.add(d,this.parent.lightTheme?
"lightThemeBorder":"darkThemeBorder")}c=q.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3e'+this.parent.nls.poweredBy+'\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"http://www.worldweatheronline.com/" title\x3d"Free Weather API" target\x3d"_blank"\x3eWorld Weather Online\x3c/a\x3e\x3c/span\x3e'},h);n.add(c,"SATcolSmall");n.add(c,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");n.add(c,"SATcolLast")},
_getDay:function(c){c=c.split("-");c="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(c[0],c[1]-1,c[2])).getDay()];return this.parent.nls[c]},_errorHandler:function(c){console.log(c.message);c=q.create("div",{innerHTML:c.message},this.container);n.add(c,"SATcolSmall");n.add(c,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder")}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x){return r("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.map=c.map;this.specialFields={};this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,d){this.incidentCount=a.length;var e=this.parent.config.distanceSettings[this.parent.config.distanceUnits],
g=this.parent.config.maxDistance;b=[];for(var h=0;h<a.length;h++)b.push(t.buffer(a[h].geometry,g,e));var k=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(k=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var m;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryFields=this._getFields(this.summaryLayer),
m=new D(this.summaryLayer.url),m.infoTemplate=this.tab.tabLayers[0].infoTemplate,k=[m],this.tab.tabLayers=k,this._performQuery(a,b,c,d,k)):this.loading||(m=new D(this.tab.tabLayers[0].url),this.loading=!0,f(m,"load",l.hitch(this,function(){this.summaryLayer=m;this.summaryFields=this._getFields(this.summaryLayer);for(var e=this.tab.tabLayers[0].url.split("MapServer/")[1],f=this.parent.map.itemInfo.itemData.operationalLayers,g=0;g<f.length;g++){var h=f[g];if("undefined"!==typeof h.layerObject&&h.layerObject.infoTemplates&&
(h=h.layerObject.infoTemplates[e])){m.infoTemplate=h.infoTemplate;break}}k=[m];this.tab.tabLayers=k;this.loading=!1;this._performQuery(a,b,c,d,k)})))}this.mapServiceLayer||this._performQuery(a,b,c,d,k)},_performQuery:function(a,b,c,d,e){var f=[],g,k;this.summaryGeoms=b;if(0<b.length)for(a=0;a<b.length;a++)f=b[a],k=x.createDefArray(e,f),g=0===a?f=k:f=g.concat(k);(new h(f)).then(l.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var f=a[e][1];isNaN(f)?f&&f.features?0<f.features.length&&(b+=1):
f&&"undefined"!==typeof f.length&&0<f.length&&(b+=1):0<f&&(b+=1)}this.updateTabCount(b,c,d)}))},updateTabCount:function(a,b,c){this.featureCount=0===parseInt(a,10)?0:a;x.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,e,g,h){this.incidentCount=a.length;this.allFields="undefined"!==typeof g&&"undefined"!==typeof h?g?!0:h:!1;var k="undefined"!==typeof e,m;q.forEach(this.tab.tabLayers,l.hitch(this,function(g){if("undefined"!==typeof g.empty&&
g.url){var h=new D(g.url);f(h,"load",l.hitch(this,function(){this.tab.tabLayers=[h];k?(m=new d,this.processIncident(a,b,c,e).then(l.hitch(this,function(a){m.resolve(a)}),l.hitch(this,function(a){console.error(a);m.reject(a)}))):this.processIncident(a,b,c,e)}))}else k?(m=new d,this.processIncident(a,b,c,e).then(l.hitch(this,function(a){m.resolve(a)}),l.hitch(this,function(a){console.error(a);m.reject(a)}))):this.processIncident(a,b,c,e)}));if(k)return m},processIncident:function(a,b,e,f){this.incidents=
a;var g,k="undefined"!==typeof f;k?g=new d:(this.container.innerHTML="",c.add(this.container,"loading"));var m=[];f=this.parent.config.distanceSettings[this.parent.config.distanceUnits];for(var n=[],p=0;p<a.length;p++){var q=a[p].geometry,r=t.buffer(q,b,f);n.push({geometry:q,buffer:r})}(this.graphicsLayer=e)&&this.graphicsLayer.clear();a=[];b=this.tab.tabLayers[0];var u=this._getFields(b);for(e=0;e<n.length;e++)f=new A,f.returnGeometry=!0,f.geometry=n[e].buffer,f.outFields="true"===this.parent.config.csvAllFields||
!0===this.parent.config.csvAllFields?["*"]:u,"undefined"!==typeof b.queryFeatures&&a.push(b.queryFeatures(f));(new h(a)).then(l.hitch(this,function(a){for(var b=0;b<a.length;b++)if(a[b][0]){var c=a[b][1].features,d=[],e=n[b].geometry;if(c&&0<c.length){for(var f=0;f<c.length;f++){var h=new s(c[f].toJson()),w=h.geometry,p=e;"point"!==e.type&&(p=e.getExtent().getCenter());for(var w=x.getDistance(p,w,this.parent.config.distanceUnits),p={DISTANCE:w},q=0;q<u.length;q++)p[u[q]]=h.attributes[u[q]];!0===this.config.csvAllFields||
"true"===this.config.csvAllFields?h.attributes.DISTANCE=w:h.attributes=p;d.push(h)}d.sort(x.compareDistance);m.push(d[0])}}else a[b][1]&&a[b][1].message&&console.log(a[b][1].message);m.sort(x.compareDistance);k?this._processResults(m,!0).then(l.hitch(this,function(a){g.resolve(a)})):this._processResults(m)}),l.hitch(this,function(a){console.error(a);g.reject(a)}));if(k)return g},_processResults:function(h,q){var r,t,A=h&&0<h.length;if(A&&"point"!==h[0].geometry.type)for(var I=h.length-1;0<=I;I--)"undefined"===
typeof h[I].geometry.getExtent()&&h.splice(I,1);q?r=new d:(this.container.innerHTML="",c.remove(this.container,"loading"),A&&(t=k.create("div",{"class":"SAT_tabPanelContent"},this.container),I=k.create("div",{},t),c.add(I,"SATcolExport"),c.add(I,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),I=k.create("div",{title:this.parent.nls.downloadCSV},I),c.add(I,"btnExport"),f(I,"click",l.hitch(this,this._exportToCSV,h))));var I=this.parent.nls[this.parent.config.distanceUnits],M=[],C=220;if(A)for(var p=
0;p<h.length;p++){var y=p+1,G=h[p],J=G.geometry,D=J;"point"!==J.type&&(D=J.getExtent().getCenter());var J=G.attributes,K;"point"===this.incidents[0].geometry.type&&(K=Math.round(100*J.DISTANCE)/100+" "+I+" ("+this.parent.nls.approximate+")");var H="",E=0,F=[],P;for(P in J)if("DISTANCE"!==P&&3>E&&"undefined"!==typeof this.displayFields)for(var T=0;T<this.displayFields.length;T++)if(this.displayFields[T].expression===P){var L=x.getFieldValue(P,J[P],this.specialFields,this.dateFields,"longMonthDayYear"),
L="undefined"!==typeof L&&null!==L?b.stripHTML(L.toString()):"",S;if(G._layer&&G._layer.fields){var V=x.getField(G._layer.fields,P);V&&(S=V.alias)}if("undefined"===typeof S||S in[""," ",null,void 0])S=P;x.isURL(L)?L='\x3ca href\x3d"'+L+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+S+"\x3c/a\x3e":x.isEmail(L)&&(L='\x3ca href\x3d"mailto:'+L+'" style\x3d"color: inherit;"\x3e'+S+"\x3c/a\x3e");H+=L+"\x3cbr/\x3e";E+=1;F.push({value:-1<L.indexOf(",")?L.replace(",",""):L,label:S})}M.push(F);q||(G=
k.create("div",{},t),c.add(G,"SATcolRec"),c.add(G,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),E=k.create("div",{},G),c.add(E,"SATcolRecBar"),F=k.create("div",{innerHTML:y},E),c.add(F,"SATcolRecNum"),u.set(F,"backgroundColor",this.parent.config.activeColor),f(F,"click",l.hitch(this,this._zoomToLocation,D)),K&&(F=k.create("div",{innerHTML:K},E),c.add(F,"SATcolDistance")),this.parent.config.enableRouting&&(E=k.create("div",{title:this.parent.nls.get_directions},E),c.add(E,"SATcolDir"),
f(E,"click",l.hitch(this,this._routeToIncident,D))),H=k.create("div",{"class":"SATcolWrap",innerHTML:H},G),c.add(H,"SATcolInfo"),C+=g.position(G).w,H=new m(m.STYLE_SOLID,new n.fromRgb(this.parent.config.activeMapGraphicColor),1),H=new a(a.STYLE_CIRCLE,24,H,new n.fromRgb(this.parent.config.activeMapGraphicColor)),G=new v,G.family="Arial",G.size="12px",y=new B(y,G,new e(this.parent.config.fontColor)),y.setOffset(0,-4),this.graphicsLayer.add(new s(D,H,J)),this.graphicsLayer.add(new s(D,y,J)))}if(!q&&
A)u.set(t,"width",C);else if(A)return r.resolve({graphics:h,analysisResults:M,context:this}),r},_exportToCSV:function(a,b,c,d){a=x.exportToCSV(a,b,c,d,{type:"closest",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){a=x.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=
a.dateFields;this.specialFields=a.specialFields;this.displayFields=x.getDisplayFields(this.tab);return a.fields},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x){return r("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.specialFields={};this.dateFields={};this.config=c.config;this.baseLabel=""!==a.label?a.label:a.layerTitle?a.layerTitle:a.layers},queryTabCount:function(a,b,c,d){this.incidentCount=a.length;var e=[this.tab.tabLayers[0]];this.mapServiceLayer&&
1<this.tab.tabLayers.length&&(e=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer")){this.mapServiceLayer=!0;var g;"undefined"!==typeof this.tab.tabLayers[0].infoTemplate?(this.summaryLayer=this.tab.tabLayers[0],this.summaryFields=this._getFields(this.summaryLayer),g=new s(this.summaryLayer.url),g.infoTemplate=this.tab.tabLayers[0].infoTemplate,e=[g],this.tab.tabLayers=e,this._performQuery(a,b,c,d,e)):this.loading||
(g=new s(this.tab.tabLayers[0].url),this.loading=!0,f(g,"load",l.hitch(this,function(){this.summaryLayer=g;this.summaryFields=this._getFields(this.summaryLayer);for(var e=this.tab.tabLayers[0].url.split("MapServer/")[1],f=this.parent.map.itemInfo.itemData.operationalLayers,h=0;h<f.length;h++){var k=f[h];if("undefined"!==typeof k.layerObject&&k.layerObject.infoTemplates&&(k=k.layerObject.infoTemplates[e])){g.infoTemplate=k.infoTemplate;break}}this.tab.tabLayers=[g];this.loading=!1;this._performQuery(a,
b,c,d,this.tab.tabLayers)})))}this.mapServiceLayer||this._performQuery(a,b,c,d,e)},_performQuery:function(a,b,c,d,e){var f=[],g,k;0<b.length?k=x.getGeoms(b):0<a.length&&(k=x.getGeoms(a));this.summaryGeoms=k;if(0<k.length)for(a=0;a<k.length;a++)f=k[a],b=x.createDefArray(e,f),g=0===a?f=b:f=g.concat(b);(new h(f)).then(l.hitch(this,function(a){for(var b=0,e=0;e<a.length;e++){var f=a[e][1];isNaN(f)?f&&f.features?b+=f.features.length:f&&"undefined"!==typeof f.length&&(b+=f.length):b+=f}this.updateTabCount(b,
c,d)}))},updateTabCount:function(a,b,c){this.featureCount=a;x.updateTabCount(this.featureCount,b,c,this.baseLabel,this.incidentCount)},updateForIncident:function(a,b,c,e,g,h){this.incidentCount=a.length;this.allFields="undefined"!==typeof g&&"undefined"!==typeof h?g?!0:h:!1;var k="undefined"!==typeof e,m;q.forEach(this.tab.tabLayers,l.hitch(this,function(g){if("undefined"!==typeof g.empty&&g.url){var h=new s(g.url);f(h,"load",l.hitch(this,function(){this.tab.tabLayers=[h];k?(m=new d,this.processIncident(a,
b,c,e).then(l.hitch(this,function(a){m.resolve(a)}),l.hitch(this,function(a){console.error(a);m.reject(a)}))):this.processIncident(a,b,c,e)}))}else k?(m=new d,this.processIncident(a,b,c,e).then(l.hitch(this,function(a){m.resolve(a)}),l.hitch(this,function(a){console.error(a);m.reject(a)}))):this.processIncident(a,b,c,e)}));if(k)return m},processIncident:function(a,b,e,f){this.incidents=a;var g=[],k;if(0===b.length)for(var m=0;m<a.length;m++)k=a[m],k=k.geometry?k.geometry:k,"polygon"===k.type?(b.push(k),
g.push({geometry:k,buffer:k})):g.push({geometry:void 0,buffer:void 0});else for(m=0;m<a.length;m++){k=a[m];var n=b[m].geometry?b[m].geometry:b[m];k=k.geometry?k.geometry:k;g.push({geometry:k,buffer:n})}if(0!==b.length){for(a=0;a<g.length;a++)if(b=g[a].buffer,"undefined"!==typeof b)for(k=0;k<g.length;k++)if(k!==a&&(m=g[k].buffer,"undefined"!==typeof m&&B.overlaps(b,m))){g[a].buffer=B.difference(b,m);g[k].buffer=B.difference(m,b);m=B.union(m,b);m=B.difference(m,g[a].buffer);m=B.difference(m,g[k].buffer);
if(Array.isArray(g[a].geometry)){if(Array.isArray(g[k].geometry))for(n=0;n<g[k].geometry.length;n++)g[a].geometry.push(g[k].geometry[n]);else g[a].geometry.push(g[k].geometry);n=g[a].geometry}else if(n=[],n.push(g[a].geometry),Array.isArray(g[k].geometry))for(var p=0;p<g[k].geometry.length;p++)n.push(g[k].geometry[p]);else n.push(g[k].geometry);g.push({geometry:n,buffer:m})}var q,s="undefined"!==typeof f;s?q=new d:(this.container.innerHTML="",c.add(this.container,"loading"));var r=[];this.graphicsLayer=
e;e=this.tab.tabLayers[0];var t=this._getFields(e);f=[];for(a=0;a<g.length;a++)b=new v,b.returnGeometry=!0,b.geometry=g[a].buffer,b.outFields="true"===this.parent.config.csvAllFields||!0===this.parent.config.csvAllFields?["*"]:t,"undefined"!==typeof e.queryFeatures&&f.push(e.queryFeatures(b));(new h(f)).then(l.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=a[b][1];if(c&&c.features)for(var c=c.features,d=g[b].geometry,e=0;e<c.length;e++){var f=c[e],h=f.geometry,k;if(Array.isArray(d)){var m;
for(k=0;k<d.length;k++){var l=d[k];"point"!==l.type&&(l=d[k].getExtent().getCenter());l=x.getDistance(l,h,this.parent.config.distanceUnits);if("undefined"===typeof m||l<m)m=l}k=m;h={DISTANCE:m}}else k=d,"point"!==d.type&&(k=d.getExtent().getCenter()),k=x.getDistance(k,h,this.parent.config.distanceUnits),h={DISTANCE:k};for(l=0;l<t.length;l++)h[t[l]]=f.attributes[t[l]];!0===this.config.csvAllFields||"true"===this.config.csvAllFields?f.attributes.DISTANCE=k:f.attributes=h;r.push(f)}}r.sort(x.compareDistance);
s?q.resolve({graphics:r,analysisResults:r.length,context:this}):this._processResults(r)}),l.hitch(this,function(a){console.error(a);q.reject(a)}));if(s)return q}},_processResults:function(d){this.container.innerHTML="";c.remove(this.container,"loading");this.graphicsLayer.clear();if("point"!==d[0].geometry.type)for(var h=d.length-1;0<=h;h--)"undefined"===typeof d[h].geometry.getExtent()&&d.splice(h,1);var h=k.create("div",{"class":"SAT_tabPanelContent"},this.container),s=this.parent.nls[this.parent.config.distanceUnits],
r=k.create("div",{},h);c.add(r,"SATcolExport");c.add(r,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");r=k.create("div",{title:this.parent.nls.downloadCSV},r);c.add(r,"btnExport");f(r,"click",l.hitch(this,this._exportToCSV,d));var v;"undefined"!==typeof this.tab.advStat&&"undefined"!==typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields?v=this.tab.advStat.stats.outFields:(v=[],0<this.tab.tabLayers.length&&q.forEach(this.tab.tabLayers,l.hitch(this,function(a){"undefined"!==
typeof a.popupInfo?q.forEach(a.popupInfo.fieldInfos,l.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;v.push(b)}})):a.infoTemplate?q.forEach(a.infoTemplate.info.fieldInfos,l.hitch(this,function(a){if(a.visible){var b={value:0};b.expression=a.fieldName;b.label=a.label;v.push(b)}})):q.forEach((a.layerObject?a.layerObject:a).fields,l.hitch(this,function(a){var b={value:0};b.expression=a.name;b.label=a.alias;v.push(b)}))})));for(var r=220,B=0;B<d.length;B++){var M=
B+1,C=d[B],p=C.geometry,y=p;"point"!==p.type&&(y=p.getExtent().getCenter());var p=C.attributes,G;"point"===this.incidents[0].geometry.type&&(G=Math.round(100*p.DISTANCE)/100+" "+s+" ("+this.parent.nls.approximate+")");var J="",O=0,K;for(K in p)if("DISTANCE"!==K&&3>O&&"undefined"!==typeof v)for(var H=0;H<v.length;H++)if(v[H].expression===K){var E=x.getFieldValue(K,p[K],this.specialFields,this.dateFields,"longMonthDayYear"),E="undefined"!==typeof E&&null!==E?A.stripHTML(E.toString()):"",F;if(C._layer&&
C._layer.fields){var P=x.getField(C._layer.fields,K);P&&(F=P.alias)}if("undefined"===typeof F||F in[""," ",null,void 0])F=K;x.isURL(E)?E='\x3ca href\x3d"'+E+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+F+"\x3c/a\x3e":x.isEmail(E)&&(E='\x3ca href\x3d"mailto:'+E+'" style\x3d"color: inherit;"\x3e'+F+"\x3c/a\x3e");J+=E+"\x3cbr/\x3e";O+=1}C=k.create("div",{},h);c.add(C,"SATcolRec");c.add(C,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");O=k.create("div",{},C);c.add(O,"SATcolRecBar");
H=k.create("div",{innerHTML:M},O);c.add(H,"SATcolRecNum");u.set(H,"backgroundColor",this.parent.config.activeColor);f(H,"click",l.hitch(this,this._zoomToLocation,y));G&&(H=k.create("div",{innerHTML:G},O),c.add(H,"SATcolDistance"));this.parent.config.enableRouting&&(O=k.create("div",{title:this.parent.nls.get_directions},O),c.add(O,"SATcolDir"),f(O,"click",l.hitch(this,this._routeToIncident,y)));J=k.create("div",{"class":"SATcolWrap",innerHTML:J},C);c.add(J,"SATcolInfo");r+=g.position(C).w;J=new D(D.STYLE_SOLID,
new n.fromString(this.parent.config.activeMapGraphicColor),1);J=new e(e.STYLE_CIRCLE,24,J,new n.fromString(this.parent.config.activeMapGraphicColor));C=new a;C.family="Arial";C.size="12px";M=new m(M,C,new t(this.parent.config.fontColor));M.setOffset(0,-4);this.graphicsLayer.add(new b(y,J,p));this.graphicsLayer.add(new b(y,M,p))}u.set(h,"width",r+"px")},_exportToCSV:function(a,b,c,d){a=x.exportToCSV(a,b,c,d,{type:"proximity",baseLabel:this.baseLabel,csvAllFields:this.parent.config.csvAllFields,layer:this.tab.tabLayers[0],
opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count});this.summaryLayer=a.summaryLayer;return a.details},_getFields:function(a){a=x.getFields(a,this.tab,this.allFields,this.parent);this.dateFields=a.dateFields;this.specialFields=a.specialFields;return a.fields},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/SituationAwareness/js/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array esri/request esri/geometry/webMercatorUtils esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/tokenUtils jimu/dijit/Message ./CSVUtils".split(" "),
function(r,l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a){return r("SnapShot",null,{portal:null,portalUrl:"",baseName:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(a){this.parent=a;this.mapItemInfo=this.parent.map.itemInfo;this.extent=this.parent.map.extent;this.nls=l.mixin(this.parent.nls,window.jimuNls.drawBox);this.downloadAll=this.parent.config.csvAllFields;a=a.appConfig;this.portalUrl=a.portalUrl;this.portal=t.getPortal(this.portalUrl);
this.selfUrl=s.getPortalSelfInfoUrl(this.portalUrl);this.baseUrl=this.portalUrl+"sharing/rest/";this.logo=a.logo;this.originMapId=a.map.itemId;this.originAppId=a.appId},createSnapShot:function(a){var c=new n;this.baseName=b.stripHTML(a.name);this.layerArray=[];var d=new Date(a.time),e=d.getTimezoneOffset();this.time=b.fieldFormatter.getFormattedDate(d,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>e?"+"+Math.abs(e)/60:"-"+e/60);this.portal.getUser().then(l.hitch(this,function(b){this.createFolder(b,
this.time).then(l.hitch(this,function(d){this.createLayerItems(b,d,a).then(l.hitch(this,function(a){this.addLayers(b,d,a).then(l.hitch(this,function(a){this.createMap(b,d,a,this.mapItemInfo).then(l.hitch(this,function(a){new D({message:'\x3ca href\x3d"'+(this.portalUrl+"home/webmap/viewer.html?webmap\x3d"+a.id)+'" target\x3d"_blank"\x3e'+(a.success?this.nls.snapshot_complete:this.nls.snapshot_failed)+"\x3c/a\x3e"});c.resolve("success")}),function(a){c.reject(a)})}),function(a){c.reject(a)})}),function(a){c.reject(a)})}),
function(a){c.reject(a)})}),function(a){c.reject(a)});return c},createFolder:function(a,b){var c=new n,e={url:this.baseUrl+"content/users/"+a.username+"/createFolder",content:{f:"json",folderName:this.baseName+"_"+b,title:this.baseName+"_"+b,description:this.baseName+" "+this.nls.snapshot},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(e.content.token=this.credential.token);d(e,{usePost:!0}).then(l.hitch(this,function(a){c.resolve(a)}),l.hitch(this,function(a){c.reject(a)}));
return c},createLayerItems:function(a,b,c){var d=new n;a=c.layers;this.buffers=c.buffers;this.incidents=c.incidents;c=[];for(b=0;b<a.length;b++){var e=!0;a[b].analysisObject&&("undefined"!==typeof a[b].analysisObject.featureCount&&0===a[b].analysisObject.featureCount)&&(e=!1);a[b].graphics&&0===a[b].graphics.length&&(e=!1);e&&c.push(this.createItem(a[b],this.incidents,this.buffers,this.time,this.nls,this.baseName))}var f=[];(new q(c)).then(l.hitch(this,function(a){for(var b=0;b<a.length;b++)f.push(a[b][1]);
d.resolve(f)}),l.hitch(this,function(a){d.reject(a)}));return d},addLayers:function(a,b,c){for(var d=new n,e=[],f=0;f<c.length;f++)e.push(a.addItem(c[f],b.folder.id));var g=[];(new q(e)).then(l.hitch(this,function(a){for(var b=0;b<a.length;b++){var c=a[b][1];c.success&&g.push(c.id)}d.resolve(g)}),l.hitch(this,function(a){d.reject(a)}));return d},createItem:function(a,b,c,d,e,f){var g=new n,h={label:a.label,title:a.label+"_"+d,desc:e.snapshot_append+" "+e.of_append+" "+a.type+" "+e.layer_append+" "+
a.label+" ("+d+")",name:a.label+" ("+d+")",tags:[f+","+e.snapshot_append]};if(a.layerObject){var k=a.layerObject;f=a.analysisObject;this.layerArray.push({layer:{id:h.title,label:h.title,opacity:1,visible:!1},label:h.name});var q;k.infoTemplate&&k.infoTemplate.info&&(q=k.infoTemplate.info);h.popupInfo=q;"groupedSummary"===a.type||"summary"===a.type?f.updateForIncident(b,c,null,null,!0,!0,!0).then(l.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,k,e,d,h);g.resolve(a)})):f.updateForIncident(b,
"closest"===a.type?this.parent.config.maxDistance:c,null,!0,!0,!0).then(l.hitch(this,function(a){a=this.createAnalysisLayerJSON(a,k,e,d,h);g.resolve(a)}))}else a=this.createIncidentBufferLayerJSON(a.graphics,e,d,h),g.resolve(a);return g},createAnalysisLayerJSON:function(a,b,c,d,e){var f=a.graphics;(a=a.context._exportToCSV(f,!0))&&a.push({name:c.snapshot_append,alias:c.snapshot_append,type:"esriFieldTypeString"});for(var g=[],h=0;h<f.length;h++){var k=f[h];k.attributes[c.snapshot_append]=d;k.geometry.cache&&
(k.geometry.clearCache(),delete k.geometry.cahce);g.push({attributes:k.attributes,geometry:k.geometry})}return{title:e.title,type:"Feature Collection",tags:e.tags,description:e.desc,extent:b.fullExtent,name:e.title,text:JSON.stringify({layers:[{layerDefinition:{capabilities:"Query",name:e.name,geometryType:b.geometryType,objectIdField:b.objectIdField,type:"Feature Layer",extent:b.fullExtent,drawingInfo:{renderer:b.renderer.toJson()},fields:a},popupInfo:e.popupInfo,featureSet:{features:g,geometryType:b.geometryType}}]}),
f:"json"}},createIncidentBufferLayerJSON:function(a,b,c,d){var e=[],g=[],l=[];h.forEach(a,function(a){switch(a.geometry.type){case "point":e.push(a);break;case "polyline":g.push(a);break;case "polygon":l.push(a)}});a=[];0<e.length&&a.push(e);0<g.length&&a.push(g);0<l.length&&a.push(l);for(var n=[],q={point:"esriGeometryPoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"},s={point:this.nls.point,polyline:this.nls.line,polygon:this.nls.polygon},r={xmin:this.extent.xmin,ymin:this.extent.ymin,
xmax:this.extent.xmax,ymax:this.extent.ymax,spatialReference:this.extent.spatialReference},t=0;t<a.length;t++){var u=a[t],p;if(0<u.length){var y=u[0];p=s["undefined"!==typeof y.geometry?y.geometry.type:y.type];for(var D=q["undefined"!==typeof y.geometry?y.geometry.type:y.type],J=y.symbol.toJson(),O=[],K=0;K<u.length;K++){var y=u[K],H;switch(D){case "esriGeometryPolyline":H=y.geometry.paths;break;case "esriGeometryPolygon":H=y.geometry.rings;break;case "esriGeometryPoint":H=[y.geometry]}var E=0,F;
h.forEach(H,function(a){switch(D){case "esriGeometryPolyline":F=new f(a);F.spatialReference=y.geometry.spatialReference;break;case "esriGeometryPolygon":F=new k(a);F.spatialReference=y.geometry.spatialReference;break;case "esriGeometryPoint":F=a}a={attributes:{ObjectID:K+E},geometry:F};a.attributes[b.snapshot_append]=c;O.push(a);E+=1})}n.push({layerDefinition:{capabilities:"Query",name:1===a.length?d.name:p,geometryType:D,objectIdField:"ObjectID",type:"Feature Layer",extent:r,drawingInfo:{renderer:{type:"simple",
label:"",description:"",symbol:J}},fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:b.snapshot_append,alias:b.snapshot_append,type:"esriFieldTypeString"}]},featureSet:{features:O,geometryType:D}})}}this.layerArray.push({layer:{id:d.title,label:d.title,opacity:1,visible:!0},label:d.name});return{title:d.title,type:"Feature Collection",tags:d.tags,description:d.desc,extent:r,name:d.title,text:JSON.stringify({layers:n}),f:"json"}},createMap:function(a,b,d,e){var f=e.itemData;
e=this.baseName+" ("+this.nls.snapshot_append+" "+this.time+")";for(var g,h=[],k=0;k<f.baseMap.baseMapLayers.length;k++)g=f.baseMap.baseMapLayers[k],h.push({id:g.id,layerType:g.layerType,url:g.url,visibility:g.visibility,opacity:g.opacity,title:g.title}),g=g.resourceInfo.spatialReference;f={baseMapLayers:h};h=[];for(k=0;k<this.layerArray.length;k++){var l=this.layerArray[k];h.push({id:l.layer.id,layerType:"ArcGISFeatureLayer",visibility:l.layer.visible,opacity:l.layer.opacity,title:l.label,type:"Feature Collection",
itemId:d[k]})}d=c.webMercatorToGeographic(this.extent);d={title:e,type:"Web Map",item:e,extent:d.xmin+","+d.ymin+","+d.xmax+","+d.ymax,text:JSON.stringify({operationalLayers:h,baseMap:f,spatialReference:g,authoringApp:"WebMapViewer",authoringAppVersion:"4.1",version:"2.4"}),tags:this.baseName+","+this.nls.snapshot_append,wabType:"HTML"};return a.addItem(d,b.folder.id)},_checkCredential:function(){var a=e.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=e.getPortalCredential(this.portalUrl))},clearCredentialAndUser:function(){this.user=this.credential=null},createDownloadZip:function(b,c,d){var e=new n,f=this.nls.calculated_results;this._performAnalysis(b,c,d,this.downloadAll,!1).then(function(b){for(var c=[],d=0;d<b.length;d++){var g=b[d];(g=g.context._exportToCSV(g.graphics,!1,!0,g.analysisResults))&&c.push(g)}0<c.length&&a.exportCalculatedResultsCSV(f,
c);e.resolve("success")},function(a){e.reject(a)});return e},_performAnalysis:function(a,b,c,d,e){for(var f=new n,g=[],h=0;h<a.length;h++){var k=a[h];console.log("AO: "+k);var r=!0;k.analysisObject&&("undefined"!==typeof k.analysisObject.featureCount&&0===k.analysisObject.featureCount)&&(r=!1);r&&("groupedSummary"===k.type||"summary"===k.type?g.push(k.analysisObject.updateForIncident(b,c,null,null,!0,e,d)):g.push(k.analysisObject.updateForIncident(b,"closest"===k.type?this.parent.config.maxDistance:
c,null,!0,e,d)))}var s=[];(new q(g)).then(l.hitch(this,function(a){for(var b=0;b<a.length;b++)s.push(a[b][1]);f.resolve(s)}),l.hitch(this,function(a){console.error(a);f.reject(a)}));return f}})})},"widgets/SituationAwareness/js/SnapshotName":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/query jimu/BaseWidget dojo/text!./SnapshotName.html dojo/Evented dijit/form/ValidationTextBox".split(" "),function(r,l,n,q,h,d,c,k,
g,u){return r([k,l,u],{templateString:g,baseClass:"jimu-widget-SAT-snapshot-name",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.nameSpan.innerHTML=this.nls.common.name+":";this.startup()},startup:function(){this.snapshotName.invalidMessage=this.nls.invalid_snapshot_name;this.snapshotName.validator=this.checkString;this.btnCancel.innerText=this.nls.common.cancel;this.own(d(this.btnCancel,
"click",n.hitch(this,function(){this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;this.own(d(this.btnOk,"click",n.hitch(this,function(){h.contains(this.btnOk,"jimu-state-disabled")||this.emit("ok",this.snapshotName.value.trim())})))},checkString:function(d){d=d.trim();d=50>d.length&&/^[\w ]+$/.test(d)?!0:!1;var b=c(".snapshot-name-footer")[0];b&&(d?q.removeClass(b.children[0],"jimu-state-disabled"):q.addClass(b.children[0],"jimu-state-disabled"));return d},destroy:function(){}})})},
"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/SnapshotName.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-r-row" style\x3d"padding-top: 10px;"\x3e\r\n    \x3cinput class\x3d"validationBox" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n      title\x3d"${nls.snapshot_name}"/\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing" style\x3d"padding-top: 10px;"\x3e\r\n    \x3cdiv class\x3d"jimu-btn ok jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 680px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"clearIncident" class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cimg class\x3d"btn32img" data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e          \r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"spinnerValue" data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" value\x3d"15" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e       \r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reverseGeocodingDIV {visibility: hidden;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: block; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 15px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 15px;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 15px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .snapshot {background-image: url('images/snapshot.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .snapshotProcessing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .downloadAll {background-image: url('images/download_all.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .save {background-image: url('images/save.png'); background-repeat: no-repeat; background-position: center center; height: 32px; width: 32px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px; max-width: 300px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.esriAttributeInspector .atiRichTextField{}.esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.esriAttributeInspector {display:inline-block;} .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.esriPopup .spinner {display: none;}",
"*now":function(r){r(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos jimu/portalUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/has dojo/Deferred dojo/DeferredList esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/tasks/GeometryService esri/toolbars/draw esri/domUtils esri/dijit/AttributeInspector esri/dijit/Popup jimu/dijit/Popup esri/tasks/query ./js/SummaryInfo ./js/GroupedCountInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShot ./js/SnapshotName dojo/keys dojo/domReady!".split(" "),function(r,
l,n,q,h,d,c,k,g,u,f,b,t,s,e,D,a,m,v,B,A,x,w,Q,R,z,N,I,M,C,p,y,G,J,O,K,H,E,F,P,T,L,S,V,X,U,ha,Y,ia,Z,$,aa,ba,ca,da,ea,W,fa,ga){return r([q,l],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},startX:0,mouseDown:!1,
btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments);this.nls=a.mixin(this.nls,window.jimuNls.units);this.widgetActive=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,null)},startup:function(){this.inherited(arguments);this.btnNodes=[];this.panelNodes=[];this.tabNodes=
[];this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?this.config.snapshotEnabled:!1;this.isSafari=x("safari");this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;
this._mapLoaded()},onOpen:function(){this.inherited(arguments);this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=b(window,"resize",a.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",a.hitch(this,this._mapResize)));this._mapResize();this._storeInitalVisibility();this._checkHideContainer();this._initEditInfo();this._clickTab(0);this._updateCounts(!0);this._restoreIncidents()},_checkHideContainer:function(){this.hideContainer=
!1;var c=this.map.infoWindow;c.popupInfoView&&c.popupInfoView.container&&(this.hideContainer=!0,this.own(b(c,"show",a.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow();this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize.remove();this.windowResize=null;this._clear();this.widgetActive=!1;this.saveEnabled&&(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this._resetInitalVisibility();
this.inherited(arguments)},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear();this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);this.inherited(arguments)},
onAppConfigChanged:function(a,b){switch(b){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(a);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,null);break;case "attributeChange":this._updateUI(a)}},_handlePopup:function(){this._clearMobileSetAsIncidentStyle();var a=f.byId("main-page"),b,c,d;this.map.infoWindow.popupInfoView?(b=this.map.infoWindow.popupInfoView.container,c=".mainSection { overflow-y: auto; height: "+
(a.clientHeight-60).toString()+"px; }",d=".atiAttributes {overflow: auto; height: "+(a.clientHeight-130).toString()+"px; }"):(b=B("div.atiAttributes",this.map.infoWindow.domNode)[0],c=".mainSection { overflow-y: none; }",d=".atiAttributes {overflow: none; }");a.clientHeight&&b&&(a=document.createElement("style"),a.type="text/css",a.id="_tempMainSectionOverride",b.appendChild(a),a.sheet.insertRule(c,0),a.sheet.insertRule(d,1))},_updateUI:function(a){this._getStyleColor(a)},_updateFontColor:function(a){"undefined"===
typeof a&&(a=this.appConfig);a=e.create("div",{id:"tempTitle",innerHTML:a.title}).getElementsByTagName("font");this.config.fontColor=a&&0<a.length?/^#[0-9A-F]{6}$/i.test(a[0].color)?a[0].color:"#ffffff":"#ffffff";e.destroy("tempTitle");a=document.querySelectorAll(".panelBottom ");for(var b=0;b<a.length;b++)a[b].style.color=this.config.fontColor},_updateButtonBackgrounds:function(a,b){m.forEach(this.imgContainer.children,function(c){if(s.contains(c.children[0],a?"btn32img":"btn32imgBlack"))s.remove(c.children[0],
a?"btn32img":"btn32imgBlack");s.add(c.children[0],a?"btn32imgBlack":"btn32img");if(s.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground"))s.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");s.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")});m.forEach(this.saveOptions.children,function(c){if(s.contains(c.children[0],a?"btn32img":"btn32imgBlack"))s.remove(c.children[0],a?"btn32img":"btn32imgBlack");s.add(c.children[0],a?"btn32imgBlack":"btn32img");
if(s.contains(c.children[0],b?"darkThemeBackground":"lightThemeBackground"))s.remove(c.children[0],b?"darkThemeBackground":"lightThemeBackground");s.add(c.children[0],b?"lightThemeBackground":"darkThemeBackground")})},_getStyleColor:function(b){this._updateFontColor(b);setTimeout(a.hitch(this,function(){var a=window.getComputedStyle(this.footerNode,null).getPropertyValue("background-color");this.config.activeMapGraphicColor=a;a=g.fromRgb(a);this.lightTheme=210>0.2126*a.r+0.7152*a.g+0.0722*a.b?!1:
!0;this.config.color=a.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(s.remove(this.tabNodes[this.curTab],"active"),s.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor="rgb(53, 53, 53)"):(s.remove(this.tabNodes[this.curTab],"activeBlack"),s.add(this.tabNodes[this.curTab],"active"),this.config.activeColor=
"rgba(39, 39, 39, 0.3)");this._setupSymbols();this.dataValue&&(this._drawIncident(this.dataValue),this.dataValue=void 0);this._bufferIncident()}),300)},updateActiveNodes:function(a,b){var c,d,e;b?(c=[".SATcolLocate",".SATcol",".SATcolRec",".SATcol2",".SATcolSmall"],d="lightThemeBorder",e="darkThemeBorder"):(c=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),d="lightThemeBackground",e="darkThemeBackground");m.forEach(c,function(b){b=B(b);for(var c=0;c<b.length;c++){var f=
b[c];s.remove(f,a?e:d);s.add(f,a?d:e)}})},setPosition:function(a,b){if(this.widgetActive){var c,e,g=f.byId("map");"TabTheme"===this.appConfig.theme.name?(e=this.widgetManager.getControllerWidgets()[0],this.position=c={left:e.domNode.clientWidth?e.domNode.clientWidth.toString()+"px":"54px",right:"0",bottom:"24px",height:"155px",relativeTo:"browser"},c=d.getPositionStyle(this.position),c.position="absolute",u.place(this.domNode,window.jimuConfig.layoutId),u.setStyle(this.domNode,c),this.started&&this.resize(),
g.style.bottom="155px",this.map.resize(!0),"TabTheme"===this.appConfig.theme.name&&this.widgetManager.minimizeWidget(e.id)):(this.position=c={left:"0",right:"0",bottom:"0",height:"155px",relativeTo:"browser"},c=d.getPositionStyle(this.position),c.position="absolute",u.place(this.domNode,window.jimuConfig.layoutId),u.setStyle(this.domNode,c),this.started&&this.resize(),g.style.bottom="155px",this.map.resize(!0))}},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&
this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(a){var b=this.map.infoWindow.getSelectedFeature();if(a&&"add"===a.type)b={eventType:"IncidentLocationAdd",dataValue:b},this.incidents=[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();else{for(var c=!0,d,e=0;e<this.lyrIncidents.graphics.length;e++){var f=this.lyrIncidents.graphics[e];if(f.geometry.type===b.geometry.type){var g=!z.equals(f.geometry,b.geometry);f.attributes&&(b.attributes&&!g)&&(g=g&&A.stringify(f.attributes)===
A.stringify(b.attributes));c=c&&g;g||(d=f)}}b={eventType:c?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:b,removeGraphic:d}}this.onReceiveData("","",b);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();a&&(a=this.map.infoWindow,a.popupNavigationBar&&(b=B(".esriMobileNavigationBar",a.popupNavigationBar.domNode),0<b.length&&u.setStyle(b[0],"display","none")),a.popupInfoView&&(b=B(".esriMobileInfoView",a.popupInfoView.domNode),0<b.length&&u.setStyle(b[0],"display","none")))},_initLayers:function(){this.gsvc=
new X(this.config.geometryService.url);this.locator=new S(this.config.geocodeService.url);this.own(b(this.locator,"location-to-address-complete",a.hitch(this,this._showIncidentAddress)));this.own(b(this.locator,"error",a.hitch(this,this._onAddressError)));this.lyrBuffer=new K;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new K;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new K;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new K;this.lyrProximity.setVisibility(!1);
this.map.addLayer(this.lyrProximity);this.summaryDisplayEnabled&&(this.lyrSummary=new K,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),this.lyrGroupedSummary=new K,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary))},_mapLoaded:function(){B("[data-reference]").style("z-index",0);this.map.itemId&&c.getInstance(this.map,this.map.itemInfo).then(a.hitch(this,function(c){this.opLayers=c;this._processOperationalLayers();if(this.saveEnabled){c=this.map.infoWindow;
this.config.saveEnabled&&("undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints)&&(this.config.savePolys=!0,this.config.polyEditLayer=this.config.editLayer,this.polyTemplate=this.config.editTemplate,this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,"point");this.config.saveLines&&this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,
"poly");this.scSignal=b(c,"selection-change",a.hitch(this,this._selectionChanged));this.sfSignal=b(c,"set-features",a.hitch(this,this._setPopupFeature));var d=B(".esriPopupWrapper",c.domNode);0<d.length&&("undefined"!==typeof d[0].clientHeight&&"undefined"!==typeof d[0].clientWidth)&&(this.defaultPopupSize={width:d[0].clientWidth});c.highlight=!0}}));var d=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];if("ArcGISTiledMapServiceLayer"!==d.layerType||!d.resourceInfo.singleFusedMapCache)this.config.defaultZoomLevel=
0.5;this._clickTab(0)},_initEditLayer:function(c,d){var e;"point"===d?(this.pointEditLayer=this.opLayers.getLayerInfoById(c).layerObject,this.isPointEditable=this._isEditable(this.pointEditLayer),e=this.pointEditLayer,e.templates&&0<e.templates.length?this.pointTemplate=e.templates[0]:e.types&&0<e.types.length&&(this.pointTemplate=e.types[0].templates[0]),this.pointTemplate&&(this.pointEditLayerPrototype=this.pointTemplate.prototype)):"line"===d?(this.lineEditLayer=this.opLayers.getLayerInfoById(c).layerObject,
this.isLineEditable=this._isEditable(this.lineEditLayer),e=this.lineEditLayer,e.templates&&0<e.templates.length?this.lineTemplate=e.templates[0]:e.types&&0<e.types.length&&(this.lineTemplate=e.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=this.lineTemplate.prototype)):"poly"===d&&(this.polyEditLayer=this.opLayers.getLayerInfoById(c).layerObject,this.isPolyEditable=this._isEditable(this.polyEditLayer),e=this.polyEditLayer,this.honorTemplate||(e.templates&&0<e.templates.length?
this.polyTemplate=e.templates[0]:e.types&&0<e.types.length&&(this.polyTemplate=e.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=this.polyTemplate.prototype));e&&this.own(b(e,"click",a.hitch(this,function(a){if(a.graphic)switch(a=a.graphic,a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "polygon":this.polyUpdateFeature=a}})))},_isEditable:function(a){var b=!1;a.isEditable()&&a.getEditCapabilities&&(b=a.getEditCapabilities());
return b&&b.canUpdate&&b.canCreate},_initEditInfo:function(){if(this.saveEnabled){var b=!1;this.polyEditLayer&&this.isPolyEditable&&(b=!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(a.hitch(this,this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(b=!0,this.defaultLineContent=this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:void 0,this.lineEditLayer.infoTemplate.setContent(a.hitch(this,
this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(b=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(a.hitch(this,this._setEditLayerPopup)));b&&this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=
a;break;case "poly":this.polyUpdateFeature=a}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var a=this.map.infoWindow.getSelectedFeature();switch(a.geometry.type){case "point":this.pointUpdateFeature=a;break;case "polyline":this.lineUpdateFeature=a;break;case "poly":this.polyUpdateFeature=a}}},_setEditLayerPopup:function(c){var d;"polygon"===c.geometry.type&&(d=this.polyEditLayer);"polyline"===c.geometry.type&&(d=this.lineEditLayer);"point"===c.geometry.type&&(d=this.pointEditLayer);
for(var f=[],g=this._getPopupFields(d),k=0;k<g.length;k++){var l=g[k];l.isEditable&&l.isEditableOnLayer&&f.push({fieldName:l.fieldName,isEditable:l.isEditable})}this.attInspector=new Y({layerInfos:[{featureLayer:d,showAttachments:!1,isEditable:!0,fieldInfos:f}]},e.create("div"));f=new n({label:this.nls.update_btn},e.create("div"));e.place(f.domNode,this.attInspector.deleteBtn.domNode.parentNode);this.own(b(f,"click",a.hitch(this,function(){d.applyEdits(null,[c],null,a.hitch(this,function(){this.map.infoWindow.hide()}),
function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new h({message:b})})})));this.own(b(this.attInspector,"attribute-change",a.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;this.pointUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polyline":this.lineUpdateFeature=a.feature;this.lineUpdateFeature.attributes[a.fieldName]=a.fieldValue;break;case "polygon":this.polyUpdateFeature=
a.feature,this.polyUpdateFeature.attributes[a.fieldName]=a.fieldValue}})));this.own(b(this.attInspector,"next",a.hitch(this,function(a){switch(a.feature.geometry.type){case "point":this.pointUpdateFeature=a.feature;break;case "polyline":this.pointUpdateFeature=a.feature;break;case "poly":this.pointUpdateFeature=a.feature}})));this.own(b(this.attInspector,"delete",a.hitch(this,function(a){var b=!1;if(0<this.incidents.length){for(var c=0;c<this.incidents.length;c++)z.equals(a.feature.geometry,this.incidents[c].geometry)&&
(b=!0);if(!b&&0<this.lyrBuffer.graphics.length)for(c=0;c<length;c++)z.equals(a.feature.geometry,this.lyrBuffer.graphics[c].geometry)&&(b=!0)}d.applyEdits(null,null,[a.feature],function(){},function(a){var b="Error";"undefined"!==typeof a.details&&(b=a.details);"undefined"!==typeof a.message&&(b=a.message);new h({message:b})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=
this.polyEditLayerPrototype);b&&this._clear();this.map.infoWindow.hide()})));switch(c.geometry.type){case "point":this.pointUpdateFeature=c;break;case "polyline":this.lineUpdateFeature=c;break;case "polygon":this.polyUpdateFeature=c}this.attInspector.showFeature(c);return this.attInspector.domNode},_getPopupFields:function(a){var b;if(a.infoTemplate)b=a.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var c=this.tab.tabLayers[0].url.split("MapServer/")[1],d=
this.parent.map.itemInfo.itemData.operationalLayers;b=null;for(var e=0;e<d.length;e++){var f=d[e];if(f.layerObject.infoTemplates&&(f=f.layerObject.infoTemplates[c])){b=f.infoTemplate.info.fieldInfos;break}}}else b=a.fields;b||(b=a.fields);return b},_updatePopup:function(b,c,d){c=[];for(d=0;d<b.length;d++){var e=b[d],f=new $;f.objectIds=[e.oid];c.push(e.layer.selectFeatures(f,H.SELECTION_NEW))}(new Q(c)).then(a.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d[0]){d=d[1][0];b.push(d);
switch(d.geometry.type){case "point":this.pointUpdateFeature=d;break;case "polyline":this.lineUpdateFeature=d;break;case "poly":this.polyUpdateFeature=d}this.attInspector||this._setEditLayerPopup(d);this.attInspector&&this.attInspector.showFeature(d)}}}))},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];b.layers&&""!==b.layers&&(this.hasLayerTitle="undefined"!==typeof b.layerTitle,b.tabLayers=this._getTabLayers(b.layers))}},_createUI:function(){var c=
d.stripHTML(this.config.bufferLabel?this.config.bufferLabel:"");this.buffer_lbl.innerHTML=c;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];c=this.config.bufferRange.minimum;this.spinnerValue.set("data-dojo-props","constrains: {min: "+c+", max: "+this.config.bufferRange.maximum+"}, intermediateChanges: true, places:0");this.spinnerValue.set("value",c);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;
this.config.tabs.splice(0,0,{type:"incidents",label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);for(var c=this.panelContainer,f=this.tabsNode,g=0,h=0;h<this.config.tabs.length;h++){var k=this.config.tabs[h],l=k.label;"weather"===k.type&&(l=this.nls.weather);if(!l||""===l)l=k.layerTitle?k.layerTitle:k.layers;l=e.create("div",{"data-dojo-attach-point":"SA_tab"+h,innerHTML:d.stripHTML(l?l:
"")},f);this.tabNodes.push(l);s.add(l,"SATTab");g+=D.position(l).w;b(l,"click",a.hitch(this,this._clickTab,h));0<h&&(l=e.create("div",{"data-dojo-attach-point":"SA_tabPanel"+h,innerHTML:""},c),this.panelNodes.push(l),s.add(l,"SAT_tabPanel"),"summary"===k.type&&(k.summaryInfo=new aa(k,l,this),this.own(b(k.summaryInfo,"summary-complete",a.hitch(this,this.restore)))),"groupedSummary"===k.type&&(k.groupedSummaryInfo=new ba(k,l,this),this.own(b(k.groupedSummaryInfo,"summary-complete",a.hitch(this,this.restore)))),
"weather"===k.type&&(k.weatherInfo=new ca(k,l,this)),"closest"===k.type&&(k.closestInfo=new da(k,l,this)),"proximity"===k.type&&(k.proximityInfo=new ea(k,l,this)))}g+=10;t.set(f,"width",g+"px");g>D.position(this.footerNode).w&&(t.set(this.footerContentNode,"right","58px"),t.set(this.panelRight,"display","block"));b(f,"scroll",a.hitch(this,this._onPanelScroll))},restore:function(a){a.tab===this.curTab&&this._clickTab(a.tab)},validateSavePrivileges:function(){var a=new w;a.resolve(!0);return a},validateSnapshotPrivileges:function(){var b=
new w;k.getPortal(this.appConfig.portalUrl).getUser().then(a.hitch(this,function(a){b.resolve(-1<a.privileges.indexOf("portal:publisher:publishFeatures")&&-1<a.privileges.indexOf("portal:user:createItem")?!0:!1)}),a.hitch(this,function(a){console.log(a);b.resolve(!1)}));return b},_loadUI:function(){var c={"0":this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];var d=e.create("span",{"class":"btn32 displayT"},this.saveOptions);this.downloadAllButon=
e.create("div",{"class":"downloadAll",title:this.nls.downloadAll},d);this.own(b(this.downloadAllButon,"click",a.hitch(this,this._downloadAll)));this.saveEnabled&&(this.saveButtonSpan=e.create("span",{"class":"btn32 displayT"},this.saveOptions),this.validateSavePrivileges().then(a.hitch(this,function(c){this.saveButton=e.create("div",{"class":c?"save":"save btnDisabled",title:c?this.nls.saveIncident:this.nls.user_credentials},this.saveButtonSpan);c&&this.own(b(this.saveButton,"click",a.hitch(this,
this._saveIncident)))}),function(a){console.log(a)}));this.snapshotEnabled&&(this.createSnapshotButtonSpan=e.create("span",{"class":"btn32 displayT"},this.saveOptions),this.validateSnapshotPrivileges().then(a.hitch(this,function(c){this.createSnapshotButton=e.create("div",{"class":c?"snapshot":"snapshot btnDisabled",title:c?this.nls.createSnapshot:this.nls.user_credentials},this.createSnapshotButtonSpan);c&&this.own(b(this.createSnapshotButton,"click",a.hitch(this,this._createSnapshot)))}),function(a){console.log(a)}));
for(d=0;3>d;d++){var f=this.btnNodes[d];u.setAttr(f,"src",this.folderUrl+"images/btn"+d+".png");u.setAttr(f,"title",c[d]);this.own(b(f,"click",a.hitch(this,this._clickIncidentsButton,d)))}this.toolbar=new U(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",a.hitch(this,this._drawIncident));this.own(b(this.spinnerValue,"change",a.hitch(this,this._sliderTextChange)));this.own(b(this.spinnerValue,"blur",a.hitch(this,function(a){this._updateSpinnerValue(!0)})));this.own(b(this.spinnerValue,
"keyup",a.hitch(this,function(a){a.keyCode===ga.ENTER?this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(a){var b;if(3>a){for(var c=0;3>c;c++)b=this.btnNodes[c],s.remove(b,"btnOn");-1<a&&a!==this.tool?(b=this.btnNodes[a],
3>a&&s.add(b,"btnOn"),this.tool=a):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear();this.toolbar.activate(U.POINT);this.disableWebMapPopup();break;case 1:this._clear();this.toolbar.activate(U.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(),this.toolbar.activate(U.POLYGON),this.disableWebMapPopup()}}else this._clear()},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,!0,"save");
var a=[];this.config.saveEnabled&&("undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints)&&(this.config.savePolys=!0);if(this.config.savePolys){var b=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<b.length&&a.push({layer:this.polyEditLayer,graphics:b})}this.config.saveLines&&(b=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<b.length&&a.push({layer:this.lineEditLayer,graphics:b}));
this.config.savePoints&&(b=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<b.length&&a.push({layer:this.pointEditLayer,graphics:b}));0<a.length?this._applyEdits(a):this._updateProcessing(this.saveButton,!1,"save");this._clickIncidentsButton(-1)},_getIncidentGraphics:function(a,b){var c=[],d=A.parse(A.stringify(b));if("polygon"===a)for(var e=0;e<this.lyrBuffer.graphics.length;e++){var f=this.lyrBuffer.graphics[e],g=new G;g.geometry=f.geometry;g.setAttributes(d.attributes);c.push(g)}for(e=
0;e<this.incidents.length;e++)f=this.incidents[e],f.geometry.type===a&&(g=new G,g.geometry=f.geometry,g.setAttributes(d.attributes),c.push(g));return c},_applyEdits:function(b){for(var c=new w,d=[],e=[],f=0;f<b.length;f++){var g=b[f];g.layer.visible||g.layer.setVisibility(!0);var k=[];if(1<g.graphics.length&&"polygon"===g.graphics[0].geometry.type){var l=g.graphics[0],m=g.graphics.map(function(a){return a.geometry});if(m=z.union(m))l.geometry=m,k.push(l)}d.push(g.layer.applyEdits(0<k.length?k:g.graphics,
null,null))}(new Q(d)).then(a.hitch(this,function(a){for(var d=!1,f=0;f<a.length;f++){var g=a[f][1][0];g.success&&(d=!0,g.hasOwnProperty("objectId")&&e.push({oid:g.objectId,layer:b[f].layer}))}if(!this.map.infoWindow.isShowing){a=this.incidents[0].geometry;var h;switch(a.type){case "point":h=a;break;case "polyline":h=a.paths[0][parseInt(a.paths[0].length/2,10)];h=new I(h[0],h[1],a.spatialReference);break;case "polygon":h=a.getCentroid()}a=this.map.toScreen(h);0<e.length&&this._updatePopup(e,h,a);
this._updateProcessing(this.saveButton,!1,"save");this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:a,mapPoint:h})}c.resolve(d)}),a.hitch(this,function(a){console.error(a);this._updateProcessing(this.saveButton,!1,"save");new h({message:a});c.reject(a)}));return c},_clear:function(){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();
this.summaryDisplayEnabled&&this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();s.remove(this.saveOptions,"displayT");s.add(this.saveOptions,"display-off");s.remove(this.clearIncident,"display-on");s.add(this.clearIncident,"display-off");this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML="");this.div_reverse_geocoding&&u.setStyle(this.div_reverse_geocoding,"visibility","hidden");this._updateCounts(!0);this._clearGraphics();this.pointEditLayer&&(this.pointUpdateFeature=
this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){e.destroy(f.byId("_tempMainSectionOverride"))},_sliderTextChange:function(){this._bufferIncident()},_updateSpinnerValue:function(a){var b=this.spinnerValue.displayedValue;isNaN(b);"string"===typeof b&&(b=parseInt(b,10));b<this.config.bufferRange.minimum?
this.spinnerValue.set("value",this.config.bufferRange.minimum):b>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);a&&this._bufferIncident()},_clickTab:function(a){this._validateFeatureCount(a)&&(this._toggleTabs(a),this._toggleTabLayers(a),this.curTab=a,this._clickIncidentsButton(-1))},_validateFeatureCount:function(a){var b=!0;a=this.config.tabs[a];switch(a.type){case "summary":b=0<a.summaryInfo.featureCount;break;case "groupedSummary":b=0<a.groupedSummaryInfo.featureCount;
break;case "weather":b=0<this.incidents.length;break;case "closest":b=0<a.closestInfo.featureCount;break;case "proximity":b=0<a.proximityInfo.featureCount}return b},_toggleTabs:function(a){for(var b=0;b<this.config.tabs.length;b++)b===a?(s.add(this.tabNodes[b],this.isBlackTheme?"activeBlack":"active"),t.set(this.panelNodes[b],"display","block")):(s.remove(this.tabNodes[b],"active"),s.remove(this.tabNodes[b],"activeBlack"),t.set(this.panelNodes[b],"display","none"));this._scrollToTab(a)},_toggleTabLayers:function(a){this._toggleTabLayersOld();
this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),a.tabLayers&&m.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}))},_toggleTabLayersNew:function(b){var c=this.config.tabs[b];switch(c.type){case "summary":var d=!1;this.lyrSummary&&
(this.currentSumLayer!==b&&(d=!0),this.lyrSummary.clear());c.tabLayers&&1<c.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=c.tabLayers[1].infoTemplate,m.forEach(c.tabLayers[1].graphics,a.hitch(this,function(a){this.lyrSummary.add(a)})),this.lyrSummary.setVisibility(!0)),d&&(this.currentSumLayer=b,this._toggleTabLayersNew(b)));0<this.incidents.length&&!0===c.updateFlag&&(c.summaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,b),
c.updateFlag=!1,this.currentSumLayer=b);break;case "groupedSummary":this.lyrGroupedSummary&&(this.currentSumLayer!==b&&(d=!0),this.lyrGroupedSummary.clear());c.tabLayers&&1<c.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=c.tabLayers[1].infoTemplate,m.forEach(c.tabLayers[1].graphics,a.hitch(this,function(a){this.lyrGroupedSummary.add(a)})),this.lyrGroupedSummary.setVisibility(!0)),d&&(this.currentSumLayer=b,this._toggleTabLayersNew(b)));0<this.incidents.length&&!0===
c.updateFlag&&(c.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrGroupedSummary:null,b),c.updateFlag=!1,this.currentGrpLayer=b);break;case "weather":c.tabLayers&&m.forEach(c.tabLayers,function(a){a.setVisibility(!0)});0<this.incidents.length&&!0===c.updateFlag&&(c.weatherInfo.updateForIncident(this.incidents),c.updateFlag=!1);break;case "closest":c.tabLayers&&m.forEach(c.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)});
this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(c.closestInfo&&c.closestInfo.container&&(c.closestInfo.container.innerHTML="",s.add(c.closestInfo.container,"loading")),!1===c.updateFlag&&this.lyrClosest.clear(),c.closestInfo.updateForIncident(this.incidents,this.config.maxDistance,this.lyrClosest),c.updateFlag=!1);break;case "proximity":c.tabLayers&&m.forEach(c.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)}),this.lyrProximity.setVisibility(!0),0<this.incidents.length&&
(c.proximityInfo&&c.proximityInfo.container&&(c.proximityInfo.container.innerHTML="",s.add(c.proximityInfo.container,"loading")),!1===c.updateFlag&&this.lyrProximity.clear(),c.proximityInfo.updateForIncident(this.incidents,this.buffers,this.lyrProximity),c.updateFlag=!1)}c.updateFlag=!1},_drawIncident:function(a,b,c){a=Array.isArray(a)?a:[a];for(var d=!1,e=0;e<a.length;e++){var f=a[e],g=f.geometry.type;null===this.symPoint&&this._getStyleColor();var h=this.symPoint;"polyline"===g&&(h=this.symLine,
d=this.isLineEditable);"polygon"===g&&(h=this.symPoly,d=this.isPolyEditable);"point"===g&&(this._getIncidentAddress(f.geometry),d=this.isPointEditable);f=new G(f.geometry,h,f.attributes,f.infoTemplate);this.incidents.push(f);this.lyrIncidents.add(f)}this.div_reversed_address.innerHTML="";u.setStyle(this.div_reverse_geocoding,"visibility","hidden");this.toolbar.deactivate();this._clickIncidentsButton(-1);this.saveEnabled&&(s.remove(this.saveButton,"display-off"),d&&s.contains(this.saveButton,"btnDisabled")&&
s.remove(this.saveButton,"btnDisabled"),s.add(this.saveButton,d?"displayT":"displayT btnDisabled"));s.remove(this.saveOptions,"display-off");s.add(this.saveOptions,"displayT");s.remove(this.clearIncident,"display-off");s.add(this.clearIncident,"display-on");this._bufferIncident(b,c)},_getIncidentAddress:function(a){this.map.graphics.clear();this.locator.locationToAddress(p.webMercatorToGeographic(a),100)},_showIncidentAddress:function(a){if(a.address.address){var b=a.address.address.Address,c=p.geographicToWebMercator(a.address.location),
d=new E;d.family="Arial";d.size="18px";d=new L(b,d,new O("#000000"));d.setOffset(20,-4);d.horizontalAlignment="left";this.map.graphics.add(new G(c,d,{}));this.div_reversed_address.innerHTML=b+"\x3c/br\x3e"+a.address.address.City+", "+a.address.address.Region+" "+a.address.address.Postal;u.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;u.setStyle(this.div_reverse_geocoding,"visibility","visible")},
_bufferIncident:function(a,b){if(0!==this.incidents.length){for(var c=0;c<this.config.tabs.length;c++)this.config.tabs[c].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();for(var c=!1,d=0;d<this.incidents.length;d++){var e=this.incidents[d],f=this.spinnerValue.get("value"),g=this.config.distanceSettings[this.config.distanceUnits];if(0<f){var h=e.geometry.spatialReference.wkid,e=(4326===h||3857===h||102100===h)&&!this.isSafari?z.geodesicBuffer(e.geometry,f,g):z.buffer(e.geometry,f,g);this.buffers.push(e)}else a=
!1,e=e.geometry.type,"polyline"===e&&!c&&(c=this.isLineEditable),"polygon"===e&&!c&&(c=this.isPolyEditable),"point"===e&&!c&&(c=this.isPointEditable)}0<this.buffers.length?(this.saveEnabled&&(s.remove(this.saveButton,"display-off"),s.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&s.remove(this.saveButton,"btnDisabled"),s.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,a)):(this.saveEnabled&&(c?s.contains(this.saveButton,"btnDisabled")&&s.remove(this.saveButton,"btnDisabled"):
s.add(this.saveButton,"btnDisabled")),this.zoomToIncidents(b))}},_handleBuffers:function(a,b){this.bufferLookUp=[];for(var c=0;c<this.buffers.length;c++){var d=new G(this.buffers[c],a);this.lyrBuffer.add(d);this.bufferLookUp[c]=d}b||this._locateBuffer(z.union(this.buffers));this._performAnalysis()},_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},_updateCounts:function(a){for(var b=0;b<this.config.tabs.length;b++){a&&0<b&&this.panelNodes[b]&&(this.panelNodes[b].innerHTML=
"");var c=this.config.tabs[b],d=this.tabNodes[b],e=null,f=!1;c.advStat&&c.advStat.stats&&("undefined"!==typeof c.advStat.stats.tabCount?f=c.advStat.stats.tabCount:c.advStat.stats.count&&(f=!0));"proximity"===c.type?e=c.proximityInfo:"closest"===c.type?e=c.closestInfo:"summary"===c.type?e=c.summaryInfo:"groupedSummary"===c.type?e=c.groupedSummaryInfo:"weather"===c.type&&(e=c.weatherInfo);e&&(a?("undefined"!==typeof e.incidentCount&&(e.incidentCount=0),e.updateTabCount(0,d,f)):e.queryTabCount(this.incidents,
this.buffers,d,f))}},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var b=this.appConfig.getConfigElementsByName("Directions");m.forEach(b,a.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var b=this.appConfig.getConfigElementsByName("AttributeTable");m.forEach(b,a.hitch(this,function(a){"AttributeTable"===a.name&&(this.attributeTable=a)}))},zoomToIncidents:function(a){var b,c=!1;
if(0<this.incidents.length){var d;1<this.buffers.length?d=z.union(this.buffers):1===this.buffers.length&&(d=this.buffers[0]);b=this.incidents;var e;d&&(c=!0,e=new G(d,d.spatialReference),b.push(e));this.geomExtent=J.graphicsExtent(this.incidents);e&&e.destroy&&e.destroy()}"undefined"===typeof a&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):b&&(a=b[0].geometry&&"point"===b[0].geometry.type?b[0].geometry:b[0].geometry.getCentroid(),this.map.centerAndZoom(a,this.config.defaultZoomLevel)));
if(!c){for(a=0;a<this.incidents.length;a++)if("polygon"===this.incidents[a].geometry.type){c=!0;break}this._performAnalysis()}c&&this._performAnalysis()},zoomToLocation:function(a){var b;if(0.5===this.config.defaultZoomLevel){var c;if(0<this.buffers.length)c=z.union(this.buffers)._extent;else if(0<this.incidents.length){for(var d=[],e=[],f=[],g=0;g<this.incidents.length;g++){var h=this.incidents[g];switch(h.geometry.type){case "point":d.push(h.geometry._extent);break;case "polyline":e.push(h.geometry);
break;case "polygon":f.push(h.geometry)}}g=[];0<d.length&&g.push(z.union(d)._extent);0<e.length&&g.push(z.union(e)._extent);0<f.length&&g.push(z.union(f)._extent);if(1<g.length)c=z.union(g)._extent;else if(1===g.length&&(1<d.length||0<e.length||0<f.length))c=g[0]}c&&(b=c.expand(0.5))}"undefined"===typeof a&&(a=b.getCentroid());b&&this.map.setExtent(b);this.map.centerAt(a)},routeToIncident:function(b){var c=this.incidents[0].geometry,d=c;"point"!==c.type&&(d=null);this.stops=[d,b];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(a.hitch(this,
function(b){if(b&&"closed"!==b.state){var c=b._dijitDirections;c?this._addStops(c):b.getDirectionsDijit().then(a.hitch(this,function(a){this._addStops(a)}))}}))},_addStops:function(a){a.clearDirections();a.removeStops();a.reset();a.addStops(this.stops)},_getTabLayers:function(b){var c=[];m.forEach(this.opLayers._layerInfos,a.hitch(this,function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,c,b);else{var d=this.hasLayerTitle?a.id:a.title;if(Array.isArray(b)?-1<b.indexOf(d):b===
d)c.push(a.layerObject),"undefined"!==typeof a.layerObject.visible&&!a.layerObject.visible&&(a.layerObject.setVisibility(!0),a.layerObject.setVisibility(!1))}}));return c},_recurseOpLayers:function(b,c,d){m.forEach(b,a.hitch(this,function(a){if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,c,d);else{var b=this.hasLayerTitle?a.id:a.title;(Array.isArray(d)?-1<d.indexOf(b):d===b)&&c.push(a.layerObject)}}))},_setupSymbols:function(){var a=g.fromString(this.config.color),b=a.toRgb();b.push(0.2);
var c=g.fromString("#000000"),a=g.blendColors(a,c,0.2).toRgb(),c=new F(F.STYLE_SOLID,new g([255,255,255,0.25]),1);this.symPoint=new T(T.STYLE_CIRCLE,20,c,new g([a[0],a[1],a[2],0.7]));this.symLine=new F(F.STYLE_SOLID,new g([a[0],a[1],a[2],0.7]),3);this.symPoly=new P(P.STYLE_SOLID,this.symLine,new g([a[0],a[1],a[2],0.3]));this.symBuffer=new P(P.STYLE_SOLID,c,new g(b));this.symSelection=new P(P.STYLE_NULL,new F(F.STYLE_SOLID,new g([0,255,255]),2),new g([0,0,0,0]))},onReceiveData:function(a,b,c){null!==
c&&c.eventType&&("IncidentLocationAdd"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=c.dataValue:this._drawIncident(c.dataValue)):"IncidentLocationRemove"===c.eventType?(a=this.incidents.indexOf(c.removeGraphic),this.incidents.splice(a,1),this.lyrIncidents.remove(c.removeGraphic),this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[a]),this.bufferLookUp.splice(a,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(a,
1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=!0,this._performAnalysis()):this._clear()):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<this.incidents.length){for(var a=[],b=0;b<this.incidents.length;b++)a.push(A.stringify(this.incidents[b].geometry.toJson()));a={location:A.stringify(a),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,
extent:A.stringify(this.map.extent.toJson())};a=A.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Incident saved to storage")}},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var a=A.parse(a,!0),b=a.buffer_dist,c=A.parse(a.location);this.curTab=a.curTab;for(var d=[],e=0;e<c.length;e++)d.push({geometry:y.fromJson(A.parse(c[e]))});
this.spinnerValue.set("value",b);for(b=0;b<this.config.tabs.length;b++)this.config.tabs[b].restore=!0;this._drawIncident(d,!0,!0);this._clickTab(0,!0);this._toggleTabs(a.curTab);this._toggleTabLayers(a.curTab);this.curTab=a.curTab;this._clickIncidentsButton(-1);this._updateW();a=y.fromJson(A.parse(a.extent));z.equals(a,this.map.extent)||this.map.setExtent(a,!1)}else s.remove(this.saveOptions,"displayT"),s.add(this.saveOptions,"display-off"),s.remove(this.clearIncident,"display-on"),s.add(this.clearIncident,
"display-off")},_updateW:function(){for(var a=0,b=0;b<this.tabNodes.length;b++)a+=D.position(this.tabNodes[b]).w;a+=10;t.set(this.tabsNode,"width",a+"px");a>D.position(this.footerNode).w&&(t.set(this.footerContentNode,"right","58px"),t.set(this.panelRight,"display","block"))},_mapResize:function(){var a;if(this.attributeTable){var b=f.byId(this.attributeTable.id);b&&(a=parseInt(b.style.height.toString().replace("px",""),10))}var b=f.byId("map"),c=parseInt(b.style.bottom.toString().replace("px",""),
10);if("opened"===this.state||"active"===this.state){var d=parseInt(this.position.height.toString().replace("px",""),10),e=parseInt(this.position.bottom.toString().replace("px",""),10),d=d+e,e=!1;if(d>a){if(this.mapBottom!==d||this.mapBottom!==c)e=!0,this.mapBottom=d}else if(a>d&&(this.mapBottom!==a||this.mapBottom!==c))e=!0,this.mapBottom=a;e&&(b.style.bottom=this.mapBottom.toString()+"px",this.map.resize(!1),this.map.reposition())}else b.style.bottom="undefined"!==typeof a?a.toString()+"px":"0px",
this.map.resize(!0),this.map.reposition()},_resize:function(a){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(),this._initEditInfo(),this._checkHideContainer()}catch(b){console.log(b)}},_onPanelScroll:function(a){var b,c,d,e;a=this.footerContentNode.getBoundingClientRect();for(var f=0;f<this.tabsNode.children.length;f++)if(e=this.tabsNode.children[f],e=e.getBoundingClientRect(),0<=e.left){b=f;d=e.left;break}for(f=
0;f<this.tabsNode.children.length;f++)if(e=this.tabsNode.children[f],e=e.getBoundingClientRect(),e.right>a.right){c=f;break}a=this.footerContentNode;c=c<=this.tabsNode.children.length;t.set(a,"right",c?"58px":"24px");t.set(this.panelRight,"display",c?"block":"none");c=34;"TabTheme"===this.appConfig.theme.name&&(c+=54);b=1<=b||d>c;t.set(a,"left",b?"34px":"0px");t.set(this.panelLeft,"display",b?"block":"none");t.set(this.panelLeft,"width",b?"34px":"0px")},_scrollToTab:function(a){var b=D.position(this.footerContentNode).w;
if(D.position(this.tabsNode).w>b){var c=D.getMarginBox(this.tabNodes[a]);this.footerContentNode.scrollLeft=c.l-(b-c.w)/2}this._onPanelScroll(a)},_navLeft:function(a){},_navRight:function(a){},_navTabsLeft:function(a){this._navTabs(!1)},_navTabsRight:function(a){this._navTabs(!0)},_navTabs:function(a){for(var b=this.footerContentNode.getBoundingClientRect(),c=0;c<this.tabsNode.children.length;c++){var d=this.tabsNode.children[c].getBoundingClientRect();if(a){if(d.right>b.right){this._scrollToTab(c);
break}}else if(0<d.right){this._scrollToTab(c);break}}},_storeInitalVisibility:function(){m.forEach(this.config.tabs,a.hitch(this,function(b){m.forEach(b.tabLayers,a.hitch(this,function(a){"undefined"!==typeof a.visible&&(a.id in this.initalLayerVisibility||(this.initalLayerVisibility[a.id]=a.visible),a.setVisibility(!1))}))}))},_resetInitalVisibility:function(){m.forEach(this.config.tabs,a.hitch(this,function(b){m.forEach(b.tabLayers,a.hitch(this,function(a){"undefined"!==typeof a.visible&&a.id in
this.initalLayerVisibility&&(a.setVisibility(this.initalLayerVisibility[a.id]),a.hasOwnProperty("visible")&&(a.visible=this.initalLayerVisibility[a.id]),a.redraw?a.redraw():a.refresh&&a.refresh())}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){m.forEach(this.config.tabs,a.hitch(this,function(a){if("summary"===a.type&&a.tabLayers&&1<a.tabLayers.length)for(var b=1;b<a.tabLayers.length;b++)a.tabLayers.pop()}))},_resetInfoWindow:function(){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);
this.defaultLineContent&&this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,"auto");this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var b=this.downloadAllButon.classList,c=!0,d=0;d<b.length;d++)if("btnDisabled"===b[d]){c=
!1;break}c&&(this._updateProcessing(this.downloadAllButon,!0,"downloadAll"),this._verifyIncident(!1)&&(b=this._getAnalysisObjects(),(new W(this)).createDownloadZip(b,this.incidents,this.buffers).then(a.hitch(this,function(a){this._updateProcessing(this.downloadAllButon,!1,"downloadAll")}),function(a){this._updateProcessing(this.downloadAllButon,!1,"downloadAll");new h({message:a.message})})))},_updateProcessing:function(a,b,c){s.remove(a,b?c:"snapshotProcessing");s.add(a,b?"snapshotProcessing":c)},
_getAnalysisObjects:function(){var a=["proximity","closest","summary","groupedSummary"],b=[];m.forEach(this.config.tabs,function(c){if(-1<a.indexOf(c.type)){var d;switch(c.type){case "proximity":d=c.proximityInfo;break;case "closest":d=c.closestInfo;break;case "summary":d=c.summaryInfo;break;case "groupedSummary":d=c.groupedSummaryInfo}var e="undefined"!==typeof c.layerTitle?c.layerTitle:c.layers;b.push({layerObject:c.tabLayers[0],label:""!==c.label?c.label:e,analysisObject:d,type:c.type})}});return b},
_verifyIncident:function(a){if(0===this.buffers.length){for(var b=!1,c=0;c<this.incidents.length;c++)if("polygon"===this.incidents[c].geometry.type){b=!0;break}b||new h({message:a?this.nls.notPolySnapShot:this.nls.notValidDownload});return b}return!0},getSnapshotName:function(){var c=new w,d=new fa({nls:this.nls}),e=new Z({width:300,autoHeight:!0,content:d,titleLabel:this.nls.snapshot_name});this.own(b(d,"ok",a.hitch(this,function(a){d.destroy();d=null;e.close();c.resolve(a)})));this.own(b(d,"cancel",
a.hitch(this,function(){d.destroy();d=null;e.close();c.resolve("cancel")})));return c},_createSnapshot:function(){for(var b=this.createSnapshotButton.classList,c=!0,d=0;d<b.length;d++)if("btnDisabled"===b[d]){c=!1;break}c&&this._verifyIncident(!0)&&this.getSnapshotName().then(a.hitch(this,function(b){if(b&&"cancel"!==b){this._updateProcessing(this.createSnapshotButton,!0,"snapshot");var c=[];c.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});0<this.buffers.length&&
c.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});c=c.concat(this._getAnalysisObjects());(new W(this)).createSnapShot({layers:c,incidents:this.incidents,buffers:this.buffers,time:Date.now(),name:b}).then(a.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,"snapshot")}),a.hitch(this,function(a){this._updateProcessing(this.createSnapshotButton,!1,"snapshot");new h({message:a.message})}))}else this._updateProcessing(this.createSnapshotButton,
!1,"snapshot")}))}})});